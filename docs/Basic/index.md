# Quick Start
## 1.安装系统
### 1.1 树莓派固件

有以下三种选择:
1. 树莓派官方提供的固件(64位或32位), [Download](https://www.raspberrypi.com/software/). 官方系统需要使用官方工具[Raspberry Pi Imager](https://downloads.raspberrypi.org/imager/imager_latest.exe)安装

2. [navio2](https://navio2.hipi.io/)提供的固件(含实时补丁32位),[Download](https://docs.emlid.com/navio2/configuring-raspberry-pi), 可以使用工具[Etcher](https://etcher.io/)安装.

3. 也可以使用其他系统如ubuntu, 但是我们没有进行测试. 

注意事项:

- 官方系统可自行打实时补丁, 也可以不打.
- 我们实测64位系统MPC运算能力提升很明显.

### 1.2 配置SSH和wifi连接
### 1.3 修改 /boot/config.txt文件为
```
[all] 
# enable sc16is752 overlay
dtoverlay=sc16is752-spi1
# enable I2C-0/1 and set the frequency to 400KHz
dtparam=i2c_arm=on,i2c_arm_baudrate=1000000
dtparam=i2c_vc=on,i2c_vc_baudrate=1000000
# enable spidev0.0
dtparam=spi=on
# enable RC input
enable_uart=1
# switch Bluetooth to miniuart
dtoverlay=miniuart-bt

[pi4]
force_turbo=0
arm_freq=1800
arm_freq_min=1500
```
使用**navio**的固件时候需要加
```
arm_freq=1800
arm_freq_min=1500
```
或者`force_turbo=1`来最大化性能。而**Rpi**官方版本系统经过测试不需要，当然统一加上即可

: [config.txt树莓派官方说明](https://www.raspberrypi.com/documentation/computers/config_txt.html#overclocking-options)

: [树莓派超频](https://zhuanlan.zhihu.com/p/76437760)

: [树莓派配置文档config.txt说明](https://blog.csdn.net/cyuyan112233/article/details/44577033)

### 测试核心频率
```
vcgencmd measure_clock arm
```

### 修改 /boot/cmdline.txt文件为
```
console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait isolcpus=2,3
```
如果是**Rpi**官方系统`root=/dev/mmcblk0p2`的内容可能每次刷固件都是不一样的，也可能和系统版本有关系，笔者这里没有深入了解

## 2.下载代码

RflyPilot源码: [https://github.com/umview/RflyPilot.git](https://github.com/umview/RflyPilot.git)

RflyPilot MATLAB源码: [https://github.com/umview/raspberry_fc_matlab.git](https://github.com/umview/raspberry_fc_matlab.git)

使用命令
```
git clone https://github.com/umview/RflyPilot.git
git clone https://github.com/umview/raspberry_fc_matlab.git
```

## 3.环境配置

1. 首先确认开启了**适用于Windows的Linux子系统功能**
2. 通过Windows应用商店安装WSL ubuntu18.04版本. 
3. 安装后打开, 等待配置后到提示输入用户名的阶段时不要输入用户名直接关闭ubuntu 18.04的终端.
4. 安装Virtual Studio 2017用于代码生成
5. 安装MTLAB 2022b

## 4.快速体验

1. 打开MATLAB 2022b, 打开RflyPilot MATLAB工程, 安装RflyPilot ToolBox
2. 代码生成姿态估计, 位置估计, SIH模型, 示例控制器.
3. 第一次下载需要提前用WSL ubuntu 18.04登录树莓派的SSH, 并建立文件夹RflyPilot_Project\RflyPilot
4. 在MTLAB APP中打开安装的RflyPilot ToolBox进行操作完成编译下载工作
5. SSH中`cd /home/pi/RflyPilot_Project/RflyPilot/`并`./rflypilot` or `sudo ./rflypilot`
> 如果不使用sudo可能无法正常向指定IP地址发送UDP数据，暂时影响SIH模式运行
<!-- ### 代码生成

- If the acado lib is used, do not copy the files `acado_solver_mex.c` and `make_acado_solver.m` into RflyPilot project.

- Such as `nmpc_solver_vz_wrapper.cpp`, the file generated by s-function builder not included in code gen folder need to be copied into RflyPilot project.

### 编译构建
- 将配置文件复制到与可执行文件相同的目录下 -->

