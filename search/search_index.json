{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"RflyPilot \u7b80\u4ecb \uf0c1 RflyPilot\u662f\u4e00\u6b3e\u7531\u5317\u822a \u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4 \u5f00\u53d1\u7684\u591a\u65cb\u7ffc\u65e0\u4eba\u673a\u81ea\u9a7e\u4eea\uff0c\u5373\u98de\u63a7\u3002\u8be5\u98de\u63a7\u786c\u4ef6\u7684\u6838\u5fc3\u91c7\u7528Raspberry Pi CM4\u8ba1\u7b97\u677f\uff0c\u8f83\u4f20\u7edf\u7684\u57fa\u4e8e\u5fae\u5904\u7406\u5668\uff08MCU\uff09\u7684\u98de\u63a7\u786c\u4ef6\uff0c\u8be5\u98de\u63a7\u5177\u6709\u66f4\u5f3a\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u9ad8\u8ba1\u7b97\u91cf\u8981\u6c42\u7684\u63a7\u5236\u65b9\u6cd5\uff0c\u6bd4\u5982\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08NMPC\uff09\u3002\u540c\u65f6RflyPilot\u91c7\u7528\u4e86\u6781\u7b80\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u629b\u5f03\u4e86\u5e38\u89c4\u7684\u591a\u5904\u7406\u65b9\u6848\uff08\u4e00\u9897\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\uff0c\u53e6\u4e00\u4e2a\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u4e0e\u4f20\u611f\u5668\u3001\u6267\u884c\u5668\u8fdb\u884c\u901a\u4fe1\uff09\uff0c\u800c\u91c7\u7528\u5355\u4e00\u5904\u7406\u5668\u65b9\u6848\uff0c\u5bf9\u4fe1\u53f7\u8fdb\u884c\u201c\u76f4\u63a5\u91c7\u6837\u201d\u3002\u8fd9\u6837\u7684\u65b9\u6848\u5927\u5927\u7b80\u5316\u4e86\u98de\u63a7\u7684\u5f00\u53d1\uff0c\u7cbe\u7b80\u4e86\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\uff0c\u4e5f\u964d\u4f4e\u4e86\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u53d1\u6325\u7cfb\u7edf\u7684\u6781\u81f4\u6027\u80fd\u3002\u98de\u63a7\u8f6f\u4ef6\u7684\u5f00\u53d1\u91c7\u7528\u4e86\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08Model Based Design, MBD\uff09\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u6709\u6548\u52a0\u901f\u5f00\u53d1\u6d41\u7a0b\uff0c\u5e76\u6709\u5229\u4e8e\u505a\u7cfb\u7edf\u7ea7\u9a8c\u8bc1\u3002\u5728MBD\u7684\u601d\u60f3\u4e4b\u4e0b\uff0cRflyPilot\u652f\u6301\u5bf9\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u8bb0\u5f55\u4e0e\u8c03\u8bd5\u529f\u80fd\uff0c\u6709\u5229\u4e8e\u5f00\u53d1\u8005\u5145\u5206\u6316\u6398\u63a7\u5236\u7cfb\u7edf\u7684\u6f5c\u80fd\u3002 \u4e3a\u4e86\u65b9\u4fbf\u98de\u63a7\u5f00\u53d1\uff0c\u8bfe\u9898\u7ec4\u4e5f\u4e3aRflyPilot\u7f16\u5199\u4e86\u4e00\u6b3eMATLAB\u5de5\u5177\u7bb1\uff0c\u53eb\u505aRflyPilotTools\uff0c\u8be5\u5de5\u5177\u7bb1\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u90e8\u7f72\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u7279\u6027 \uf0c1 RflyPilot\u91c7\u7528\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u4e3a\u6838\u5fc3\u5904\u7406\u5668\uff0c\u5177\u6709\u8f83\u5f3a\u7684\u8fd0\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u5b9e\u65f6\u8fd0\u884c\u590d\u6742\u7684\u63a7\u5236\u7b97\u6cd5\uff0c\u5982Nonlinear MPC\u7b49\uff1b RflyPilot\u7684\u5904\u7406\u5668\u4e0e\u4f20\u611f\u5668\u548c\u6267\u884c\u5668\u76f4\u63a5\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u66f4\u4e3a\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff1b RflyPilot\u91c7\u7528\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08MBD\uff09\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u63d0\u4f9b\u4e86\u5168\u94fe\u6761\u7684\u4eff\u771f\u9a8c\u8bc1\u65b9\u6848\uff0c\u53ef\u4ee5\u8fdb\u884cMIL\u3001SIH\u3001HIL\u548c\u5b9e\u98de\u5b9e\u9a8c\uff0c\u5176\u4e2dHIL\u6a21\u5f0f\u4e0b\u517c\u5bb9 RflySim-RT\u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \uff1b \u98de\u63a7\u63d0\u4f9b\u4e86\u5305\u62ec\u63a7\u5236\u5668\u3001\u88ab\u63a7\u5bf9\u8c61\u548c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4eff\u771f\u6a21\u578b\u6846\u67b6\uff0c\u5229\u7528MATLAB\u7684\u4ee3\u7801\u751f\u6210\u529f\u80fd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff0c\u5e76\u4e14\u652f\u6301 RflySim3D \u8fdb\u884c\u89c6\u666f\u663e\u793a\uff1b RflyPilotTools\u4e3a\u98de\u63a7\u5f00\u53d1\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u63d0\u4f9b\u201c\u4e00\u952e\u4ee3\u7801\u90e8\u7f72\u201d\uff0c\u201c\u4e00\u952e\u7f16\u8bd1\u4e0e\u4e0a\u4f20\u201d\u7b49\u5b9e\u7528\u529f\u80fd\uff1b \u98de\u63a7\u57fa\u4e8eLinux\u7cfb\u7edf\uff0c\u5e95\u5c42\u9a71\u52a8\u4e0e\u7cfb\u7edf\u4efb\u52a1\u91c7\u7528\u9ad8\u6548\u7684C/C++\u4ee3\u7801\u7f16\u5199\u5b8c\u6210\uff0c\u91c7\u7528\u4e86\u591a\u79cd\u65b9\u6cd5\u4ee5\u4fdd\u969c\u98de\u884c\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\uff1b RflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u5f00\u53d1\u8c03\u8bd5\u63a5\u53e3\uff0c\u5f97\u76ca\u4e8e\u677f\u8f7dWIFI\uff0c\u98de\u63a7\u652f\u6301\u5b9e\u65f6\u6570\u636e\u66f2\u7ebf\u3001\u5728\u7ebf\u53c2\u6570\u4fee\u6539\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u8fdc\u7a0b\u63a7\u5236\u53f0\u7b49\u529f\u80fd\uff1b \u652f\u6301\u4ea4\u53c9\u7f16\u8bd1\u3002 \u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f \uf0c1 RflyPilot\u652f\u6301\u591a\u79cd\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a \u6a21\u5f0f\u4ee3\u53f7 \u6a21\u5f0f \u8bf4\u660e MIL \u6a21\u578b\u5728\u73af\uff08Model in the Loop\uff09 \u5b8c\u5168\u57fa\u4e8eSimulink\u7684\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u65e9\u671f\u7684\u6570\u503c\u4eff\u771f\u9a8c\u8bc1 SIH \u4eff\u771f\u5668\u5728\u73af\uff08Simulator in the Loop\uff09 \u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eRflyPilot\u98de\u63a7\u4e2d\uff0c\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u786c\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5b9e\u9645\u8868\u73b0 HIL \u786c\u4ef6\u5728\u73af\uff08Hardware in the Loop\uff09 RflyPilot\u8fde\u63a5\u5230\u865a\u62df\u88ab\u63a7\u5bf9\u8c61\u8fdb\u884c\u4eff\u771f\uff0c\u8be5\u6a21\u5f0f\u8003\u8651\u5230\u7cfb\u7edf\u8c03\u5ea6\u3001\u4f20\u611f\u5668\u5ef6\u65f6\u7b49\u7ec6\u8282\uff0c\u4f5c\u4e3a\u5b9e\u9a8c\u524d\u7684\u6700\u540e\u4e00\u6b65\u9a8c\u8bc1 EXP \u5b9e\u9a8c\uff08Experiment\uff09 \u5b9e\u98de\u9a8c\u8bc1 OFFBOARD \u4e0a\u4f4d\u673a\u6a21\u5f0f \u7528\u4e8e\u652f\u6301\u989d\u5916\u8ba1\u7b97\u673a\u81ea\u52a8\u5316\u6307\u4ee4\u8f93\u5165 \u5f97\u76ca\u4e8eMBD\u601d\u60f3\uff0c\u4e0a\u8ff0\u5404\u4e2a\u6a21\u5f0f\u95f4\u53ef\u4ee5\u8fdb\u884c\u5feb\u901f\u5207\u6362 MIL SIH HIL \uf0c1 \u5b9e\u98de\u5b9e\u9a8c \uf0c1 \u63a8\u8350\u4eba\u7fa4\u548c\u5e94\u7528\u573a\u666f \uf0c1 RflyPilot\u4f5c\u4e3a\u4e00\u6b3e\u5c0f\u578b\u7684\u9ad8\u6027\u80fd\u98de\u63a7\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u4e8e\u5c0f\u578b\u65e0\u4eba\u673a\u3002\u7efc\u5408\u6765\u8bb2\uff0cRflyPilot\u9002\u5408\u5177\u6709\u4e00\u5b9a\u98de\u63a7\u5f00\u53d1\u7ecf\u9a8c\u7684\u4eba\u7fa4\uff0c\u6bd4\u5982\u4ece\u4e8b\u98de\u884c\u63a7\u5236\u76f8\u5173\u7684\u9ad8\u6821\u5b66\u751f\u7b49\uff0c\u540c\u65f6\u5f00\u53d1\u8005\u8fd8\u9700\u8981\u719f\u6089MATLAB/Simulink\uff0c\u5e76\u5177\u6709\u4e00\u5b9a\u7684Linux\u4f7f\u7528\u57fa\u7840\u3002 RflyPilot\u9002\u5408\u88ab\u5e94\u7528\u4e8e\u4f20\u7edf\u98de\u63a7\u65b9\u6848\uff08\u6838\u5fc3\u5904\u7406\u5668\u4e3a\u5fae\u5904\u7406\u5668\uff09\u7684\u8ba1\u7b97\u80fd\u529b\u4e0d\u80fd\u6ee1\u8db3\u9700\u6c42\u7684\u573a\u5408\uff0c\u6216\u8005\u9700\u8981\u4ee5\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1(MBD)\u65b9\u5f0f\u8fdb\u884c\u98de\u63a7\u5f00\u53d1\u65f6\uff0cRflyPilot\u5c06\u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u98de\u63a7\u5f88\u9002\u5408\u9ad8\u6821\u5b66\u751f\u8fdb\u884c\u98de\u884c\u63a7\u5236\u7814\u7a76\u3002 \u6587\u6863\u8bf4\u660e \uf0c1 \u672c\u6587\u6863\u5c06\u4e3b\u8981\u5206\u4e3a\u4e09\u5927\u90e8\u5206\uff0c\u5feb\u901f\u4f7f\u7528\u3001\u7528\u6237\u624b\u518c\u3001\u5f00\u53d1\u624b\u518c\u3002 \u5feb\u901f\u4f7f\u7528 \uff1a\u901a\u8fc7\u9605\u8bfb\u8fd9\u90e8\u5206\u6587\u6863\uff0c\u8bfb\u8005\u5c06\u5bf9RflyPilot\u7684\u4f7f\u7528\u6709\u4e00\u4e2a\u7cfb\u7edf\u6027\u7684\u8ba4\u77e5\uff0c\u5b9e\u73b0RflyPilot\u73af\u5883\u914d\u7f6e\u5230\u8fd0\u884c\u4eff\u771f\u7684\u6700\u5c0f\u95ed\u73af\uff0c\u5176\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u5feb\u901f\u4e0a\u624bRflyPilot\u3002 \u7528\u6237\u624b\u518c \uff1a\u57fa\u672c\u4f7f\u7528\u4f5c\u4e3a\u5feb\u901f\u4f7f\u7528\u7684\u529f\u80fd\u8865\u5145\uff0c\u8fd9\u90e8\u5206\u6587\u6863\u5c06\u7740\u91cd\u4ecb\u7ecdRflyPilot\u7684\u57fa\u672c\u4f7f\u7528\u4e0e\u57fa\u672c\u529f\u80fd\uff0c\u5982\u786c\u4ef6\u8fde\u63a5\u3001\u4eff\u771f\u6b65\u9aa4\u3001\u65e5\u5fd7\u7cfb\u7edf\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u638c\u63e1RflyPilot\u57fa\u672c\u529f\u80fd\u7684\u4f7f\u7528\u3002\u4f5c\u4e3aRflyPilot\u7684\u4f7f\u7528\u8005\u800c\u8a00\uff0c\u5982\u679c\u4e0d\u5173\u6ce8\u5982\u4f55\u5bf9RflyPilot\u7cfb\u7edf\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u8bfb\u8005\u53ea\u9700\u8981\u5173\u6ce8\u5feb\u901f\u4f7f\u7528\u548c\u7528\u6237\u624b\u518c\u4e24\u5927\u90e8\u5206\u5185\u5bb9\u5373\u53ef\u3002 \u5f00\u53d1\u624b\u518c \uff1a\u8fd9\u90e8\u5206\u5185\u5bb9\u4e3b\u8981\u9488\u5bf9\u5bf9RflyPilot\u4fee\u6539\u9700\u6c42\u7684\u7528\u6237\uff0c\u5373RflyPilot\u7684\u5f00\u53d1\u8005\uff0c\u5b83\u63d0\u4f9b\u7ed9\u4e86\u5f00\u53d1\u8005\u8be6\u7ec6\u7684\u8bf4\u660e\u6587\u6863\uff0c\u5305\u62ecRflyPilot\u5404\u79cd\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u7b49\u3002\u8fd9\u90e8\u5185\u5bb9\u8981\u6c42\u8bfb\u8005\u719f\u6089\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3002","title":"RflyPilot \u7b80\u4ecb"},{"location":"#rflypilot","text":"RflyPilot\u662f\u4e00\u6b3e\u7531\u5317\u822a \u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4 \u5f00\u53d1\u7684\u591a\u65cb\u7ffc\u65e0\u4eba\u673a\u81ea\u9a7e\u4eea\uff0c\u5373\u98de\u63a7\u3002\u8be5\u98de\u63a7\u786c\u4ef6\u7684\u6838\u5fc3\u91c7\u7528Raspberry Pi CM4\u8ba1\u7b97\u677f\uff0c\u8f83\u4f20\u7edf\u7684\u57fa\u4e8e\u5fae\u5904\u7406\u5668\uff08MCU\uff09\u7684\u98de\u63a7\u786c\u4ef6\uff0c\u8be5\u98de\u63a7\u5177\u6709\u66f4\u5f3a\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u9ad8\u8ba1\u7b97\u91cf\u8981\u6c42\u7684\u63a7\u5236\u65b9\u6cd5\uff0c\u6bd4\u5982\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08NMPC\uff09\u3002\u540c\u65f6RflyPilot\u91c7\u7528\u4e86\u6781\u7b80\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u629b\u5f03\u4e86\u5e38\u89c4\u7684\u591a\u5904\u7406\u65b9\u6848\uff08\u4e00\u9897\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\uff0c\u53e6\u4e00\u4e2a\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u4e0e\u4f20\u611f\u5668\u3001\u6267\u884c\u5668\u8fdb\u884c\u901a\u4fe1\uff09\uff0c\u800c\u91c7\u7528\u5355\u4e00\u5904\u7406\u5668\u65b9\u6848\uff0c\u5bf9\u4fe1\u53f7\u8fdb\u884c\u201c\u76f4\u63a5\u91c7\u6837\u201d\u3002\u8fd9\u6837\u7684\u65b9\u6848\u5927\u5927\u7b80\u5316\u4e86\u98de\u63a7\u7684\u5f00\u53d1\uff0c\u7cbe\u7b80\u4e86\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\uff0c\u4e5f\u964d\u4f4e\u4e86\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u53d1\u6325\u7cfb\u7edf\u7684\u6781\u81f4\u6027\u80fd\u3002\u98de\u63a7\u8f6f\u4ef6\u7684\u5f00\u53d1\u91c7\u7528\u4e86\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08Model Based Design, MBD\uff09\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u6709\u6548\u52a0\u901f\u5f00\u53d1\u6d41\u7a0b\uff0c\u5e76\u6709\u5229\u4e8e\u505a\u7cfb\u7edf\u7ea7\u9a8c\u8bc1\u3002\u5728MBD\u7684\u601d\u60f3\u4e4b\u4e0b\uff0cRflyPilot\u652f\u6301\u5bf9\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u8bb0\u5f55\u4e0e\u8c03\u8bd5\u529f\u80fd\uff0c\u6709\u5229\u4e8e\u5f00\u53d1\u8005\u5145\u5206\u6316\u6398\u63a7\u5236\u7cfb\u7edf\u7684\u6f5c\u80fd\u3002 \u4e3a\u4e86\u65b9\u4fbf\u98de\u63a7\u5f00\u53d1\uff0c\u8bfe\u9898\u7ec4\u4e5f\u4e3aRflyPilot\u7f16\u5199\u4e86\u4e00\u6b3eMATLAB\u5de5\u5177\u7bb1\uff0c\u53eb\u505aRflyPilotTools\uff0c\u8be5\u5de5\u5177\u7bb1\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u90e8\u7f72\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002","title":"RflyPilot \u7b80\u4ecb"},{"location":"#_1","text":"RflyPilot\u91c7\u7528\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u4e3a\u6838\u5fc3\u5904\u7406\u5668\uff0c\u5177\u6709\u8f83\u5f3a\u7684\u8fd0\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u5b9e\u65f6\u8fd0\u884c\u590d\u6742\u7684\u63a7\u5236\u7b97\u6cd5\uff0c\u5982Nonlinear MPC\u7b49\uff1b RflyPilot\u7684\u5904\u7406\u5668\u4e0e\u4f20\u611f\u5668\u548c\u6267\u884c\u5668\u76f4\u63a5\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u66f4\u4e3a\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff1b RflyPilot\u91c7\u7528\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08MBD\uff09\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u63d0\u4f9b\u4e86\u5168\u94fe\u6761\u7684\u4eff\u771f\u9a8c\u8bc1\u65b9\u6848\uff0c\u53ef\u4ee5\u8fdb\u884cMIL\u3001SIH\u3001HIL\u548c\u5b9e\u98de\u5b9e\u9a8c\uff0c\u5176\u4e2dHIL\u6a21\u5f0f\u4e0b\u517c\u5bb9 RflySim-RT\u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \uff1b \u98de\u63a7\u63d0\u4f9b\u4e86\u5305\u62ec\u63a7\u5236\u5668\u3001\u88ab\u63a7\u5bf9\u8c61\u548c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4eff\u771f\u6a21\u578b\u6846\u67b6\uff0c\u5229\u7528MATLAB\u7684\u4ee3\u7801\u751f\u6210\u529f\u80fd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff0c\u5e76\u4e14\u652f\u6301 RflySim3D \u8fdb\u884c\u89c6\u666f\u663e\u793a\uff1b RflyPilotTools\u4e3a\u98de\u63a7\u5f00\u53d1\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u63d0\u4f9b\u201c\u4e00\u952e\u4ee3\u7801\u90e8\u7f72\u201d\uff0c\u201c\u4e00\u952e\u7f16\u8bd1\u4e0e\u4e0a\u4f20\u201d\u7b49\u5b9e\u7528\u529f\u80fd\uff1b \u98de\u63a7\u57fa\u4e8eLinux\u7cfb\u7edf\uff0c\u5e95\u5c42\u9a71\u52a8\u4e0e\u7cfb\u7edf\u4efb\u52a1\u91c7\u7528\u9ad8\u6548\u7684C/C++\u4ee3\u7801\u7f16\u5199\u5b8c\u6210\uff0c\u91c7\u7528\u4e86\u591a\u79cd\u65b9\u6cd5\u4ee5\u4fdd\u969c\u98de\u884c\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\uff1b RflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u5f00\u53d1\u8c03\u8bd5\u63a5\u53e3\uff0c\u5f97\u76ca\u4e8e\u677f\u8f7dWIFI\uff0c\u98de\u63a7\u652f\u6301\u5b9e\u65f6\u6570\u636e\u66f2\u7ebf\u3001\u5728\u7ebf\u53c2\u6570\u4fee\u6539\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u8fdc\u7a0b\u63a7\u5236\u53f0\u7b49\u529f\u80fd\uff1b \u652f\u6301\u4ea4\u53c9\u7f16\u8bd1\u3002","title":"\u7279\u6027"},{"location":"#_2","text":"RflyPilot\u652f\u6301\u591a\u79cd\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a \u6a21\u5f0f\u4ee3\u53f7 \u6a21\u5f0f \u8bf4\u660e MIL \u6a21\u578b\u5728\u73af\uff08Model in the Loop\uff09 \u5b8c\u5168\u57fa\u4e8eSimulink\u7684\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u65e9\u671f\u7684\u6570\u503c\u4eff\u771f\u9a8c\u8bc1 SIH \u4eff\u771f\u5668\u5728\u73af\uff08Simulator in the Loop\uff09 \u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eRflyPilot\u98de\u63a7\u4e2d\uff0c\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u786c\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5b9e\u9645\u8868\u73b0 HIL \u786c\u4ef6\u5728\u73af\uff08Hardware in the Loop\uff09 RflyPilot\u8fde\u63a5\u5230\u865a\u62df\u88ab\u63a7\u5bf9\u8c61\u8fdb\u884c\u4eff\u771f\uff0c\u8be5\u6a21\u5f0f\u8003\u8651\u5230\u7cfb\u7edf\u8c03\u5ea6\u3001\u4f20\u611f\u5668\u5ef6\u65f6\u7b49\u7ec6\u8282\uff0c\u4f5c\u4e3a\u5b9e\u9a8c\u524d\u7684\u6700\u540e\u4e00\u6b65\u9a8c\u8bc1 EXP \u5b9e\u9a8c\uff08Experiment\uff09 \u5b9e\u98de\u9a8c\u8bc1 OFFBOARD \u4e0a\u4f4d\u673a\u6a21\u5f0f \u7528\u4e8e\u652f\u6301\u989d\u5916\u8ba1\u7b97\u673a\u81ea\u52a8\u5316\u6307\u4ee4\u8f93\u5165 \u5f97\u76ca\u4e8eMBD\u601d\u60f3\uff0c\u4e0a\u8ff0\u5404\u4e2a\u6a21\u5f0f\u95f4\u53ef\u4ee5\u8fdb\u884c\u5feb\u901f\u5207\u6362","title":"\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f"},{"location":"#mil-sih-hil","text":"","title":"MIL SIH HIL"},{"location":"#_3","text":"","title":"\u5b9e\u98de\u5b9e\u9a8c"},{"location":"#_4","text":"RflyPilot\u4f5c\u4e3a\u4e00\u6b3e\u5c0f\u578b\u7684\u9ad8\u6027\u80fd\u98de\u63a7\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u4e8e\u5c0f\u578b\u65e0\u4eba\u673a\u3002\u7efc\u5408\u6765\u8bb2\uff0cRflyPilot\u9002\u5408\u5177\u6709\u4e00\u5b9a\u98de\u63a7\u5f00\u53d1\u7ecf\u9a8c\u7684\u4eba\u7fa4\uff0c\u6bd4\u5982\u4ece\u4e8b\u98de\u884c\u63a7\u5236\u76f8\u5173\u7684\u9ad8\u6821\u5b66\u751f\u7b49\uff0c\u540c\u65f6\u5f00\u53d1\u8005\u8fd8\u9700\u8981\u719f\u6089MATLAB/Simulink\uff0c\u5e76\u5177\u6709\u4e00\u5b9a\u7684Linux\u4f7f\u7528\u57fa\u7840\u3002 RflyPilot\u9002\u5408\u88ab\u5e94\u7528\u4e8e\u4f20\u7edf\u98de\u63a7\u65b9\u6848\uff08\u6838\u5fc3\u5904\u7406\u5668\u4e3a\u5fae\u5904\u7406\u5668\uff09\u7684\u8ba1\u7b97\u80fd\u529b\u4e0d\u80fd\u6ee1\u8db3\u9700\u6c42\u7684\u573a\u5408\uff0c\u6216\u8005\u9700\u8981\u4ee5\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1(MBD)\u65b9\u5f0f\u8fdb\u884c\u98de\u63a7\u5f00\u53d1\u65f6\uff0cRflyPilot\u5c06\u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u98de\u63a7\u5f88\u9002\u5408\u9ad8\u6821\u5b66\u751f\u8fdb\u884c\u98de\u884c\u63a7\u5236\u7814\u7a76\u3002","title":"\u63a8\u8350\u4eba\u7fa4\u548c\u5e94\u7528\u573a\u666f"},{"location":"#_5","text":"\u672c\u6587\u6863\u5c06\u4e3b\u8981\u5206\u4e3a\u4e09\u5927\u90e8\u5206\uff0c\u5feb\u901f\u4f7f\u7528\u3001\u7528\u6237\u624b\u518c\u3001\u5f00\u53d1\u624b\u518c\u3002 \u5feb\u901f\u4f7f\u7528 \uff1a\u901a\u8fc7\u9605\u8bfb\u8fd9\u90e8\u5206\u6587\u6863\uff0c\u8bfb\u8005\u5c06\u5bf9RflyPilot\u7684\u4f7f\u7528\u6709\u4e00\u4e2a\u7cfb\u7edf\u6027\u7684\u8ba4\u77e5\uff0c\u5b9e\u73b0RflyPilot\u73af\u5883\u914d\u7f6e\u5230\u8fd0\u884c\u4eff\u771f\u7684\u6700\u5c0f\u95ed\u73af\uff0c\u5176\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u5feb\u901f\u4e0a\u624bRflyPilot\u3002 \u7528\u6237\u624b\u518c \uff1a\u57fa\u672c\u4f7f\u7528\u4f5c\u4e3a\u5feb\u901f\u4f7f\u7528\u7684\u529f\u80fd\u8865\u5145\uff0c\u8fd9\u90e8\u5206\u6587\u6863\u5c06\u7740\u91cd\u4ecb\u7ecdRflyPilot\u7684\u57fa\u672c\u4f7f\u7528\u4e0e\u57fa\u672c\u529f\u80fd\uff0c\u5982\u786c\u4ef6\u8fde\u63a5\u3001\u4eff\u771f\u6b65\u9aa4\u3001\u65e5\u5fd7\u7cfb\u7edf\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u638c\u63e1RflyPilot\u57fa\u672c\u529f\u80fd\u7684\u4f7f\u7528\u3002\u4f5c\u4e3aRflyPilot\u7684\u4f7f\u7528\u8005\u800c\u8a00\uff0c\u5982\u679c\u4e0d\u5173\u6ce8\u5982\u4f55\u5bf9RflyPilot\u7cfb\u7edf\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u8bfb\u8005\u53ea\u9700\u8981\u5173\u6ce8\u5feb\u901f\u4f7f\u7528\u548c\u7528\u6237\u624b\u518c\u4e24\u5927\u90e8\u5206\u5185\u5bb9\u5373\u53ef\u3002 \u5f00\u53d1\u624b\u518c \uff1a\u8fd9\u90e8\u5206\u5185\u5bb9\u4e3b\u8981\u9488\u5bf9\u5bf9RflyPilot\u4fee\u6539\u9700\u6c42\u7684\u7528\u6237\uff0c\u5373RflyPilot\u7684\u5f00\u53d1\u8005\uff0c\u5b83\u63d0\u4f9b\u7ed9\u4e86\u5f00\u53d1\u8005\u8be6\u7ec6\u7684\u8bf4\u660e\u6587\u6863\uff0c\u5305\u62ecRflyPilot\u5404\u79cd\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u7b49\u3002\u8fd9\u90e8\u5185\u5bb9\u8981\u6c42\u8bfb\u8005\u719f\u6089\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3002","title":"\u6587\u6863\u8bf4\u660e"},{"location":"Basic/calibration/","text":"\u672c\u5c0f\u7ed3\u5c06\u4ecb\u7ecd\u4f20\u611f\u5668\u7684\u6821\u51c6\u65b9\u6cd5\uff0c\u5305\u62ecIMU\u548c\u78c1\u529b\u8ba1\u3002\u4f20\u611f\u5668\u6821\u51c6\u662f\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u4e2d\u81f3\u5173\u91cd\u8981\u7684\u4e00\u6b65\uff0c\u5b83\u6709\u5229\u4e8e\u964d\u4f4e\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u8bef\u5dee\u3002 \u57fa\u672c\u4f7f\u7528 \uf0c1 RflyPilot\u5185\u7f6e\u4e86\u4f20\u611f\u5668\u6821\u51c6\u529f\u80fd\uff0c\u6821\u51c6\u64cd\u4f5c\u4e3b\u8981\u901a\u8fc7\u63a7\u5236\u53f0\u547d\u4ee4\u5b9e\u73b0\uff0c\u6821\u51c6\u7ed3\u679c\u5c06\u4ee5\u6587\u672c\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u50a8\u5728RflyPilot\u98de\u63a7\u4e2d\u3002 \u5728\u8fd9\u4e4b\u524d\uff0c\u9700\u8981\u8bbe\u7f6e rflypilot.txt \u4e2d\u7684 valid_mode = 3 \uff0c\u4ee5\u542f\u7528\u5b9e\u9a8c\u6a21\u5f0f\u3002\u6821\u51c6\u53c2\u6570\u5c06\u88ab\u4ee5\u6587\u672c\u5f62\u5f0f\u5b58\u50a8\u5728 calibration.txt \uff0c\u5728\u9996\u6b21\u4f7f\u7528\u65f6\uff0c\u8be5\u6587\u4ef6\u9700\u8981\u624b\u52a8\u521b\u5efa\uff0c\u6587\u4ef6\u5185\u5bb9\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5982\u4e0b accel_scale_0 = 0.000000 accel_scale_1 = 0.000000 accel_scale_2 = 0.000000 accel_offset_0 = 0.000000 accel_offset_1 = 0.000000 accel_offset_2 = 0.000000 gyro_scale_0 = 1.000000 gyro_scale_1 = 1.000000 gyro_scale_2 = 1.000000 gyro_offset_0 = 0.000000 gyro_offset_1 = 0.000000 gyro_offset_2 = 0.000000 mag_scale_0 = 0.000000 mag_scale_1 = 0.000000 mag_scale_2 = 0.000000 mag_offset_0 = 0.000000 mag_offset_1 = 0.000000 mag_offset_2 = 0.000000 Tip \u6ce8\u610f\u6587\u4ef6\u5185\u5bb9\u7684\u683c\u5f0f\uff0c\u8981\u4fdd\u7559\u7a7a\u683c\u3002\u4e3b\u8981\u9640\u87ba\u4eea\u7684\u5c3a\u5ea6\u7cfb\u6570 gyro_scale_{0,1,2} \u5e94\u8bbe\u7f6e\u4e3a 1 \u3002 \u9640\u87ba\u4eea\u6821\u51c6 \uf0c1 \u5728\u63a7\u5236\u53f0\u4e2d\u8f93\u5165 calib gyro \uff0c\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5373\u53ef\u5b8c\u6210\u6821\u51c6\u3002 vehicle > calib gyro gyro calibration mode Calibration thread created with process pid : 1036 Calibration starting vehicle > thread calibration running start gyro calibration process...... Please do not move the aircraft gyro calibration parameter is: gyro_x_offset = 0.013428 gyro_y_offset = 0.006644 gyro_z_offset = -0.002992 calibration finished ! Tip \u5728\u6821\u51c6\u7684\u8fc7\u7a0b\u4e2d\u4e00\u5b9a\u8981\u4fdd\u6301RflyPilot\u5904\u4e8e\u9759\u6b62\u72b6\u6001\uff1b\u8fd9\u91cc\u53ea\u6821\u51c6\u4e86\u9640\u87ba\u4eea\u7684\u96f6\u504f\uff0c\u6ca1\u6709\u6821\u51c6\u9640\u87ba\u4eea\u7684\u5c3a\u5ea6\u7cfb\u6570\u3002\u5efa\u8bae\u5728\u4e0a\u7535\u4e4b\u540eIMU\u5668\u4ef6\u6e29\u5ea6\u7a33\u5b9a\u540e\u518d\u8fdb\u884c\u6821\u51c6\u3002 \u5728\u8f93\u5165 calib save \u5373\u53ef\u4fdd\u5b58\u6821\u51c6\u6570\u636e\u3002 vehicle > calib gyro gyro calibration mode Calibration thread created with process pid : 1036 Calibration starting vehicle > thread calibration running start gyro calibration process...... Please do not move the aircraft gyro calibration parameter is: gyro_x_offset = 0.013428 gyro_y_offset = 0.006644 gyro_z_offset = -0.002992 calibration finished ! \u901a\u8fc7 calib load \u5373\u53ef\u67e5\u770b\u6821\u51c6\u53c2\u6570 vehicle > calib load LOAD calibration mode Calibration thread created with process pid : 1220 Calibration starting vehicle > thread calibration running key has 18 accel_scale_0 is 0.000000 accel_scale_1 is 0.000000 accel_scale_2 is 0.000000 accel_offset_0 is 0.000000 accel_offset_1 is 0.000000 accel_offset_2 is 0.000000 gyro_scale_0 is 1.000000 gyro_scale_1 is 1.000000 gyro_scale_2 is 1.000000 gyro_offset_0 is 0.013428 gyro_offset_1 is 0.006644 gyro_offset_2 is -0.002992 mag_scale_0 is 0.000000 mag_scale_1 is 0.000000 mag_scale_2 is 0.000000 mag_offset_0 is 0.000000 mag_offset_1 is 0.000000 mag_offset_2 is 0.000000 calibration finished ! Tip \u6821\u51c6\u7ed3\u679c\u5c06\u88ab\u5b58\u50a8\u5728\u4e0e rflypilot \u53ef\u6267\u884c\u6587\u4ef6\u540c\u7ea7\u7684 calibration.txt \u4e2d\u3002 \u52a0\u901f\u5ea6\u8ba1\u6821\u51c6 \uf0c1 RflyPilot\u7684\u5750\u6807\u7cfb\u5b9a\u4e49\u5982\u4e0b \u52a0\u901f\u5ea6\u8ba1\u7684\u6821\u51c6\u91c7\u7528\u4e86\u5e38\u7528\u7684\u516d\u9762\u6821\u51c6\u6cd5\u3002\u8f93\u5165\u6307\u4ee4 calib accel \uff0c\u4fbf\u5f00\u59cb\u4e86\u6821\u51c6\u3002 RflyPilot\u9996\u5148\u4f1a\u63d0\u793a\uff0c Please place the (+x) axis of the aircraft upward ,\u4f7f\u7528\u8005\u5c06 +x \u8f74\u671d\u4e0a\u9759\u7f6e\u5373\u53ef\uff0c\u5f85\u59ff\u6001\u7a33\u5b9a\u540e\uff0cRflyPilot\u5c06\u63d0\u793a Please do not move the aircraft \uff0c\u6b64\u65f6\u9700\u8981\u9759\u7f6e\u98de\u63a7\uff0cRflyPilot\u6b63\u5728\u91c7\u96c6\u52a0\u901f\u5ea6\u8ba1\u6570\u636e\u3002\u5f85\u6570\u636e\u91c7\u96c6\u5b8c\u6210\u540e\uff0c\u5c06\u4f1a\u63d0\u793a Please place the (+z) axis of the aircraft upward \uff0c\u540e\u7eed\u64cd\u4f5c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 vehicle > calib accel accel calibration mode Calibration thread created with process pid : 1406 Calibration starting vehicle > thread calibration running start accel calibration process...... Please place the (+x) axis of the aircraft upward PX_UP is detected! accel data: accel x = 9.7417, y = -0.7865, z = -0.2954 Please do not move the aircraft step1 is completed! A = 1381.0000 Please place the (+z) axis of the aircraft upward PZ_UP is detected! accel data: accel x = -0.6721, y = -0.4783, z = 9.6469 Please do not move the aircraft step2 is completed! A = 2763.0000 Please place the (-x) axis of the aircraft upward NX_UP is detected! accel data: accel x = -9.7803, y = -0.4612, z = -0.1445 Please do not move the aircraft step3 is completed! A = 4144.0000 Please place the (-z) axis of the aircraft upward NZ_UP is detected! accel data: accel x = 0.1338, y = 0.0895, z = -9.9620 Please do not move the aircraft step4 is completed! A = 5526.0000 Please place the (-y) axis of the aircraft upward NY_UP is detected! accel data: accel x = -0.2413, y = -9.8469, z = -0.2811 Please do not move the aircraft step5 is completed! A = 6908.0000 Please place the (+y) axis of the aircraft upward PY_UP is detected! accel data: accel x = 0.3244, y = 9.7597, z = 0.8039 Please do not move the aircraft step6 is completed! A = 8290.0000 1.000355 0.998360 0.997071 0.022998 0.011350 0.116596 calibration finished ! \u52a0\u901f\u5ea6\u8ba1\u6821\u51c6\u5b8c\u6210\u540e\uff0c\u5229\u7528 calib save \u4fdd\u5b58\u5373\u53ef\uff0c\u6570\u636e\u5c06\u5199\u5165\u5230 calibration.txt \u4e2d\u3002 \u78c1\u529b\u8ba1\u6821\u51c6 \uf0c1 \u78c1\u529b\u8ba1\u6821\u51c6\u4f7f\u7528\u7684\u65b9\u6cd5\u662f\u692d\u7403\u62df\u5408\u3002\u8f93\u5165\u547d\u4ee4 calib mag , RflyPilot\u9996\u5148\u4f1a\u63d0\u793a\uff0c Please place the (-z) axis of the aircraft upward ,\u4f7f\u7528\u8005\u5c06 -z \u8f74\u671d\u4e0a\u9759\u7f6e\u5373\u53ef\uff0c\u5f85\u59ff\u6001\u7a33\u5b9a\u540e\uff0c\u51fa\u73b0\u63d0\u793a Please rotate the aircraft around -z axis \uff0c\u6b64\u65f6\u7ed5 -z \u8f74\u7f13\u6162\u5355\u5411\u65cb\u8f6cRflyPilot\u5373\u53ef\uff08\u65cb\u8f6c\u65b9\u5411\u4efb\u610f\uff09\uff0cRflyPilot\u9700\u8981\u4f7f\u7528\u8005\u57287\u79d2\u949f\u5185\u7ed5\u4e00\u5708\uff0c7\u79d2\u949f\u540e\uff0c\u6821\u51c6\u7a0b\u5e8f\u5c06\u81ea\u52a8\u8fdb\u5165\u4e0b\u4e00\u9636\u6bb5\uff0c Please place the (+x) axis of the aircraft upward , \u6b64\u65f6\u6309\u7167\u6b65\u9aa4\u64cd\u4f5c\u5373\u53ef\u3002 Calibration thread created with process pid : 786 Calibration starting vehicle > thread calibration running start mag calibration process......Please place the (-z) axis of the aircraft upward NZ_UP is detected! accel data: accel x = -0.2963, y = 0.3090, z = -10.0077 mag data: mag x = -0.099583, y = 0.007083, z = 0.261417 Please rotate the aircraft around -z axis step1 is completed! A = 695.0000 Please place the (+x) axis of the aircraft upward PX_UP is detected! accel data: accel x = 9.7193, y = 0.5693, z = -0.6472 mag data: mag x = -0.553500, y = -0.092667, z = -0.231417 Please rotate the aircraft around +x axis step2 is completed! A = 1391.0000 Please place the (-x) axis of the aircraft upward NX_UP is detected! accel data: accel x = -9.8372, y = 0.5258, z = -0.2316 mag data: mag x = 0.443917, y = 0.078917, z = -0.021417 Please rotate the aircraft around -x axis step3 is completed! A = 2087.0000 Please place the (-y) axis of the aircraft upward NY_UP is detected! accel data: accel x = -0.3618, y = -9.7050, z = -0.9713 mag data: mag x = 0.136000, y = 0.345000, z = -0.076250 Please rotate the aircraft around -y axis step4 is completed!A = 2783.0000 Please place the (+y) axis of the aircraft upward PY_UP is detected! accel data: accel x = 1.3548, y = 9.6512, z = 0.4473 mag data: mag x = 0.017250, y = -0.516000, z = 0.026833 Please rotate the aircraft around +y axis step5 is completed! A = 3479.0000 Please place the (+z) axis of the aircraft upward PZ_UP is detected! accel data: accel x = -0.3423, y = 0.1443, z = 9.5431 mag data: mag x = -0.063333, y = -0.248750, z = -0.517500 Please rotate the aircraft around +z axis step6 is completed! A = 4175.0000 1.912619 2.172892 2.158774 0.092122 0.183707 0.208248 calibration finished ! \u78c1\u529b\u8ba1\u8ba1\u6821\u51c6\u5b8c\u6210\u540e\uff0c\u5229\u7528 calib save \u4fdd\u5b58\u5373\u53ef\uff0c\u6570\u636e\u5c06\u5199\u5165\u5230 calibration.txt \u4e2d\u3002 Tip \u78c1\u529b\u8ba1\u7684\u6821\u51c6\u9700\u8981\u5728\u78c1\u573a\u5e72\u6270\u8f83\u5c11\u7684\u533a\u57df\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5468\u56f4\u6709\u91d1\u5c5e\u7269\u8d28\u3002 \u5176\u4ed6 \uf0c1 \u5982\u8981\u67e5\u770b\u5f53\u524d\u4f20\u611f\u5668\u6821\u51c6\u53c2\u6570\uff0c\u53ef\u4ee5\u8f93\u5165\u547d\u4ee4 calib load \uff0c\u5373\u53ef\u5217\u51fa\u5f53\u524d\u6821\u51c6\u53c2\u6570\u3002 RflyPilot\u9ed8\u8ba4\u4fdd\u5b58\u4e86\u6821\u51c6\u65f6\u8bfb\u53d6\u7684\u4f20\u611f\u5668\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5728\u6821\u51c6\u5b8c\u6210\u4e4b\u540e\u5c06\u5b58\u50a8\u5728\u5f53\u524d\u76ee\u5f55\uff0c\u5206\u522b\u540d\u4e3a accel_data.txt , gyro_data.txt , mag_data.txt \uff0c\u8fd9\u4e9b\u6570\u636e\u53ef\u7528\u4e8e\u5728MATLAB\u4e2d\u8fdb\u884c\u5904\u7406\u3002 \u9996\u6b21\u4f7f\u7528RflyPilot\u65f6\uff0c calibration.txt \u6587\u4ef6\u5e76\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u4f7f\u7528\u8005\u81ea\u884c\u521b\u5efa\u3002","title":"\u4f20\u611f\u5668\u6821\u51c6"},{"location":"Basic/calibration/#_1","text":"RflyPilot\u5185\u7f6e\u4e86\u4f20\u611f\u5668\u6821\u51c6\u529f\u80fd\uff0c\u6821\u51c6\u64cd\u4f5c\u4e3b\u8981\u901a\u8fc7\u63a7\u5236\u53f0\u547d\u4ee4\u5b9e\u73b0\uff0c\u6821\u51c6\u7ed3\u679c\u5c06\u4ee5\u6587\u672c\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u50a8\u5728RflyPilot\u98de\u63a7\u4e2d\u3002 \u5728\u8fd9\u4e4b\u524d\uff0c\u9700\u8981\u8bbe\u7f6e rflypilot.txt \u4e2d\u7684 valid_mode = 3 \uff0c\u4ee5\u542f\u7528\u5b9e\u9a8c\u6a21\u5f0f\u3002\u6821\u51c6\u53c2\u6570\u5c06\u88ab\u4ee5\u6587\u672c\u5f62\u5f0f\u5b58\u50a8\u5728 calibration.txt \uff0c\u5728\u9996\u6b21\u4f7f\u7528\u65f6\uff0c\u8be5\u6587\u4ef6\u9700\u8981\u624b\u52a8\u521b\u5efa\uff0c\u6587\u4ef6\u5185\u5bb9\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5982\u4e0b accel_scale_0 = 0.000000 accel_scale_1 = 0.000000 accel_scale_2 = 0.000000 accel_offset_0 = 0.000000 accel_offset_1 = 0.000000 accel_offset_2 = 0.000000 gyro_scale_0 = 1.000000 gyro_scale_1 = 1.000000 gyro_scale_2 = 1.000000 gyro_offset_0 = 0.000000 gyro_offset_1 = 0.000000 gyro_offset_2 = 0.000000 mag_scale_0 = 0.000000 mag_scale_1 = 0.000000 mag_scale_2 = 0.000000 mag_offset_0 = 0.000000 mag_offset_1 = 0.000000 mag_offset_2 = 0.000000 Tip \u6ce8\u610f\u6587\u4ef6\u5185\u5bb9\u7684\u683c\u5f0f\uff0c\u8981\u4fdd\u7559\u7a7a\u683c\u3002\u4e3b\u8981\u9640\u87ba\u4eea\u7684\u5c3a\u5ea6\u7cfb\u6570 gyro_scale_{0,1,2} \u5e94\u8bbe\u7f6e\u4e3a 1 \u3002","title":"\u57fa\u672c\u4f7f\u7528"},{"location":"Basic/calibration/#_2","text":"\u5728\u63a7\u5236\u53f0\u4e2d\u8f93\u5165 calib gyro \uff0c\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5373\u53ef\u5b8c\u6210\u6821\u51c6\u3002 vehicle > calib gyro gyro calibration mode Calibration thread created with process pid : 1036 Calibration starting vehicle > thread calibration running start gyro calibration process...... Please do not move the aircraft gyro calibration parameter is: gyro_x_offset = 0.013428 gyro_y_offset = 0.006644 gyro_z_offset = -0.002992 calibration finished ! Tip \u5728\u6821\u51c6\u7684\u8fc7\u7a0b\u4e2d\u4e00\u5b9a\u8981\u4fdd\u6301RflyPilot\u5904\u4e8e\u9759\u6b62\u72b6\u6001\uff1b\u8fd9\u91cc\u53ea\u6821\u51c6\u4e86\u9640\u87ba\u4eea\u7684\u96f6\u504f\uff0c\u6ca1\u6709\u6821\u51c6\u9640\u87ba\u4eea\u7684\u5c3a\u5ea6\u7cfb\u6570\u3002\u5efa\u8bae\u5728\u4e0a\u7535\u4e4b\u540eIMU\u5668\u4ef6\u6e29\u5ea6\u7a33\u5b9a\u540e\u518d\u8fdb\u884c\u6821\u51c6\u3002 \u5728\u8f93\u5165 calib save \u5373\u53ef\u4fdd\u5b58\u6821\u51c6\u6570\u636e\u3002 vehicle > calib gyro gyro calibration mode Calibration thread created with process pid : 1036 Calibration starting vehicle > thread calibration running start gyro calibration process...... Please do not move the aircraft gyro calibration parameter is: gyro_x_offset = 0.013428 gyro_y_offset = 0.006644 gyro_z_offset = -0.002992 calibration finished ! \u901a\u8fc7 calib load \u5373\u53ef\u67e5\u770b\u6821\u51c6\u53c2\u6570 vehicle > calib load LOAD calibration mode Calibration thread created with process pid : 1220 Calibration starting vehicle > thread calibration running key has 18 accel_scale_0 is 0.000000 accel_scale_1 is 0.000000 accel_scale_2 is 0.000000 accel_offset_0 is 0.000000 accel_offset_1 is 0.000000 accel_offset_2 is 0.000000 gyro_scale_0 is 1.000000 gyro_scale_1 is 1.000000 gyro_scale_2 is 1.000000 gyro_offset_0 is 0.013428 gyro_offset_1 is 0.006644 gyro_offset_2 is -0.002992 mag_scale_0 is 0.000000 mag_scale_1 is 0.000000 mag_scale_2 is 0.000000 mag_offset_0 is 0.000000 mag_offset_1 is 0.000000 mag_offset_2 is 0.000000 calibration finished ! Tip \u6821\u51c6\u7ed3\u679c\u5c06\u88ab\u5b58\u50a8\u5728\u4e0e rflypilot \u53ef\u6267\u884c\u6587\u4ef6\u540c\u7ea7\u7684 calibration.txt \u4e2d\u3002","title":"\u9640\u87ba\u4eea\u6821\u51c6"},{"location":"Basic/calibration/#_3","text":"RflyPilot\u7684\u5750\u6807\u7cfb\u5b9a\u4e49\u5982\u4e0b \u52a0\u901f\u5ea6\u8ba1\u7684\u6821\u51c6\u91c7\u7528\u4e86\u5e38\u7528\u7684\u516d\u9762\u6821\u51c6\u6cd5\u3002\u8f93\u5165\u6307\u4ee4 calib accel \uff0c\u4fbf\u5f00\u59cb\u4e86\u6821\u51c6\u3002 RflyPilot\u9996\u5148\u4f1a\u63d0\u793a\uff0c Please place the (+x) axis of the aircraft upward ,\u4f7f\u7528\u8005\u5c06 +x \u8f74\u671d\u4e0a\u9759\u7f6e\u5373\u53ef\uff0c\u5f85\u59ff\u6001\u7a33\u5b9a\u540e\uff0cRflyPilot\u5c06\u63d0\u793a Please do not move the aircraft \uff0c\u6b64\u65f6\u9700\u8981\u9759\u7f6e\u98de\u63a7\uff0cRflyPilot\u6b63\u5728\u91c7\u96c6\u52a0\u901f\u5ea6\u8ba1\u6570\u636e\u3002\u5f85\u6570\u636e\u91c7\u96c6\u5b8c\u6210\u540e\uff0c\u5c06\u4f1a\u63d0\u793a Please place the (+z) axis of the aircraft upward \uff0c\u540e\u7eed\u64cd\u4f5c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 vehicle > calib accel accel calibration mode Calibration thread created with process pid : 1406 Calibration starting vehicle > thread calibration running start accel calibration process...... Please place the (+x) axis of the aircraft upward PX_UP is detected! accel data: accel x = 9.7417, y = -0.7865, z = -0.2954 Please do not move the aircraft step1 is completed! A = 1381.0000 Please place the (+z) axis of the aircraft upward PZ_UP is detected! accel data: accel x = -0.6721, y = -0.4783, z = 9.6469 Please do not move the aircraft step2 is completed! A = 2763.0000 Please place the (-x) axis of the aircraft upward NX_UP is detected! accel data: accel x = -9.7803, y = -0.4612, z = -0.1445 Please do not move the aircraft step3 is completed! A = 4144.0000 Please place the (-z) axis of the aircraft upward NZ_UP is detected! accel data: accel x = 0.1338, y = 0.0895, z = -9.9620 Please do not move the aircraft step4 is completed! A = 5526.0000 Please place the (-y) axis of the aircraft upward NY_UP is detected! accel data: accel x = -0.2413, y = -9.8469, z = -0.2811 Please do not move the aircraft step5 is completed! A = 6908.0000 Please place the (+y) axis of the aircraft upward PY_UP is detected! accel data: accel x = 0.3244, y = 9.7597, z = 0.8039 Please do not move the aircraft step6 is completed! A = 8290.0000 1.000355 0.998360 0.997071 0.022998 0.011350 0.116596 calibration finished ! \u52a0\u901f\u5ea6\u8ba1\u6821\u51c6\u5b8c\u6210\u540e\uff0c\u5229\u7528 calib save \u4fdd\u5b58\u5373\u53ef\uff0c\u6570\u636e\u5c06\u5199\u5165\u5230 calibration.txt \u4e2d\u3002","title":"\u52a0\u901f\u5ea6\u8ba1\u6821\u51c6"},{"location":"Basic/calibration/#_4","text":"\u78c1\u529b\u8ba1\u6821\u51c6\u4f7f\u7528\u7684\u65b9\u6cd5\u662f\u692d\u7403\u62df\u5408\u3002\u8f93\u5165\u547d\u4ee4 calib mag , RflyPilot\u9996\u5148\u4f1a\u63d0\u793a\uff0c Please place the (-z) axis of the aircraft upward ,\u4f7f\u7528\u8005\u5c06 -z \u8f74\u671d\u4e0a\u9759\u7f6e\u5373\u53ef\uff0c\u5f85\u59ff\u6001\u7a33\u5b9a\u540e\uff0c\u51fa\u73b0\u63d0\u793a Please rotate the aircraft around -z axis \uff0c\u6b64\u65f6\u7ed5 -z \u8f74\u7f13\u6162\u5355\u5411\u65cb\u8f6cRflyPilot\u5373\u53ef\uff08\u65cb\u8f6c\u65b9\u5411\u4efb\u610f\uff09\uff0cRflyPilot\u9700\u8981\u4f7f\u7528\u8005\u57287\u79d2\u949f\u5185\u7ed5\u4e00\u5708\uff0c7\u79d2\u949f\u540e\uff0c\u6821\u51c6\u7a0b\u5e8f\u5c06\u81ea\u52a8\u8fdb\u5165\u4e0b\u4e00\u9636\u6bb5\uff0c Please place the (+x) axis of the aircraft upward , \u6b64\u65f6\u6309\u7167\u6b65\u9aa4\u64cd\u4f5c\u5373\u53ef\u3002 Calibration thread created with process pid : 786 Calibration starting vehicle > thread calibration running start mag calibration process......Please place the (-z) axis of the aircraft upward NZ_UP is detected! accel data: accel x = -0.2963, y = 0.3090, z = -10.0077 mag data: mag x = -0.099583, y = 0.007083, z = 0.261417 Please rotate the aircraft around -z axis step1 is completed! A = 695.0000 Please place the (+x) axis of the aircraft upward PX_UP is detected! accel data: accel x = 9.7193, y = 0.5693, z = -0.6472 mag data: mag x = -0.553500, y = -0.092667, z = -0.231417 Please rotate the aircraft around +x axis step2 is completed! A = 1391.0000 Please place the (-x) axis of the aircraft upward NX_UP is detected! accel data: accel x = -9.8372, y = 0.5258, z = -0.2316 mag data: mag x = 0.443917, y = 0.078917, z = -0.021417 Please rotate the aircraft around -x axis step3 is completed! A = 2087.0000 Please place the (-y) axis of the aircraft upward NY_UP is detected! accel data: accel x = -0.3618, y = -9.7050, z = -0.9713 mag data: mag x = 0.136000, y = 0.345000, z = -0.076250 Please rotate the aircraft around -y axis step4 is completed!A = 2783.0000 Please place the (+y) axis of the aircraft upward PY_UP is detected! accel data: accel x = 1.3548, y = 9.6512, z = 0.4473 mag data: mag x = 0.017250, y = -0.516000, z = 0.026833 Please rotate the aircraft around +y axis step5 is completed! A = 3479.0000 Please place the (+z) axis of the aircraft upward PZ_UP is detected! accel data: accel x = -0.3423, y = 0.1443, z = 9.5431 mag data: mag x = -0.063333, y = -0.248750, z = -0.517500 Please rotate the aircraft around +z axis step6 is completed! A = 4175.0000 1.912619 2.172892 2.158774 0.092122 0.183707 0.208248 calibration finished ! \u78c1\u529b\u8ba1\u8ba1\u6821\u51c6\u5b8c\u6210\u540e\uff0c\u5229\u7528 calib save \u4fdd\u5b58\u5373\u53ef\uff0c\u6570\u636e\u5c06\u5199\u5165\u5230 calibration.txt \u4e2d\u3002 Tip \u78c1\u529b\u8ba1\u7684\u6821\u51c6\u9700\u8981\u5728\u78c1\u573a\u5e72\u6270\u8f83\u5c11\u7684\u533a\u57df\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5468\u56f4\u6709\u91d1\u5c5e\u7269\u8d28\u3002","title":"\u78c1\u529b\u8ba1\u6821\u51c6"},{"location":"Basic/calibration/#_5","text":"\u5982\u8981\u67e5\u770b\u5f53\u524d\u4f20\u611f\u5668\u6821\u51c6\u53c2\u6570\uff0c\u53ef\u4ee5\u8f93\u5165\u547d\u4ee4 calib load \uff0c\u5373\u53ef\u5217\u51fa\u5f53\u524d\u6821\u51c6\u53c2\u6570\u3002 RflyPilot\u9ed8\u8ba4\u4fdd\u5b58\u4e86\u6821\u51c6\u65f6\u8bfb\u53d6\u7684\u4f20\u611f\u5668\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5728\u6821\u51c6\u5b8c\u6210\u4e4b\u540e\u5c06\u5b58\u50a8\u5728\u5f53\u524d\u76ee\u5f55\uff0c\u5206\u522b\u540d\u4e3a accel_data.txt , gyro_data.txt , mag_data.txt \uff0c\u8fd9\u4e9b\u6570\u636e\u53ef\u7528\u4e8e\u5728MATLAB\u4e2d\u8fdb\u884c\u5904\u7406\u3002 \u9996\u6b21\u4f7f\u7528RflyPilot\u65f6\uff0c calibration.txt \u6587\u4ef6\u5e76\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u4f7f\u7528\u8005\u81ea\u884c\u521b\u5efa\u3002","title":"\u5176\u4ed6"},{"location":"Basic/config/","text":"Configuration \uf0c1 TODO\u914d\u7f6e\u6e05\u5355 \uf0c1 \u5982\u4f55\u5207\u6362\u7535\u673a\u8f93\u51fa\u534f\u8bae \u4f7f\u7528\u524d\u9700\u8981\u5728rflypilot.txt\u6587\u4ef6\u6839\u636e\u81ea\u8eab\u9700\u6c42\u4fee\u6539\u63a7\u5236\u5668\u9891\u7387 \u4ee3\u7801\u751f\u6210\u6ce8\u610f\u542f\u7528long long \u7c7b\u578b \u5173\u952e\u914d\u7f6e \uf0c1 \u5728 config/configure.h \u6587\u4ef6\u4e2d #define USE_RFLYPILOT 1 \u8868\u793a\u542f\u7528RflyPilot\u786c\u4ef6 #define USE_RFLYPILOT 0 \u8868\u793a\u4f7f\u7528PilotPi\u786c\u4ef6 #define USE_ONESHOT_125 1 \u8868\u793a\u4f7f\u7528ONESHOT125\u534f\u8bae #define USE_ONESHOT_125 0 \u8868\u793a\u4f7f\u7528400Hz PWM \u57fa\u4e8eWSL\u4ea4\u53c9\u7f16\u8bd1 \uf0c1 \u5728WSL ubuntu 18.04\u4e2d\u5b89\u88c5 sudo apt-get install gcc-arm-linux-gnueabihf sudo apt-get install g++-arm-linux-gnueabihf sudo apt-get install sshpass \u539f\u751f\u7f16\u8bd1 \uf0c1 \u76ee\u524d\u539f\u751f\u7f16\u8bd1\u751f\u6210\u7684\u7a0b\u5e8f\u65e0\u6cd5\u7a33\u5b9a\u4ea7\u751flog\uff0c\u6682\u65f6\u4e0d\u5efa\u8bae\u4f7f\u7528","title":"Configuration"},{"location":"Basic/config/#configuration","text":"","title":"Configuration"},{"location":"Basic/config/#todo","text":"\u5982\u4f55\u5207\u6362\u7535\u673a\u8f93\u51fa\u534f\u8bae \u4f7f\u7528\u524d\u9700\u8981\u5728rflypilot.txt\u6587\u4ef6\u6839\u636e\u81ea\u8eab\u9700\u6c42\u4fee\u6539\u63a7\u5236\u5668\u9891\u7387 \u4ee3\u7801\u751f\u6210\u6ce8\u610f\u542f\u7528long long \u7c7b\u578b","title":"TODO\u914d\u7f6e\u6e05\u5355"},{"location":"Basic/config/#_1","text":"\u5728 config/configure.h \u6587\u4ef6\u4e2d #define USE_RFLYPILOT 1 \u8868\u793a\u542f\u7528RflyPilot\u786c\u4ef6 #define USE_RFLYPILOT 0 \u8868\u793a\u4f7f\u7528PilotPi\u786c\u4ef6 #define USE_ONESHOT_125 1 \u8868\u793a\u4f7f\u7528ONESHOT125\u534f\u8bae #define USE_ONESHOT_125 0 \u8868\u793a\u4f7f\u7528400Hz PWM","title":"\u5173\u952e\u914d\u7f6e"},{"location":"Basic/config/#wsl","text":"\u5728WSL ubuntu 18.04\u4e2d\u5b89\u88c5 sudo apt-get install gcc-arm-linux-gnueabihf sudo apt-get install g++-arm-linux-gnueabihf sudo apt-get install sshpass","title":"\u57fa\u4e8eWSL\u4ea4\u53c9\u7f16\u8bd1"},{"location":"Basic/config/#_2","text":"\u76ee\u524d\u539f\u751f\u7f16\u8bd1\u751f\u6210\u7684\u7a0b\u5e8f\u65e0\u6cd5\u7a33\u5b9a\u4ea7\u751flog\uff0c\u6682\u65f6\u4e0d\u5efa\u8bae\u4f7f\u7528","title":"\u539f\u751f\u7f16\u8bd1"},{"location":"Basic/console/","text":"\u63a7\u5236\u53f0\u529f\u80fd\u662fRflyPilot\u98de\u63a7\u7684\u4e00\u4e2a\u975e\u5e38\u5b9e\u7528\u7684\u529f\u80fd\uff0c\u5b83\u8d77\u5230\u4e86\u8fdc\u7a0b\u8c03\u8bd5\u7684\u529f\u80fd\uff0c\u5b83\u53ef\u4ee5\u4f5c\u4e3a\u7b80\u6613\u7684\u98de\u63a7\u5730\u9762\u7ad9\u529f\u80fd\u3002\u5b83\u652f\u6301\u591a\u79cd\u8c03\u8bd5\u6307\u4ee4\uff0c\u4e5f\u53ef\u4e5f\u7531\u5f00\u53d1\u8005\u81ea\u884c\u589e\u52a0\u6307\u4ee4\u3002\u4e8e\u6b64\u540c\u65f6\uff0c\u63a7\u5236\u53f0\u8fd8\u652f\u6301\u5b9e\u65f6\u663e\u793a\u5f53\u524d\u72b6\u6001\u4fe1\u606f\uff0c\u5305\u62ec\u59ff\u6001\u3001GPS\u4fe1\u53f7\u8d28\u91cf\u3001\u8fd0\u884c\u9891\u7387\u7b49\u7b49\u3002\u5728\u5ba4\u5916\u8fdb\u884c\u5b9e\u98de\u5b9e\u9a8c\u65f6\uff0c\u5229\u7528\u624b\u673aSSH\u8fde\u63a5\u5230RflyPilot\u63a7\u5236\u53f0\uff0c\u5373\u53ef\u7b80\u5355\u4fbf\u6377\u5730\u83b7\u53d6\u98de\u63a7\u72b6\u6001\u4fe1\u606f\uff0c\u67e5\u770b\u5f02\u5e38\u4fe1\u606f\u3002 \u72b6\u6001\u4fe1\u606f \uf0c1 \u5982\u4e0a\u56fe\u6240\u793a\uff0cRflyPilot\u98de\u63a7\u7684\u72b6\u6001\u4fe1\u606f\u4f1a\u5b9e\u65f6\u66f4\u65b0\u3002 \u7b26\u53f7 \u8bf4\u660e \u5355\u4f4d Timestamp \u5f53\u524d\u884c\u53d8\u91cf\u7684\u65f6\u95f4\u6233 \u5fae\u79d2 lpe p{x,y,z} LPE\u4f30\u8ba1\u4f4d\u7f6e m lpe v{x,y,z} LPE\u4f30\u8ba1\u901f\u5ea6 m/s roll/pitch/yaw \u59ff\u6001\u89d2 deg baroInnov \u6c14\u538b\u8ba1\u65b0\u606f m baroAltRef \u6c14\u538b\u8ba1\u53c2\u8003\u9ad8\u5ea6 m gpsInnovZ GPS\u5782\u5411\u65b0\u606f m gpsAltRef GPS\u9ad8\u5ea6\u53c2\u8003 m gyro_{x,y,z} \u89d2\u901f\u5ea6 deg/s accel_{x,y,z} \u52a0\u901f\u5ea6 m/s^2 mag_{x,y,z} \u78c1\u529b\u8ba1\u8f93\u51fa hacc GPS\u6c34\u5e73\u7cbe\u5ea6\u56e0\u5b50 vacc GPS\u5782\u76f4\u7cbe\u5ea6\u56e0\u5b50 sacc GPS\u901f\u5ea6\u7cbe\u5ea6\u56e0\u5b50 fixType GPS\u5de5\u4f5c\u6a21\u5f0f numSV GPS\u536b\u661f\u6570 Updated \u72b6\u6001\u4f30\u8ba1\u521d\u59cb\u5316\u5b8c\u6210\u6807\u5fd7\u4f4d imuRate IMU\u91c7\u6837\u7387 Hz ctrlRate \u63a7\u5236\u5668\u8fd0\u884c\u9891\u7387 Hz gpsRate GPS\u6570\u636e\u66f4\u65b0\u9891\u7387 Hz","title":"\u8fdc\u7a0b\u63a7\u5236\u53f0"},{"location":"Basic/console/#_1","text":"\u5982\u4e0a\u56fe\u6240\u793a\uff0cRflyPilot\u98de\u63a7\u7684\u72b6\u6001\u4fe1\u606f\u4f1a\u5b9e\u65f6\u66f4\u65b0\u3002 \u7b26\u53f7 \u8bf4\u660e \u5355\u4f4d Timestamp \u5f53\u524d\u884c\u53d8\u91cf\u7684\u65f6\u95f4\u6233 \u5fae\u79d2 lpe p{x,y,z} LPE\u4f30\u8ba1\u4f4d\u7f6e m lpe v{x,y,z} LPE\u4f30\u8ba1\u901f\u5ea6 m/s roll/pitch/yaw \u59ff\u6001\u89d2 deg baroInnov \u6c14\u538b\u8ba1\u65b0\u606f m baroAltRef \u6c14\u538b\u8ba1\u53c2\u8003\u9ad8\u5ea6 m gpsInnovZ GPS\u5782\u5411\u65b0\u606f m gpsAltRef GPS\u9ad8\u5ea6\u53c2\u8003 m gyro_{x,y,z} \u89d2\u901f\u5ea6 deg/s accel_{x,y,z} \u52a0\u901f\u5ea6 m/s^2 mag_{x,y,z} \u78c1\u529b\u8ba1\u8f93\u51fa hacc GPS\u6c34\u5e73\u7cbe\u5ea6\u56e0\u5b50 vacc GPS\u5782\u76f4\u7cbe\u5ea6\u56e0\u5b50 sacc GPS\u901f\u5ea6\u7cbe\u5ea6\u56e0\u5b50 fixType GPS\u5de5\u4f5c\u6a21\u5f0f numSV GPS\u536b\u661f\u6570 Updated \u72b6\u6001\u4f30\u8ba1\u521d\u59cb\u5316\u5b8c\u6210\u6807\u5fd7\u4f4d imuRate IMU\u91c7\u6837\u7387 Hz ctrlRate \u63a7\u5236\u5668\u8fd0\u884c\u9891\u7387 Hz gpsRate GPS\u6570\u636e\u66f4\u65b0\u9891\u7387 Hz","title":"\u72b6\u6001\u4fe1\u606f"},{"location":"Basic/hardware_connection/","text":"\u672c\u8282\u5c06\u4ecb\u7ecdRflyPilot\u7684\u786c\u4ef6\u8fde\u63a5\u60c5\u51b5\uff0c\u4ee5\u53ca\u5728\u4e0d\u540c\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\u4e0b\u7684\u6700\u5c0f\u786c\u4ef6\u914d\u7f6e\u65b9\u6848\u3002 RflyPilot\u5e95\u677f\u7684\u786c\u4ef6\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a IMU\u4f20\u611f\u5668\u677f\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u2469\u5e94\u4e0e\u53f8\u76f8\u8fde \u7ebf\u5e8f\u4ecb\u7ecd \uf0c1 \u2460\u8f85\u52a9PWM\u63a5\u53e3\uff08\u7528\u4e8e\u8235\u673a\u7b49\uff09 \u5de6 \u53f3 GND PWM1 PWM2 PWM3 PWM4 PWM5 PWM6 PWM7 PWM8 5V \u2461\u4e3bPWM\u63a5\u53e3\uff08\u7528\u4e8e\u7535\u8c03\uff09 \u5de6 \u53f3 GND PWM1 PWM2 PWM3 PWM4 PWM5 PWM6 PWM7 PWM8 5V \u2462\u9884\u7559\u4e32\u53e3 \u5de6 \u53f3 GND RTSB CTSB RXB TXB 5V \u2463IMU\u63a5\u53e3 \u4e0a \u4e0b GND MISO MOSI CLK CS 3V3 \u2464SBUS/IBUS\u63a5\u6536\u673a\u63a5\u53e3 \u5de6 \u53f3 GND NC NC RC 5V \u2465GPS\u63a5\u53e3 \u5de6 \u53f3 5V TX RX SCL SDA NC NC 3V3 NC GND \u2466\u5916\u7f6eIIC\u603b\u7ebf\u63a5\u53e3 \u5de6 \u53f3 5V SCL SDA GND \u2467\u7535\u6e90\u6a21\u5757\u63a5\u53e3(\u63a8\u8350PM06) \u4e0a \u4e0b 5V 5V BAT_V BAT_I GND GND \u2468Type-C USB \u6ce8\u610f \u9ed8\u8ba4\u8be5TypeC\u63a5\u53e3\u5141\u8bb8\u4f5c\u4e3a\u7535\u6e90\u8f93\u5165\u63a5\u53e3\uff0c\u4f46\u65e0\u6cd5\u5bf9\u5916\u4f9b\u7535\u3002\u5982\u9700\u4f9b\u7535\u9700\u77ed\u63a5\u7535\u8def\u677f\u4e0a\u7684 D1 \u4e8c\u6781\u7ba1\u3002 \u2469IMU\u677f\u63a5\u53e3 \u4e0a \u4e0b 3V3 CS CLK MOSI MISO GND \u8fde\u63a5\u8bf4\u660e \uf0c1 MIL\u4eff\u771f \uf0c1 \u7531\u4e8eMIL\u4eff\u771f\u7684\u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eSimulink\u4e2d\uff0c\u6545\u5176\u5e76\u4e0d\u9700\u8981RflyPilot\u98de\u63a7\u786c\u4ef6\u3002\u4e3a\u4e86\u8ba9\u4eff\u771f\u65f6\u98de\u884c\u5668\u5177\u6709\u66f4\u597d\u5730\u64cd\u63a7\u6027\uff0c\u53ef\u4ee5\u5c06\u9065\u63a7\u5668\u8fde\u63a5\u81f3\u8ba1\u7b97\u673a\u3002\u8fd9\u4e00\u5c0f\u7ed3\u5c06\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u8fde\u63a5\u9065\u63a7\u5668\u7528\u4ee5\u8fdb\u884cMIL\u4eff\u771f\u3002 \u9700\u8981\u7528\u4e00\u6839USB\u7ebf\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u6b64\u65f6\u4fbf\u53ef\u4ee5\u901a\u8fc7\u9065\u63a7\u5668\u63a7\u5236Simulink\u4e2d\u7684\u4eff\u771f\u6a21\u578b\u3002\u8fd9\u91cc\u7b14\u8005\u4f7f\u7528\u7684\u662f\u5bcc\u65af\u7684\u9065\u63a7\u5668\uff0c\u8be5\u9065\u63a7\u5668\u53ef\u4ee5\u4f5c\u4e3a\u8ba1\u7b97\u673a\u7684\u8f93\u5165\u8bbe\u5907\uff0c\u540c\u65f6Simulink\u4e2d\u4e5f\u6709\u76f8\u5e94\u7684\u7ec4\u4ef6\u652f\u6301\uff08Pilot Joystick\uff09\uff0c\u9a71\u52a8\u6b63\u786e\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5c06\u5728\u8bbe\u5907\u7ba1\u7406\u5668\u4e2d\u51fa\u73b0\u201c\u4eba\u673a\u63a5\u53e3\u8bbe\u5907/HID-compliant game controller\u201d\u3002 \u9065\u63a7\u5668\u6307\u4ee4\u8f93\u5165\u5bf9\u5e94 MIL \u4eff\u771f\u6a21\u578b\u4e2d\u7684 Real RC \u6a21\u5757\u3002 Tips Simulink\u4e2d\u7684 Pilot Joystick \u6a21\u5757\uff0c\u9664\u4e86\u652f\u6301\u5bcc\u65af\u7684\u8fd9\u6b3e\u9065\u63a7\u5668\u4e4b\u5916\uff0c\u4e5f\u652f\u6301\u5176\u4ed6\u9065\u63a7\u5668\uff0c\u7b14\u8005\u5728\u8fd9\u91cc\u6ca1\u6709\u8fc7\u591a\u5c1d\u8bd5\u3002 SIH\u4eff\u771f \uf0c1 \u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u98de\u63a7\u8f6f\u4ef6\u548c\u88ab\u63a7\u5bf9\u8c61\u90fd\u8fd0\u884c\u5728RflyPilot\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8fde\u63a5\u5230\u98de\u884c\u5668\u672c\u4f53\u4e0a\uff0c\u4f46\u662f\u7531\u4e8e\u4eff\u771f\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8f93\u5165\u63a7\u5236\u6307\u4ee4\uff0c\u6b64\u65f6\uff0c\u8fd8\u9700\u8981\u5c06\u9065\u63a7\u5668\u7684\u63a5\u6536\u673a\u8fde\u63a5\u5230RflyPilot\u4e0a\u3002 \u6545\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u786c\u4ef6\u51c6\u5907\u4e0a\uff0c\u53ea\u9700\u8981RflyPilot\u4e0e\u9065\u63a7\u5668\u548c\u63a5\u6536\u673a\uff0c\u6700\u540e\u901a\u8fc7WIFI\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u5728RflySim3D\u4e0a\u8fdb\u884c\u663e\u793a\u3002 HIL\u4eff\u771f \uf0c1 HIL\u4eff\u771f\u76f8\u6bd4\u4e8e\u5b9e\u98de\u5b9e\u9a8c\u7684\u533a\u522b\u662fRflyPilot\u98de\u63a7\u76f4\u63a5\u8fde\u63a5\u5230\u534a\u7269\u7406\u4eff\u771f\u7cfb\u7edf\u4e0a\u800c\u4e0d\u662f\u8fde\u63a5\u5230\u771f\u5b9e\u7684\u98de\u673a\u4e0a\u3002\u6240\u4ee5\u8fdb\u884cHIL\u4eff\u771f\u9700\u8981\u534a\u7269\u7406\u4eff\u771f\u7cfb\u7edf\uff0c\u8fd9\u91cc\u7b14\u8005\u91c7\u7528\u7684\u662f\u8bfe\u9898\u7ec4\u81ea\u7814\u7684 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \u3002\u5229\u7528\u8be5\u5e73\u53f0\u53ef\u4ee5\u5b8c\u6210\u88ab\u63a7\u5bf9\u8c61\u7684\u6a21\u62df\uff0c\u540c\u65f6\u4e5f\u5229\u7528\u5176\u5f3a\u5927\u7684FPGA\uff0c\u5b9e\u73b0\u4f20\u611f\u5668\u7ea7\u7684\u7cbe\u7ec6\u6a21\u62df\u3002 \u7531\u4e8e\u8fdb\u884cHIL\u4eff\u771f\u5e76\u4e0d\u9700\u8981\u771f\u5b9e\u7684\u4f20\u611f\u5668\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8fdb\u884cHIL\u4eff\u771f\uff0c\u7b14\u8005\u76f4\u63a5\u4f7f\u7528\u6811\u8393\u6d3e4B\u548c\u201cRflysim for Pilot\"\u63a5\u53e3\u677f\u4ee3\u66ffRflyPilot\u8fde\u63a5\u5230\u786c\u4ef6\u5728\u73af\u4eff\u771f\u5e73\u53f0\u4e0a\u3002 \u5c06\u4ee5\u4e0a\u4e24\u4e2a\u7ec4\u4ef6\u62fc\u63a5\u5b8c\u6210\u540e\uff0c\u5f97\u5230\u4e86\u53ef\u4ee5\u7528\u4e8e\u786c\u4ef6\u5728\u73af\u4eff\u771f\u7684RflyPilot\u3002 \u6ce8\u610f \u7531\u4e8e\u524d\u671f\u786c\u4ef6\u7535\u8def\u8bbe\u8ba1\u5b58\u5728\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u4e32\u53e3\u82af\u7247 SC16IS752IPW \u7684\u4e2d\u65ad\u5f15\u811a\u6ca1\u6709\u8fde\u63a5\u5230\u6811\u8393\u6d3e\u7684 BCM24 \u53f7\u5f15\u811a\uff0c\u6545\u8fd9\u91cc\u589e\u52a0\u4e86\u7ea2\u8272\u98de\u7ebf \u53c2\u8003 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \u4e2d\u7684\u6559\u7a0b\u8fdb\u884c\u786c\u4ef6\u8fde\u63a5\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u534a\u7269\u7406\u8054\u5408\u4eff\u771f\u5e73\u53f0\u3002 Tip \u7531\u4e8e\u98de\u63a7\u8fd0\u884c\u65f6\u5904\u7406\u5668\u529f\u7387\u589e\u52a0\uff0c\u4e3a\u4fdd\u969c\u8ba1\u7b97\u6027\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528\u5927\u529f\u7387\u7535\u6e90\u8fde\u63a5\u6811\u8393\u6d3e\u3002 \u5b9e\u98de\u5b9e\u9a8c \uf0c1 \u5b9e\u98de\u5b9e\u9a8c\u7684\u786c\u4ef6\u8fde\u63a5\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u56fe\u3002 Tip RflyPilot\u5728\u5de5\u4f5c\u65f6\u5bf9\u7535\u6e90\u529f\u7387\u6709\u4e00\u5b9a\u7684\u8981\u6c42\uff0c\u8fd9\u91cc\u63a8\u8350\u8bfb\u8005\u4f7f\u7528 PM06 \u7535\u6e90\u6a21\u5757\u3002","title":"\u786c\u4ef6\u8fde\u63a5"},{"location":"Basic/hardware_connection/#_1","text":"\u2460\u8f85\u52a9PWM\u63a5\u53e3\uff08\u7528\u4e8e\u8235\u673a\u7b49\uff09 \u5de6 \u53f3 GND PWM1 PWM2 PWM3 PWM4 PWM5 PWM6 PWM7 PWM8 5V \u2461\u4e3bPWM\u63a5\u53e3\uff08\u7528\u4e8e\u7535\u8c03\uff09 \u5de6 \u53f3 GND PWM1 PWM2 PWM3 PWM4 PWM5 PWM6 PWM7 PWM8 5V \u2462\u9884\u7559\u4e32\u53e3 \u5de6 \u53f3 GND RTSB CTSB RXB TXB 5V \u2463IMU\u63a5\u53e3 \u4e0a \u4e0b GND MISO MOSI CLK CS 3V3 \u2464SBUS/IBUS\u63a5\u6536\u673a\u63a5\u53e3 \u5de6 \u53f3 GND NC NC RC 5V \u2465GPS\u63a5\u53e3 \u5de6 \u53f3 5V TX RX SCL SDA NC NC 3V3 NC GND \u2466\u5916\u7f6eIIC\u603b\u7ebf\u63a5\u53e3 \u5de6 \u53f3 5V SCL SDA GND \u2467\u7535\u6e90\u6a21\u5757\u63a5\u53e3(\u63a8\u8350PM06) \u4e0a \u4e0b 5V 5V BAT_V BAT_I GND GND \u2468Type-C USB \u6ce8\u610f \u9ed8\u8ba4\u8be5TypeC\u63a5\u53e3\u5141\u8bb8\u4f5c\u4e3a\u7535\u6e90\u8f93\u5165\u63a5\u53e3\uff0c\u4f46\u65e0\u6cd5\u5bf9\u5916\u4f9b\u7535\u3002\u5982\u9700\u4f9b\u7535\u9700\u77ed\u63a5\u7535\u8def\u677f\u4e0a\u7684 D1 \u4e8c\u6781\u7ba1\u3002 \u2469IMU\u677f\u63a5\u53e3 \u4e0a \u4e0b 3V3 CS CLK MOSI MISO GND","title":"\u7ebf\u5e8f\u4ecb\u7ecd"},{"location":"Basic/hardware_connection/#_2","text":"","title":"\u8fde\u63a5\u8bf4\u660e"},{"location":"Basic/hardware_connection/#mil","text":"\u7531\u4e8eMIL\u4eff\u771f\u7684\u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eSimulink\u4e2d\uff0c\u6545\u5176\u5e76\u4e0d\u9700\u8981RflyPilot\u98de\u63a7\u786c\u4ef6\u3002\u4e3a\u4e86\u8ba9\u4eff\u771f\u65f6\u98de\u884c\u5668\u5177\u6709\u66f4\u597d\u5730\u64cd\u63a7\u6027\uff0c\u53ef\u4ee5\u5c06\u9065\u63a7\u5668\u8fde\u63a5\u81f3\u8ba1\u7b97\u673a\u3002\u8fd9\u4e00\u5c0f\u7ed3\u5c06\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u8fde\u63a5\u9065\u63a7\u5668\u7528\u4ee5\u8fdb\u884cMIL\u4eff\u771f\u3002 \u9700\u8981\u7528\u4e00\u6839USB\u7ebf\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u6b64\u65f6\u4fbf\u53ef\u4ee5\u901a\u8fc7\u9065\u63a7\u5668\u63a7\u5236Simulink\u4e2d\u7684\u4eff\u771f\u6a21\u578b\u3002\u8fd9\u91cc\u7b14\u8005\u4f7f\u7528\u7684\u662f\u5bcc\u65af\u7684\u9065\u63a7\u5668\uff0c\u8be5\u9065\u63a7\u5668\u53ef\u4ee5\u4f5c\u4e3a\u8ba1\u7b97\u673a\u7684\u8f93\u5165\u8bbe\u5907\uff0c\u540c\u65f6Simulink\u4e2d\u4e5f\u6709\u76f8\u5e94\u7684\u7ec4\u4ef6\u652f\u6301\uff08Pilot Joystick\uff09\uff0c\u9a71\u52a8\u6b63\u786e\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5c06\u5728\u8bbe\u5907\u7ba1\u7406\u5668\u4e2d\u51fa\u73b0\u201c\u4eba\u673a\u63a5\u53e3\u8bbe\u5907/HID-compliant game controller\u201d\u3002 \u9065\u63a7\u5668\u6307\u4ee4\u8f93\u5165\u5bf9\u5e94 MIL \u4eff\u771f\u6a21\u578b\u4e2d\u7684 Real RC \u6a21\u5757\u3002 Tips Simulink\u4e2d\u7684 Pilot Joystick \u6a21\u5757\uff0c\u9664\u4e86\u652f\u6301\u5bcc\u65af\u7684\u8fd9\u6b3e\u9065\u63a7\u5668\u4e4b\u5916\uff0c\u4e5f\u652f\u6301\u5176\u4ed6\u9065\u63a7\u5668\uff0c\u7b14\u8005\u5728\u8fd9\u91cc\u6ca1\u6709\u8fc7\u591a\u5c1d\u8bd5\u3002","title":"MIL\u4eff\u771f"},{"location":"Basic/hardware_connection/#sih","text":"\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u98de\u63a7\u8f6f\u4ef6\u548c\u88ab\u63a7\u5bf9\u8c61\u90fd\u8fd0\u884c\u5728RflyPilot\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8fde\u63a5\u5230\u98de\u884c\u5668\u672c\u4f53\u4e0a\uff0c\u4f46\u662f\u7531\u4e8e\u4eff\u771f\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8f93\u5165\u63a7\u5236\u6307\u4ee4\uff0c\u6b64\u65f6\uff0c\u8fd8\u9700\u8981\u5c06\u9065\u63a7\u5668\u7684\u63a5\u6536\u673a\u8fde\u63a5\u5230RflyPilot\u4e0a\u3002 \u6545\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u786c\u4ef6\u51c6\u5907\u4e0a\uff0c\u53ea\u9700\u8981RflyPilot\u4e0e\u9065\u63a7\u5668\u548c\u63a5\u6536\u673a\uff0c\u6700\u540e\u901a\u8fc7WIFI\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u5728RflySim3D\u4e0a\u8fdb\u884c\u663e\u793a\u3002","title":"SIH\u4eff\u771f"},{"location":"Basic/hardware_connection/#hil","text":"HIL\u4eff\u771f\u76f8\u6bd4\u4e8e\u5b9e\u98de\u5b9e\u9a8c\u7684\u533a\u522b\u662fRflyPilot\u98de\u63a7\u76f4\u63a5\u8fde\u63a5\u5230\u534a\u7269\u7406\u4eff\u771f\u7cfb\u7edf\u4e0a\u800c\u4e0d\u662f\u8fde\u63a5\u5230\u771f\u5b9e\u7684\u98de\u673a\u4e0a\u3002\u6240\u4ee5\u8fdb\u884cHIL\u4eff\u771f\u9700\u8981\u534a\u7269\u7406\u4eff\u771f\u7cfb\u7edf\uff0c\u8fd9\u91cc\u7b14\u8005\u91c7\u7528\u7684\u662f\u8bfe\u9898\u7ec4\u81ea\u7814\u7684 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \u3002\u5229\u7528\u8be5\u5e73\u53f0\u53ef\u4ee5\u5b8c\u6210\u88ab\u63a7\u5bf9\u8c61\u7684\u6a21\u62df\uff0c\u540c\u65f6\u4e5f\u5229\u7528\u5176\u5f3a\u5927\u7684FPGA\uff0c\u5b9e\u73b0\u4f20\u611f\u5668\u7ea7\u7684\u7cbe\u7ec6\u6a21\u62df\u3002 \u7531\u4e8e\u8fdb\u884cHIL\u4eff\u771f\u5e76\u4e0d\u9700\u8981\u771f\u5b9e\u7684\u4f20\u611f\u5668\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8fdb\u884cHIL\u4eff\u771f\uff0c\u7b14\u8005\u76f4\u63a5\u4f7f\u7528\u6811\u8393\u6d3e4B\u548c\u201cRflysim for Pilot\"\u63a5\u53e3\u677f\u4ee3\u66ffRflyPilot\u8fde\u63a5\u5230\u786c\u4ef6\u5728\u73af\u4eff\u771f\u5e73\u53f0\u4e0a\u3002 \u5c06\u4ee5\u4e0a\u4e24\u4e2a\u7ec4\u4ef6\u62fc\u63a5\u5b8c\u6210\u540e\uff0c\u5f97\u5230\u4e86\u53ef\u4ee5\u7528\u4e8e\u786c\u4ef6\u5728\u73af\u4eff\u771f\u7684RflyPilot\u3002 \u6ce8\u610f \u7531\u4e8e\u524d\u671f\u786c\u4ef6\u7535\u8def\u8bbe\u8ba1\u5b58\u5728\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u4e32\u53e3\u82af\u7247 SC16IS752IPW \u7684\u4e2d\u65ad\u5f15\u811a\u6ca1\u6709\u8fde\u63a5\u5230\u6811\u8393\u6d3e\u7684 BCM24 \u53f7\u5f15\u811a\uff0c\u6545\u8fd9\u91cc\u589e\u52a0\u4e86\u7ea2\u8272\u98de\u7ebf \u53c2\u8003 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u5e73\u53f0 \u4e2d\u7684\u6559\u7a0b\u8fdb\u884c\u786c\u4ef6\u8fde\u63a5\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u534a\u7269\u7406\u8054\u5408\u4eff\u771f\u5e73\u53f0\u3002 Tip \u7531\u4e8e\u98de\u63a7\u8fd0\u884c\u65f6\u5904\u7406\u5668\u529f\u7387\u589e\u52a0\uff0c\u4e3a\u4fdd\u969c\u8ba1\u7b97\u6027\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528\u5927\u529f\u7387\u7535\u6e90\u8fde\u63a5\u6811\u8393\u6d3e\u3002","title":"HIL\u4eff\u771f"},{"location":"Basic/hardware_connection/#_3","text":"\u5b9e\u98de\u5b9e\u9a8c\u7684\u786c\u4ef6\u8fde\u63a5\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u56fe\u3002 Tip RflyPilot\u5728\u5de5\u4f5c\u65f6\u5bf9\u7535\u6e90\u529f\u7387\u6709\u4e00\u5b9a\u7684\u8981\u6c42\uff0c\u8fd9\u91cc\u63a8\u8350\u8bfb\u8005\u4f7f\u7528 PM06 \u7535\u6e90\u6a21\u5757\u3002","title":"\u5b9e\u98de\u5b9e\u9a8c"},{"location":"Basic/logger/","text":"RflyPilot\u652f\u6301\u591a\u79cd\u65e5\u5fd7\u7cfb\u7edf\uff0c\u5305\u62eculog\uff0c\u672c\u5c0f\u7ed3\u5c06\u5bf9ulog\u7684\u4f7f\u7528\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002 Ulog\u7b80\u4ecb \uf0c1 ULog\u662f\u7528\u4e8e\u8bb0\u5f55\u6d88\u606f\u7684\u6587\u4ef6\u683c\u5f0f\u3002\u8be5\u683c\u5f0f\u662f\u81ea\u5305\u542b\u7684\uff0c\u5373\u5b83\u5305\u542b\u8bb0\u5f55\u7684\u683c\u5f0f\u548c\u6d88\u606f\u7c7b\u578b\u3002\u5173\u4e8eUlog\u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 ULog\u6587\u4ef6\u683c\u5f0f \u3002 \u57fa\u672c\u914d\u7f6e \uf0c1 \u542f\u7528\u7cfb\u7edf\u65e5\u5fd7\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 rflypilot.txt \uff0c\u4f7f sys_log_en = 1 \uff0c\u5373\u53ef\u542f\u7528\u8bb0\u5f55\u7cfb\u7edf\u65e5\u5fd7\u3002\u9ed8\u8ba4\u9891\u7387\u4e3a50Hz\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 src/application/ulog_thread.cpp \u6587\u4ef6\u6539\u53d8\u65e5\u5fd7\u8bb0\u5f55\u9891\u7387\u3002 void * thread_ulog(void * dir) { core_bind(ULOG_CORE); timespec thread_log_sleep; thread_log_sleep.tv_sec = 0; thread_log_sleep.tv_nsec = 20*1000*1000;//20ms \u9ed8\u8ba450Hz \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u8fd0\u884c ./rflypilot \uff0c\u5373\u53ef\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5 log \u5f00\u5934\u5e76\u5305\u542b\u65f6\u95f4\u7684\u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u50a8log\u3002 Warning \u6ce8\uff1aRflyPilot\u9ed8\u8ba4\u53ea\u4f1a\u5728EXP\u548cHIL\u6a21\u5f0f\u4e0b\u542f\u7528ulog\u8bb0\u5f55\u7ebf\u7a0b\u3002\u65e5\u5fd7\u8bb0\u5f55\u9891\u7387\u4e0d\u53ef\u8fc7\u9ad8\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u8d44\u6e90\u7d27\u5f20\u3002 \u65e5\u5fd7\u7684\u89e3\u6790 \uf0c1 \u8bb0\u5f55\u5f97\u5230\u7684ulog\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u901a\u8fc7SSH\u62f7\u8d1d\u5230\u8ba1\u7b97\u673a\u4e2d\u7528 ulog2csv \u51fd\u6570\u8fdb\u884c\u89e3\u6790\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u65e5\u5fd7\u67e5\u770b\u5de5\u5177 FlightPlot \uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002","title":"\u65e5\u5fd7\u7cfb\u7edf"},{"location":"Basic/logger/#ulog","text":"ULog\u662f\u7528\u4e8e\u8bb0\u5f55\u6d88\u606f\u7684\u6587\u4ef6\u683c\u5f0f\u3002\u8be5\u683c\u5f0f\u662f\u81ea\u5305\u542b\u7684\uff0c\u5373\u5b83\u5305\u542b\u8bb0\u5f55\u7684\u683c\u5f0f\u548c\u6d88\u606f\u7c7b\u578b\u3002\u5173\u4e8eUlog\u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 ULog\u6587\u4ef6\u683c\u5f0f \u3002","title":"Ulog\u7b80\u4ecb"},{"location":"Basic/logger/#_1","text":"\u542f\u7528\u7cfb\u7edf\u65e5\u5fd7\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 rflypilot.txt \uff0c\u4f7f sys_log_en = 1 \uff0c\u5373\u53ef\u542f\u7528\u8bb0\u5f55\u7cfb\u7edf\u65e5\u5fd7\u3002\u9ed8\u8ba4\u9891\u7387\u4e3a50Hz\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 src/application/ulog_thread.cpp \u6587\u4ef6\u6539\u53d8\u65e5\u5fd7\u8bb0\u5f55\u9891\u7387\u3002 void * thread_ulog(void * dir) { core_bind(ULOG_CORE); timespec thread_log_sleep; thread_log_sleep.tv_sec = 0; thread_log_sleep.tv_nsec = 20*1000*1000;//20ms \u9ed8\u8ba450Hz \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u8fd0\u884c ./rflypilot \uff0c\u5373\u53ef\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5 log \u5f00\u5934\u5e76\u5305\u542b\u65f6\u95f4\u7684\u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u50a8log\u3002 Warning \u6ce8\uff1aRflyPilot\u9ed8\u8ba4\u53ea\u4f1a\u5728EXP\u548cHIL\u6a21\u5f0f\u4e0b\u542f\u7528ulog\u8bb0\u5f55\u7ebf\u7a0b\u3002\u65e5\u5fd7\u8bb0\u5f55\u9891\u7387\u4e0d\u53ef\u8fc7\u9ad8\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u8d44\u6e90\u7d27\u5f20\u3002","title":"\u57fa\u672c\u914d\u7f6e"},{"location":"Basic/logger/#_2","text":"\u8bb0\u5f55\u5f97\u5230\u7684ulog\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u901a\u8fc7SSH\u62f7\u8d1d\u5230\u8ba1\u7b97\u673a\u4e2d\u7528 ulog2csv \u51fd\u6570\u8fdb\u884c\u89e3\u6790\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u65e5\u5fd7\u67e5\u770b\u5de5\u5177 FlightPlot \uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002","title":"\u65e5\u5fd7\u7684\u89e3\u6790"},{"location":"Basic/paramupdate/","text":"RflyPilot\u652f\u6301\u5728\u7ebf\u8c03\u53c2\u529f\u80fd\uff0c\u5141\u8bb8\u5728\u98de\u63a7\u8fd0\u884c\u65f6\u8fdb\u884c\u53c2\u6570\u4fee\u6539\u4e0e\u66f4\u65b0\u3002 MIL \uf0c1 \u89e3\u538b\u5de5\u7a0b\u6587\u4ef6\u4e2d slib/rflypilotblock.zip \uff0c\u5e76\u6dfb\u52a0\u5230\u5de5\u7a0b\u8def\u5f84\u4e2d\uff0c\u8fd0\u884c\u811a\u672c slblocks.m \uff0c\u6b64\u65f6RflyPilot\u6a21\u5757\u4fbf\u88ab\u52a0\u8f7d\u5230Simulink\u4e2d\uff0c\u6b64\u65f6\u6253\u5f00 MIL_HIL.slx \u6a21\u578b\u6587\u4ef6\uff0c\u5373\u53ef\u5728\u201c\u5e93\u6d4f\u89c8\u5668\u201d\u4e2d\u770b\u5230\u76f8\u5e94\u7684\u6a21\u5757\u3002\u76f8\u5e94\u7684\u8c03\u7528\u793a\u4f8b\uff0c\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003 RflyPilot_Model/debug_tools/ParamUpdate.slx \u6587\u4ef6\uff0c\u8bfb\u8005\u53ef\u4ee5\u5c06\u6539\u6a21\u5757\u590d\u5236\u5230MIL\u4eff\u771f\u6a21\u578b\u4e2d\u3002 \u8be5\u53c2\u6570\u6a21\u5757\u5728\u6a21\u578b\u9996\u6b21\u8fd0\u884c\u65f6\u5c06\u8fd0\u884c\u4e00\u6b21\uff0c\u8bfb\u53d6\u76f8\u5e94\u5b57\u7b26\u4e32\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u800c\u540e\u5728 param_read_flag \u7684\u4e0a\u5347\u6cbf\u65f6\u5c06\u518d\u6b21\u89e6\u53d1\uff0c\u7ee7\u7eed\u8bfb\u53d6\u53c2\u6570\uff0c\u4ee5\u5b9e\u73b0\u53c2\u6570\u66f4\u65b0\u7684\u76ee\u7684\u3002 \u5c06 parameter.txt \u62f7\u8d1d\u5230\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u6a21\u578b\u5728\u8fd0\u884c\u65f6\u5c06\u4f1a\u4ece\u4e2d\u8bfb\u53d6\u53c2\u6570\u3002 \u8bbe\u7f6e get_param \u6a21\u5757\u7684\u91c7\u6837\u5468\u671f\u4e3a -1 \u3002\u5e76\u8bbe\u7f6e param_name \u4e3a test_data \u3002 \u73b0\u7ed9 param_read_flag \u8109\u51b2\u4fe1\u53f7\uff0c\u5219\u5c06\u5728\u8109\u51b2\u7684\u4e0a\u5347\u6cbf\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\uff0c\u6700\u540e\u663e\u793a\u5230\u793a\u6ce2\u5668\u4e2d\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5728\u4eff\u771f\u7684\u8fc7\u7a0b\u4e2d\u4fee\u6539 parameter.txt \u4e2d\u7684 test_data \u6570\u503c\uff0c\u793a\u6ce2\u5668\u4e2d\u7684\u6570\u503c\u4f1a\u53d1\u751f\u76f8\u5e94\u7684\u53d8\u5316\uff0c\u800c\u53d8\u5316\u5468\u671f\u4e0e\u8109\u51b2\u4fe1\u53f7\u5468\u671f\u76f8\u540c\u3002 Tip \u5f3a\u70c8\u5efa\u8bae\u5f00\u53d1\u8005\u81ea\u884c\u5f15\u5165 param_read_flag \u4fe1\u53f7\uff0c\u6bd4\u5982\u7531\u9065\u63a7\u5668\u7684\u5f00\u5173\u89e6\u53d1\uff0c\u5728\u4fee\u6539\u5b8c parameter.txt \u540e\uff0c\u901a\u8fc7\u9065\u63a7\u5668\u5f00\u5173\u89e6\u53d1\uff0c\u8fd9\u6837\u7684\u89e6\u53d1\u65b9\u5f0f\u6709\u5229\u4e8e\u964d\u4f4e\u53c2\u6570\u66f4\u65b0\u6a21\u5757\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u5360\u7528\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u53c2\u6570\u66f4\u65b0\u6a21\u5757\u5728\u6bcf\u6b21\u53c2\u6570\u66f4\u65b0\u65f6\u5747\u4f1a\u6267\u884c\u8bfb\u64cd\u4f5c\uff0c\u5e76\u4e14\u4f1a\u904d\u5386 parameter.txt \uff0c\u5982\u679c\u53ea\u4f7f\u7528\u8109\u51b2\u4fe1\u53f7\u89e6\u53d1\uff0c\u6bd4\u5982\u4f1a\u9020\u6210\u7cfb\u7edf\u8d44\u6e90\u7684\u6781\u5927\u6d6a\u8d39\uff0c\u540c\u65f6\u53ef\u9760\u6027\u4e0d\u9ad8\u3002 SIH/HIL/EXP \uf0c1 \u53c2\u6570\u66f4\u65b0\u6a21\u5757\u540c\u6837\u53ef\u4ee5\u8fd0\u7528\u5728SIH/HIL\u6a21\u5f0f\u548c\u5b9e\u9a8c\u4e2d\u3002\u5176\u4f7f\u7528\u65b9\u6cd5\u4e0eMIL\u5dee\u522b\u4e0d\u5927\uff0c\u4ec5\u9700\u5c06 parameter.txt \u6587\u4ef6\u66f4\u65b0\u5230RflyPilot\u98de\u63a7\u6e90\u7801\u7684 config/parameter.txt \u4e2d\uff0c\u5728\u4f7f\u7528RflyPilotTools\u8fdb\u884c\u4e0a\u4f20\u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u81ea\u52a8\u4e0a\u4f20\u81f3RflyPilot\u98de\u63a7\u4e2d\u3002\u5728\u6b64\u6a21\u5f0f\u4e2d\uff0c\u7b14\u8005\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u9065\u63a7\u5668\u5f00\u5173\u89e6\u53d1\u53c2\u6570\u66f4\u65b0\u3002","title":"\u5728\u7ebf\u8c03\u53c2"},{"location":"Basic/paramupdate/#mil","text":"\u89e3\u538b\u5de5\u7a0b\u6587\u4ef6\u4e2d slib/rflypilotblock.zip \uff0c\u5e76\u6dfb\u52a0\u5230\u5de5\u7a0b\u8def\u5f84\u4e2d\uff0c\u8fd0\u884c\u811a\u672c slblocks.m \uff0c\u6b64\u65f6RflyPilot\u6a21\u5757\u4fbf\u88ab\u52a0\u8f7d\u5230Simulink\u4e2d\uff0c\u6b64\u65f6\u6253\u5f00 MIL_HIL.slx \u6a21\u578b\u6587\u4ef6\uff0c\u5373\u53ef\u5728\u201c\u5e93\u6d4f\u89c8\u5668\u201d\u4e2d\u770b\u5230\u76f8\u5e94\u7684\u6a21\u5757\u3002\u76f8\u5e94\u7684\u8c03\u7528\u793a\u4f8b\uff0c\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003 RflyPilot_Model/debug_tools/ParamUpdate.slx \u6587\u4ef6\uff0c\u8bfb\u8005\u53ef\u4ee5\u5c06\u6539\u6a21\u5757\u590d\u5236\u5230MIL\u4eff\u771f\u6a21\u578b\u4e2d\u3002 \u8be5\u53c2\u6570\u6a21\u5757\u5728\u6a21\u578b\u9996\u6b21\u8fd0\u884c\u65f6\u5c06\u8fd0\u884c\u4e00\u6b21\uff0c\u8bfb\u53d6\u76f8\u5e94\u5b57\u7b26\u4e32\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u800c\u540e\u5728 param_read_flag \u7684\u4e0a\u5347\u6cbf\u65f6\u5c06\u518d\u6b21\u89e6\u53d1\uff0c\u7ee7\u7eed\u8bfb\u53d6\u53c2\u6570\uff0c\u4ee5\u5b9e\u73b0\u53c2\u6570\u66f4\u65b0\u7684\u76ee\u7684\u3002 \u5c06 parameter.txt \u62f7\u8d1d\u5230\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u6a21\u578b\u5728\u8fd0\u884c\u65f6\u5c06\u4f1a\u4ece\u4e2d\u8bfb\u53d6\u53c2\u6570\u3002 \u8bbe\u7f6e get_param \u6a21\u5757\u7684\u91c7\u6837\u5468\u671f\u4e3a -1 \u3002\u5e76\u8bbe\u7f6e param_name \u4e3a test_data \u3002 \u73b0\u7ed9 param_read_flag \u8109\u51b2\u4fe1\u53f7\uff0c\u5219\u5c06\u5728\u8109\u51b2\u7684\u4e0a\u5347\u6cbf\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\uff0c\u6700\u540e\u663e\u793a\u5230\u793a\u6ce2\u5668\u4e2d\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5728\u4eff\u771f\u7684\u8fc7\u7a0b\u4e2d\u4fee\u6539 parameter.txt \u4e2d\u7684 test_data \u6570\u503c\uff0c\u793a\u6ce2\u5668\u4e2d\u7684\u6570\u503c\u4f1a\u53d1\u751f\u76f8\u5e94\u7684\u53d8\u5316\uff0c\u800c\u53d8\u5316\u5468\u671f\u4e0e\u8109\u51b2\u4fe1\u53f7\u5468\u671f\u76f8\u540c\u3002 Tip \u5f3a\u70c8\u5efa\u8bae\u5f00\u53d1\u8005\u81ea\u884c\u5f15\u5165 param_read_flag \u4fe1\u53f7\uff0c\u6bd4\u5982\u7531\u9065\u63a7\u5668\u7684\u5f00\u5173\u89e6\u53d1\uff0c\u5728\u4fee\u6539\u5b8c parameter.txt \u540e\uff0c\u901a\u8fc7\u9065\u63a7\u5668\u5f00\u5173\u89e6\u53d1\uff0c\u8fd9\u6837\u7684\u89e6\u53d1\u65b9\u5f0f\u6709\u5229\u4e8e\u964d\u4f4e\u53c2\u6570\u66f4\u65b0\u6a21\u5757\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u5360\u7528\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u53c2\u6570\u66f4\u65b0\u6a21\u5757\u5728\u6bcf\u6b21\u53c2\u6570\u66f4\u65b0\u65f6\u5747\u4f1a\u6267\u884c\u8bfb\u64cd\u4f5c\uff0c\u5e76\u4e14\u4f1a\u904d\u5386 parameter.txt \uff0c\u5982\u679c\u53ea\u4f7f\u7528\u8109\u51b2\u4fe1\u53f7\u89e6\u53d1\uff0c\u6bd4\u5982\u4f1a\u9020\u6210\u7cfb\u7edf\u8d44\u6e90\u7684\u6781\u5927\u6d6a\u8d39\uff0c\u540c\u65f6\u53ef\u9760\u6027\u4e0d\u9ad8\u3002","title":"MIL"},{"location":"Basic/paramupdate/#sihhilexp","text":"\u53c2\u6570\u66f4\u65b0\u6a21\u5757\u540c\u6837\u53ef\u4ee5\u8fd0\u7528\u5728SIH/HIL\u6a21\u5f0f\u548c\u5b9e\u9a8c\u4e2d\u3002\u5176\u4f7f\u7528\u65b9\u6cd5\u4e0eMIL\u5dee\u522b\u4e0d\u5927\uff0c\u4ec5\u9700\u5c06 parameter.txt \u6587\u4ef6\u66f4\u65b0\u5230RflyPilot\u98de\u63a7\u6e90\u7801\u7684 config/parameter.txt \u4e2d\uff0c\u5728\u4f7f\u7528RflyPilotTools\u8fdb\u884c\u4e0a\u4f20\u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u81ea\u52a8\u4e0a\u4f20\u81f3RflyPilot\u98de\u63a7\u4e2d\u3002\u5728\u6b64\u6a21\u5f0f\u4e2d\uff0c\u7b14\u8005\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u9065\u63a7\u5668\u5f00\u5173\u89e6\u53d1\u53c2\u6570\u66f4\u65b0\u3002","title":"SIH/HIL/EXP"},{"location":"Basic/rflysim3d/","text":"RflySim3D\u662f\u4e00\u6b3e\u57fa\u4e8eUE\u5f15\u64ce\u5f00\u53d1\u7684\u98de\u884c\u5668\u89c6\u666f\u663e\u793a\u5e73\u53f0\uff0c\u5b83\u662f \u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4 \u5f00\u53d1\u7684RflySim\u5e73\u53f0\u7684\u4e00\u90e8\u5206\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u901a\u8fc7UDP\u53d1\u9001\u7279\u5b9a\u534f\u8bae\u7684\u6570\u636e\u5305\uff0c\u8fdb\u800c\u5b9e\u73b0\u63a7\u5236\u89c6\u666f\u4e2d\u65e0\u4eba\u673a\u7684\u4f4d\u7f6e\u3001\u59ff\u6001\u3001\u65cb\u7ffc\u8f6c\u901f\u7b49\uff0c\u662f\u65e0\u4eba\u673a\u63a7\u5236\u5668\u5f00\u53d1\u7684\u5229\u5668\u3002\u66f4\u591a\u7684\u4ecb\u7ecd\u8bf7\u53c2\u8003 RflySim\u5b98\u65b9\u7f51\u7ad9 \u3002 RflySim3D\u663e\u793a\u5e38\u7528\u4e8eMIL\\SIH\\HIL\u4eff\u771f\uff0c\u672c\u5c0f\u7ed3\u5c06\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5728SIH","title":"Rflysim3d"},{"location":"Basic/scope/","text":"RflyPilot\u98de\u63a7\u652f\u6301\u5c06\u98de\u884c\u6570\u636e\u901a\u8fc7UDP\u5b9e\u65f6\u663e\u793a\u5728\u8ba1\u7b97\u673a\u4e0a\u3002\u672c\u8282\u5c06\u4ee5SIH\u4eff\u771f\u4e3a\u4f8b\u4ecb\u7ecd\u793a\u6ce2\u5668\u7cfb\u7edf\u7684\u57fa\u672c\u529f\u80fd\u4e0e\u4f7f\u7528\u65b9\u6cd5\u3002 RflyPilot\u7684\u5728\u7ebf\u793a\u6ce2\u5668 \uf0c1 RflyPilot\u5728\u98de\u63a7\u7cfb\u7edf\u5e95\u5c42\u652f\u6301\u5c06\u4e00\u4e9b\u5173\u952e\u6570\u636e\u4f20\u8f93\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u3002\u8fd9\u4e9b\u6570\u636e\u7684\u7c7b\u578b\u5df2\u7ecf\u9884\u5b9a\u4e49\u5728\u98de\u63a7\u5e95\u5c42\u4ee3\u7801\u4e2d\uff0c\u5982\u9700\u4fee\u6539\uff0c\u9700\u8981\u81ea\u884c\u4fee\u6539\u98de\u63a7\u6e90\u7801\uff0c\u8be5\u793a\u6ce2\u5668\u53eb\u505a system scope \u3002\u53ef\u7531\u914d\u7f6e\u6587\u4ef6 rflypilot.txt \u8fdb\u884c\u914d\u7f6e\u5f00\u542f\u6216\u8005\u5173\u95ed\u3002\u53e6\u4e00\u79cd\u793a\u6ce2\u5668\u4e3a controller scope \uff0c\u8be5\u793a\u6ce2\u5668\u7528\u4e8e\u8f93\u51fa\u4e0e\u63a7\u5236\u5668\u6709\u5173\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u7684\u5b9a\u4e49\u53ef\u4ee5\u7531\u5f00\u53d1\u8005\u81ea\u884c\u51b3\u5b9a\u3002\u4e24\u79cd\u793a\u6ce2\u5668\u7684\u9ed8\u8ba4\u6570\u636e\u66f4\u65b0\u9891\u7387\u4e3a100Hz\uff0c\u53ef\u80fd\u53d7\u7cfb\u7edf\u8fd0\u884c\u5f71\u54cd\u800c\u7565\u6709\u6d6e\u52a8\u3002 \u7cfb\u7edf\u793a\u6ce2\u5668 \uf0c1 system scope \u4e2d\u5305\u542b\u8f83\u4e3a\u4e30\u5bcc\u7684\u7cfb\u7edf\u72b6\u6001\u4fe1\u606f\uff0c\u5305\u62ec\u4f4d\u7f6e\u3001\u901f\u5ea6\u3001\u59ff\u6001\u3001\u63a7\u5236\u91cf\u3001\u8fd0\u884c\u9891\u7387\u7b49\u3002RflyPilot\u901a\u8fc7\u672c\u673a\u7684 UDP3333 \u7aef\u53e3\u5411\u5c40\u57df\u7f51\u5e7f\u64ad\u6570\u636e\uff0c\u8be5\u6570\u636e\u4e3a\u4e00\u6570\u7ec4\uff0c\u5176\u5b9a\u4e49\u4e3a #define SCOPE_DATA_N 40 typedef struct { uint64_t timestamp; uint32_t rate_hz; float data[SCOPE_DATA_N]; }scope_data_typedef; ringbuffer_typedef<scope_data_typedef> system_scope_msg(20,\"system_debug_data\",LOG_DISABLE); Tip \u6ce8\uff1a\u5173\u4e8e system scope \u7684\u5177\u4f53\u5b9a\u4e49\uff0c\u8bf7\u53c2\u8003RflyPilot\u6e90\u7801\u6587\u4ef6 src/msg/msg_def.h \u3002 \u8be5\u793a\u6ce2\u5668\u5177\u4f53\u4fe1\u606f\u53ef\u4ee5\u53c2\u89c1\u5982\u4e0b\u4ee3\u7801\uff0c\u5176\u4e2d _system_debug_data \u4e3a\u793a\u6ce2\u5668\u6570\u636e\u3002 _system_debug_data.data[0] = 1234; //\u5e27\u5934 _system_debug_data.data[1] = get_time_now() / 1e6; //\u65f6\u95f4\u6233 _system_debug_data.data[2] = _att.roll; //\u6eda\u8f6c\u89d2 _system_debug_data.data[3] = _att.pitch; //\u4fef\u4ef0\u89d2 _system_debug_data.data[4] = _att.yaw; //\u822a\u5411\u89d2 for(i = 0; i < 3; i++) { _system_debug_data.data[i+5] = _gyro.gyro[i]; //\u9640\u87ba\u4eea\u6570\u636e\uff08\u6ee4\u6ce2\u540e\uff09 } for(i = 0; i < 3; i++) { _system_debug_data.data[i+8] = _accel.accel[i]; //\u52a0\u901f\u5ea6\u8ba1\u6570\u636e \uff08\u6ee4\u6ce2\u540e\uff09 } for(i = 0; i< 3; i++)_system_debug_data.data[i+11] = _lpe.pos_ned[i]; //NED\u4f4d\u7f6e\uff08\u4f30\u8ba1\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+14] = _lpe.vel_ned[i];//NED\u901f\u5ea6\uff08\u4f30\u8ba1\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+17] = _gps.pos_ned[i];//NED\u4f4d\u7f6e\uff08GPS\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+20] = _gps.vel_ned[i];//NED\u4f4d\u7f6e\uff08GPS\uff09 for(i = 0; i < 4; i++)_system_debug_data.data[i+23] = (float)_actuator_output.actuator_output[i];//PWM\u8f93\u51fa _system_debug_data.data[27] = actuator_output_msg.publish_rate_hz;//\u63a7\u5236\u5668\u9891\u7387 _system_debug_data.data[28] = cf_output_msg.publish_rate_hz;//\u59ff\u6001\u4f30\u8ba1\u9891\u7387 _system_debug_data.data[29] = lpe_output_msg.publish_rate_hz;//\u4f4d\u7f6e\u4f30\u8ba1\u9891\u7387 _system_debug_data.data[30] = accel_msg.publish_rate_hz;//IMU\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[31] = mag_msg.publish_rate_hz; //\u78c1\u529b\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[32] = baro_msg.publish_rate_hz;//\u6c14\u538b\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[33] = _baro.temperature;//\u6e29\u5ea6\uff08\u6c14\u538b\u8ba1\uff09 _system_debug_data.data[34] = _baro.pressure;//\u6c14\u538b\uff08\u6c14\u538b\u8ba1\uff09 _system_debug_data.data[35] = _rc_input_msg.channels[0];//\u9065\u63a7\u5668\u8f93\u5165CH1 _system_debug_data.data[36] = _rc_input_msg.channels[1];//\u9065\u63a7\u5668\u8f93\u5165CH2 _system_debug_data.data[37] = _mag.mag[0];//\u78c1\u529b\u8ba1\u6570\u636ex\u8f74 _system_debug_data.data[38] = _mag.mag[1];//\u78c1\u529b\u8ba1\u6570\u636ey\u8f74 _system_debug_data.data[39] = _mag.mag[2];//\u78c1\u529b\u8ba1\u6570\u636ez\u8f74 \u53ef\u89c1\uff0c\u5229\u7528\u8be5\u793a\u6ce2\u5668\u4e00\u6b21\u6700\u591a\u663e\u793a40\u4e2a\u901a\u9053\u6570\u636e\u3002 \u914d\u7f6e \uf0c1 RflyPilot\u7aef \uf0c1 RflyPilot\u7aef\u4ec5\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 config/rflypilot.txt \uff0c\u9996\u5148\u9700\u8981\u542f\u7528\u7cfb\u7edf\u65e5\u5fd7 sys_scope_en = 1 \uff0c\u4e3a 1 \u8868\u793a\u542f\u7528\u7cfb\u7edf\u793a\u6ce2\u5668\uff0c\u4e3a 2 \u8868\u793a\u7981\u7528\u7cfb\u7edf\u793a\u6ce2\u5668\u3002\u6700\u540e\u8bbe\u7f6e station_ip \u4e0e scope_ip \u4e3a\u8ba1\u7b97\u673aIP\uff0c\u6ce8\u610f\u52a0\u5f15\u53f7\u3002 sys_scope_en = 1 scope_ip = \"192.168.199.152\" Warning \u6ce8\uff1a\u5728\u914d\u7f6e\u9879\u6240\u5728\u884c\uff0c\u4e0d\u80fd\u589e\u52a0\u6ce8\u91ca\u7b49\u65e0\u5173\u5185\u5bb9\uff0c\u6ce8\u610f = \u4e24\u7aef\u7684\u7a7a\u683c\u3002 \u81f3\u6b64\uff0cRflyPilot\u7aef\u914d\u7f6e\u5b8c\u6210\u3002 \u7535\u8111\u7aef \uf0c1 \u6253\u5f00RflyPilot\u7684Simulink\u5de5\u7a0b\u6587\u4ef6\uff0c\u5e76\u6253\u5f00 debug_tools/udp_recv3_ke.slx \u3002\u53cc\u51fb\u6253\u5f00\u2460\u540e\uff0c\u914d\u7f6e\u2461 Remote IP address \uff0c\u8be5IP\u5e94\u8bbe\u7f6e\u4e3aRflyPilot\u7684IP\u3002\u70b9\u51fb\u201c\u786e\u5b9a\u201d\u5373\u53ef\u5b8c\u6210\u8bbe\u7f6e\u3002 \u4f7f\u7528 \uf0c1 \u8fd0\u884c ./rflypilot \uff0c\u5e76\u542f\u52a8\u793a\u6ce2\u5668\uff0c\u901a\u8fc7\u9065\u63a7\u5668\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\u3002 \u63a7\u5236\u5668\u793a\u6ce2\u5668 \uf0c1 \u63a7\u5236\u5668\u793a\u6ce2\u5668 controller scope \u4e5f\u4f7f\u7528\u4e86\u4e0e\u7cfb\u7edf\u793a\u6ce2\u5668\u540c\u6837\u7684\u539f\u7406\u5b9e\u73b0\u3002\u63a7\u5236\u5668\u793a\u6ce2\u5668\u540c\u6837\u5177\u670940\u4e2a\u6d6e\u70b9\u6570\u901a\u9053\u3002\u5176\u914d\u7f6e\u65b9\u6cd5\u4e0e\u7cfb\u7edf\u793a\u6ce2\u5668\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u505a\u8fc7\u591a\u5c55\u5f00\u3002\u5176\u4e3b\u8981\u533a\u522b\u662f controller scope \u4f7f\u7528\u4e86 UDP3334 \u7aef\u53e3\u3002\u5f00\u542f\u63a7\u5236\u5668\u793a\u6ce2\u5668\u9700\u8981\u8bbe\u7f6e ctrl_scope_en = 1 \u3002 Tip \u4e3a\u907f\u514d\u7cfb\u7edf\u8d44\u6e90\u6d6a\u8d39\uff0c\u5efa\u8bae\u5c06\u672a\u4f7f\u7528\u7684\u793a\u6ce2\u5668\u8bbe\u7f6e\u4e3a\u5173\u95ed\u3002 \u914d\u7f6e\u81ea\u5b9a\u4e49\u793a\u6ce2\u5668\u6570\u636e \uf0c1 controller scope \u7684\u6570\u636e\u8f93\u51fa\u7aef\u53e3\u5728\u63a7\u5236\u5668\u6a21\u5757\u4e2d\uff0c\u5728Simulink\u6a21\u578b\u7684 MPC_HIL/usrcontroller (MPCControllerCodeGen_Vz) \u4e2d\uff0c\u6709\u9884\u5b9a\u4e49\u4e00\u8f93\u51fa\u7aef\u53e3\uff0c\u5982\u4e0b\u56fe\u4e2d\u2461\u6240\u793a\u3002 \u5b83\u5728Simulink\u4e2d\u7684\u5b9a\u4e49\u5982\u4e0b\uff0c\u53cc\u51fb\u8bbe\u7f6e\u2460\uff0c\u5c06\u2462 data \u52a0\u5165\u5230\u2463 \u8981\u8d4b\u503c\u7684\u5143\u7d20\u4e2d \uff0c\u5e76\u201c\u786e\u5b9a\u201d\u3002\u6b64\u65f6\u6a21\u5757\u2460\u5c06\u4f1a\u589e\u52a0\u4e00\u7aef\u53e3\u7528\u4e8e\u8f93\u5165\u6570\u636e\uff0c\u7ef4\u5ea6\u4e3a40\u3002 _s_scope_s \u7684\u6570\u636e\u5b9a\u4e49\u540cRflyPilot\u4ee3\u7801\u4e2d\u4e00\u81f4 #define SCOPE_DATA_N 40 typedef struct { uint64_t timestamp; uint32_t rate_hz; float data[SCOPE_DATA_N]; }scope_data_typedef; scope_data_typedef _controller_debug; \u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0c\u8fd9\u91cc\u589e\u52a0\u4e00\u8109\u51b2\u53d1\u751f\u5668\u548c\u5e38\u6570\u6a21\u5757\uff0c\u5982\u4e0b\u56fe\u6240\u793a \u968f\u540e\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u4e0e\u90e8\u7f72\u5373\u53ef\uff0c\u8fd9\u90e8\u5206\u5df2\u7ecf\u5728 \u5feb\u901f\u5f00\u59cb \u4e2d\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u7535\u8111\u7aef \uf0c1 \u7535\u8111\u7aef\u4ec5\u9700\u5c06UDP\u7aef\u53e3\u4fee\u6539\u4e3a 3334 \u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7136\u540e\u9009\u62e9\u9700\u8981\u63a5\u6536\u7684\u6570\u636e\u901a\u9053\u3002 \u5728\u6b64\u76f4\u63a5\u8fdb\u884cSIH\u4eff\u771f\uff0c\u5373\u53ef\u5f97\u5230\u4ece\u63a7\u5236\u5668\u6a21\u5757\u4e2d\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u8f93\u51fa\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u4e0d\u96be\u53d1\u73b0\uff0c\u65b9\u6ce2\u4fe1\u53f7\u5e76\u4e0d\u89c4\u6574\uff0c\u539f\u56e0\u662f\u63a7\u5236\u5668\u7684\u8fd0\u884c\u9891\u7387\u4e0e\u793a\u6ce2\u5668\u6570\u636e\u53d1\u9001\u7684\u9891\u7387\u5f02\u6b65\uff0c\u793a\u6ce2\u5668\u7684\u8fd0\u884c\u9891\u7387\u7ea6\u4e3a100Hz\uff0c\u800c\u63a7\u5236\u5668\u7ea6\u4e3a333Hz\uff0c\u6545\u51fa\u73b0\u6b64\u95ee\u9898\uff0c\u8fd9\u4e5f\u5c5e\u4e8e\u6b63\u5e38\u73b0\u8c61\u3002","title":"\u5728\u7ebf\u793a\u6ce2\u5668"},{"location":"Basic/scope/#rflypilot","text":"RflyPilot\u5728\u98de\u63a7\u7cfb\u7edf\u5e95\u5c42\u652f\u6301\u5c06\u4e00\u4e9b\u5173\u952e\u6570\u636e\u4f20\u8f93\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u3002\u8fd9\u4e9b\u6570\u636e\u7684\u7c7b\u578b\u5df2\u7ecf\u9884\u5b9a\u4e49\u5728\u98de\u63a7\u5e95\u5c42\u4ee3\u7801\u4e2d\uff0c\u5982\u9700\u4fee\u6539\uff0c\u9700\u8981\u81ea\u884c\u4fee\u6539\u98de\u63a7\u6e90\u7801\uff0c\u8be5\u793a\u6ce2\u5668\u53eb\u505a system scope \u3002\u53ef\u7531\u914d\u7f6e\u6587\u4ef6 rflypilot.txt \u8fdb\u884c\u914d\u7f6e\u5f00\u542f\u6216\u8005\u5173\u95ed\u3002\u53e6\u4e00\u79cd\u793a\u6ce2\u5668\u4e3a controller scope \uff0c\u8be5\u793a\u6ce2\u5668\u7528\u4e8e\u8f93\u51fa\u4e0e\u63a7\u5236\u5668\u6709\u5173\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u7684\u5b9a\u4e49\u53ef\u4ee5\u7531\u5f00\u53d1\u8005\u81ea\u884c\u51b3\u5b9a\u3002\u4e24\u79cd\u793a\u6ce2\u5668\u7684\u9ed8\u8ba4\u6570\u636e\u66f4\u65b0\u9891\u7387\u4e3a100Hz\uff0c\u53ef\u80fd\u53d7\u7cfb\u7edf\u8fd0\u884c\u5f71\u54cd\u800c\u7565\u6709\u6d6e\u52a8\u3002","title":"RflyPilot\u7684\u5728\u7ebf\u793a\u6ce2\u5668"},{"location":"Basic/scope/#_1","text":"system scope \u4e2d\u5305\u542b\u8f83\u4e3a\u4e30\u5bcc\u7684\u7cfb\u7edf\u72b6\u6001\u4fe1\u606f\uff0c\u5305\u62ec\u4f4d\u7f6e\u3001\u901f\u5ea6\u3001\u59ff\u6001\u3001\u63a7\u5236\u91cf\u3001\u8fd0\u884c\u9891\u7387\u7b49\u3002RflyPilot\u901a\u8fc7\u672c\u673a\u7684 UDP3333 \u7aef\u53e3\u5411\u5c40\u57df\u7f51\u5e7f\u64ad\u6570\u636e\uff0c\u8be5\u6570\u636e\u4e3a\u4e00\u6570\u7ec4\uff0c\u5176\u5b9a\u4e49\u4e3a #define SCOPE_DATA_N 40 typedef struct { uint64_t timestamp; uint32_t rate_hz; float data[SCOPE_DATA_N]; }scope_data_typedef; ringbuffer_typedef<scope_data_typedef> system_scope_msg(20,\"system_debug_data\",LOG_DISABLE); Tip \u6ce8\uff1a\u5173\u4e8e system scope \u7684\u5177\u4f53\u5b9a\u4e49\uff0c\u8bf7\u53c2\u8003RflyPilot\u6e90\u7801\u6587\u4ef6 src/msg/msg_def.h \u3002 \u8be5\u793a\u6ce2\u5668\u5177\u4f53\u4fe1\u606f\u53ef\u4ee5\u53c2\u89c1\u5982\u4e0b\u4ee3\u7801\uff0c\u5176\u4e2d _system_debug_data \u4e3a\u793a\u6ce2\u5668\u6570\u636e\u3002 _system_debug_data.data[0] = 1234; //\u5e27\u5934 _system_debug_data.data[1] = get_time_now() / 1e6; //\u65f6\u95f4\u6233 _system_debug_data.data[2] = _att.roll; //\u6eda\u8f6c\u89d2 _system_debug_data.data[3] = _att.pitch; //\u4fef\u4ef0\u89d2 _system_debug_data.data[4] = _att.yaw; //\u822a\u5411\u89d2 for(i = 0; i < 3; i++) { _system_debug_data.data[i+5] = _gyro.gyro[i]; //\u9640\u87ba\u4eea\u6570\u636e\uff08\u6ee4\u6ce2\u540e\uff09 } for(i = 0; i < 3; i++) { _system_debug_data.data[i+8] = _accel.accel[i]; //\u52a0\u901f\u5ea6\u8ba1\u6570\u636e \uff08\u6ee4\u6ce2\u540e\uff09 } for(i = 0; i< 3; i++)_system_debug_data.data[i+11] = _lpe.pos_ned[i]; //NED\u4f4d\u7f6e\uff08\u4f30\u8ba1\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+14] = _lpe.vel_ned[i];//NED\u901f\u5ea6\uff08\u4f30\u8ba1\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+17] = _gps.pos_ned[i];//NED\u4f4d\u7f6e\uff08GPS\uff09 for(i = 0; i< 3; i++)_system_debug_data.data[i+20] = _gps.vel_ned[i];//NED\u4f4d\u7f6e\uff08GPS\uff09 for(i = 0; i < 4; i++)_system_debug_data.data[i+23] = (float)_actuator_output.actuator_output[i];//PWM\u8f93\u51fa _system_debug_data.data[27] = actuator_output_msg.publish_rate_hz;//\u63a7\u5236\u5668\u9891\u7387 _system_debug_data.data[28] = cf_output_msg.publish_rate_hz;//\u59ff\u6001\u4f30\u8ba1\u9891\u7387 _system_debug_data.data[29] = lpe_output_msg.publish_rate_hz;//\u4f4d\u7f6e\u4f30\u8ba1\u9891\u7387 _system_debug_data.data[30] = accel_msg.publish_rate_hz;//IMU\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[31] = mag_msg.publish_rate_hz; //\u78c1\u529b\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[32] = baro_msg.publish_rate_hz;//\u6c14\u538b\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387 _system_debug_data.data[33] = _baro.temperature;//\u6e29\u5ea6\uff08\u6c14\u538b\u8ba1\uff09 _system_debug_data.data[34] = _baro.pressure;//\u6c14\u538b\uff08\u6c14\u538b\u8ba1\uff09 _system_debug_data.data[35] = _rc_input_msg.channels[0];//\u9065\u63a7\u5668\u8f93\u5165CH1 _system_debug_data.data[36] = _rc_input_msg.channels[1];//\u9065\u63a7\u5668\u8f93\u5165CH2 _system_debug_data.data[37] = _mag.mag[0];//\u78c1\u529b\u8ba1\u6570\u636ex\u8f74 _system_debug_data.data[38] = _mag.mag[1];//\u78c1\u529b\u8ba1\u6570\u636ey\u8f74 _system_debug_data.data[39] = _mag.mag[2];//\u78c1\u529b\u8ba1\u6570\u636ez\u8f74 \u53ef\u89c1\uff0c\u5229\u7528\u8be5\u793a\u6ce2\u5668\u4e00\u6b21\u6700\u591a\u663e\u793a40\u4e2a\u901a\u9053\u6570\u636e\u3002","title":"\u7cfb\u7edf\u793a\u6ce2\u5668"},{"location":"Basic/scope/#_2","text":"","title":"\u914d\u7f6e"},{"location":"Basic/scope/#rflypilot_1","text":"RflyPilot\u7aef\u4ec5\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 config/rflypilot.txt \uff0c\u9996\u5148\u9700\u8981\u542f\u7528\u7cfb\u7edf\u65e5\u5fd7 sys_scope_en = 1 \uff0c\u4e3a 1 \u8868\u793a\u542f\u7528\u7cfb\u7edf\u793a\u6ce2\u5668\uff0c\u4e3a 2 \u8868\u793a\u7981\u7528\u7cfb\u7edf\u793a\u6ce2\u5668\u3002\u6700\u540e\u8bbe\u7f6e station_ip \u4e0e scope_ip \u4e3a\u8ba1\u7b97\u673aIP\uff0c\u6ce8\u610f\u52a0\u5f15\u53f7\u3002 sys_scope_en = 1 scope_ip = \"192.168.199.152\" Warning \u6ce8\uff1a\u5728\u914d\u7f6e\u9879\u6240\u5728\u884c\uff0c\u4e0d\u80fd\u589e\u52a0\u6ce8\u91ca\u7b49\u65e0\u5173\u5185\u5bb9\uff0c\u6ce8\u610f = \u4e24\u7aef\u7684\u7a7a\u683c\u3002 \u81f3\u6b64\uff0cRflyPilot\u7aef\u914d\u7f6e\u5b8c\u6210\u3002","title":"RflyPilot\u7aef"},{"location":"Basic/scope/#_3","text":"\u6253\u5f00RflyPilot\u7684Simulink\u5de5\u7a0b\u6587\u4ef6\uff0c\u5e76\u6253\u5f00 debug_tools/udp_recv3_ke.slx \u3002\u53cc\u51fb\u6253\u5f00\u2460\u540e\uff0c\u914d\u7f6e\u2461 Remote IP address \uff0c\u8be5IP\u5e94\u8bbe\u7f6e\u4e3aRflyPilot\u7684IP\u3002\u70b9\u51fb\u201c\u786e\u5b9a\u201d\u5373\u53ef\u5b8c\u6210\u8bbe\u7f6e\u3002","title":"\u7535\u8111\u7aef"},{"location":"Basic/scope/#_4","text":"\u8fd0\u884c ./rflypilot \uff0c\u5e76\u542f\u52a8\u793a\u6ce2\u5668\uff0c\u901a\u8fc7\u9065\u63a7\u5668\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\u3002","title":"\u4f7f\u7528"},{"location":"Basic/scope/#_5","text":"\u63a7\u5236\u5668\u793a\u6ce2\u5668 controller scope \u4e5f\u4f7f\u7528\u4e86\u4e0e\u7cfb\u7edf\u793a\u6ce2\u5668\u540c\u6837\u7684\u539f\u7406\u5b9e\u73b0\u3002\u63a7\u5236\u5668\u793a\u6ce2\u5668\u540c\u6837\u5177\u670940\u4e2a\u6d6e\u70b9\u6570\u901a\u9053\u3002\u5176\u914d\u7f6e\u65b9\u6cd5\u4e0e\u7cfb\u7edf\u793a\u6ce2\u5668\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u505a\u8fc7\u591a\u5c55\u5f00\u3002\u5176\u4e3b\u8981\u533a\u522b\u662f controller scope \u4f7f\u7528\u4e86 UDP3334 \u7aef\u53e3\u3002\u5f00\u542f\u63a7\u5236\u5668\u793a\u6ce2\u5668\u9700\u8981\u8bbe\u7f6e ctrl_scope_en = 1 \u3002 Tip \u4e3a\u907f\u514d\u7cfb\u7edf\u8d44\u6e90\u6d6a\u8d39\uff0c\u5efa\u8bae\u5c06\u672a\u4f7f\u7528\u7684\u793a\u6ce2\u5668\u8bbe\u7f6e\u4e3a\u5173\u95ed\u3002","title":"\u63a7\u5236\u5668\u793a\u6ce2\u5668"},{"location":"Basic/scope/#_6","text":"controller scope \u7684\u6570\u636e\u8f93\u51fa\u7aef\u53e3\u5728\u63a7\u5236\u5668\u6a21\u5757\u4e2d\uff0c\u5728Simulink\u6a21\u578b\u7684 MPC_HIL/usrcontroller (MPCControllerCodeGen_Vz) \u4e2d\uff0c\u6709\u9884\u5b9a\u4e49\u4e00\u8f93\u51fa\u7aef\u53e3\uff0c\u5982\u4e0b\u56fe\u4e2d\u2461\u6240\u793a\u3002 \u5b83\u5728Simulink\u4e2d\u7684\u5b9a\u4e49\u5982\u4e0b\uff0c\u53cc\u51fb\u8bbe\u7f6e\u2460\uff0c\u5c06\u2462 data \u52a0\u5165\u5230\u2463 \u8981\u8d4b\u503c\u7684\u5143\u7d20\u4e2d \uff0c\u5e76\u201c\u786e\u5b9a\u201d\u3002\u6b64\u65f6\u6a21\u5757\u2460\u5c06\u4f1a\u589e\u52a0\u4e00\u7aef\u53e3\u7528\u4e8e\u8f93\u5165\u6570\u636e\uff0c\u7ef4\u5ea6\u4e3a40\u3002 _s_scope_s \u7684\u6570\u636e\u5b9a\u4e49\u540cRflyPilot\u4ee3\u7801\u4e2d\u4e00\u81f4 #define SCOPE_DATA_N 40 typedef struct { uint64_t timestamp; uint32_t rate_hz; float data[SCOPE_DATA_N]; }scope_data_typedef; scope_data_typedef _controller_debug; \u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0c\u8fd9\u91cc\u589e\u52a0\u4e00\u8109\u51b2\u53d1\u751f\u5668\u548c\u5e38\u6570\u6a21\u5757\uff0c\u5982\u4e0b\u56fe\u6240\u793a \u968f\u540e\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u4e0e\u90e8\u7f72\u5373\u53ef\uff0c\u8fd9\u90e8\u5206\u5df2\u7ecf\u5728 \u5feb\u901f\u5f00\u59cb \u4e2d\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002","title":"\u914d\u7f6e\u81ea\u5b9a\u4e49\u793a\u6ce2\u5668\u6570\u636e"},{"location":"Basic/scope/#_7","text":"\u7535\u8111\u7aef\u4ec5\u9700\u5c06UDP\u7aef\u53e3\u4fee\u6539\u4e3a 3334 \u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7136\u540e\u9009\u62e9\u9700\u8981\u63a5\u6536\u7684\u6570\u636e\u901a\u9053\u3002 \u5728\u6b64\u76f4\u63a5\u8fdb\u884cSIH\u4eff\u771f\uff0c\u5373\u53ef\u5f97\u5230\u4ece\u63a7\u5236\u5668\u6a21\u5757\u4e2d\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u8f93\u51fa\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u4e0d\u96be\u53d1\u73b0\uff0c\u65b9\u6ce2\u4fe1\u53f7\u5e76\u4e0d\u89c4\u6574\uff0c\u539f\u56e0\u662f\u63a7\u5236\u5668\u7684\u8fd0\u884c\u9891\u7387\u4e0e\u793a\u6ce2\u5668\u6570\u636e\u53d1\u9001\u7684\u9891\u7387\u5f02\u6b65\uff0c\u793a\u6ce2\u5668\u7684\u8fd0\u884c\u9891\u7387\u7ea6\u4e3a100Hz\uff0c\u800c\u63a7\u5236\u5668\u7ea6\u4e3a333Hz\uff0c\u6545\u51fa\u73b0\u6b64\u95ee\u9898\uff0c\u8fd9\u4e5f\u5c5e\u4e8e\u6b63\u5e38\u73b0\u8c61\u3002","title":"\u7535\u8111\u7aef"},{"location":"Basic/simulation/","text":"\u672c\u5c0f\u7ed3\u5c06\u5bf9\u5e38\u7528\u7684\u4e09\u79cd\u4eff\u771f\u6a21\u5f0f\uff08MIL\\SIH\\HIL\uff09\u8fdb\u884c\u64cd\u4f5c\u4ecb\u7ecd\u3002 MIL \uf0c1 MIL\u4eff\u771f\uff0c\u5373\u6a21\u578b\u5728\u73af\uff0c\u8be5\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u8fdb\u884c\u63a7\u5236\u7cfb\u7edf\u7684\u521d\u671f\u9a8c\u8bc1\u9636\u6bb5\uff0c\u7528\u4e8e\u8bc4\u4f30\u63a7\u5236\u5668\u7684\u53ef\u63a7\u6027\u3002\u5229\u7528RflyPilot\u5de5\u7a0b\u6587\u4ef6\u5939\u4e0b\u7684 MIL/MPC_HIL.slx \u5373\u53ef\u8fdb\u884cMIL\u4eff\u771f\u3002\u8fd9\u90e8\u5206\u4eff\u771f\u4e3b\u8981\u5728Simulink\u4e2d\u8fdb\u884c\uff0c\u5176\u4eff\u771f\u65b9\u6cd5\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u5177\u4f53\u5185\u5bb9\u7531\u8bfb\u8005\u81ea\u884c\u51b3\u5b9a\uff0c\u76f8\u5e94\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 \u5feb\u901f\u4f7f\u7528 \u4e2d\u7684\u90e8\u5206\u5185\u5bb9\u3002 SIH \uf0c1 SIH\u4eff\u771f\uff0c\u5373\u4eff\u771f\u5668\u5728\u73af\uff0c\u8be5\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u63a7\u5236\u5668\u5728\u771f\u5b9e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\u7684\u8868\u73b0\u3002SIH\u7684\u4eff\u771f\u6b65\u9aa4\u5728 \u5feb\u901f\u4f7f\u7528 \u4e2d\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8fd9\u91cc\u4e5f\u4e0d\u518d\u8d58\u8ff0\u3002 HIL \uf0c1 HIL\uff0c\u5373\u534a\u7269\u7406\u4eff\u771f\uff0c\u4e00\u822c\u4f5c\u4e3a\u5b9e\u98de\u5b9e\u9a8c\u7684\u6700\u540e\u4e00\u6b65\uff0c\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e2d\uff0cRflyPilot\u5c06\u76f4\u63a5\u8fde\u63a5\u5230 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u7cfb\u7edf \u4e0a\uff0c\u5176\u786c\u4ef6\u8fde\u63a5\u65b9\u6cd5\u8bf7\u53c2\u8003 \u786c\u4ef6\u8fde\u63a5 \u4e00\u8282\u4e2d\u7684\u5185\u5bb9\u3002 \u5728HIL\u4eff\u771f\u4e2d\uff0c\u4eff\u771f\u64cd\u4f5c\u4e0eSIH\u57fa\u672c\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\u9700\u8981\u4fee\u6539 valid_mode = 2 \uff0c\u540c\u65f6\u4fee\u6539\u5b8f\u5b9a\u4e49\u6587\u4ef6 config/configure.h \u4e2d\u7684 USE_RFLYPILOT \u4e3a 0 \u3002 #define POLL_TIME_US 10*1000// 10*1000ns = 10us #define TIMER_TICK_RATE 2000 #define SCOPE_DATA_N 40 /* Estimator Thread Core */ #define ATT_EST_CORE 2 #define POS_EST_CORE 2 /* Sensor Thread Core */ #define IMU_CORE 2 #define MAG_CORE 2 #define BARO_CORE 2 #define GPS_CORE 2 /* Control Thread Core */ #define SUBS_CORE 2 #define BASIC_CTRL_CORE 2 #define CTRL_CORE 3 /* SIH Thread Core */ #define SIH_CORE 2 /* Serve Thread Core */ #define SCREEN_CORE 1 #define CONSOLE_CORE 1 #define LOG_CORE 1 #define ULOG_CORE 1 /* Rate Div */ #define USING_THREAD_SYNC 0 #define IMU_LPE 1 #define LPE_ATT 1 #define ATT_CTRL 2 #define USE_RFLYPILOT 0 #define USE_ONESHOT_125 1 #define OFFBOARD_DATA_N 20 #define PWM_FREQ (USE_ONESHOT_125==1?1500:400) #define SERVO_PWM_FREQ 333 #define I2C_BUS_1 \"/dev/i2c-1\" #define I2C_BUS_0 \"/dev/i2c-10\" #define TASK_SCHEDULE_DEBUG 0 \u6700\u540e\u91cd\u65b0\u7f16\u8bd1\u4e0a\u4f20\u5373\u53ef\u3002 \u6ce8\u610f \u7531\u4e8e\u534a\u7269\u7406\u4eff\u771f\u5e73\u53f0\u7684PWM\u4fe1\u53f7\u652f\u6301\u6807\u6ce8400HzPWM\u548cOneshot125\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4fee\u6539\u8be5\u6587\u4ef6\u8fdb\u884c\u9002\u914d\u3002\u9ed8\u8ba4\u914d\u7f6e\u4e3aOneshot125\uff0c\u5982\u9700\u4fee\u6539\u4e3a400Hz\u7684PWM\uff0c\u53ef\u4ee5\u8bbe\u7f6e USE_ONESHOT_125 0 \u3002 EXP \uf0c1 EXP\uff0c\u5373\u5b9e\u98de\u5b9e\u9a8c\u6a21\u5f0f\uff0c\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0cRflyPilot\u5c06\u5229\u7528\u771f\u5b9e\u7684\u4f20\u611f\u5668\u6570\u636e\u8ba1\u7b97\u63a7\u5236\u8f93\u51fa\uff0c\u5e76\u76f4\u63a5\u8f93\u51faPWM\u63a7\u5236\u6307\u4ee4\u3002\u4e3a\u542f\u7528\u8be5\u6a21\u5f0f\uff0c\u8bfb\u8005\u9700\u8981\u4fee\u6539 valid_mode = 3 \uff0c\u540c\u65f6\u4fee\u6539\u5b8f\u5b9a\u4e49\u6587\u4ef6 config/configure.h \u4e2d\u7684 USE_RFLYPILOT \u4e3a 1 \u3002\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u5f00\u53d1\u8005\u81ea\u884c\u8fde\u63a5\u98de\u63a7\u5230\u98de\u884c\u5668\u4e0a\uff0c\u5305\u62ec\u7535\u6e90\u6a21\u5757\u3001GPS\u3001\u63a5\u6536\u673a\u3001\u7535\u8c03\u7b49\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fd9\u662f\u4e00\u67b6\u642d\u8f7dRflyPilot\u7684\u56db\u65cb\u7ffc\u65e0\u4eba\u673a \u5b9e\u98de\u6548\u679c\u5982\u4e0b","title":"MIL\\SIH\\HIL\u4eff\u771f\u4e0e\u5b9e\u9a8c"},{"location":"Basic/simulation/#mil","text":"MIL\u4eff\u771f\uff0c\u5373\u6a21\u578b\u5728\u73af\uff0c\u8be5\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u8fdb\u884c\u63a7\u5236\u7cfb\u7edf\u7684\u521d\u671f\u9a8c\u8bc1\u9636\u6bb5\uff0c\u7528\u4e8e\u8bc4\u4f30\u63a7\u5236\u5668\u7684\u53ef\u63a7\u6027\u3002\u5229\u7528RflyPilot\u5de5\u7a0b\u6587\u4ef6\u5939\u4e0b\u7684 MIL/MPC_HIL.slx \u5373\u53ef\u8fdb\u884cMIL\u4eff\u771f\u3002\u8fd9\u90e8\u5206\u4eff\u771f\u4e3b\u8981\u5728Simulink\u4e2d\u8fdb\u884c\uff0c\u5176\u4eff\u771f\u65b9\u6cd5\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u5177\u4f53\u5185\u5bb9\u7531\u8bfb\u8005\u81ea\u884c\u51b3\u5b9a\uff0c\u76f8\u5e94\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 \u5feb\u901f\u4f7f\u7528 \u4e2d\u7684\u90e8\u5206\u5185\u5bb9\u3002","title":"MIL"},{"location":"Basic/simulation/#sih","text":"SIH\u4eff\u771f\uff0c\u5373\u4eff\u771f\u5668\u5728\u73af\uff0c\u8be5\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u63a7\u5236\u5668\u5728\u771f\u5b9e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\u7684\u8868\u73b0\u3002SIH\u7684\u4eff\u771f\u6b65\u9aa4\u5728 \u5feb\u901f\u4f7f\u7528 \u4e2d\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8fd9\u91cc\u4e5f\u4e0d\u518d\u8d58\u8ff0\u3002","title":"SIH"},{"location":"Basic/simulation/#hil","text":"HIL\uff0c\u5373\u534a\u7269\u7406\u4eff\u771f\uff0c\u4e00\u822c\u4f5c\u4e3a\u5b9e\u98de\u5b9e\u9a8c\u7684\u6700\u540e\u4e00\u6b65\uff0c\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e2d\uff0cRflyPilot\u5c06\u76f4\u63a5\u8fde\u63a5\u5230 \u786c\u4ef6\u5728\u73af\u5b9e\u65f6\u4eff\u771f\u7cfb\u7edf \u4e0a\uff0c\u5176\u786c\u4ef6\u8fde\u63a5\u65b9\u6cd5\u8bf7\u53c2\u8003 \u786c\u4ef6\u8fde\u63a5 \u4e00\u8282\u4e2d\u7684\u5185\u5bb9\u3002 \u5728HIL\u4eff\u771f\u4e2d\uff0c\u4eff\u771f\u64cd\u4f5c\u4e0eSIH\u57fa\u672c\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\u9700\u8981\u4fee\u6539 valid_mode = 2 \uff0c\u540c\u65f6\u4fee\u6539\u5b8f\u5b9a\u4e49\u6587\u4ef6 config/configure.h \u4e2d\u7684 USE_RFLYPILOT \u4e3a 0 \u3002 #define POLL_TIME_US 10*1000// 10*1000ns = 10us #define TIMER_TICK_RATE 2000 #define SCOPE_DATA_N 40 /* Estimator Thread Core */ #define ATT_EST_CORE 2 #define POS_EST_CORE 2 /* Sensor Thread Core */ #define IMU_CORE 2 #define MAG_CORE 2 #define BARO_CORE 2 #define GPS_CORE 2 /* Control Thread Core */ #define SUBS_CORE 2 #define BASIC_CTRL_CORE 2 #define CTRL_CORE 3 /* SIH Thread Core */ #define SIH_CORE 2 /* Serve Thread Core */ #define SCREEN_CORE 1 #define CONSOLE_CORE 1 #define LOG_CORE 1 #define ULOG_CORE 1 /* Rate Div */ #define USING_THREAD_SYNC 0 #define IMU_LPE 1 #define LPE_ATT 1 #define ATT_CTRL 2 #define USE_RFLYPILOT 0 #define USE_ONESHOT_125 1 #define OFFBOARD_DATA_N 20 #define PWM_FREQ (USE_ONESHOT_125==1?1500:400) #define SERVO_PWM_FREQ 333 #define I2C_BUS_1 \"/dev/i2c-1\" #define I2C_BUS_0 \"/dev/i2c-10\" #define TASK_SCHEDULE_DEBUG 0 \u6700\u540e\u91cd\u65b0\u7f16\u8bd1\u4e0a\u4f20\u5373\u53ef\u3002 \u6ce8\u610f \u7531\u4e8e\u534a\u7269\u7406\u4eff\u771f\u5e73\u53f0\u7684PWM\u4fe1\u53f7\u652f\u6301\u6807\u6ce8400HzPWM\u548cOneshot125\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4fee\u6539\u8be5\u6587\u4ef6\u8fdb\u884c\u9002\u914d\u3002\u9ed8\u8ba4\u914d\u7f6e\u4e3aOneshot125\uff0c\u5982\u9700\u4fee\u6539\u4e3a400Hz\u7684PWM\uff0c\u53ef\u4ee5\u8bbe\u7f6e USE_ONESHOT_125 0 \u3002","title":"HIL"},{"location":"Basic/simulation/#exp","text":"EXP\uff0c\u5373\u5b9e\u98de\u5b9e\u9a8c\u6a21\u5f0f\uff0c\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0cRflyPilot\u5c06\u5229\u7528\u771f\u5b9e\u7684\u4f20\u611f\u5668\u6570\u636e\u8ba1\u7b97\u63a7\u5236\u8f93\u51fa\uff0c\u5e76\u76f4\u63a5\u8f93\u51faPWM\u63a7\u5236\u6307\u4ee4\u3002\u4e3a\u542f\u7528\u8be5\u6a21\u5f0f\uff0c\u8bfb\u8005\u9700\u8981\u4fee\u6539 valid_mode = 3 \uff0c\u540c\u65f6\u4fee\u6539\u5b8f\u5b9a\u4e49\u6587\u4ef6 config/configure.h \u4e2d\u7684 USE_RFLYPILOT \u4e3a 1 \u3002\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u5f00\u53d1\u8005\u81ea\u884c\u8fde\u63a5\u98de\u63a7\u5230\u98de\u884c\u5668\u4e0a\uff0c\u5305\u62ec\u7535\u6e90\u6a21\u5757\u3001GPS\u3001\u63a5\u6536\u673a\u3001\u7535\u8c03\u7b49\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fd9\u662f\u4e00\u67b6\u642d\u8f7dRflyPilot\u7684\u56db\u65cb\u7ffc\u65e0\u4eba\u673a \u5b9e\u98de\u6548\u679c\u5982\u4e0b","title":"EXP"},{"location":"Future/future/","text":"\u4e0b\u4e00\u4ee3RflyPilot \uf0c1 \u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u914d\u7f6e\u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u589e\u52a0FPGA\u82af\u7247\u4ee5\u652f\u6301\u66f4\u9ad8\u9891\u7684\u7535\u8c03\u534f\u8bae\uff0c\u5982OneShot\u3001Dshot\u7b49\u3002\u4e0b\u4e00\u4ee3RflyPilot\u8fd8\u5c06\u6269\u5c55\u66f4\u591a\u7684\u4e32\u53e3\uff0c\u4ee5\u652f\u6301\u66f4\u591a\u7684\u6267\u884c\u5668\u548c\u4f20\u611f\u5668\uff0c\u5982\u65e0\u5237\u76f4\u9a71\u7535\u673a\u3001UWB\u7b49\u3002\u540c\u65f6\u5728\u7535\u6e90\u82af\u7247\u4e0a\uff0c\u4e5f\u4f1a\u8fdb\u884c\u9769\u65b0\uff0c\u63d0\u4f9b\u66f4\u52a0\u7a33\u5065\u7684\u7535\u6e90\u65b9\u6848\uff0c\u4ee5\u786e\u4fdd\u98de\u63a7\u7684\u53ef\u9760\u8fd0\u884c\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u652f\u6301\u3001\u53ef\u9760\u6027\u7b49\u65b9\u9762\u8fdb\u884c\u6539\u8fdb\u3002","title":"\u4e0b\u4e00\u4ee3RflyPilot"},{"location":"Future/future/#rflypilot","text":"\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u914d\u7f6e\u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u589e\u52a0FPGA\u82af\u7247\u4ee5\u652f\u6301\u66f4\u9ad8\u9891\u7684\u7535\u8c03\u534f\u8bae\uff0c\u5982OneShot\u3001Dshot\u7b49\u3002\u4e0b\u4e00\u4ee3RflyPilot\u8fd8\u5c06\u6269\u5c55\u66f4\u591a\u7684\u4e32\u53e3\uff0c\u4ee5\u652f\u6301\u66f4\u591a\u7684\u6267\u884c\u5668\u548c\u4f20\u611f\u5668\uff0c\u5982\u65e0\u5237\u76f4\u9a71\u7535\u673a\u3001UWB\u7b49\u3002\u540c\u65f6\u5728\u7535\u6e90\u82af\u7247\u4e0a\uff0c\u4e5f\u4f1a\u8fdb\u884c\u9769\u65b0\uff0c\u63d0\u4f9b\u66f4\u52a0\u7a33\u5065\u7684\u7535\u6e90\u65b9\u6848\uff0c\u4ee5\u786e\u4fdd\u98de\u63a7\u7684\u53ef\u9760\u8fd0\u884c\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u652f\u6301\u3001\u53ef\u9760\u6027\u7b49\u65b9\u9762\u8fdb\u884c\u6539\u8fdb\u3002","title":"\u4e0b\u4e00\u4ee3RflyPilot"},{"location":"Sim/HIL/","text":"HIL \uf0c1 \u7b80\u4ecb \uf0c1 \u5982\u4f55\u4f7f\u7528 \uf0c1 \u6ce8\u610f\u4e8b\u9879 \uf0c1","title":"HIL"},{"location":"Sim/HIL/#hil","text":"","title":"HIL"},{"location":"Sim/HIL/#_1","text":"","title":"\u7b80\u4ecb"},{"location":"Sim/HIL/#_2","text":"","title":"\u5982\u4f55\u4f7f\u7528"},{"location":"Sim/HIL/#_3","text":"","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"Sim/OFFBOARD/","text":"Offboard \uf0c1 \u7b80\u4ecb \uf0c1 \u5728Offboard\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u4e4b\u95f4\u901a\u8fc7Simulink\u53bb\u63a7\u5236\u6267\u884c\u5668\u8f93\u51fa\uff0c\u8be5\u6a21\u5f0f\u5e38\u7528\u4e8e\u5728\u98de\u884c\u5668\u8c03\u8bd5\u7684\u521d\u671f\uff0c\u7528\u4e8e\u6d4b\u8bd5\u6267\u884c\u5668\u7684\u5de5\u4f5c\u60c5\u51b5\uff0c\u6216\u8005\u8fdb\u884c\u7b80\u5355\u7684\u53c2\u6570\u8fa8\u8bc6\u3002 \u5982\u4f55\u4f7f\u7528 \uf0c1 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6rflypilot.txt \uf0c1 \u5c06\u914d\u7f6e\u6587\u4ef6rflypilot.txt\u4e2d\u7684 valid_mode \u4fee\u6539\u4e3a valid_mode=4 \u3002\u8fd0\u884c\u7a0b\u5e8f ./rflypilot \uff0c\u5373\u53ef\u8fdb\u5165Offboard\u6a21\u5f0f \u6ce8\u610f\u4e8b\u9879 \uf0c1","title":"Offboard"},{"location":"Sim/OFFBOARD/#offboard","text":"","title":"Offboard"},{"location":"Sim/OFFBOARD/#_1","text":"\u5728Offboard\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u4e4b\u95f4\u901a\u8fc7Simulink\u53bb\u63a7\u5236\u6267\u884c\u5668\u8f93\u51fa\uff0c\u8be5\u6a21\u5f0f\u5e38\u7528\u4e8e\u5728\u98de\u884c\u5668\u8c03\u8bd5\u7684\u521d\u671f\uff0c\u7528\u4e8e\u6d4b\u8bd5\u6267\u884c\u5668\u7684\u5de5\u4f5c\u60c5\u51b5\uff0c\u6216\u8005\u8fdb\u884c\u7b80\u5355\u7684\u53c2\u6570\u8fa8\u8bc6\u3002","title":"\u7b80\u4ecb"},{"location":"Sim/OFFBOARD/#_2","text":"","title":"\u5982\u4f55\u4f7f\u7528"},{"location":"Sim/OFFBOARD/#rflypilottxt","text":"\u5c06\u914d\u7f6e\u6587\u4ef6rflypilot.txt\u4e2d\u7684 valid_mode \u4fee\u6539\u4e3a valid_mode=4 \u3002\u8fd0\u884c\u7a0b\u5e8f ./rflypilot \uff0c\u5373\u53ef\u8fdb\u5165Offboard\u6a21\u5f0f","title":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6rflypilot.txt"},{"location":"Sim/OFFBOARD/#_3","text":"","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"Sim/SIH/","text":"SIH \uf0c1 \u7b80\u4ecb \uf0c1 SIH Mode \u901a\u8fc7\u5728\u63a7\u5236\u5668\u4e0a\u8fd0\u884c\u88ab\u63a7\u5bf9\u8c61\u7684\u6570\u5b66\u6a21\u578b\u548c\u63a7\u5236\u5668\u7ec4\u6210\u95ed\u73af\u6765\u5b9e\u73b0\u4eff\u771f\u9a8c\u8bc1\u3002 \u57fa\u4e8eRflyPilot\u7684SIH\u6a21\u5f0f\u5177\u5907\u4e00\u4e0b\u7279\u70b9 \u53d7\u76ca\u4e8eCM4\u7684\u8ba1\u7b97\u6027\u80fd\uff0c\u6240\u91c7\u7528\u7684\u4eff\u771f\u6a21\u578b\u53ef\u4ee5\u66f4\u52a0\u590d\u6742\u548c\u7cbe\u7ec6\u5316 \u4e0d\u9700\u8981\u989d\u5916\u7684\u8bbe\u5907\u5373\u53ef\u8fdb\u884c\u786c\u4ef6\u4eff\u771f \u5982\u4f55\u542f\u7528 \uf0c1 \u6ce8\u610f\u4e8b\u9879 \uf0c1 \u6a21\u578b\u76f4\u63a5\u63d0\u4f9b\u7684\u4f20\u611f\u5668\u6570\u636e\u4e3a\u65e0\u9971\u548c\u7ea6\u675f\u7684\u6570\u636e\uff0c\u518d\u8fdb\u884c\u5b9e\u9a8c\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u4e0b\u4f20\u611f\u5668\u9971\u548c\u7684\u95ee\u9898","title":"SIH"},{"location":"Sim/SIH/#sih","text":"","title":"SIH"},{"location":"Sim/SIH/#_1","text":"SIH Mode \u901a\u8fc7\u5728\u63a7\u5236\u5668\u4e0a\u8fd0\u884c\u88ab\u63a7\u5bf9\u8c61\u7684\u6570\u5b66\u6a21\u578b\u548c\u63a7\u5236\u5668\u7ec4\u6210\u95ed\u73af\u6765\u5b9e\u73b0\u4eff\u771f\u9a8c\u8bc1\u3002 \u57fa\u4e8eRflyPilot\u7684SIH\u6a21\u5f0f\u5177\u5907\u4e00\u4e0b\u7279\u70b9 \u53d7\u76ca\u4e8eCM4\u7684\u8ba1\u7b97\u6027\u80fd\uff0c\u6240\u91c7\u7528\u7684\u4eff\u771f\u6a21\u578b\u53ef\u4ee5\u66f4\u52a0\u590d\u6742\u548c\u7cbe\u7ec6\u5316 \u4e0d\u9700\u8981\u989d\u5916\u7684\u8bbe\u5907\u5373\u53ef\u8fdb\u884c\u786c\u4ef6\u4eff\u771f","title":"\u7b80\u4ecb"},{"location":"Sim/SIH/#_2","text":"","title":"\u5982\u4f55\u542f\u7528"},{"location":"Sim/SIH/#_3","text":"\u6a21\u578b\u76f4\u63a5\u63d0\u4f9b\u7684\u4f20\u611f\u5668\u6570\u636e\u4e3a\u65e0\u9971\u548c\u7ea6\u675f\u7684\u6570\u636e\uff0c\u518d\u8fdb\u884c\u5b9e\u9a8c\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u4e0b\u4f20\u611f\u5668\u9971\u548c\u7684\u95ee\u9898","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"development/compiling_deploy/","text":"\u7f16\u8bd1\u4e0e\u90e8\u7f72 \uf0c1 \u672c\u5c0f\u8282\u5c06\u4ecb\u7ecdRflyPilotTools\u5bf9RflyPilot\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\u4e0e\u90e8\u7f72\u7684\u57fa\u672c\u539f\u7406\uff0c\u5176\u80cc\u540e\u662f\u5728WSL\u5b50\u7cfb\u7edf\u4e2d\u6267\u884cLinux\u6307\u4ee4\u3002 \u7f16\u8bd1 \uf0c1 \u5728WSL\u5b50\u7cfb\u7edf\u4e0b root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot# cd build/ root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build# cmake .. -- Configuring done -- Generating done -- Build files have been written to: /mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build# make -j128 [ 9%] Built target estimator_codegen [ 18%] Built target libsbus [ 18%] Built target confc [ 38%] Built target sih_codegen [ 38%] Built target basic_controller_codegen [ 55%] Built target controller_codegen [100%] Built target rflypilot root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build# \u90e8\u7f72 \uf0c1 RflyPilot\u7684\u90e8\u7f72\u8fd0\u884c\u7684\u6307\u4ee4\u662f make upload \u3002\u5176\u76f8\u5173\u811a\u672c\u6587\u4ef6\u5728 tools/upload.sh \u3002 #!/bin/sh hostname=\"192.168.199.183\" password=\"raspberry\" if [ $# = 1 ]; then hostname=$1 fi if [ $# = 2 ]; then hostname=$1 password=$2 fi echo \"hostname: ${hostname}\" echo \"password: ${password}\" sshpass -p \"${password}\" ssh -o StrictHostKeyChecking=no pi@\"${hostname}\" 'mkdir -p RflyPilot_Project/RflyPilot/' sshpass -p \"${password}\" scp -r ./rflypilot ../config/rflypilot.txt ../config/parameter.txt pi@\"${hostname}\":/home/pi/RflyPilot_Project/RflyPilot/ # sshpass -p \"${password}\" scp -r ./rflypilot ../config/rflypilot.txt ../config/calibration.txt ../config/parameter.txt pi@\"${hostname}\":/home/pi/RflyPilot_Project/RflyPilot/ Tip \u5f00\u53d1\u8005\u53ef\u4ee5\u5c06 hostname \u8bbe\u7f6e\u4e3aRflyPilot\u5bf9\u5e94\u7684IP\u5730\u5740\u3002","title":"\u7f16\u8bd1\u4e0e\u90e8\u7f72"},{"location":"development/compiling_deploy/#_1","text":"\u672c\u5c0f\u8282\u5c06\u4ecb\u7ecdRflyPilotTools\u5bf9RflyPilot\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\u4e0e\u90e8\u7f72\u7684\u57fa\u672c\u539f\u7406\uff0c\u5176\u80cc\u540e\u662f\u5728WSL\u5b50\u7cfb\u7edf\u4e2d\u6267\u884cLinux\u6307\u4ee4\u3002","title":"\u7f16\u8bd1\u4e0e\u90e8\u7f72"},{"location":"development/compiling_deploy/#_2","text":"\u5728WSL\u5b50\u7cfb\u7edf\u4e0b root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot# cd build/ root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build# cmake .. -- Configuring done -- Generating done -- Build files have been written to: /mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build# make -j128 [ 9%] Built target estimator_codegen [ 18%] Built target libsbus [ 18%] Built target confc [ 38%] Built target sih_codegen [ 38%] Built target basic_controller_codegen [ 55%] Built target controller_codegen [100%] Built target rflypilot root@DESKTOP-LVGT24C:/mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build#","title":"\u7f16\u8bd1"},{"location":"development/compiling_deploy/#_3","text":"RflyPilot\u7684\u90e8\u7f72\u8fd0\u884c\u7684\u6307\u4ee4\u662f make upload \u3002\u5176\u76f8\u5173\u811a\u672c\u6587\u4ef6\u5728 tools/upload.sh \u3002 #!/bin/sh hostname=\"192.168.199.183\" password=\"raspberry\" if [ $# = 1 ]; then hostname=$1 fi if [ $# = 2 ]; then hostname=$1 password=$2 fi echo \"hostname: ${hostname}\" echo \"password: ${password}\" sshpass -p \"${password}\" ssh -o StrictHostKeyChecking=no pi@\"${hostname}\" 'mkdir -p RflyPilot_Project/RflyPilot/' sshpass -p \"${password}\" scp -r ./rflypilot ../config/rflypilot.txt ../config/parameter.txt pi@\"${hostname}\":/home/pi/RflyPilot_Project/RflyPilot/ # sshpass -p \"${password}\" scp -r ./rflypilot ../config/rflypilot.txt ../config/calibration.txt ../config/parameter.txt pi@\"${hostname}\":/home/pi/RflyPilot_Project/RflyPilot/ Tip \u5f00\u53d1\u8005\u53ef\u4ee5\u5c06 hostname \u8bbe\u7f6e\u4e3aRflyPilot\u5bf9\u5e94\u7684IP\u5730\u5740\u3002","title":"\u90e8\u7f72"},{"location":"development/msg/","text":"\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7cfb\u7edf \uf0c1 RflyPilot\u91c7\u7528\u4e86\u4e00\u5957\u57fa\u4e8e\u5171\u4eab\u5185\u5b58\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u3002\u901a\u8fc7\u6d88\u606f publish \u548c read \u673a\u5236\u5b9e\u73b0\u4e00\u5199\u591a\u8bfb\u7684\u901a\u4fe1\u62d3\u6251\u3002\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u8fd8\u652f\u6301\u7edf\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387\u548c\u9ad8\u8d28\u91cf\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3002\u5176\u6e90\u7801\u4f4d\u4e8e src/lib/ringbuffer.h \uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb\u3002\u7cfb\u7edf\u5185\u90e8\u6d88\u606f\u5b9a\u4e49\u5728 src/msg/msg_def.* \u6587\u4ef6\u4e2d\u3002 \u6d88\u606f\u5b9a\u4e49 \uf0c1 \u5728 msg_def.h \u4e2d\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53\u4f5c\u4e3a\u6d88\u606f\u3002 typedef struct { uint64_t timestamp; float data[2]; }my_data_typedef; \u6ce8\u610f \u6bcf\u4e2a\u7ed3\u6784\u4f53\u4e2d\u5fc5\u987b\u5305\u542b uint64_t timestamp \u7528\u4e8e\u8bb0\u5f55\u65f6\u95f4\u6233\u3002 \u5728 msg_def.cpp \u4e2d\uff0c\u5b9a\u4e49\u6d88\u606f #define N_MY_DATA 3 ringbuffer_typedef<my_data_typedef> my_data_msg(N_MY_DATA, \"my_data\", N); \u8fd9\u4e2a\u6d88\u606f\u5b9a\u4e49\u4e2d\uff0c\u5229\u7528\u6a21\u677f ringbuffer_typdef \uff0c\u5b9a\u4e49\u4e86 my_data_msg \u6d88\u606f\u3002\u5176\u4e2d N_MY_DATA \u4e3a\u73af\u5f62\u5b58\u50a8\u5668\u5b58\u50a8\u6df1\u5ea6\uff0c\u5373\u5b58\u50a8\u6700\u65b0\u7684 N_MY_DATA \u4e2a\u6d88\u606f\u3002 my_data \u4e3a\u6d88\u606f\u540d\uff0cN\u8868\u793a\u6bcf publish N\u6b21\u540e\uff0c\u5199\u5165\u4e00\u6b21\u65e5\u5fd7\u6d88\u606f\uff0cN\u5373\u5206\u9891\u7cfb\u6570\u3002\u5f53N=0\u65f6\u8868\u793a\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u6d88\u606f\u3002 \u5728 msg_def.h \u4e2d\uff0c\u589e\u52a0\u4e00\u884c extern ringbuffer_typedef<my_data_typedef> my_data_msg; \u6d88\u606f\u7684\u53d1\u5e03\u4e0e\u8bfb\u53d6 \uf0c1 \u7a0b\u5e8f\u793a\u4f8b \uf0c1 class adaptive_delay_typedef adp_delay(0.5,15,0); void * thread_send(void * ptr) { my_data_typedef send_my_data; uint32_t cnt = 0; for(;;) { send_my_data.data[0] = 1; send_my_data.data[1] = get_time_now()/1e6; my_data_msg.publish(&send_my_data);//\u53d1\u5e03\u6d88\u606f if(cnt++ == 300) { printf(\"send: %f , %f\\n\",send_my_data.data[0], send_my_data.data[1]); cnt = 0; } adp_delay.delay_us(1000);//\u4f7f\u7528\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570 } } void * thread_recv(void * ptr) { my_data_typedef recv_my_data; for(;;) { my_data_msg.read(&recv_my_data);//\u8bfb\u53d6\u6d88\u606f printf(\"recv: %f , %f\\n\",recv_my_data.data[0], recv_my_data.data[1]); printf(\"send rate : %f \\n\", my_data_msg.publish_rate_hz); usleep(100000); } } int main(int argc, const char *argv[]) { bool ret = create_thread(\"thread_send\", thread_send, NULL); ret = create_thread(\"thread_recv\", thread_recv, NULL); while(1) { sleep(1); } return 0; } \u8fd0\u884c\u7ed3\u679c \uf0c1 recv: 1.000000 , 0.000012 send rate : 1000000.000000 thread_recv starting recv: 1.000000 , 0.100024 send rate : 956.022888 recv: 1.000000 , 0.199830 send rate : 967.118042 recv: 1.000000 , 0.299697 send rate : 975.609741 send: 1.000000 , 0.311999 recv: 1.000000 , 0.399873 send rate : 981.354309 recv: 1.000000 , 0.500497 send rate : 986.193237 recv: 1.000000 , 0.599694 send rate : 990.098999 send: 1.000000 , 0.617905 recv: 1.000000 , 0.700633 send rate : 992.063477 recv: 1.000000 , 0.800291 send rate : 995.024902 recv: 1.000000 , 0.900782 send rate : 996.015991 send: 1.000000 , 0.920866 recv: 1.000000 , 1.000038 send rate : 997.009033 recv: 1.000000 , 1.100356 send rate : 997.009033 recv: 1.000000 , 1.200573 send rate : 998.004028 send: 1.000000 , 1.222612 recv: 1.000000 , 1.300498 send rate : 1001.000977 recv: 1.000000 , 1.400427 send rate : 1001.000977 recv: 1.000000 , 1.501440 send rate : 1001.000977 send: 1.000000 , 1.524425 \u6ce8\u610f \u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e86 \u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570 adp_delay.delay_us() \u4ee5\u786e\u4fdd\u7ebf\u7a0b\u8fd0\u884c\u9891\u7387\u4e3a\u8bbe\u5b9a\u503c 1000Hz \uff0c\u53ef\u4ee5\u5728\u8fd0\u884c\u7ed3\u679c\u4e2d\u89c2\u5bdf\u5230\u8fd0\u884c\u9891\u7387\u7a33\u5b9a\u5230 1000Hz \u7684\u8fc7\u7a0b\u3002","title":"\u7ebf\u7a0b\u95f4\u901a\u4fe1"},{"location":"development/msg/#_1","text":"RflyPilot\u91c7\u7528\u4e86\u4e00\u5957\u57fa\u4e8e\u5171\u4eab\u5185\u5b58\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u3002\u901a\u8fc7\u6d88\u606f publish \u548c read \u673a\u5236\u5b9e\u73b0\u4e00\u5199\u591a\u8bfb\u7684\u901a\u4fe1\u62d3\u6251\u3002\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u8fd8\u652f\u6301\u7edf\u8ba1\u6d88\u606f\u53d1\u5e03\u9891\u7387\u548c\u9ad8\u8d28\u91cf\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3002\u5176\u6e90\u7801\u4f4d\u4e8e src/lib/ringbuffer.h \uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb\u3002\u7cfb\u7edf\u5185\u90e8\u6d88\u606f\u5b9a\u4e49\u5728 src/msg/msg_def.* \u6587\u4ef6\u4e2d\u3002","title":"\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7cfb\u7edf"},{"location":"development/msg/#_2","text":"\u5728 msg_def.h \u4e2d\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53\u4f5c\u4e3a\u6d88\u606f\u3002 typedef struct { uint64_t timestamp; float data[2]; }my_data_typedef; \u6ce8\u610f \u6bcf\u4e2a\u7ed3\u6784\u4f53\u4e2d\u5fc5\u987b\u5305\u542b uint64_t timestamp \u7528\u4e8e\u8bb0\u5f55\u65f6\u95f4\u6233\u3002 \u5728 msg_def.cpp \u4e2d\uff0c\u5b9a\u4e49\u6d88\u606f #define N_MY_DATA 3 ringbuffer_typedef<my_data_typedef> my_data_msg(N_MY_DATA, \"my_data\", N); \u8fd9\u4e2a\u6d88\u606f\u5b9a\u4e49\u4e2d\uff0c\u5229\u7528\u6a21\u677f ringbuffer_typdef \uff0c\u5b9a\u4e49\u4e86 my_data_msg \u6d88\u606f\u3002\u5176\u4e2d N_MY_DATA \u4e3a\u73af\u5f62\u5b58\u50a8\u5668\u5b58\u50a8\u6df1\u5ea6\uff0c\u5373\u5b58\u50a8\u6700\u65b0\u7684 N_MY_DATA \u4e2a\u6d88\u606f\u3002 my_data \u4e3a\u6d88\u606f\u540d\uff0cN\u8868\u793a\u6bcf publish N\u6b21\u540e\uff0c\u5199\u5165\u4e00\u6b21\u65e5\u5fd7\u6d88\u606f\uff0cN\u5373\u5206\u9891\u7cfb\u6570\u3002\u5f53N=0\u65f6\u8868\u793a\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u6d88\u606f\u3002 \u5728 msg_def.h \u4e2d\uff0c\u589e\u52a0\u4e00\u884c extern ringbuffer_typedef<my_data_typedef> my_data_msg;","title":"\u6d88\u606f\u5b9a\u4e49"},{"location":"development/msg/#_3","text":"","title":"\u6d88\u606f\u7684\u53d1\u5e03\u4e0e\u8bfb\u53d6"},{"location":"development/msg/#_4","text":"class adaptive_delay_typedef adp_delay(0.5,15,0); void * thread_send(void * ptr) { my_data_typedef send_my_data; uint32_t cnt = 0; for(;;) { send_my_data.data[0] = 1; send_my_data.data[1] = get_time_now()/1e6; my_data_msg.publish(&send_my_data);//\u53d1\u5e03\u6d88\u606f if(cnt++ == 300) { printf(\"send: %f , %f\\n\",send_my_data.data[0], send_my_data.data[1]); cnt = 0; } adp_delay.delay_us(1000);//\u4f7f\u7528\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570 } } void * thread_recv(void * ptr) { my_data_typedef recv_my_data; for(;;) { my_data_msg.read(&recv_my_data);//\u8bfb\u53d6\u6d88\u606f printf(\"recv: %f , %f\\n\",recv_my_data.data[0], recv_my_data.data[1]); printf(\"send rate : %f \\n\", my_data_msg.publish_rate_hz); usleep(100000); } } int main(int argc, const char *argv[]) { bool ret = create_thread(\"thread_send\", thread_send, NULL); ret = create_thread(\"thread_recv\", thread_recv, NULL); while(1) { sleep(1); } return 0; }","title":"\u7a0b\u5e8f\u793a\u4f8b"},{"location":"development/msg/#_5","text":"recv: 1.000000 , 0.000012 send rate : 1000000.000000 thread_recv starting recv: 1.000000 , 0.100024 send rate : 956.022888 recv: 1.000000 , 0.199830 send rate : 967.118042 recv: 1.000000 , 0.299697 send rate : 975.609741 send: 1.000000 , 0.311999 recv: 1.000000 , 0.399873 send rate : 981.354309 recv: 1.000000 , 0.500497 send rate : 986.193237 recv: 1.000000 , 0.599694 send rate : 990.098999 send: 1.000000 , 0.617905 recv: 1.000000 , 0.700633 send rate : 992.063477 recv: 1.000000 , 0.800291 send rate : 995.024902 recv: 1.000000 , 0.900782 send rate : 996.015991 send: 1.000000 , 0.920866 recv: 1.000000 , 1.000038 send rate : 997.009033 recv: 1.000000 , 1.100356 send rate : 997.009033 recv: 1.000000 , 1.200573 send rate : 998.004028 send: 1.000000 , 1.222612 recv: 1.000000 , 1.300498 send rate : 1001.000977 recv: 1.000000 , 1.400427 send rate : 1001.000977 recv: 1.000000 , 1.501440 send rate : 1001.000977 send: 1.000000 , 1.524425 \u6ce8\u610f \u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e86 \u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570 adp_delay.delay_us() \u4ee5\u786e\u4fdd\u7ebf\u7a0b\u8fd0\u884c\u9891\u7387\u4e3a\u8bbe\u5b9a\u503c 1000Hz \uff0c\u53ef\u4ee5\u5728\u8fd0\u884c\u7ed3\u679c\u4e2d\u89c2\u5bdf\u5230\u8fd0\u884c\u9891\u7387\u7a33\u5b9a\u5230 1000Hz \u7684\u8fc7\u7a0b\u3002","title":"\u8fd0\u884c\u7ed3\u679c"},{"location":"development/net_interface/","text":"\u7f51\u7edc\u901a\u4fe1\u63a5\u53e3 \uf0c1 \u672c\u5c0f\u8282\u5c06\u4ecb\u7ecdRflyPilot\u7684\u7f51\u7edc\u901a\u4fe1\u63a5\u53e3\uff0c\u5305\u62ecRflySim3D\u63a5\u53e3\u3001\u793a\u6ce2\u5668\u63a5\u53e3\u7b49\u3002 \u529f\u80fd \u63a5\u53e3 \u63a5/\u53d1 \u8bf4\u660e \u6e90\u6587\u4ef6 \u8fdc\u7a0b\u63a7\u5236\u53f0SSH TCP:22 \u63a5\u53d1 \u4efb\u4f55\u6a21\u5f0f RflySim3D\u89c6\u666f\u663e\u793a UDP:20010 \u53d1\u9001 \u5728SIH\u6a21\u5f0f\u4e0b\u542f\u7528 src/application/scope_thread.cpp \u7cfb\u7edf\u793a\u6ce2\u5668 UDP:3333 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u63a7\u5236\u5668\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3334 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u59ff\u6001\u4f30\u8ba1\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3335 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u4f4d\u7f6e\u4f30\u8ba1\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3336 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3 UDP:2222 \u63a5\u6536 \u5728OFFBOARD\u6a21\u5f0f\u542f\u7528 src/application/offboard_thread.cpp Tip \u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3\u7684\u529f\u80fd\u662f\u63d0\u4f9bSimulink\u63a5\u53e3\uff0c\u4f7f\u5f00\u53d1\u8005\u53ef\u4ee5\u5229\u7528Simulink\u8c03\u8282\u6267\u884c\u5668\u8f93\u51fa\u7684PWM\u3002\u76f8\u5e94\u7684Simulink\u6587\u4ef6\u5728 debug_tools/udp_send.slx \u6587\u4ef6\u4e2d\u3002 \u6ce8\u610f \u4f7f\u7528RflyPilot\u7684\u7f51\u7edc\u76f8\u5173\u529f\u80fd\u65f6\uff0c\u9700\u8981\u5c06RflyPilot\u8fde\u63a5\u5230\u5c40\u57df\u7f51\uff0c\u540c\u65f6\u8bbe\u7f6e\u597d rflypilot.txt \u4e2d\u7684 scope_ip \uff08\u5728\u7ebf\u793a\u6ce2\u5668\u8ba1\u7b97\u673a\u7684IP\uff09\u548c station_ip (RflySim3D\u548c\u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3\u8ba1\u7b97\u673a\u7684IP)\u3002 # string scope_ip = \"192.168.199.233\" # 152 station_ip = \"192.168.199.233\"","title":"\u7f51\u7edc\u901a\u4fe1\u63a5\u53e3"},{"location":"development/net_interface/#_1","text":"\u672c\u5c0f\u8282\u5c06\u4ecb\u7ecdRflyPilot\u7684\u7f51\u7edc\u901a\u4fe1\u63a5\u53e3\uff0c\u5305\u62ecRflySim3D\u63a5\u53e3\u3001\u793a\u6ce2\u5668\u63a5\u53e3\u7b49\u3002 \u529f\u80fd \u63a5\u53e3 \u63a5/\u53d1 \u8bf4\u660e \u6e90\u6587\u4ef6 \u8fdc\u7a0b\u63a7\u5236\u53f0SSH TCP:22 \u63a5\u53d1 \u4efb\u4f55\u6a21\u5f0f RflySim3D\u89c6\u666f\u663e\u793a UDP:20010 \u53d1\u9001 \u5728SIH\u6a21\u5f0f\u4e0b\u542f\u7528 src/application/scope_thread.cpp \u7cfb\u7edf\u793a\u6ce2\u5668 UDP:3333 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u63a7\u5236\u5668\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3334 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u59ff\u6001\u4f30\u8ba1\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3335 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u4f4d\u7f6e\u4f30\u8ba1\u793a\u6ce2\u5668\uff08\u81ea\u5b9a\u4e49\uff09 UDP:3336 \u53d1\u9001 \u4efb\u4f55\u6a21\u5f0f src/application/scope_thread.cpp \u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3 UDP:2222 \u63a5\u6536 \u5728OFFBOARD\u6a21\u5f0f\u542f\u7528 src/application/offboard_thread.cpp Tip \u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3\u7684\u529f\u80fd\u662f\u63d0\u4f9bSimulink\u63a5\u53e3\uff0c\u4f7f\u5f00\u53d1\u8005\u53ef\u4ee5\u5229\u7528Simulink\u8c03\u8282\u6267\u884c\u5668\u8f93\u51fa\u7684PWM\u3002\u76f8\u5e94\u7684Simulink\u6587\u4ef6\u5728 debug_tools/udp_send.slx \u6587\u4ef6\u4e2d\u3002 \u6ce8\u610f \u4f7f\u7528RflyPilot\u7684\u7f51\u7edc\u76f8\u5173\u529f\u80fd\u65f6\uff0c\u9700\u8981\u5c06RflyPilot\u8fde\u63a5\u5230\u5c40\u57df\u7f51\uff0c\u540c\u65f6\u8bbe\u7f6e\u597d rflypilot.txt \u4e2d\u7684 scope_ip \uff08\u5728\u7ebf\u793a\u6ce2\u5668\u8ba1\u7b97\u673a\u7684IP\uff09\u548c station_ip (RflySim3D\u548c\u6267\u884c\u5668\u8fdc\u7a0b\u8c03\u8bd5\u63a5\u53e3\u8ba1\u7b97\u673a\u7684IP)\u3002 # string scope_ip = \"192.168.199.233\" # 152 station_ip = \"192.168.199.233\"","title":"\u7f51\u7edc\u901a\u4fe1\u63a5\u53e3"},{"location":"development/other/","text":"\u5176\u4ed6\u8bbe\u7f6e \uf0c1 1 rflypilot.txt : sih_use_real_state \uf0c1 \u8fd9\u4e2a\u9009\u9879\u662f\u8bbe\u7f6e\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u662f\u5426\u4f7f\u7528\u771f\u5b9e\u72b6\u6001\u4f5c\u4e3a\u63a7\u5236\u7cfb\u7edf\u7684\u53cd\u9988\uff0c\u5f53\u4e3a 1 \u65f6\uff0c\u5219\u8868\u793a\u4e0d\u542f\u7528\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u5e76\u76f4\u63a5\u5c06\u6a21\u578b\u72b6\u6001\u4f5c\u4e3a\u53cd\u9988\u8f93\u51fa\u5230\u63a7\u5236\u5668\u4e2d\uff1b\u5f53\u4e3a 0 \u65f6\uff0c\u5219\u8868\u793a\u542f\u7528\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u6240\u6709\u7cfb\u7edf\u72b6\u6001\u7531\u4f20\u611f\u5668\u878d\u5408\u5f97\u5230\u3002 src/application/sih_thread.cpp \uf0c1 /* Get model outputs here */ if(_config.sih_use_real_state) { // SIH_Model_Y._e_cf_s; memcpy(&_cf_msg, &SIH_Model_Y._e_cf_s, sizeof(_cf_msg)); cf_output_msg.publish(&_cf_msg); // SIH_Model_Y._e_lpe_s; memcpy(&_lpe_msg, &SIH_Model_Y._e_lpe_s, sizeof(_lpe_msg)); lpe_output_msg.publish(&_lpe_msg); lpeLowPass_output_msg.publish(&_lpe_msg); } src/main.cpp \uf0c1 case SIH: printf(\"mode : SIH\\n\"); start_sih(); usleep(500000); if(!(_config_msg.sih_use_real_state)) { start_attitudeEstimator(); start_lpe(); } usleep(500000); start_usrController(); break; 2 rflypilot.txt : accel_cutoff_hz , gyro_cutoff_hz \uf0c1 accel_cutoff_hz \u4e0e gyro_cutoff_hz \u5206\u522b\u4e3a\u52a0\u901f\u5ea6\u8ba1\u548c\u9640\u87ba\u4eea\u4f4e\u901a\u6ee4\u6ce2\u5668\u622a\u6b62\u9891\u7387\uff0c\u5355\u4f4dHz\u3002 Warning \u4f4e\u901a\u6ee4\u6ce2\u5668\u622a\u6b62\u9891\u7387\u5e94\u5c0f\u4e8eIMU\u91c7\u6837\u7387\u76841/2\u3002 Tip \u9ed8\u8ba4\u4f7f\u7528\u7684\u4f4e\u901a\u6ee4\u6ce2\u5668\u4e3a\u4e8c\u9636\u5df4\u7279\u6c83\u65af\u6ee4\u6ce2\u5668\uff0c\u6e90\u7801\u4f4d\u4e8e src/lib/math_function.h \u3002 class iir_lpf2_typedef{ public: iir_lpf2_typedef(float sample_freq, float cutoff_freq) { // set initial parameters set_cutoff_frequency(sample_freq, cutoff_freq); } iir_lpf2_typedef(void) { } // Change filter parameters void set_cutoff_frequency(float sample_freq, float cutoff_freq); float apply(float sample); // Return the cutoff frequency float get_cutoff_freq() const { return _cutoff_freq; } // Reset the filter state to this value float reset(float sample); protected: float _cutoff_freq; float _a1; float _a2; float _b0; float _b1; float _b2; float _delay_element_1; // buffered sample -1 float _delay_element_2; // buffered sample -2 };","title":"\u5176\u4ed6\u8bbe\u7f6e"},{"location":"development/other/#_1","text":"","title":"\u5176\u4ed6\u8bbe\u7f6e"},{"location":"development/other/#1-rflypilottxtsih_use_real_state","text":"\u8fd9\u4e2a\u9009\u9879\u662f\u8bbe\u7f6e\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u662f\u5426\u4f7f\u7528\u771f\u5b9e\u72b6\u6001\u4f5c\u4e3a\u63a7\u5236\u7cfb\u7edf\u7684\u53cd\u9988\uff0c\u5f53\u4e3a 1 \u65f6\uff0c\u5219\u8868\u793a\u4e0d\u542f\u7528\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u5e76\u76f4\u63a5\u5c06\u6a21\u578b\u72b6\u6001\u4f5c\u4e3a\u53cd\u9988\u8f93\u51fa\u5230\u63a7\u5236\u5668\u4e2d\uff1b\u5f53\u4e3a 0 \u65f6\uff0c\u5219\u8868\u793a\u542f\u7528\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u6240\u6709\u7cfb\u7edf\u72b6\u6001\u7531\u4f20\u611f\u5668\u878d\u5408\u5f97\u5230\u3002","title":"1 rflypilot.txt:sih_use_real_state"},{"location":"development/other/#srcapplicationsih_threadcpp","text":"/* Get model outputs here */ if(_config.sih_use_real_state) { // SIH_Model_Y._e_cf_s; memcpy(&_cf_msg, &SIH_Model_Y._e_cf_s, sizeof(_cf_msg)); cf_output_msg.publish(&_cf_msg); // SIH_Model_Y._e_lpe_s; memcpy(&_lpe_msg, &SIH_Model_Y._e_lpe_s, sizeof(_lpe_msg)); lpe_output_msg.publish(&_lpe_msg); lpeLowPass_output_msg.publish(&_lpe_msg); }","title":"src/application/sih_thread.cpp"},{"location":"development/other/#srcmaincpp","text":"case SIH: printf(\"mode : SIH\\n\"); start_sih(); usleep(500000); if(!(_config_msg.sih_use_real_state)) { start_attitudeEstimator(); start_lpe(); } usleep(500000); start_usrController(); break;","title":"src/main.cpp"},{"location":"development/other/#2-rflypilottxtaccel_cutoff_hzgyro_cutoff_hz","text":"accel_cutoff_hz \u4e0e gyro_cutoff_hz \u5206\u522b\u4e3a\u52a0\u901f\u5ea6\u8ba1\u548c\u9640\u87ba\u4eea\u4f4e\u901a\u6ee4\u6ce2\u5668\u622a\u6b62\u9891\u7387\uff0c\u5355\u4f4dHz\u3002 Warning \u4f4e\u901a\u6ee4\u6ce2\u5668\u622a\u6b62\u9891\u7387\u5e94\u5c0f\u4e8eIMU\u91c7\u6837\u7387\u76841/2\u3002 Tip \u9ed8\u8ba4\u4f7f\u7528\u7684\u4f4e\u901a\u6ee4\u6ce2\u5668\u4e3a\u4e8c\u9636\u5df4\u7279\u6c83\u65af\u6ee4\u6ce2\u5668\uff0c\u6e90\u7801\u4f4d\u4e8e src/lib/math_function.h \u3002 class iir_lpf2_typedef{ public: iir_lpf2_typedef(float sample_freq, float cutoff_freq) { // set initial parameters set_cutoff_frequency(sample_freq, cutoff_freq); } iir_lpf2_typedef(void) { } // Change filter parameters void set_cutoff_frequency(float sample_freq, float cutoff_freq); float apply(float sample); // Return the cutoff frequency float get_cutoff_freq() const { return _cutoff_freq; } // Reset the filter state to this value float reset(float sample); protected: float _cutoff_freq; float _a1; float _a2; float _b0; float _b1; float _b2; float _delay_element_1; // buffered sample -1 float _delay_element_2; // buffered sample -2 };","title":"2 rflypilot.txt:accel_cutoff_hz,gyro_cutoff_hz"},{"location":"development/realtime/","text":"\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027 \uf0c1 \u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\u6307\u7684\u662f\u63a7\u5236\u5668\u8fd0\u884c\u9891\u7387\u9ad8\u4f4e\u4e0e\u8fd0\u884c\u5468\u671f\u7a33\u5b9a\u6027\uff0c\u98de\u884c\u63a7\u5236\u5668\u7684\u5b9e\u65f6\u6027\u662f\u98de\u884c\u63a7\u5236\u7684\u91cd\u8981\u4fdd\u969c\u6761\u4ef6\u4e4b\u4e00\u3002\u5bf9\u4e8e\u4f20\u7edf\u7684\u57fa\u4e8eMCU\u7684\u98de\u63a7\u65b9\u6848\uff0c\u7531\u4e8e\u98de\u63a7\u4e2d\u8fd0\u884c\u4e86\u5d4c\u5165\u5f0f\u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u98de\u63a7\u7a0b\u5e8f\u7684\u5b9e\u65f6\u6027\u53ef\u4ee5\u5f97\u5230\u4fdd\u969c\u3002\u800c\u5bf9\u4e8eA\u7cfb\u5217\u5904\u7406\u5668\uff0c\u4fdd\u969c\u5176\u4e2d\u98de\u63a7\u7a0b\u5e8f\u7684\u5b9e\u65f6\u6027\u8981\u6bd4M\u7cfb\u5217\u5904\u7406\u5668\u66f4\u52a0\u56f0\u96be\u3002\u867d\u7136\u5176\u8ba1\u7b97\u80fd\u529b\u6709\u4e86\u6781\u5927\u7684\u63d0\u9ad8\uff0c\u63a7\u5236\u7b97\u6cd5\u53ef\u4ee5\u4ee5\u8f83\u9ad8\u7684\u9891\u7387\u8fd0\u884c\uff0c\u4f46\u662f\u5728\u98de\u63a7\u7b97\u6cd5\u8fd0\u884c\u5468\u671f\u7684\u7a33\u5b9a\u6027\u65b9\u9762\uff0c\u4f9d\u7136\u5b58\u5728\u8f83\u5927\u7684\u6311\u6218\u3002 \u5b9e\u65f6\u8865\u4e01 \uf0c1 RflyPilot\u98de\u63a7\u7cfb\u7edf\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u662f Navio2 \uff0c\u8be5\u7cfb\u7edf\u652f\u6301 PREEMPT \u8865\u4e01\uff0c\u6709\u5229\u4e8e\u6539\u5584\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\u3002 Tip Navio2\u7684\u4e0b\u8f7d\u5730\u5740 \u591a\u7ebf\u7a0b\u5e76\u884c \uf0c1 RflyPilot\u91c7\u7528\u4e86\u591a\u7ebf\u7a0b\u5e76\u884c\u7684\u65b9\u6848\uff0c\u5373\u5c06\u98de\u63a7\u4efb\u52a1\u5212\u5206\u4e3a\u591a\u4e2a\u5b50\u4efb\u52a1\uff0c\u5373\u7ebf\u7a0b\u3002\u5f97\u76ca\u4e8e\u6811\u8393\u6d3e\u76844\u6838CPU\uff0cRflyPilot\u53ef\u4ee5\u505a\u5230\u591a\u7ebf\u7a0b\u5e76\u884c\u8fd0\u884c\uff0c\u6709\u6548\u63d0\u9ad8\u4e86\u6838\u5fc3\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\u3002 \u6838\u5fc3\u5c4f\u853d\u4e0e\u7ed1\u5b9a \uf0c1 \u57fa\u672c\u539f\u7406 \uf0c1 \u4e3a\u4e86\u6700\u5927\u9650\u5ea6\u4fdd\u969c\u6838\u5fc3\u4efb\u52a1\u7684\u8fd0\u884c\u4e0d\u88ab\u6253\u65ad\uff0cRflyPilot\u5bf9\u4e8e\u5173\u952e\u4efb\u52a1\u91c7\u7528\u4e86\u6838\u5fc3\u7ed1\u5b9a\u7684\u64cd\u4f5c\uff0c\u5e76\u5728\u7cfb\u7edf\u5c42\u9762\u5c4f\u853d\u4e86\u8be5CPU\u6838\u5fc3\u7684\u4f7f\u7528\uff0c\u5373\u7cfb\u7edf\u9ed8\u8ba4\u4e0d\u4f1a\u4f7f\u7528\u8be5\u6838\u5fc3\uff0c\u5728\u542f\u52a8 rflypilot \u540e\uff0c\u67d0\u4e9b\u5173\u952e\u4efb\u52a1\u5c06\u4f1a\u88ab\u5b89\u6392\u5728\u8be5\u6838\u5fc3\u4e2d\u8fd0\u884c\u3002 \u4e0b\u56fe\u4e2d Thread 1 \u4e0e Thread 2 \u5206\u522b\u8fd0\u884c\u4e8e CORE0 , CORE1 \u3002 Thread 3 \u4e0e Thread 4 \u8fd0\u884c\u4e8e CORE2 , Thread 5 \u8fd0\u884c\u4e8e CORE3 \u3002\u5176\u4e2d Linux OS \u8fd0\u884c\u4e8e CORE0 \u4e0e CORE1 \u4e2d\uff0c\u5b83\u4f1a\u6253\u65ad Thread 1 \u4e0e Thread 2 \u7684\u8fd0\u884c\u3002\u800c CORE2 \u4e0e CORE3 \u4e0d\u8fd0\u884cLinux\u7cfb\u7edf\uff0c\u5176\u4efb\u52a1\u4e0d\u6613\u88ab\u6253\u65ad\uff0c\u4f46\u662f Thread 3 \u4e0e Thread 4 \u5bb9\u6613\u76f8\u4e92\u6253\u65ad\u3002 Thread 5 \u72ec\u4eab CORE3 \uff0c\u5c06\u5177\u6709\u8f83\u9ad8\u7684\u5b9e\u65f6\u6027\u3002 \u8fd0\u884c\u7ed3\u679c \uf0c1 \u5f53\u98de\u63a7\u7a0b\u5e8f\u672a\u8fd0\u884c\u65f6\uff0cCPU\u5360\u7528\u60c5\u51b5\u4e3a Tip RflyPilot\u9ed8\u8ba4\u8bbe\u7f6e CORE2 \u4e0e CORE3 \u4e3a\u88ab\u9694\u79bb\u7684CPU\u6838\u5fc3\uff0c\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6\u4e3a /boot/cmdline.txt \uff0c isolcpus=2,3 \u3002 dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait isolcpus=2,3 \u98de\u63a7\u5b9e\u9645\u8fd0\u884c\u540e\u7ed3\u679c\u5982\u4e0b \u5b9e\u9645\u7ed1\u5b9a\u60c5\u51b5\u5982\u4e0b \u6838\u5fc3\u7ed1\u5b9a\u8bbe\u7f6e \uf0c1 \u5173\u4e8e\u98de\u63a7\u7684\u6838\u5fc3\u7ed1\u5b9a\u8bbe\u7f6e\uff0c\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003RflyPilot\u98de\u63a7\u4ee3\u7801\u4e0b\u7684 config/configure.h \u6587\u4ef6\u3002 /* Estimator Thread Core */ #define ATT_EST_CORE 2 #define POS_EST_CORE 2 /* Sensor Thread Core */ #define IMU_CORE 2 #define MAG_CORE 2 #define BARO_CORE 2 #define GPS_CORE 2 /* Control Thread Core */ #define SUBS_CORE 2 #define BASIC_CTRL_CORE 2 #define CTRL_CORE 3 /* SIH Thread Core */ #define SIH_CORE 2 /* Serve Thread Core */ #define SCREEN_CORE 1 #define CONSOLE_CORE 1 #define LOG_CORE 1 #define ULOG_CORE 1 \u63d0\u793a \u5982\u679c\u5f00\u53d1\u8005\u9700\u8981\u4e3a\u81ea\u5df1\u7684\u7ebf\u7a0b\u7ed1\u5b9a\u6838\u5fc3\u53ef\u4ee5\u5728\u7ebf\u7a0b\u51fd\u6570\u4e2d\u8fd0\u884c\u4e00\u6b21 core_bind(x); \uff0c x \u4e3a\u6838\u5fc3\u6807\u53f7\uff080-3\uff09\u3002 \u7ebf\u7a0b\u540c\u6b65\u673a\u5236 \uf0c1 \u4f18\u70b9 \uf0c1 \u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u7684\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u6838\u5fc3\u7ebf\u7a0b\uff08\u5982\uff0cIMU\u7ebf\u7a0b\u3001\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\uff09\u4e4b\u95f4\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1\u5ef6\u8fdf\u6700\u5c0f\u3002\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u73af\u8def\u4e2d\u5ef6\u8fdf\u65f6\u95f4\u7684\u7a33\u5b9a\u6027\uff0c\u6539\u5584\u7cfb\u7edf\u6027\u80fd\u3002 Tip \u5b9e\u9a8c\u8868\u660e\uff0c\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u53ef\u4ee5\u6781\u5927\u6539\u5584\u98de\u884c\u5668\u5728\u9ad8\u52a8\u6001\u4e0b\u7684\u95ed\u73af\u7a33\u5b9a\u6027\u3002 \u57fa\u672c\u539f\u7406 \uf0c1 RflyPilot\u4e2d\u7ebf\u7a0b\u540c\u6b65\u91c7\u7528\u4e86\u89e6\u53d1\u7684\u65b9\u5f0f\uff0c\u9996\u5148IMU\u7ebf\u7a0b\u4ee5\u56fa\u5b9a\u9891\u7387\u8fd0\u884c\uff08\u901a\u8fc7\u5ef6\u65f6\u51fd\u6570 delay_us_combined() \uff09\uff0c\u5f53\u8ba1\u6570\u5668 count_for_lpe == IMU_LPE \u6761\u4ef6\u6210\u7acb\u65f6\uff0c\u89e6\u53d1 pthread_cond_signal(&cond_imu2lpe) \u3002\u800cLPE\u7ebf\u7a0b\u8fd0\u884c\u65f6\u4f1a\u7b49\u5f85 pthread_cond_wait(&cond_imu2lpe, &mutex_imu2lpe) \uff0c\u76f4\u5230\u6536\u5230\u6709IMU\u7ebf\u7a0b\u4f20\u6765\u7684\u6d88\u606f\u624d\u5f00\u59cb\u6267\u884c\u5faa\u73af\u3002\u4e4b\u540e\u7531LPE\u7ebf\u7a0b\u4f1a\u89e6\u53d1\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b\uff0c\u6700\u540e\u662f\u63a7\u5236\u5668\u7ebf\u7a0b\u3002 \u57fa\u672c\u8bbe\u7f6e \uf0c1 \u5176\u914d\u7f6e\u6587\u4ef6\u5728RflyPilot\u98de\u63a7\u4ee3\u7801\u4e0b\u7684 config/configure.h \u4e2d\u3002\u76ee\u524dRflyPilot\u53ea\u5bf9\u6838\u5fc3\u7ebf\u7a0b\u542f\u7528\u4e86\u8be5\u529f\u80fd\u3002 /* Rate Div */ #define USING_THREAD_SYNC 0 #define IMU_LPE 1 #define LPE_ATT 1 #define ATT_CTRL 2 \u6ce8\u610f \u9ed8\u8ba4\u8be5\u529f\u80fd\u672a\u542f\u7528\uff0c\u4e3a\u542f\u7528\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u9700\u8981\u5c06 USING_THREAD_SYNC \u8bbe\u4e3a 1 \u3002 IMU_LPE / LPE_ATT / ATT_CTRL \u4e3a\u76f8\u5e94\u7684\u5206\u9891\u7cfb\u6570\u3002 IMU\u7ebf\u7a0b\u7684\u8fd0\u884c\u9891\u7387\u53ef\u4ee5\u5728 rflypilot.txt \u6587\u4ef6\u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u9ed8\u8ba4 imu_rate = 800 \uff0c\u5373800Hz\u3002 \u7ebf\u7a0b \u8fd0\u884c\u9891\u7387(Hz) IMU 800 LPE 800/IMU_LPE = 800 ATT 800/IMU_LPE/LPE_ATT = 800 CTRL 800/IMU_LPE/LPE_ATT/ATT_CTRL = 400 \u8fd0\u884c\u7ed3\u679c \uf0c1 Warning \u5f53\u542f\u7528 USING_THREAD_SYNC \u540e\uff0c rflypilot.txt \u4e2d\u7684 controller_rate , attitude_est_rate , lpe_rate \u5c06\u4e0d\u518d\u751f\u6548\u3002 \u4ee3\u7801\u4f18\u5316 \uf0c1 \u5728\u4ee3\u7801\u4e2d\uff0cRflyPilot\u5c3d\u91cf\u51cf\u5c11\u4e86\u9891\u7e41\u7684IO\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u969c\u8f83\u5c0f\u7684\u4efb\u52a1\u8017\u65f6\u3002","title":"\u7cfb\u7edf\u5b9e\u65f6\u6027"},{"location":"development/realtime/#_1","text":"\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\u6307\u7684\u662f\u63a7\u5236\u5668\u8fd0\u884c\u9891\u7387\u9ad8\u4f4e\u4e0e\u8fd0\u884c\u5468\u671f\u7a33\u5b9a\u6027\uff0c\u98de\u884c\u63a7\u5236\u5668\u7684\u5b9e\u65f6\u6027\u662f\u98de\u884c\u63a7\u5236\u7684\u91cd\u8981\u4fdd\u969c\u6761\u4ef6\u4e4b\u4e00\u3002\u5bf9\u4e8e\u4f20\u7edf\u7684\u57fa\u4e8eMCU\u7684\u98de\u63a7\u65b9\u6848\uff0c\u7531\u4e8e\u98de\u63a7\u4e2d\u8fd0\u884c\u4e86\u5d4c\u5165\u5f0f\u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u98de\u63a7\u7a0b\u5e8f\u7684\u5b9e\u65f6\u6027\u53ef\u4ee5\u5f97\u5230\u4fdd\u969c\u3002\u800c\u5bf9\u4e8eA\u7cfb\u5217\u5904\u7406\u5668\uff0c\u4fdd\u969c\u5176\u4e2d\u98de\u63a7\u7a0b\u5e8f\u7684\u5b9e\u65f6\u6027\u8981\u6bd4M\u7cfb\u5217\u5904\u7406\u5668\u66f4\u52a0\u56f0\u96be\u3002\u867d\u7136\u5176\u8ba1\u7b97\u80fd\u529b\u6709\u4e86\u6781\u5927\u7684\u63d0\u9ad8\uff0c\u63a7\u5236\u7b97\u6cd5\u53ef\u4ee5\u4ee5\u8f83\u9ad8\u7684\u9891\u7387\u8fd0\u884c\uff0c\u4f46\u662f\u5728\u98de\u63a7\u7b97\u6cd5\u8fd0\u884c\u5468\u671f\u7684\u7a33\u5b9a\u6027\u65b9\u9762\uff0c\u4f9d\u7136\u5b58\u5728\u8f83\u5927\u7684\u6311\u6218\u3002","title":"\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027"},{"location":"development/realtime/#_2","text":"RflyPilot\u98de\u63a7\u7cfb\u7edf\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u662f Navio2 \uff0c\u8be5\u7cfb\u7edf\u652f\u6301 PREEMPT \u8865\u4e01\uff0c\u6709\u5229\u4e8e\u6539\u5584\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\u3002 Tip Navio2\u7684\u4e0b\u8f7d\u5730\u5740","title":"\u5b9e\u65f6\u8865\u4e01"},{"location":"development/realtime/#_3","text":"RflyPilot\u91c7\u7528\u4e86\u591a\u7ebf\u7a0b\u5e76\u884c\u7684\u65b9\u6848\uff0c\u5373\u5c06\u98de\u63a7\u4efb\u52a1\u5212\u5206\u4e3a\u591a\u4e2a\u5b50\u4efb\u52a1\uff0c\u5373\u7ebf\u7a0b\u3002\u5f97\u76ca\u4e8e\u6811\u8393\u6d3e\u76844\u6838CPU\uff0cRflyPilot\u53ef\u4ee5\u505a\u5230\u591a\u7ebf\u7a0b\u5e76\u884c\u8fd0\u884c\uff0c\u6709\u6548\u63d0\u9ad8\u4e86\u6838\u5fc3\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\u3002","title":"\u591a\u7ebf\u7a0b\u5e76\u884c"},{"location":"development/realtime/#_4","text":"","title":"\u6838\u5fc3\u5c4f\u853d\u4e0e\u7ed1\u5b9a"},{"location":"development/realtime/#_5","text":"\u4e3a\u4e86\u6700\u5927\u9650\u5ea6\u4fdd\u969c\u6838\u5fc3\u4efb\u52a1\u7684\u8fd0\u884c\u4e0d\u88ab\u6253\u65ad\uff0cRflyPilot\u5bf9\u4e8e\u5173\u952e\u4efb\u52a1\u91c7\u7528\u4e86\u6838\u5fc3\u7ed1\u5b9a\u7684\u64cd\u4f5c\uff0c\u5e76\u5728\u7cfb\u7edf\u5c42\u9762\u5c4f\u853d\u4e86\u8be5CPU\u6838\u5fc3\u7684\u4f7f\u7528\uff0c\u5373\u7cfb\u7edf\u9ed8\u8ba4\u4e0d\u4f1a\u4f7f\u7528\u8be5\u6838\u5fc3\uff0c\u5728\u542f\u52a8 rflypilot \u540e\uff0c\u67d0\u4e9b\u5173\u952e\u4efb\u52a1\u5c06\u4f1a\u88ab\u5b89\u6392\u5728\u8be5\u6838\u5fc3\u4e2d\u8fd0\u884c\u3002 \u4e0b\u56fe\u4e2d Thread 1 \u4e0e Thread 2 \u5206\u522b\u8fd0\u884c\u4e8e CORE0 , CORE1 \u3002 Thread 3 \u4e0e Thread 4 \u8fd0\u884c\u4e8e CORE2 , Thread 5 \u8fd0\u884c\u4e8e CORE3 \u3002\u5176\u4e2d Linux OS \u8fd0\u884c\u4e8e CORE0 \u4e0e CORE1 \u4e2d\uff0c\u5b83\u4f1a\u6253\u65ad Thread 1 \u4e0e Thread 2 \u7684\u8fd0\u884c\u3002\u800c CORE2 \u4e0e CORE3 \u4e0d\u8fd0\u884cLinux\u7cfb\u7edf\uff0c\u5176\u4efb\u52a1\u4e0d\u6613\u88ab\u6253\u65ad\uff0c\u4f46\u662f Thread 3 \u4e0e Thread 4 \u5bb9\u6613\u76f8\u4e92\u6253\u65ad\u3002 Thread 5 \u72ec\u4eab CORE3 \uff0c\u5c06\u5177\u6709\u8f83\u9ad8\u7684\u5b9e\u65f6\u6027\u3002","title":"\u57fa\u672c\u539f\u7406"},{"location":"development/realtime/#_6","text":"\u5f53\u98de\u63a7\u7a0b\u5e8f\u672a\u8fd0\u884c\u65f6\uff0cCPU\u5360\u7528\u60c5\u51b5\u4e3a Tip RflyPilot\u9ed8\u8ba4\u8bbe\u7f6e CORE2 \u4e0e CORE3 \u4e3a\u88ab\u9694\u79bb\u7684CPU\u6838\u5fc3\uff0c\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6\u4e3a /boot/cmdline.txt \uff0c isolcpus=2,3 \u3002 dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait isolcpus=2,3 \u98de\u63a7\u5b9e\u9645\u8fd0\u884c\u540e\u7ed3\u679c\u5982\u4e0b \u5b9e\u9645\u7ed1\u5b9a\u60c5\u51b5\u5982\u4e0b","title":"\u8fd0\u884c\u7ed3\u679c"},{"location":"development/realtime/#_7","text":"\u5173\u4e8e\u98de\u63a7\u7684\u6838\u5fc3\u7ed1\u5b9a\u8bbe\u7f6e\uff0c\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003RflyPilot\u98de\u63a7\u4ee3\u7801\u4e0b\u7684 config/configure.h \u6587\u4ef6\u3002 /* Estimator Thread Core */ #define ATT_EST_CORE 2 #define POS_EST_CORE 2 /* Sensor Thread Core */ #define IMU_CORE 2 #define MAG_CORE 2 #define BARO_CORE 2 #define GPS_CORE 2 /* Control Thread Core */ #define SUBS_CORE 2 #define BASIC_CTRL_CORE 2 #define CTRL_CORE 3 /* SIH Thread Core */ #define SIH_CORE 2 /* Serve Thread Core */ #define SCREEN_CORE 1 #define CONSOLE_CORE 1 #define LOG_CORE 1 #define ULOG_CORE 1 \u63d0\u793a \u5982\u679c\u5f00\u53d1\u8005\u9700\u8981\u4e3a\u81ea\u5df1\u7684\u7ebf\u7a0b\u7ed1\u5b9a\u6838\u5fc3\u53ef\u4ee5\u5728\u7ebf\u7a0b\u51fd\u6570\u4e2d\u8fd0\u884c\u4e00\u6b21 core_bind(x); \uff0c x \u4e3a\u6838\u5fc3\u6807\u53f7\uff080-3\uff09\u3002","title":"\u6838\u5fc3\u7ed1\u5b9a\u8bbe\u7f6e"},{"location":"development/realtime/#_8","text":"","title":"\u7ebf\u7a0b\u540c\u6b65\u673a\u5236"},{"location":"development/realtime/#_9","text":"\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u7684\u6838\u5fc3\u76ee\u7684\u662f\u8ba9\u6838\u5fc3\u7ebf\u7a0b\uff08\u5982\uff0cIMU\u7ebf\u7a0b\u3001\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\uff09\u4e4b\u95f4\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1\u5ef6\u8fdf\u6700\u5c0f\u3002\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u73af\u8def\u4e2d\u5ef6\u8fdf\u65f6\u95f4\u7684\u7a33\u5b9a\u6027\uff0c\u6539\u5584\u7cfb\u7edf\u6027\u80fd\u3002 Tip \u5b9e\u9a8c\u8868\u660e\uff0c\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u53ef\u4ee5\u6781\u5927\u6539\u5584\u98de\u884c\u5668\u5728\u9ad8\u52a8\u6001\u4e0b\u7684\u95ed\u73af\u7a33\u5b9a\u6027\u3002","title":"\u4f18\u70b9"},{"location":"development/realtime/#_10","text":"RflyPilot\u4e2d\u7ebf\u7a0b\u540c\u6b65\u91c7\u7528\u4e86\u89e6\u53d1\u7684\u65b9\u5f0f\uff0c\u9996\u5148IMU\u7ebf\u7a0b\u4ee5\u56fa\u5b9a\u9891\u7387\u8fd0\u884c\uff08\u901a\u8fc7\u5ef6\u65f6\u51fd\u6570 delay_us_combined() \uff09\uff0c\u5f53\u8ba1\u6570\u5668 count_for_lpe == IMU_LPE \u6761\u4ef6\u6210\u7acb\u65f6\uff0c\u89e6\u53d1 pthread_cond_signal(&cond_imu2lpe) \u3002\u800cLPE\u7ebf\u7a0b\u8fd0\u884c\u65f6\u4f1a\u7b49\u5f85 pthread_cond_wait(&cond_imu2lpe, &mutex_imu2lpe) \uff0c\u76f4\u5230\u6536\u5230\u6709IMU\u7ebf\u7a0b\u4f20\u6765\u7684\u6d88\u606f\u624d\u5f00\u59cb\u6267\u884c\u5faa\u73af\u3002\u4e4b\u540e\u7531LPE\u7ebf\u7a0b\u4f1a\u89e6\u53d1\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b\uff0c\u6700\u540e\u662f\u63a7\u5236\u5668\u7ebf\u7a0b\u3002","title":"\u57fa\u672c\u539f\u7406"},{"location":"development/realtime/#_11","text":"\u5176\u914d\u7f6e\u6587\u4ef6\u5728RflyPilot\u98de\u63a7\u4ee3\u7801\u4e0b\u7684 config/configure.h \u4e2d\u3002\u76ee\u524dRflyPilot\u53ea\u5bf9\u6838\u5fc3\u7ebf\u7a0b\u542f\u7528\u4e86\u8be5\u529f\u80fd\u3002 /* Rate Div */ #define USING_THREAD_SYNC 0 #define IMU_LPE 1 #define LPE_ATT 1 #define ATT_CTRL 2 \u6ce8\u610f \u9ed8\u8ba4\u8be5\u529f\u80fd\u672a\u542f\u7528\uff0c\u4e3a\u542f\u7528\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u9700\u8981\u5c06 USING_THREAD_SYNC \u8bbe\u4e3a 1 \u3002 IMU_LPE / LPE_ATT / ATT_CTRL \u4e3a\u76f8\u5e94\u7684\u5206\u9891\u7cfb\u6570\u3002 IMU\u7ebf\u7a0b\u7684\u8fd0\u884c\u9891\u7387\u53ef\u4ee5\u5728 rflypilot.txt \u6587\u4ef6\u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u9ed8\u8ba4 imu_rate = 800 \uff0c\u5373800Hz\u3002 \u7ebf\u7a0b \u8fd0\u884c\u9891\u7387(Hz) IMU 800 LPE 800/IMU_LPE = 800 ATT 800/IMU_LPE/LPE_ATT = 800 CTRL 800/IMU_LPE/LPE_ATT/ATT_CTRL = 400","title":"\u57fa\u672c\u8bbe\u7f6e"},{"location":"development/realtime/#_12","text":"Warning \u5f53\u542f\u7528 USING_THREAD_SYNC \u540e\uff0c rflypilot.txt \u4e2d\u7684 controller_rate , attitude_est_rate , lpe_rate \u5c06\u4e0d\u518d\u751f\u6548\u3002","title":"\u8fd0\u884c\u7ed3\u679c"},{"location":"development/realtime/#_13","text":"\u5728\u4ee3\u7801\u4e2d\uff0cRflyPilot\u5c3d\u91cf\u51cf\u5c11\u4e86\u9891\u7e41\u7684IO\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u969c\u8f83\u5c0f\u7684\u4efb\u52a1\u8017\u65f6\u3002","title":"\u4ee3\u7801\u4f18\u5316"},{"location":"development/rflypilot_dev_example/","text":"\u5f00\u53d1\u793a\u4f8b \uf0c1 \u672c\u5c0f\u8282\u5c06\u7ed9\u51faRflyPilot\u5f00\u53d1\u793a\u4f8b\u3002\u9996\u5148\u4ecb\u7ecdRflyPilot\u98de\u63a7\u76ee\u5f55\u7ed3\u6784\uff0c\u7136\u540e\u4ecb\u7ecd\u5982\u4f55\u4e3aRflyPilot\u72ec\u7acb\u7684\u7ebf\u7a0b\uff0c\u6700\u7ec8\u7ed9\u51fa\u8fd0\u884c\u7ed3\u679c\u3002 \u76ee\u5f55\u7ed3\u6784\u4e0e\u8f6f\u4ef6\u67b6\u6784 \uf0c1 . \u251c\u2500\u2500 CMakeLists.txt // cmakelists\u6587\u4ef6\uff0c\u7528\u4e8e\u7f16\u8bd1 \u251c\u2500\u2500 basic_controller_codegen // \u7528\u4e8e\u5b58\u653e\u57fa\u7840\u63a7\u5236\u5668\uff08\u76ee\u524d\u5f03\u7528\uff09 \u251c\u2500\u2500 build // \u7f16\u8bd1\u65f6\u7684\u76ee\u6807\u76ee\u5f55 \u251c\u2500\u2500 config // \u7528\u4e8e\u653e\u7f6e\u914d\u7f6e\u6587\u4ef6 \u251c\u2500\u2500 controller_codegen // \u7528\u4e8e\u653e\u7f6e\u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 estimator_codegen // \u7528\u4e8e\u653e\u7f6e\u72b6\u6001\u4f30\u8ba1\u5668\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 sih_codegen // \u7528\u4e8e\u653e\u7f6e\u6a21\u578b\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 src // RflyPilot\u6e90\u7801\u6587\u4ef6 \u2502 \u251c\u2500\u2500 3rdparty // \u7b2c\u4e09\u65b9\u5e93\u6587\u4ef6 \u2502 \u2502 \u251c\u2500\u2500 conf-c \u2502 \u2502 \u2514\u2500\u2500 sbus \u2502 \u251c\u2500\u2500 application // \u5e94\u7528\u5c42\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u51fd\u6570 \u2502 \u251c\u2500\u2500 calibration // \u6821\u51c6\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 console // \u63a7\u5236\u53f0\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 drivers // \u5e95\u5c42\u9a71\u52a8\u4ee3\u7801 \u2502 \u2502 \u251c\u2500\u2500 actuator // \u6267\u884c\u5668\u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 fpga \u2502 \u2502 \u2502 \u2514\u2500\u2500 pca9685 \u2502 \u2502 \u251c\u2500\u2500 barometer // \u6c14\u538b\u8ba1\u9a71\u52a8 \u2502 \u2502 \u2502 \u2514\u2500\u2500 ms5611 \u2502 \u2502 \u251c\u2500\u2500 gps // GPS\u9a71\u52a8 \u2502 \u2502 \u251c\u2500\u2500 imu // IMU \u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 accelerometer \u2502 \u2502 \u2502 \u251c\u2500\u2500 gyroscope \u2502 \u2502 \u2502 \u251c\u2500\u2500 icm20689 \u2502 \u2502 \u2502 \u251c\u2500\u2500 icm20689new // icm20689\u9a71\u52a8\uff0cFIFO supported \u2502 \u2502 \u2502 \u2514\u2500\u2500 icm42688p \u2502 \u2502 \u251c\u2500\u2500 magnetometer // \u78c1\u529b\u8ba1\u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 ist8310 \u2502 \u2502 \u2502 \u2514\u2500\u2500 qmc5883l \u2502 \u2502 \u2514\u2500\u2500 rc //\u9065\u63a7\u5668\u9a71\u52a8 \u2502 \u2502 \u2514\u2500\u2500 sbus \u2502 \u251c\u2500\u2500 include.h // \u4e3b\u5934\u6587\u4ef6 \u2502 \u251c\u2500\u2500 lib // \u57fa\u7840\u529f\u80fd\u51fd\u6570\u5e93 \u2502 \u251c\u2500\u2500 log // \u65e5\u5fd7\u7cfb\u7edf\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 main.cpp // \u5165\u53e3\u6587\u4ef6 \u2502 \u251c\u2500\u2500 msg // \u6d88\u606f\u7cfb\u7edf\u4ee3\u7801 \u2502 \u251c\u2500\u2500 parameter // \u53c2\u6570\u7cfb\u7edf\u4ee3\u7801 \u2502 \u251c\u2500\u2500 scope // \u5728\u7ebf\u793a\u6ce2\u5668\u4ee3\u7801 \u2502 \u251c\u2500\u2500 simulink_utility // simulink\u76f8\u5173\u652f\u6301\u4ee3\u7801 \u2502 \u2514\u2500\u2500 system_utility //\u7cfb\u7edf\u7ea7\u652f\u6301\u4ee3\u7801 \u251c\u2500\u2500 tools // \u811a\u672c\u6587\u4ef6 \u2502 \u251c\u2500\u2500 compile.sh \u2502 \u2514\u2500\u2500 upload.sh RflyPilot\u8f6f\u4ef6\u67b6\u6784\u5982\u4e0b\uff0cRflyPilot\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\u53ef\u4ee5\u5206\u4e3a\u4e09\u5c42\u3002\u7b2c\u4e00\u5c42\u4e3a\u4eff\u771f\u6a21\u5f0f\uff0c\u5305\u62ecHIL/SIH/EXP\uff0cRflyPilot\u5c06\u7531\u8fd9\u4e09\u79cd\u6a21\u5f0f\u786e\u5b9a\u542f\u52a8\u4e0d\u540c\u7684\u7ebf\u7a0b\u7ec4\u5408\u3002\u7b2c\u4e8c\u5c42\u5e94\u7528\u5c42\u7531\u591a\u79cd\u7ebf\u7a0b\u4efb\u52a1\u7ec4\u6210\uff0c\u5e94\u7528\u5c42\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5c0f\u4efb\u52a1\u90fd\u5c01\u88c5\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u88ab\u72ec\u7acb\u8c03\u7528\uff0c\u5176\u5bf9\u5e94\u8fd9 application \u4e2d\u7684\u5404\u4e2a\u6e90\u7801\u6587\u4ef6\u3002\u7b2c\u4e09\u5c42\u4e3a\u529f\u80fd\u4e0e\u9a71\u52a8\uff0c\u8be5\u5c42\u7684\u51fd\u6570\u6784\u6210\u4e86\u5e94\u7528\u5c42\u7684\u5404\u4e2a\u7ebf\u7a0b\u3002\u4ed6\u4eec\u7531\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u548c\u9a71\u52a8\u6784\u6210\uff0c\u5206\u6563\u5728 src/driver \u548c src \u4e0b\u7684\u5404\u4e2a\u529f\u80fd\u6587\u4ef6\u5939\u4e2d\u3002 Tip \u5982\u679c\u8bfb\u8005\u8981\u589e\u52a0\u81ea\u5df1\u7684\u4efb\u52a1 mytask \uff0c\u53ef\u4ee5\u8003\u8651\u5148\u5728 src \u76ee\u5f55\u4e2d\u521b\u5efa\u76f8\u5e94\u5b50\u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u653e\u76f8\u5e94\u7684\u529f\u80fd\u7ec4\u4ef6\u6216\u9a71\u52a8\uff0c\u7136\u540e\u518d\u5728 application \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u76f8\u5e94\u7684 mytask_thread.cpp/h \u6587\u4ef6\uff0c\u7528\u4e8e\u6784\u6210\u72ec\u7acb\u7684\u7ebf\u7a0b\u3002\u6700\u540e\u6839\u636e\u8fd0\u884c\u6a21\u5f0f\u7684\u9700\u8981\uff0c\u5728 main.cpp \u4e2d\u8fdb\u884c\u8c03\u7528\u5373\u53ef\u3002 \u6ce8\u610f RflyPilot\u4e2d\u4e5f\u5b58\u5728\u90e8\u5206\u7ebf\u7a0b\u5b9a\u4e49\u5728\u9a71\u52a8\u4ee3\u7801\u4e2d\u3002 \u5f00\u53d1\u793a\u4f8b \uf0c1 \u589e\u52a0\u529f\u80fd\u4ee3\u7801 \uf0c1 \u5728 src \u4e2d\u521b\u5efa\u6587\u4ef6\u5939 mytask \uff0c\u5e76\u521b\u5efa\u4e24\u4e2a\u6587\u4ef6 mytask.cpp \u4e0e mytask.h \u3002\u5185\u5bb9\u5982\u4e0b mytask.cpp #include \"mytask.h\" void my_task_typedef::my_task_init(void) { cnt = 0; } void my_task_typedef::my_task_run(void) { cnt++; printf(\"timestamp %f, %d\\n\", get_time_now() / 1e6, cnt); } mytask.h #ifndef _MY_TASK_ #define _MY_TASK_ #include \"include.h\" class my_task_typedef { public: uint32_t cnt; void my_task_init(void); void my_task_run(void); }; #endif 2. \u4fee\u6539 include.h \u4e0e CMakeLists.txt \u5728 include.h \u7684\u6700\u540e\u4e00\u884c\u52a0\u5165 #include \"mytask.h\" \u5728 CMakeLists.txt \u4e2d\uff0c\u4fee\u6539 source_file \u3002 SET(source_file src/main.cpp src/system_utility/systime.cpp src/system_utility/system.cpp src/lib/math_function.cpp src/msg/msg_def.cpp src/calibration/accel_calib.cpp src/calibration/gyro_calib.cpp src/calibration/mag_calib.cpp src/calibration/ellipsoid_method.cpp src/calibration/sensor_calibration.cpp src/parameter/parameter_read.cpp src/scope/scope.cpp src/log/binlog.cpp src/console/console.cpp src/console/screen.cpp src/mytask/mytask.cpp ) \u5e76\u5728 include_directories \u4e2d\u589e\u52a0 src/mytask \u3002 include_directories( config/ src src/lib src/calibration ${drivers_include} src/3rdparty/conf-c/include src/simulink_utility src/system_utility src/application src/msg src/parameter src/scope src/console src/log controller_codegen estimator_codegen sih_codegen basic_controller_codegen src/mytask ) \u81f3\u6b64\uff0c mytask \u529f\u80fd\u6a21\u5757\u5df2\u88ab\u52a0\u5165\u5230RflyPilot\u4e2d\u3002 \u589e\u52a0\u7ebf\u7a0b\u5e94\u7528 \uf0c1 \u5728 src/application \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u6587\u4ef6 mytask_thread.cpp/h mytask_thread.cpp #include \"mytask_thread.h\" class my_task_typedef mytask; void * thread_mytask(void * ptr) { mytask.my_task_init(); for(;;) { mytask.my_task_run(); sleep(1); } } void start_mytask(void) { bool ret = create_thread(\"mytask\", thread_mytask, NULL); } mytask_thread.h #ifndef _MY_TASK_THREAD_ #define _MY_TASK_THREAD_ #include \"include.h\" void * thread_mytask(void * ptr); void start_mytask(void); #endif \u5728 include.h \u4e2d\u52a0\u5165 #include \"mytask_thread.h\" \u81f3\u6b64\uff0c\u5df2\u5c06 mytask \u4f5c\u4e3a\u72ec\u7acb\u7684\u7ebf\u7a0b\u589e\u52a0\u81f3RflyPilot\u4e2d\u3002 \u65b0\u4efb\u52a1\u7684\u8c03\u7528 \uf0c1 \u5728\u672c\u793a\u4f8b\u4e2d\uff0c\u5c06\u5728EXP\u6a21\u5f0f\u4e2d\u5bf9 mytask_thread \u8fdb\u884c\u8c03\u7528\u3002\u4fee\u6539 main.cpp \uff0c\u589e\u52a0 start_mytask() \u3002 case EXP: printf(\"mode : EXP\\n\"); pca9685_dev.pca9685_init(I2C_BUS_1,PWM_FREQ, true); pca9685_dev_aux.pca9685_init(I2C_BUS_0,333, true); start_icm42688p(); start_baro(); start_gps(\"/dev/ttySC0\"); start_qmc5883l(); usleep(500000); start_attitudeEstimator(); start_lpe(); usleep(500000); start_usrController(); //start_basicController(); // start_log(NULL); start_ulog(NULL); start_mytask(); break; \u8fd0\u884c\u7ed3\u679c \uf0c1 \u5b8c\u6210\u4e0a\u8ff0\u6b65\u9aa4\u540e\uff0c\u5bf9RflyPilot\u8fdb\u884c\u91cd\u65b0\u7f16\u8bd1\uff0c\u4fee\u6539\u4eff\u771f\u6a21\u5f0f\u4e3aEXP\uff0c\u5e76\u4e0a\u4f20\u81f3RflyPilot\u98de\u63a7\u4e2d\uff0c\u8fd0\u884c rflypilot \u3002\u5f97\u5230\u5982\u4e0b\u8f93\u51fa\u4fe1\u606f ... mytask thread created with process pid : 1537 mytask starting ... timestamp 7.645346, 7 timestamp 8.645485, 8 timestamp 9.645568, 9 timestamp 10.645977, 10 timestamp 12.646189, 12 timestamp 13.646284, 13 timestamp 14.646379, 14 timestamp 15.646473, 15 timestamp 16.646567, 16 timestamp 17.646661, 17 timestamp 18.646752, 18 timestamp 19.646845, 19 timestamp 20.646963, 20 timestamp 21.647062, 21 ... \u8f93\u51fa\u7ed3\u679c\u8bf4\u660e\uff0c\u65b0\u589e\u52a0\u7684mytask\u7ebf\u7a0b\u6b63\u786e\u8fd0\u884c\u3002","title":"\u5f00\u53d1\u793a\u4f8b"},{"location":"development/rflypilot_dev_example/#_1","text":"\u672c\u5c0f\u8282\u5c06\u7ed9\u51faRflyPilot\u5f00\u53d1\u793a\u4f8b\u3002\u9996\u5148\u4ecb\u7ecdRflyPilot\u98de\u63a7\u76ee\u5f55\u7ed3\u6784\uff0c\u7136\u540e\u4ecb\u7ecd\u5982\u4f55\u4e3aRflyPilot\u72ec\u7acb\u7684\u7ebf\u7a0b\uff0c\u6700\u7ec8\u7ed9\u51fa\u8fd0\u884c\u7ed3\u679c\u3002","title":"\u5f00\u53d1\u793a\u4f8b"},{"location":"development/rflypilot_dev_example/#_2","text":". \u251c\u2500\u2500 CMakeLists.txt // cmakelists\u6587\u4ef6\uff0c\u7528\u4e8e\u7f16\u8bd1 \u251c\u2500\u2500 basic_controller_codegen // \u7528\u4e8e\u5b58\u653e\u57fa\u7840\u63a7\u5236\u5668\uff08\u76ee\u524d\u5f03\u7528\uff09 \u251c\u2500\u2500 build // \u7f16\u8bd1\u65f6\u7684\u76ee\u6807\u76ee\u5f55 \u251c\u2500\u2500 config // \u7528\u4e8e\u653e\u7f6e\u914d\u7f6e\u6587\u4ef6 \u251c\u2500\u2500 controller_codegen // \u7528\u4e8e\u653e\u7f6e\u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 estimator_codegen // \u7528\u4e8e\u653e\u7f6e\u72b6\u6001\u4f30\u8ba1\u5668\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 sih_codegen // \u7528\u4e8e\u653e\u7f6e\u6a21\u578b\u4ee3\u7801\u751f\u6210\u540e\u7684\u6587\u4ef6 \u251c\u2500\u2500 src // RflyPilot\u6e90\u7801\u6587\u4ef6 \u2502 \u251c\u2500\u2500 3rdparty // \u7b2c\u4e09\u65b9\u5e93\u6587\u4ef6 \u2502 \u2502 \u251c\u2500\u2500 conf-c \u2502 \u2502 \u2514\u2500\u2500 sbus \u2502 \u251c\u2500\u2500 application // \u5e94\u7528\u5c42\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u51fd\u6570 \u2502 \u251c\u2500\u2500 calibration // \u6821\u51c6\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 console // \u63a7\u5236\u53f0\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 drivers // \u5e95\u5c42\u9a71\u52a8\u4ee3\u7801 \u2502 \u2502 \u251c\u2500\u2500 actuator // \u6267\u884c\u5668\u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 fpga \u2502 \u2502 \u2502 \u2514\u2500\u2500 pca9685 \u2502 \u2502 \u251c\u2500\u2500 barometer // \u6c14\u538b\u8ba1\u9a71\u52a8 \u2502 \u2502 \u2502 \u2514\u2500\u2500 ms5611 \u2502 \u2502 \u251c\u2500\u2500 gps // GPS\u9a71\u52a8 \u2502 \u2502 \u251c\u2500\u2500 imu // IMU \u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 accelerometer \u2502 \u2502 \u2502 \u251c\u2500\u2500 gyroscope \u2502 \u2502 \u2502 \u251c\u2500\u2500 icm20689 \u2502 \u2502 \u2502 \u251c\u2500\u2500 icm20689new // icm20689\u9a71\u52a8\uff0cFIFO supported \u2502 \u2502 \u2502 \u2514\u2500\u2500 icm42688p \u2502 \u2502 \u251c\u2500\u2500 magnetometer // \u78c1\u529b\u8ba1\u9a71\u52a8 \u2502 \u2502 \u2502 \u251c\u2500\u2500 ist8310 \u2502 \u2502 \u2502 \u2514\u2500\u2500 qmc5883l \u2502 \u2502 \u2514\u2500\u2500 rc //\u9065\u63a7\u5668\u9a71\u52a8 \u2502 \u2502 \u2514\u2500\u2500 sbus \u2502 \u251c\u2500\u2500 include.h // \u4e3b\u5934\u6587\u4ef6 \u2502 \u251c\u2500\u2500 lib // \u57fa\u7840\u529f\u80fd\u51fd\u6570\u5e93 \u2502 \u251c\u2500\u2500 log // \u65e5\u5fd7\u7cfb\u7edf\u76f8\u5173\u4ee3\u7801 \u2502 \u251c\u2500\u2500 main.cpp // \u5165\u53e3\u6587\u4ef6 \u2502 \u251c\u2500\u2500 msg // \u6d88\u606f\u7cfb\u7edf\u4ee3\u7801 \u2502 \u251c\u2500\u2500 parameter // \u53c2\u6570\u7cfb\u7edf\u4ee3\u7801 \u2502 \u251c\u2500\u2500 scope // \u5728\u7ebf\u793a\u6ce2\u5668\u4ee3\u7801 \u2502 \u251c\u2500\u2500 simulink_utility // simulink\u76f8\u5173\u652f\u6301\u4ee3\u7801 \u2502 \u2514\u2500\u2500 system_utility //\u7cfb\u7edf\u7ea7\u652f\u6301\u4ee3\u7801 \u251c\u2500\u2500 tools // \u811a\u672c\u6587\u4ef6 \u2502 \u251c\u2500\u2500 compile.sh \u2502 \u2514\u2500\u2500 upload.sh RflyPilot\u8f6f\u4ef6\u67b6\u6784\u5982\u4e0b\uff0cRflyPilot\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\u53ef\u4ee5\u5206\u4e3a\u4e09\u5c42\u3002\u7b2c\u4e00\u5c42\u4e3a\u4eff\u771f\u6a21\u5f0f\uff0c\u5305\u62ecHIL/SIH/EXP\uff0cRflyPilot\u5c06\u7531\u8fd9\u4e09\u79cd\u6a21\u5f0f\u786e\u5b9a\u542f\u52a8\u4e0d\u540c\u7684\u7ebf\u7a0b\u7ec4\u5408\u3002\u7b2c\u4e8c\u5c42\u5e94\u7528\u5c42\u7531\u591a\u79cd\u7ebf\u7a0b\u4efb\u52a1\u7ec4\u6210\uff0c\u5e94\u7528\u5c42\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5c0f\u4efb\u52a1\u90fd\u5c01\u88c5\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u88ab\u72ec\u7acb\u8c03\u7528\uff0c\u5176\u5bf9\u5e94\u8fd9 application \u4e2d\u7684\u5404\u4e2a\u6e90\u7801\u6587\u4ef6\u3002\u7b2c\u4e09\u5c42\u4e3a\u529f\u80fd\u4e0e\u9a71\u52a8\uff0c\u8be5\u5c42\u7684\u51fd\u6570\u6784\u6210\u4e86\u5e94\u7528\u5c42\u7684\u5404\u4e2a\u7ebf\u7a0b\u3002\u4ed6\u4eec\u7531\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u548c\u9a71\u52a8\u6784\u6210\uff0c\u5206\u6563\u5728 src/driver \u548c src \u4e0b\u7684\u5404\u4e2a\u529f\u80fd\u6587\u4ef6\u5939\u4e2d\u3002 Tip \u5982\u679c\u8bfb\u8005\u8981\u589e\u52a0\u81ea\u5df1\u7684\u4efb\u52a1 mytask \uff0c\u53ef\u4ee5\u8003\u8651\u5148\u5728 src \u76ee\u5f55\u4e2d\u521b\u5efa\u76f8\u5e94\u5b50\u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u653e\u76f8\u5e94\u7684\u529f\u80fd\u7ec4\u4ef6\u6216\u9a71\u52a8\uff0c\u7136\u540e\u518d\u5728 application \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u76f8\u5e94\u7684 mytask_thread.cpp/h \u6587\u4ef6\uff0c\u7528\u4e8e\u6784\u6210\u72ec\u7acb\u7684\u7ebf\u7a0b\u3002\u6700\u540e\u6839\u636e\u8fd0\u884c\u6a21\u5f0f\u7684\u9700\u8981\uff0c\u5728 main.cpp \u4e2d\u8fdb\u884c\u8c03\u7528\u5373\u53ef\u3002 \u6ce8\u610f RflyPilot\u4e2d\u4e5f\u5b58\u5728\u90e8\u5206\u7ebf\u7a0b\u5b9a\u4e49\u5728\u9a71\u52a8\u4ee3\u7801\u4e2d\u3002","title":"\u76ee\u5f55\u7ed3\u6784\u4e0e\u8f6f\u4ef6\u67b6\u6784"},{"location":"development/rflypilot_dev_example/#_3","text":"","title":"\u5f00\u53d1\u793a\u4f8b"},{"location":"development/rflypilot_dev_example/#_4","text":"\u5728 src \u4e2d\u521b\u5efa\u6587\u4ef6\u5939 mytask \uff0c\u5e76\u521b\u5efa\u4e24\u4e2a\u6587\u4ef6 mytask.cpp \u4e0e mytask.h \u3002\u5185\u5bb9\u5982\u4e0b mytask.cpp #include \"mytask.h\" void my_task_typedef::my_task_init(void) { cnt = 0; } void my_task_typedef::my_task_run(void) { cnt++; printf(\"timestamp %f, %d\\n\", get_time_now() / 1e6, cnt); } mytask.h #ifndef _MY_TASK_ #define _MY_TASK_ #include \"include.h\" class my_task_typedef { public: uint32_t cnt; void my_task_init(void); void my_task_run(void); }; #endif 2. \u4fee\u6539 include.h \u4e0e CMakeLists.txt \u5728 include.h \u7684\u6700\u540e\u4e00\u884c\u52a0\u5165 #include \"mytask.h\" \u5728 CMakeLists.txt \u4e2d\uff0c\u4fee\u6539 source_file \u3002 SET(source_file src/main.cpp src/system_utility/systime.cpp src/system_utility/system.cpp src/lib/math_function.cpp src/msg/msg_def.cpp src/calibration/accel_calib.cpp src/calibration/gyro_calib.cpp src/calibration/mag_calib.cpp src/calibration/ellipsoid_method.cpp src/calibration/sensor_calibration.cpp src/parameter/parameter_read.cpp src/scope/scope.cpp src/log/binlog.cpp src/console/console.cpp src/console/screen.cpp src/mytask/mytask.cpp ) \u5e76\u5728 include_directories \u4e2d\u589e\u52a0 src/mytask \u3002 include_directories( config/ src src/lib src/calibration ${drivers_include} src/3rdparty/conf-c/include src/simulink_utility src/system_utility src/application src/msg src/parameter src/scope src/console src/log controller_codegen estimator_codegen sih_codegen basic_controller_codegen src/mytask ) \u81f3\u6b64\uff0c mytask \u529f\u80fd\u6a21\u5757\u5df2\u88ab\u52a0\u5165\u5230RflyPilot\u4e2d\u3002","title":"\u589e\u52a0\u529f\u80fd\u4ee3\u7801"},{"location":"development/rflypilot_dev_example/#_5","text":"\u5728 src/application \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u6587\u4ef6 mytask_thread.cpp/h mytask_thread.cpp #include \"mytask_thread.h\" class my_task_typedef mytask; void * thread_mytask(void * ptr) { mytask.my_task_init(); for(;;) { mytask.my_task_run(); sleep(1); } } void start_mytask(void) { bool ret = create_thread(\"mytask\", thread_mytask, NULL); } mytask_thread.h #ifndef _MY_TASK_THREAD_ #define _MY_TASK_THREAD_ #include \"include.h\" void * thread_mytask(void * ptr); void start_mytask(void); #endif \u5728 include.h \u4e2d\u52a0\u5165 #include \"mytask_thread.h\" \u81f3\u6b64\uff0c\u5df2\u5c06 mytask \u4f5c\u4e3a\u72ec\u7acb\u7684\u7ebf\u7a0b\u589e\u52a0\u81f3RflyPilot\u4e2d\u3002","title":"\u589e\u52a0\u7ebf\u7a0b\u5e94\u7528"},{"location":"development/rflypilot_dev_example/#_6","text":"\u5728\u672c\u793a\u4f8b\u4e2d\uff0c\u5c06\u5728EXP\u6a21\u5f0f\u4e2d\u5bf9 mytask_thread \u8fdb\u884c\u8c03\u7528\u3002\u4fee\u6539 main.cpp \uff0c\u589e\u52a0 start_mytask() \u3002 case EXP: printf(\"mode : EXP\\n\"); pca9685_dev.pca9685_init(I2C_BUS_1,PWM_FREQ, true); pca9685_dev_aux.pca9685_init(I2C_BUS_0,333, true); start_icm42688p(); start_baro(); start_gps(\"/dev/ttySC0\"); start_qmc5883l(); usleep(500000); start_attitudeEstimator(); start_lpe(); usleep(500000); start_usrController(); //start_basicController(); // start_log(NULL); start_ulog(NULL); start_mytask(); break;","title":"\u65b0\u4efb\u52a1\u7684\u8c03\u7528"},{"location":"development/rflypilot_dev_example/#_7","text":"\u5b8c\u6210\u4e0a\u8ff0\u6b65\u9aa4\u540e\uff0c\u5bf9RflyPilot\u8fdb\u884c\u91cd\u65b0\u7f16\u8bd1\uff0c\u4fee\u6539\u4eff\u771f\u6a21\u5f0f\u4e3aEXP\uff0c\u5e76\u4e0a\u4f20\u81f3RflyPilot\u98de\u63a7\u4e2d\uff0c\u8fd0\u884c rflypilot \u3002\u5f97\u5230\u5982\u4e0b\u8f93\u51fa\u4fe1\u606f ... mytask thread created with process pid : 1537 mytask starting ... timestamp 7.645346, 7 timestamp 8.645485, 8 timestamp 9.645568, 9 timestamp 10.645977, 10 timestamp 12.646189, 12 timestamp 13.646284, 13 timestamp 14.646379, 14 timestamp 15.646473, 15 timestamp 16.646567, 16 timestamp 17.646661, 17 timestamp 18.646752, 18 timestamp 19.646845, 19 timestamp 20.646963, 20 timestamp 21.647062, 21 ... \u8f93\u51fa\u7ed3\u679c\u8bf4\u660e\uff0c\u65b0\u589e\u52a0\u7684mytask\u7ebf\u7a0b\u6b63\u786e\u8fd0\u884c\u3002","title":"\u8fd0\u884c\u7ed3\u679c"},{"location":"development/rflypilot_system/","text":"\u8f6f\u4ef6\u7cfb\u7edf\u67b6\u6784 \uf0c1 \u672c\u8282\u5185\u5bb9\u5c06\u4ecb\u7ecdRflyPilot\u7684\u8f6f\u4ef6\u7cfb\u7edf\u67b6\u6784\u3002RflyPilot\u7cfb\u7edf\u4e2d\u7684\u4efb\u52a1\u4e3b\u8981\u4ee5\u7ebf\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u90e8\u5206\u7ebf\u7a0b\u4e4b\u95f4\u72ec\u7acb\u8fd0\u884c\u4e92\u4e0d\u5e72\u6270\uff0c\u800c\u67d0\u4e9b\u5173\u952e\u7ebf\u7a0b\u5b58\u5728\u8282\u62cd\u5173\u7cfb\u3002\u5404\u4e2a\u7ebf\u7a0b\u95f4\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7cfb\u7edf\u8fdb\u884c\u901a\u4fe1\u3002 \u4e3b\u51fd\u6570 \uf0c1 RflyPilot\u5728\u542f\u52a8\u65f6\u4f1a\u8bfb\u53d6 rflypilot.txt \u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u6839\u636e valid_mode \u7684\u8bbe\u7f6e\u60c5\u51b5\uff0c\u901a\u8fc7 switch-case \u8bed\u53e5\uff0c\u5224\u65ad\u542f\u52a8\u54ea\u4e9b\u7ebf\u7a0b\u3002\u5728RflyPilot\u4e2d\uff0c\u6240\u6709\u4efb\u52a1\u90fd\u4ee5\u7ebf\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b start_usrController() \u3001IMU\u7ebf\u7a0b start_icm42688p() \u3001GPS\u7ebf\u7a0b start_gps() \u3001\u65e5\u5fd7\u7ebf\u7a0b start_ulog() \u7b49\u7b49\u3002 \u7ebf\u7a0b \u529f\u80fd \u5907\u6ce8 start_console \u542f\u52a8\u63a7\u5236\u53f0 start_screen \u542f\u52a8\u63a7\u5236\u53f0\u5b9e\u65f6\u53c2\u6570\u663e\u793a\u529f\u80fd start_ulog \u542f\u52a8ulog\u65e5\u5fd7\u8bb0\u5f55 start_sbus \u8fd0\u884c\u4e32\u884c\u603b\u7ebf\u63a5\u6536\u673a\u9a71\u52a8 HIL/EXP/SIH start_system_app \u8fd0\u884c\u9ed8\u8ba4\u7684\u7cfb\u7edf\u7ea7\u6d88\u606f\u53d1\u5e03\u7cfb\u7edf \u4e3b\u8981\u7528\u4e8e\u66f4\u65b0\u6d88\u606f system_scope_msg start_scope \u8fd0\u884c\u5728\u7ebf\u793a\u6ce2\u5668\u7cfb\u7edf \u5305\u62ec\u7cfb\u7edf\u793a\u6ce2\u5668\u3001\u63a7\u5236\u5668\u793a\u6ce2\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u793a\u6ce2\u5668 start_icm20689_new \u542f\u52a8icm20689\u7ebf\u7a0b IMU\uff0cHIL\uff0c\u652f\u6301FIFO\u8bfb\u53d6 start_ist8310 \u542f\u52a8ist8310\u7ebf\u7a0b \u78c1\u529b\u8ba1\uff0cHIL start_baro \u542f\u52a8MS5611\u7ebf\u7a0b \u6c14\u538b\u8ba1\uff0cHIL/EXP start_gps \u542f\u52a8GPS\u7ebf\u7a0b GPS\uff0cHIL/EXP start_attitudeEstimator \u542f\u52a8\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b \u652f\u6301\u4ee3\u7801\u751f\u6210 start_lpe \u542f\u52a8LPE\u4f4d\u7f6e\u4f30\u8ba1\u5668 \u652f\u6301\u4ee3\u7801\u751f\u6210 start_usrController \u542f\u52a8\u63a7\u5236\u5668\u7ebf\u7a0b \u652f\u6301\u4ee3\u7801\u751f\u6210 start_icm42688p \u542f\u52a8icm42688p\u7ebf\u7a0b IMU\uff0cEXP start_qmc5883l \u542f\u52a8qmc5883l\u7ebf\u7a0b \u78c1\u529b\u8ba1\uff0cEXP start_sih \u542f\u52a8SIH\u4eff\u771f\u6a21\u578b\u7ebf\u7a0b \u88ab\u63a7\u5bf9\u8c61\u6a21\u578b\uff0cSIH start_offboard \u542f\u52a8offboard\u7ebf\u7a0b \u7528\u4e8e\u63a5\u6536\u8ba1\u7b97\u673a\u6307\u4ee4 start_calibration \u542f\u52a8\u4f20\u611f\u5668\u6821\u51c6\u7ebf\u7a0b \u4ec5\u5728\u4f20\u611f\u5668\u6821\u51c6\u65f6\u8fd0\u884c Tip \u5173\u4e8e\u5404\u4e2a\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\u8fd0\u884c\u4e0d\u540c\u7ebf\u7a0b\u7684\u5177\u4f53\u60c5\u51b5\uff0c\u611f\u5174\u8da3\u7684\u7684\u8bfb\u8005\u53ef\u4ee5\u4ed4\u7ec6\u9605\u8bfb\u4ee3\u7801 src/main.cpp \u3002 \u7cfb\u7edf\u7ea7\u51fd\u6570 \uf0c1 \u7cfb\u7edf\u7ea7\u51fd\u6570\u662f\u6709\u4e0e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7d27\u5bc6\u76f8\u5173\u7684\u51fd\u6570\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u6838\u5fc3\u7ed1\u5b9a\u3001\u65f6\u95f4\u6233\u7b49\u7b49\uff0c\u8fd9\u4e9b\u51fd\u6570\u901a\u5e38\u5b9a\u4e49\u5728 src/system_utility \u4e2d\u3002 \u51fd\u6570 \u529f\u80fd \u5907\u6ce8 create_thread \u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b bool ret = create_thread(\"barometer\", thread_baro, NULL); core_bind \u7528\u4e8e\u5c06\u67d0\u4e00\u7ebf\u7a0b\u7ed1\u5b9a\u81f3\u67d0\u4e2aCPU\u6838\u5fc3 \u8f93\u5165\u53c2\u65700~3 get_time_now \u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4 \u5355\u4f4d(us)","title":"\u8f6f\u4ef6\u67b6\u6784"},{"location":"development/rflypilot_system/#_1","text":"\u672c\u8282\u5185\u5bb9\u5c06\u4ecb\u7ecdRflyPilot\u7684\u8f6f\u4ef6\u7cfb\u7edf\u67b6\u6784\u3002RflyPilot\u7cfb\u7edf\u4e2d\u7684\u4efb\u52a1\u4e3b\u8981\u4ee5\u7ebf\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u90e8\u5206\u7ebf\u7a0b\u4e4b\u95f4\u72ec\u7acb\u8fd0\u884c\u4e92\u4e0d\u5e72\u6270\uff0c\u800c\u67d0\u4e9b\u5173\u952e\u7ebf\u7a0b\u5b58\u5728\u8282\u62cd\u5173\u7cfb\u3002\u5404\u4e2a\u7ebf\u7a0b\u95f4\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7cfb\u7edf\u8fdb\u884c\u901a\u4fe1\u3002","title":"\u8f6f\u4ef6\u7cfb\u7edf\u67b6\u6784"},{"location":"development/rflypilot_system/#_2","text":"RflyPilot\u5728\u542f\u52a8\u65f6\u4f1a\u8bfb\u53d6 rflypilot.txt \u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u6839\u636e valid_mode \u7684\u8bbe\u7f6e\u60c5\u51b5\uff0c\u901a\u8fc7 switch-case \u8bed\u53e5\uff0c\u5224\u65ad\u542f\u52a8\u54ea\u4e9b\u7ebf\u7a0b\u3002\u5728RflyPilot\u4e2d\uff0c\u6240\u6709\u4efb\u52a1\u90fd\u4ee5\u7ebf\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b start_usrController() \u3001IMU\u7ebf\u7a0b start_icm42688p() \u3001GPS\u7ebf\u7a0b start_gps() \u3001\u65e5\u5fd7\u7ebf\u7a0b start_ulog() \u7b49\u7b49\u3002 \u7ebf\u7a0b \u529f\u80fd \u5907\u6ce8 start_console \u542f\u52a8\u63a7\u5236\u53f0 start_screen \u542f\u52a8\u63a7\u5236\u53f0\u5b9e\u65f6\u53c2\u6570\u663e\u793a\u529f\u80fd start_ulog \u542f\u52a8ulog\u65e5\u5fd7\u8bb0\u5f55 start_sbus \u8fd0\u884c\u4e32\u884c\u603b\u7ebf\u63a5\u6536\u673a\u9a71\u52a8 HIL/EXP/SIH start_system_app \u8fd0\u884c\u9ed8\u8ba4\u7684\u7cfb\u7edf\u7ea7\u6d88\u606f\u53d1\u5e03\u7cfb\u7edf \u4e3b\u8981\u7528\u4e8e\u66f4\u65b0\u6d88\u606f system_scope_msg start_scope \u8fd0\u884c\u5728\u7ebf\u793a\u6ce2\u5668\u7cfb\u7edf \u5305\u62ec\u7cfb\u7edf\u793a\u6ce2\u5668\u3001\u63a7\u5236\u5668\u793a\u6ce2\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u793a\u6ce2\u5668 start_icm20689_new \u542f\u52a8icm20689\u7ebf\u7a0b IMU\uff0cHIL\uff0c\u652f\u6301FIFO\u8bfb\u53d6 start_ist8310 \u542f\u52a8ist8310\u7ebf\u7a0b \u78c1\u529b\u8ba1\uff0cHIL start_baro \u542f\u52a8MS5611\u7ebf\u7a0b \u6c14\u538b\u8ba1\uff0cHIL/EXP start_gps \u542f\u52a8GPS\u7ebf\u7a0b GPS\uff0cHIL/EXP start_attitudeEstimator \u542f\u52a8\u59ff\u6001\u4f30\u8ba1\u7ebf\u7a0b \u652f\u6301\u4ee3\u7801\u751f\u6210 start_lpe \u542f\u52a8LPE\u4f4d\u7f6e\u4f30\u8ba1\u5668 \u652f\u6301\u4ee3\u7801\u751f\u6210 start_usrController \u542f\u52a8\u63a7\u5236\u5668\u7ebf\u7a0b \u652f\u6301\u4ee3\u7801\u751f\u6210 start_icm42688p \u542f\u52a8icm42688p\u7ebf\u7a0b IMU\uff0cEXP start_qmc5883l \u542f\u52a8qmc5883l\u7ebf\u7a0b \u78c1\u529b\u8ba1\uff0cEXP start_sih \u542f\u52a8SIH\u4eff\u771f\u6a21\u578b\u7ebf\u7a0b \u88ab\u63a7\u5bf9\u8c61\u6a21\u578b\uff0cSIH start_offboard \u542f\u52a8offboard\u7ebf\u7a0b \u7528\u4e8e\u63a5\u6536\u8ba1\u7b97\u673a\u6307\u4ee4 start_calibration \u542f\u52a8\u4f20\u611f\u5668\u6821\u51c6\u7ebf\u7a0b \u4ec5\u5728\u4f20\u611f\u5668\u6821\u51c6\u65f6\u8fd0\u884c Tip \u5173\u4e8e\u5404\u4e2a\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\u8fd0\u884c\u4e0d\u540c\u7ebf\u7a0b\u7684\u5177\u4f53\u60c5\u51b5\uff0c\u611f\u5174\u8da3\u7684\u7684\u8bfb\u8005\u53ef\u4ee5\u4ed4\u7ec6\u9605\u8bfb\u4ee3\u7801 src/main.cpp \u3002","title":"\u4e3b\u51fd\u6570"},{"location":"development/rflypilot_system/#_3","text":"\u7cfb\u7edf\u7ea7\u51fd\u6570\u662f\u6709\u4e0e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7d27\u5bc6\u76f8\u5173\u7684\u51fd\u6570\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u6838\u5fc3\u7ed1\u5b9a\u3001\u65f6\u95f4\u6233\u7b49\u7b49\uff0c\u8fd9\u4e9b\u51fd\u6570\u901a\u5e38\u5b9a\u4e49\u5728 src/system_utility \u4e2d\u3002 \u51fd\u6570 \u529f\u80fd \u5907\u6ce8 create_thread \u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b bool ret = create_thread(\"barometer\", thread_baro, NULL); core_bind \u7528\u4e8e\u5c06\u67d0\u4e00\u7ebf\u7a0b\u7ed1\u5b9a\u81f3\u67d0\u4e2aCPU\u6838\u5fc3 \u8f93\u5165\u53c2\u65700~3 get_time_now \u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4 \u5355\u4f4d(us)","title":"\u7cfb\u7edf\u7ea7\u51fd\u6570"},{"location":"development/sys_overview/","text":"\u672c\u5c0f\u7ed3\u5c06\u4e3b\u8981\u4ecb\u7ecdRflyPilot\u98de\u63a7\u7684\u786c\u4ef6\u53ca\u8f6f\u4ef6\u67b6\u6784\uff0c\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u5bf9RflyPilot\u6709\u7cfb\u7edf\u6027\u7684\u4e86\u89e3\u3002 1 \u786c\u4ef6\u67b6\u6784 \uf0c1 Rflypilot\u98de\u63a7\u786c\u4ef6\u65b9\u6848\u7684\u6700\u663e\u8457\u7279\u70b9\u5c31\u662f\u9ad8\u6027\u80fd\u4e0e\u201c\u76f4\u63a5\u91c7\u6837\u201d\uff0c\u5b83\u91c7\u7528\u4e86\u9ad8\u6027\u80fd\u7684ARM\u5904\u7406\u5668\uff0c\u5177\u67094\u6838CPU\u548c1.8GHz\u4e3b\u9891\uff0c\u5728\u4f20\u611f\u5668\u5916\u8bbe\u4e0a\uff0cCPU\u76f4\u63a5\u5bf9\u4f20\u611f\u5668\u6570\u636e\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u76f4\u63a5\u53d1\u9001\u63a7\u5236\u6307\u4ee4\u3002\u8fd9\u4e00\u70b9\u8f83\u4f20\u7edf\u7684\u201c\u4e0a\u4e0b\u4f4d\u673a\u201d\u7684\u786c\u4ef6\u65b9\u6848\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\u4e0a\u9650\u3002 RflyPilot\u98de\u63a7\u786c\u4ef6\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff0c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u548c\u5916\u8bbe\u62d3\u5c55\u677f\u3002\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u662f\u6210\u54c1\u7535\u8def\u677f\uff0c\u5b83\u8f83\u6811\u8393\u6d3e4B\u5177\u6709\u66f4\u5c0f\u7684\u4f53\u79ef\uff0c\u5b83\u53ea\u4fdd\u7559\u4e86\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6838\u5fc3\u7684\u5904\u7406\u5668\u3001\u5185\u5b58\u3001\u5b58\u50a8\u82af\u7247\u7b49\u90e8\u4ef6\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728\u5c0f\u578b\u591a\u65cb\u7ffc\u7684\u98de\u63a7\u4e2d\u4f5c\u8ba1\u7b97\u6838\u5fc3\u3002\u5916\u8bbe\u62d3\u5c55\u677f\u4e0e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u901a\u8fc7\u4e24\u6761100pin\u63a5\u53e3\u76f8\u8fde\u63a5\uff0c\u5b83\u4e3b\u8981\u5305\u542b\u98de\u63a7\u6240\u9700\u7684\u57fa\u672c\u4f20\u611f\u5668\uff08IMU\uff0c\u6c14\u538b\u8ba1\uff0c\u78c1\u529b\u8ba1\u7b49\uff09\uff0c\u540c\u65f6\u4e5f\u914d\u5907\u4e86\u8fde\u63a5GPS\u3001\u7535\u6e90\u6a21\u5757\u3001\u7535\u8c03\u3001\u63a5\u6536\u673a\u7b49\u98de\u884c\u5668\u5e38\u7528\u8bbe\u5907\u7ec4\u4ef6\u7684\u63a5\u53e3\u3002\u5f53\u7136\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u4e5f\u914d\u5907\u4e86\u7535\u6d41\u91c7\u6837\u82af\u7247\uff0c\u7528\u4e8e\u6d4b\u91cf\u52a8\u529b\u7cfb\u7edf\u7684\u5de5\u4f5c\u7535\u6d41\u3002 \u603b\u4f53\u4e0a\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u7684\u5c3a\u5bf8\u540c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u5927\u5c0f\u4e00\u81f4\uff0c\u5728\u914d\u5907\u4e30\u5bcc\u7684\u4f20\u611f\u5668\u4e0e\u9ad8\u6027\u80fd\u5904\u7406\u5668\u7684\u540c\u65f6\uff0c\u517c\u987e\u4e86\u4f53\u79ef\u3002 1.1 \u6811\u8393\u6d3e\u8ba1\u7b97\u7248 \uf0c1 \u5173\u4e8e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u7684\u76f8\u5173\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 https://www.raspberrypi.com/documentation/computers/compute-module.html 1.2 \u5916\u8bbe\u6269\u5c55\u677f \uf0c1 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u4e3b\u8981\u642d\u8f7d\u4f20\u611f\u5668\u3001\u5916\u90e8\u8bbe\u5907\u63a5\u53e3\u3001\u7535\u6d41\u4f20\u611f\u5668\u7b49\uff0c\u540c\u65f6\u5728\u62d3\u5c55\u677f\u4e0a\u4e5f\u8bbe\u8ba1\u4e86\u76f8\u5e94\u7684\u62e8\u7801\u5f00\u5173\uff0c\u7528\u4e8e\u4fee\u6539\u67d0\u4e9b\u914d\u7f6e\u9009\u9879\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u4f7f\u7528IMU\uff0cRflyPilot\u7684IMU\u88ab\u72ec\u7acb\u51fa\u6765\uff0c\u7528\u4e8e\u5f00\u53d1\u8005\u589e\u52a0\u51cf\u9707\u6216\u8005\u5176\u4ed6\u989d\u5916\u7684\u5904\u7406\u3002\uff08\u6bd4\u5982\uff0c\u5728\u56db\u65cb\u7ffc\u98de\u884c\u5668\u8fdb\u884c\u65cb\u7ffc\u5931\u6548\u7684\u5bb9\u9519\u5b9e\u9a8c\u65f6\uff0c\u98de\u884c\u5668\u5f80\u5f80\u4f1a\u8fdb\u5165\u9ad8\u901f\u7684\u81ea\u65cb\u72b6\u6001\uff0c\u6b64\u65f6\u7684\u81ea\u65cb\u89d2\u901f\u5ea6\u53ef\u80fd\u4f1a\u8d85\u51fa\u9640\u87ba\u4eea\u7684\u91cf\u7a0b\uff0c\u6b64\u65f6\u901a\u8fc7\u5c06\u9640\u87ba\u4eea\u503e\u659c\u653e\u7f6e\u662f\u53ef\u4ee5\u589e\u52a0\u9640\u87ba\u4eea\u5728\u67d0\u4e00\u4e2a\u65b9\u5411\u7684\u91cf\u7a0b\uff0c\u8fdb\u800c\u907f\u514d\u8d85\u7a0b\u95ee\u9898\uff09 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u90e8\u5206\u4f20\u611f\u5668\u5e03\u7f6e\u5982\u4e0b \u90e8\u5206\u63a5\u53e3\u914d\u7f6e\u60c5\u51b5\u5982\u4e0b \u4f20\u611f\u5668 \u603b\u7ebf\u7c7b\u578b \u5f15\u811a IMU SPI CS:BCM8/CLK:BCM11/MOSI:BCM10/MISO:BCM9 \u78c1\u529b\u8ba1QMC5883L IIC SCL:BCM3/SDA:BCM2 \u6c14\u538b\u8ba1MS5611 IIC SCL:BCM3/SDA:BCM2 PWM0\u82af\u7247PCA9685 IIC SCL:BCM3/SDA:BCM2 PWM1\u82af\u7247PCA9685 IIC SCL:BCM1/SDA:BCM0 \u7535\u6d41\u91c7\u6837ADS1115 IIC SCL:BCM3/SDA:BCM2 \u63a5\u6536\u673a SBUS/iBUS BCM15 \u6ce8\u610f\uff1a\u7531\u4e8e\u6811\u8393\u6d3eCM4\u672c\u8eab\u7684\u652f\u6301PWM\u8f93\u51fa\u7684IO\u6570\u91cf\u8f83\u5c11\uff0cRflyPilot\u91c7\u7528PCA9685\u82af\u7247\u5b9e\u73b0PWM\u4fe1\u53f7\u7684\u751f\u6210\uff0c\u6811\u8393\u6d3eCM4\u901a\u8fc7IIC\u603b\u7ebf\u4e0ePCA9685\u8fdb\u884c\u901a\u4fe1\uff0c\u751f\u6210\u76f8\u5e94\u7684PWM\u4fe1\u53f7\u3002 2 \u8f6f\u4ef6\u67b6\u6784 \uf0c1 RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u3002\u987e\u540d\u601d\u4e49\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e3aRflyPilot\u63d0\u4f9b\u53ef\u9760\u7684\u5e95\u5c42\u9a71\u52a8\u3001\u7cfb\u7edf\u4efb\u52a1\u8c03\u5ea6\u3001\u8c03\u8bd5\u63a5\u53e3\u548c\u7ebf\u7a0b\u901a\u4fe1\u7b49\u76f8\u5173\u652f\u6301\uff0c\u6240\u6709\u4ee3\u7801\u5747\u7531C/C++\u7f16\u5199\u800c\u6210\u3002\u800c\u5f00\u53d1\u8005\u6a21\u5757\u5219\u63d0\u4f9b\u4e86Simulink\u7684\u4ee3\u7801\u751f\u6210\u63a5\u53e3\uff0c\u5305\u62ec\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u53ef\u4ee5\u76f4\u63a5\u7531Simulink\u4ee3\u7801\u751f\u6210\u5f97\u5230\uff0c\u5e76\u76f4\u63a5\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u7684\u63a5\u53e3\u8fdb\u884c\u5bf9\u63a5\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u90e8\u7f72\u7684\u65f6\u95f4\u6210\u672c\u3002\u5f00\u53d1\u8005\u6a21\u5757\u57fa\u4e8eMBD\u7684\u601d\u60f3\uff0c\u52a0\u901f\u4e86\u98de\u884c\u63a7\u5236\u548c\u72b6\u6001\u4f30\u8ba1\u7b97\u6cd5\u7684\u7cfb\u7edf\u7ea7\u5f00\u53d1\u4e0e\u9a8c\u8bc1\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u7684\u7279\u6027\u5728\u4e8e\u5176\u5f3a\u5927\u7684\u8ba1\u7b97\u6027\u80fd\u3001\u517c\u5907\u7cfb\u7edf\u7ea7\u7684\u9a8c\u8bc1\u80fd\u529b\u4e0e\u4fbf\u6377\u76f4\u89c2\u7684\u5f00\u53d1\u65b9\u5f0f\u3002 2.1 \u5e95\u5c42\u9a71\u52a8 \uf0c1 RflyPilot\u7684\u90e8\u5206\u5e95\u5c42\u9a71\u52a8\u53c2\u8003\u4e86PX4\u76f8\u5173\u7684\u9a71\u52a8\u4ee3\u7801\u3002\u603b\u4f53\u4e0a\uff0cRflyPilot\u652f\u6301\u5e38\u89c1\u7684\u4f20\u611f\u5668\uff0c\u5927\u591a\u6570\u4f20\u611f\u5668\u6570\u636e\u91c7\u96c6\u64cd\u4f5c\u88ab\u5c01\u88c5\u4e3a\u72ec\u7acb\u7684\u4efb\u52a1\uff0c\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7684\u5f62\u5f0f\u53d1\u5e03\u5230\u7cfb\u7edf\u4e2d\u3002 \u76ee\u524dRflyPilot\u652f\u6301\u7684\u4f20\u611f\u5668\u5982\u4e0b \u4f20\u611f\u5668 \u578b\u53f7 \u9a71\u52a8\u4ee3\u7801 IMU ICM42688p src/drivers/imu/icm42688p IMU ICM20689 src/drivers/imu/icm20689 \u6c14\u538b\u8ba1 MS5611 src/drivers/barometer/ms5611 \u78c1\u529b\u8ba1 IST8310 src/drviers/magnetometer/ist8310 \u78c1\u529b\u8ba1 QMC5883L src/drviers/magnetometer/qmc5883l \u63a5\u6536\u673a SBUS/iBUS src/drviers/rc/sbus GPS M8N/M9N src/drviers/gps PWM\u8f93\u51fa PCA9685 src/drviers/actuator/pca9685 UWB LinkTrack src/drivers/uwb 2.2 \u4efb\u52a1\u8c03\u5ea6 \uf0c1 RflyPilot\u98de\u63a7\u4e2d\u5404\u4e2a\u4efb\u52a1\u4ee5\u72ec\u7acb\u7ebf\u7a0b\uff08thread\uff09\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982IMU\u91c7\u6837\u7ebf\u7a0b\u3001GPS\u7ebf\u7a0b\u3001\u72b6\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\u7b49\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u542f\u52a8\u4e0d\u540c\u7ebf\u7a0b\uff0c\u7528\u4ee5\u652f\u6301\u7cfb\u7edf\u7684\u8fd0\u884c\u3002\u6811\u8393\u6d3e\u8ba1\u7b97\u677f\u91c7\u7528\u7684\u662fBCM2711\uff0c\u56db\u6838Cortex A72\u5904\u7406\u5668\uff0cRflyPilot\u4e2d\u90e8\u5206\u7ebf\u7a0b\u5206\u522b\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684\u5904\u7406\u5668\u6838\u5fc3\u4e0a\uff0c\u4e3a\u4fdd\u969c\u7ebf\u7a0b\u7684\u5b9e\u65f6\u6027\uff0c\u4e2a\u522b\u7ebf\u7a0b\u5c06\u88ab\u7ed1\u5b9a\u5230\u88ab\u7cfb\u7edf\u9694\u79bb\u7684CPU\u6838\u5fc3\u4e0a\uff0c\u5e76\u72ec\u4eab\u8be5CPU\u6838\u5fc3\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u964d\u4f4e\u7cfb\u7edf\u672c\u8eab\u548c\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8be5\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u4fdd\u969c\u5176\u5b9e\u65f6\u6027\u7684\u3002\u540c\u65f6\u4e3a\u4e86\u964d\u4f4e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0cRflyPilot\u4e5f\u5f15\u5165\u4e86\u4e00\u5957\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u7528\u4e8e\u89c4\u5b9a\u7ebf\u7a0b\u8fd0\u884c\u7684\u5148\u540e\u987a\u5e8f\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u8be5\u673a\u5236\u7684\u5f15\u5165\u5927\u5927\u63d0\u9ad8\u4e86\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u7684\u6027\u80fd\uff0c\u8ba9\u7cfb\u7edf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5728\u9ad8\u52a8\u6001\u7684\u5de5\u51b5\u3002 2.3 \u8c03\u8bd5\u6a21\u5757 \uf0c1 \u8c03\u8bd5\u6a21\u5757\u4e3b\u8981\u5305\u62ec\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3001\u53c2\u6570\u8bfb\u53d6\u4e0e\u5728\u7ebf\u66f4\u65b0\u529f\u80fd\u3001\u5728\u7ebf\u793a\u6ce2\u5668\u529f\u80fd\u3001\u63a7\u5236\u53f0\u529f\u80fd\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u66f4\u597d\u5730\u4e86\u89e3\u98de\u884c\u5668\u7684\u98de\u884c\u72b6\u6001\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u8c03\u8bd5\u63a5\u53e3\u3002\u6240\u6709\u7684\u5728\u7ebf\u8c03\u8bd5\u529f\u80fd\u5747\u53ef\u4ee5\u901a\u8fc7\u677f\u8f7dWIFI\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u989d\u5916\u589e\u52a0\u6570\u4f20\u6a21\u5757\u3002 2.4 \u901a\u4fe1\u673a\u5236 \uf0c1 RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u5185\u90e8\u7684\u7ebf\u7a0b\u901a\u4fe1\u673a\u5236\u4e3b\u8981\u91c7\u7528\u7684\u662f\u5171\u4eab\u5185\u5b58\u7684\u5f62\u5f0f\uff0c\u6240\u6709\u6570\u636e\u4ee5\u6d88\u606f\u5f62\u5f0f\u5b58\u50a8\u5728\u7cfb\u7edf\u5185\u5b58\u4e2d\u3002\u4e3a\u907f\u514d\u540c\u65f6\u8fdb\u884c\u6d88\u606f\u8bfb\u53d6\u4e0e\u5199\u5165\u800c\u51fa\u73b0\u7684\u6570\u636e\u5f02\u5e38\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u201c\u539f\u5b50\u9501 \u201d\u8fdb\u884c\u5904\u7406\uff0c\u6700\u7ec8\u6d88\u606f\u7684\u8bfb\u53d6 read \u4e0e\u53d1\u5e03 publish \u4e92\u4e0d\u51b2\u7a81\uff0c\u4e5f\u652f\u6301\u4e00\u53d1\u591a\u6536\u7684\u901a\u4fe1\u5f62\u5f0f\u3002\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8bfb\u53d6\u5386\u53f2\u6570\u636e\uff08\u4e00\u6bb5\u65f6\u95f4\uff09\uff0c\u7528\u4e8e\u907f\u514d\u6d88\u606f\u7684\u9057\u6f0f\uff0c\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8fdb\u884c\u5373\u65f6\u7684\u6d88\u606f\u8bb0\u5f55\u3002","title":"\u8f6f\u786c\u4ef6\u6982\u89c8"},{"location":"development/sys_overview/#1","text":"Rflypilot\u98de\u63a7\u786c\u4ef6\u65b9\u6848\u7684\u6700\u663e\u8457\u7279\u70b9\u5c31\u662f\u9ad8\u6027\u80fd\u4e0e\u201c\u76f4\u63a5\u91c7\u6837\u201d\uff0c\u5b83\u91c7\u7528\u4e86\u9ad8\u6027\u80fd\u7684ARM\u5904\u7406\u5668\uff0c\u5177\u67094\u6838CPU\u548c1.8GHz\u4e3b\u9891\uff0c\u5728\u4f20\u611f\u5668\u5916\u8bbe\u4e0a\uff0cCPU\u76f4\u63a5\u5bf9\u4f20\u611f\u5668\u6570\u636e\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u76f4\u63a5\u53d1\u9001\u63a7\u5236\u6307\u4ee4\u3002\u8fd9\u4e00\u70b9\u8f83\u4f20\u7edf\u7684\u201c\u4e0a\u4e0b\u4f4d\u673a\u201d\u7684\u786c\u4ef6\u65b9\u6848\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\u4e0a\u9650\u3002 RflyPilot\u98de\u63a7\u786c\u4ef6\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff0c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u548c\u5916\u8bbe\u62d3\u5c55\u677f\u3002\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u662f\u6210\u54c1\u7535\u8def\u677f\uff0c\u5b83\u8f83\u6811\u8393\u6d3e4B\u5177\u6709\u66f4\u5c0f\u7684\u4f53\u79ef\uff0c\u5b83\u53ea\u4fdd\u7559\u4e86\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6838\u5fc3\u7684\u5904\u7406\u5668\u3001\u5185\u5b58\u3001\u5b58\u50a8\u82af\u7247\u7b49\u90e8\u4ef6\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728\u5c0f\u578b\u591a\u65cb\u7ffc\u7684\u98de\u63a7\u4e2d\u4f5c\u8ba1\u7b97\u6838\u5fc3\u3002\u5916\u8bbe\u62d3\u5c55\u677f\u4e0e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u901a\u8fc7\u4e24\u6761100pin\u63a5\u53e3\u76f8\u8fde\u63a5\uff0c\u5b83\u4e3b\u8981\u5305\u542b\u98de\u63a7\u6240\u9700\u7684\u57fa\u672c\u4f20\u611f\u5668\uff08IMU\uff0c\u6c14\u538b\u8ba1\uff0c\u78c1\u529b\u8ba1\u7b49\uff09\uff0c\u540c\u65f6\u4e5f\u914d\u5907\u4e86\u8fde\u63a5GPS\u3001\u7535\u6e90\u6a21\u5757\u3001\u7535\u8c03\u3001\u63a5\u6536\u673a\u7b49\u98de\u884c\u5668\u5e38\u7528\u8bbe\u5907\u7ec4\u4ef6\u7684\u63a5\u53e3\u3002\u5f53\u7136\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u4e5f\u914d\u5907\u4e86\u7535\u6d41\u91c7\u6837\u82af\u7247\uff0c\u7528\u4e8e\u6d4b\u91cf\u52a8\u529b\u7cfb\u7edf\u7684\u5de5\u4f5c\u7535\u6d41\u3002 \u603b\u4f53\u4e0a\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u7684\u5c3a\u5bf8\u540c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u5927\u5c0f\u4e00\u81f4\uff0c\u5728\u914d\u5907\u4e30\u5bcc\u7684\u4f20\u611f\u5668\u4e0e\u9ad8\u6027\u80fd\u5904\u7406\u5668\u7684\u540c\u65f6\uff0c\u517c\u987e\u4e86\u4f53\u79ef\u3002","title":"1 \u786c\u4ef6\u67b6\u6784"},{"location":"development/sys_overview/#11","text":"\u5173\u4e8e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u7684\u76f8\u5173\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 https://www.raspberrypi.com/documentation/computers/compute-module.html","title":"1.1 \u6811\u8393\u6d3e\u8ba1\u7b97\u7248"},{"location":"development/sys_overview/#12","text":"RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u4e3b\u8981\u642d\u8f7d\u4f20\u611f\u5668\u3001\u5916\u90e8\u8bbe\u5907\u63a5\u53e3\u3001\u7535\u6d41\u4f20\u611f\u5668\u7b49\uff0c\u540c\u65f6\u5728\u62d3\u5c55\u677f\u4e0a\u4e5f\u8bbe\u8ba1\u4e86\u76f8\u5e94\u7684\u62e8\u7801\u5f00\u5173\uff0c\u7528\u4e8e\u4fee\u6539\u67d0\u4e9b\u914d\u7f6e\u9009\u9879\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u4f7f\u7528IMU\uff0cRflyPilot\u7684IMU\u88ab\u72ec\u7acb\u51fa\u6765\uff0c\u7528\u4e8e\u5f00\u53d1\u8005\u589e\u52a0\u51cf\u9707\u6216\u8005\u5176\u4ed6\u989d\u5916\u7684\u5904\u7406\u3002\uff08\u6bd4\u5982\uff0c\u5728\u56db\u65cb\u7ffc\u98de\u884c\u5668\u8fdb\u884c\u65cb\u7ffc\u5931\u6548\u7684\u5bb9\u9519\u5b9e\u9a8c\u65f6\uff0c\u98de\u884c\u5668\u5f80\u5f80\u4f1a\u8fdb\u5165\u9ad8\u901f\u7684\u81ea\u65cb\u72b6\u6001\uff0c\u6b64\u65f6\u7684\u81ea\u65cb\u89d2\u901f\u5ea6\u53ef\u80fd\u4f1a\u8d85\u51fa\u9640\u87ba\u4eea\u7684\u91cf\u7a0b\uff0c\u6b64\u65f6\u901a\u8fc7\u5c06\u9640\u87ba\u4eea\u503e\u659c\u653e\u7f6e\u662f\u53ef\u4ee5\u589e\u52a0\u9640\u87ba\u4eea\u5728\u67d0\u4e00\u4e2a\u65b9\u5411\u7684\u91cf\u7a0b\uff0c\u8fdb\u800c\u907f\u514d\u8d85\u7a0b\u95ee\u9898\uff09 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u90e8\u5206\u4f20\u611f\u5668\u5e03\u7f6e\u5982\u4e0b \u90e8\u5206\u63a5\u53e3\u914d\u7f6e\u60c5\u51b5\u5982\u4e0b \u4f20\u611f\u5668 \u603b\u7ebf\u7c7b\u578b \u5f15\u811a IMU SPI CS:BCM8/CLK:BCM11/MOSI:BCM10/MISO:BCM9 \u78c1\u529b\u8ba1QMC5883L IIC SCL:BCM3/SDA:BCM2 \u6c14\u538b\u8ba1MS5611 IIC SCL:BCM3/SDA:BCM2 PWM0\u82af\u7247PCA9685 IIC SCL:BCM3/SDA:BCM2 PWM1\u82af\u7247PCA9685 IIC SCL:BCM1/SDA:BCM0 \u7535\u6d41\u91c7\u6837ADS1115 IIC SCL:BCM3/SDA:BCM2 \u63a5\u6536\u673a SBUS/iBUS BCM15 \u6ce8\u610f\uff1a\u7531\u4e8e\u6811\u8393\u6d3eCM4\u672c\u8eab\u7684\u652f\u6301PWM\u8f93\u51fa\u7684IO\u6570\u91cf\u8f83\u5c11\uff0cRflyPilot\u91c7\u7528PCA9685\u82af\u7247\u5b9e\u73b0PWM\u4fe1\u53f7\u7684\u751f\u6210\uff0c\u6811\u8393\u6d3eCM4\u901a\u8fc7IIC\u603b\u7ebf\u4e0ePCA9685\u8fdb\u884c\u901a\u4fe1\uff0c\u751f\u6210\u76f8\u5e94\u7684PWM\u4fe1\u53f7\u3002","title":"1.2 \u5916\u8bbe\u6269\u5c55\u677f"},{"location":"development/sys_overview/#2","text":"RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u3002\u987e\u540d\u601d\u4e49\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e3aRflyPilot\u63d0\u4f9b\u53ef\u9760\u7684\u5e95\u5c42\u9a71\u52a8\u3001\u7cfb\u7edf\u4efb\u52a1\u8c03\u5ea6\u3001\u8c03\u8bd5\u63a5\u53e3\u548c\u7ebf\u7a0b\u901a\u4fe1\u7b49\u76f8\u5173\u652f\u6301\uff0c\u6240\u6709\u4ee3\u7801\u5747\u7531C/C++\u7f16\u5199\u800c\u6210\u3002\u800c\u5f00\u53d1\u8005\u6a21\u5757\u5219\u63d0\u4f9b\u4e86Simulink\u7684\u4ee3\u7801\u751f\u6210\u63a5\u53e3\uff0c\u5305\u62ec\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u53ef\u4ee5\u76f4\u63a5\u7531Simulink\u4ee3\u7801\u751f\u6210\u5f97\u5230\uff0c\u5e76\u76f4\u63a5\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u7684\u63a5\u53e3\u8fdb\u884c\u5bf9\u63a5\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u90e8\u7f72\u7684\u65f6\u95f4\u6210\u672c\u3002\u5f00\u53d1\u8005\u6a21\u5757\u57fa\u4e8eMBD\u7684\u601d\u60f3\uff0c\u52a0\u901f\u4e86\u98de\u884c\u63a7\u5236\u548c\u72b6\u6001\u4f30\u8ba1\u7b97\u6cd5\u7684\u7cfb\u7edf\u7ea7\u5f00\u53d1\u4e0e\u9a8c\u8bc1\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u7684\u7279\u6027\u5728\u4e8e\u5176\u5f3a\u5927\u7684\u8ba1\u7b97\u6027\u80fd\u3001\u517c\u5907\u7cfb\u7edf\u7ea7\u7684\u9a8c\u8bc1\u80fd\u529b\u4e0e\u4fbf\u6377\u76f4\u89c2\u7684\u5f00\u53d1\u65b9\u5f0f\u3002","title":"2 \u8f6f\u4ef6\u67b6\u6784"},{"location":"development/sys_overview/#21","text":"RflyPilot\u7684\u90e8\u5206\u5e95\u5c42\u9a71\u52a8\u53c2\u8003\u4e86PX4\u76f8\u5173\u7684\u9a71\u52a8\u4ee3\u7801\u3002\u603b\u4f53\u4e0a\uff0cRflyPilot\u652f\u6301\u5e38\u89c1\u7684\u4f20\u611f\u5668\uff0c\u5927\u591a\u6570\u4f20\u611f\u5668\u6570\u636e\u91c7\u96c6\u64cd\u4f5c\u88ab\u5c01\u88c5\u4e3a\u72ec\u7acb\u7684\u4efb\u52a1\uff0c\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7684\u5f62\u5f0f\u53d1\u5e03\u5230\u7cfb\u7edf\u4e2d\u3002 \u76ee\u524dRflyPilot\u652f\u6301\u7684\u4f20\u611f\u5668\u5982\u4e0b \u4f20\u611f\u5668 \u578b\u53f7 \u9a71\u52a8\u4ee3\u7801 IMU ICM42688p src/drivers/imu/icm42688p IMU ICM20689 src/drivers/imu/icm20689 \u6c14\u538b\u8ba1 MS5611 src/drivers/barometer/ms5611 \u78c1\u529b\u8ba1 IST8310 src/drviers/magnetometer/ist8310 \u78c1\u529b\u8ba1 QMC5883L src/drviers/magnetometer/qmc5883l \u63a5\u6536\u673a SBUS/iBUS src/drviers/rc/sbus GPS M8N/M9N src/drviers/gps PWM\u8f93\u51fa PCA9685 src/drviers/actuator/pca9685 UWB LinkTrack src/drivers/uwb","title":"2.1 \u5e95\u5c42\u9a71\u52a8"},{"location":"development/sys_overview/#22","text":"RflyPilot\u98de\u63a7\u4e2d\u5404\u4e2a\u4efb\u52a1\u4ee5\u72ec\u7acb\u7ebf\u7a0b\uff08thread\uff09\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982IMU\u91c7\u6837\u7ebf\u7a0b\u3001GPS\u7ebf\u7a0b\u3001\u72b6\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\u7b49\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u542f\u52a8\u4e0d\u540c\u7ebf\u7a0b\uff0c\u7528\u4ee5\u652f\u6301\u7cfb\u7edf\u7684\u8fd0\u884c\u3002\u6811\u8393\u6d3e\u8ba1\u7b97\u677f\u91c7\u7528\u7684\u662fBCM2711\uff0c\u56db\u6838Cortex A72\u5904\u7406\u5668\uff0cRflyPilot\u4e2d\u90e8\u5206\u7ebf\u7a0b\u5206\u522b\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684\u5904\u7406\u5668\u6838\u5fc3\u4e0a\uff0c\u4e3a\u4fdd\u969c\u7ebf\u7a0b\u7684\u5b9e\u65f6\u6027\uff0c\u4e2a\u522b\u7ebf\u7a0b\u5c06\u88ab\u7ed1\u5b9a\u5230\u88ab\u7cfb\u7edf\u9694\u79bb\u7684CPU\u6838\u5fc3\u4e0a\uff0c\u5e76\u72ec\u4eab\u8be5CPU\u6838\u5fc3\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u964d\u4f4e\u7cfb\u7edf\u672c\u8eab\u548c\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8be5\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u4fdd\u969c\u5176\u5b9e\u65f6\u6027\u7684\u3002\u540c\u65f6\u4e3a\u4e86\u964d\u4f4e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0cRflyPilot\u4e5f\u5f15\u5165\u4e86\u4e00\u5957\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u7528\u4e8e\u89c4\u5b9a\u7ebf\u7a0b\u8fd0\u884c\u7684\u5148\u540e\u987a\u5e8f\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u8be5\u673a\u5236\u7684\u5f15\u5165\u5927\u5927\u63d0\u9ad8\u4e86\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u7684\u6027\u80fd\uff0c\u8ba9\u7cfb\u7edf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5728\u9ad8\u52a8\u6001\u7684\u5de5\u51b5\u3002","title":"2.2 \u4efb\u52a1\u8c03\u5ea6"},{"location":"development/sys_overview/#23","text":"\u8c03\u8bd5\u6a21\u5757\u4e3b\u8981\u5305\u62ec\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3001\u53c2\u6570\u8bfb\u53d6\u4e0e\u5728\u7ebf\u66f4\u65b0\u529f\u80fd\u3001\u5728\u7ebf\u793a\u6ce2\u5668\u529f\u80fd\u3001\u63a7\u5236\u53f0\u529f\u80fd\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u66f4\u597d\u5730\u4e86\u89e3\u98de\u884c\u5668\u7684\u98de\u884c\u72b6\u6001\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u8c03\u8bd5\u63a5\u53e3\u3002\u6240\u6709\u7684\u5728\u7ebf\u8c03\u8bd5\u529f\u80fd\u5747\u53ef\u4ee5\u901a\u8fc7\u677f\u8f7dWIFI\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u989d\u5916\u589e\u52a0\u6570\u4f20\u6a21\u5757\u3002","title":"2.3 \u8c03\u8bd5\u6a21\u5757"},{"location":"development/sys_overview/#24","text":"RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u5185\u90e8\u7684\u7ebf\u7a0b\u901a\u4fe1\u673a\u5236\u4e3b\u8981\u91c7\u7528\u7684\u662f\u5171\u4eab\u5185\u5b58\u7684\u5f62\u5f0f\uff0c\u6240\u6709\u6570\u636e\u4ee5\u6d88\u606f\u5f62\u5f0f\u5b58\u50a8\u5728\u7cfb\u7edf\u5185\u5b58\u4e2d\u3002\u4e3a\u907f\u514d\u540c\u65f6\u8fdb\u884c\u6d88\u606f\u8bfb\u53d6\u4e0e\u5199\u5165\u800c\u51fa\u73b0\u7684\u6570\u636e\u5f02\u5e38\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u201c\u539f\u5b50\u9501 \u201d\u8fdb\u884c\u5904\u7406\uff0c\u6700\u7ec8\u6d88\u606f\u7684\u8bfb\u53d6 read \u4e0e\u53d1\u5e03 publish \u4e92\u4e0d\u51b2\u7a81\uff0c\u4e5f\u652f\u6301\u4e00\u53d1\u591a\u6536\u7684\u901a\u4fe1\u5f62\u5f0f\u3002\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8bfb\u53d6\u5386\u53f2\u6570\u636e\uff08\u4e00\u6bb5\u65f6\u95f4\uff09\uff0c\u7528\u4e8e\u907f\u514d\u6d88\u606f\u7684\u9057\u6f0f\uff0c\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8fdb\u884c\u5373\u65f6\u7684\u6d88\u606f\u8bb0\u5f55\u3002","title":"2.4 \u901a\u4fe1\u673a\u5236"},{"location":"development/task_period/","text":"\u4efb\u52a1\u8fd0\u884c\u9891\u7387 \uf0c1 \u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u8bbe\u7f6e\u4e0d\u540c\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\u3002RflyPilot\u4e2d\u4e0d\u540c\u7684\u7ebf\u7a0b\u6709\u4e0d\u540c\u7684\u8fd0\u884c\u9891\u7387\uff0c\u4e5f\u5bf9\u8fd0\u884c\u5468\u671f\u7684\u7a33\u5b9a\u6027\u6709\u4e0d\u540c\u7684\u8981\u6c42\uff0cRflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u8fd0\u884c\u9891\u7387\u8bbe\u7f6e\u65b9\u6848\u3002\u76f8\u5e94\u7684\u914d\u7f6e\u4e3a rflypilot.txt \u4e2d\u7684 scheduler_mode \u3002\u5728RflyPilot\u4e2d\uff0c\u8bbe\u7f6e\u8fd0\u884c\u9891\u7387\u7684\u65b9\u6848\u5171\u6709\u4e09\u79cd\uff0c\u5206\u522b\u4e3a \u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u7684\u65b9\u6cd5 \uff0c \u81ea\u9002\u5e94\u5ef6\u65f6 \uff0c Linux\u7cfb\u7edf\u5ef6\u65f6\u51fd\u6570 \u3002 \u65b9\u6848 \u8bf4\u660e \u7ebf\u7a0b\u540c\u6b65 \u9002\u7528\u4e8e\u5bf9\u7ebf\u7a0b\u95f4\u6709\u4e25\u683c\u65f6\u5e8f\u8981\u6c42\u7684\u60c5\u51b5\uff0c\u5982\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u3001IMU \u81ea\u9002\u5e94\u5ef6\u65f6 \u9002\u7528\u4e8e\u9700\u8981\u7cbe\u786e\u63a7\u5236\u8fd0\u884c\u5468\u671f\u7684\u60c5\u51b5\uff0c\u5982\u78c1\u529b\u8ba1\u3001\u65e5\u5fd7\u7cfb\u7edf\u7b49 Linux\u7cfb\u7edf\u5ef6\u65f6\u51fd\u6570 \u9002\u7528\u4e8e\u5bf9\u8fd0\u884c\u9891\u7387\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\uff0c\u5982\u5728\u7ebf\u793a\u6ce2\u5668\u7b49 \u7ebf\u7a0b\u540c\u6b65 \uf0c1 \u8fd9\u90e8\u5206\u5185\u5bb9\u8bf7\u89c1 \u7cfb\u7edf\u5b9e\u65f6\u6027-\u7ebf\u7a0b\u540c\u6b65\u673a\u5236 \u3002 \u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570 \uf0c1 \u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8be5\u5ef6\u65f6\u51fd\u6570\u53ef\u4ee5\u81ea\u52a8\u8c03\u8282\u5ef6\u65f6\u65f6\u95f4\uff0c\u4f7f\u4efb\u52a1\u7a33\u5b9a\u8fd0\u884c\u5728\u671f\u671b\u9891\u7387\u4e0b\u3002\u7531\u4e8e\u4efb\u52a1\u672c\u8eab\u662f\u9700\u8981\u6d88\u8017CPU\u65f6\u95f4\u7684\uff0c\u4f20\u7edf\u7684\u5ef6\u65f6\u65b9\u6848\u5f88\u96be\u7cbe\u786e\u63a7\u5236\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\uff0c\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570\u901a\u8fc7\u5e26\u524d\u9988\u7684PI\u63a7\u5236\u5668\uff0c\u5b9e\u73b0\u81ea\u52a8\u8ba1\u7b97\u5ef6\u65f6\u65f6\u95f4\uff0c\u8fdb\u800c\u505a\u5230\u81ea\u9002\u5e94\u3002 \u8be5\u51fd\u6570\u5b9a\u4e49\u5728 src/system_utility/system.cpp \u4e2d\u3002 class adaptive_delay_typedef { public: timespec _sleep; bool initd; double delay_us_feedback; double integral; double integral_2; double kp_output; long delay_ns_output; double ff; double err; float kp; float ki; uint64_t offset_us; uint64_t t0_us; uint64_t t1_us; uint64_t delay_us_feedback_last; float lpf_k; bool locked; int lock_cnt; // offset_us \u4e3a\u7a0b\u5e8f\u672c\u8eab\u6240\u6d88\u8017\u7684\u65f6\u95f4 \u5355\u4f4dus adaptive_delay_typedef(float _kp, float _ki, uint64_t _offset_us); void delay_us(uint64_t us); uint64_t calc_delay_us(uint64_t us); void delay_freq(uint64_t freq); /**** for timestamp sync ***********/ uint64_t time_sync_accumulated; double time_sync_cnt; bool time_sync_initd; uint64_t time_sync_time0; uint64_t time_sync_time; }; \u51fd\u6570\u5b9a\u4e49\u4e0e\u4f7f\u7528 \uf0c1 class adaptive_delay_typedef adp_delay(0.5,15,400);//\u5b9a\u4e49\u5bf9\u8c61\uff0ckp=0.5\uff0cki=15\uff0coffset=400us void main(void) { for(;;) { task();//\u8017\u65f6\u7ea6400us adp_delay.delay_us(1000000/800);//\u5355\u4f4dus } } IMU\u7ebf\u7a0b\u8fd0\u884c\u7ed3\u679c \uf0c1 \u53ef\u4ee5\u89c2\u5bdf\u5230IMU\u9891\u7387\u9010\u6e10\u7a33\u5b9a\u5728800Hz\u7684\u62e8\u52a8\u66f2\u7ebf\u3002 Linux\u7cfb\u7edf\u7ea7\u5ef6\u65f6\u51fd\u6570 \uf0c1 Linux\u7cfb\u7edf\u7ea7\u5ef6\u65f6\u51fd\u6570\u4e3a\u7cfb\u7edf\u5e93\u4e2d\u7684\u5ef6\u65f6\u51fd\u6570\uff0c\u5305\u62ec usleep \uff0c nanosleep \u7b49\uff0c\u5176\u4f7f\u7528\u65b9\u6cd5\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u5ef6\u65f6\u51fd\u6570\u7684\u5207\u6362 \uf0c1 RflyPilot\u652f\u6301\u5bf9\u90e8\u5206\u7ebf\u7a0b\u4e2d\u5ef6\u65f6\u65b9\u6cd5\u8fdb\u884c\u5207\u6362\uff0c\u8bbe\u7f6e rflypilot.txt \u4e2d\u7684 scheduler_mode \u5373\u53ef\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 2 \uff0c\u5373\u81ea\u9002\u5e94\u5ef6\u65f6\u65b9\u6848\u3002\u5f53\u5f00\u53d1\u8fd9\u60f3\u5207\u6362\u5230\u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u7684\u5ef6\u65f6\u65b9\u6848\u662f\uff0c\u9700\u8981\u8bbe\u7f6e scheduler_mode = 2 \u5e76\u542f\u7528 USING_THREAD_SYNC 1 \u3002 #system sample rate imu_rate = 800 mag_rate = 95 # max rate 100Hz controller_rate = 333 attitude_est_rate = 500 lpe_rate = 500 #scheduler_mode delay:1 adaptive_delay:2 timer:3(NOT RECOMMENDED!) scheduler_mode = 2 Tip \u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u65b9\u6848\u7684\u65f6\u949f\u6e90\u6765\u81eaIMU\u7ebf\u7a0b\uff0c\u6545IMU\u7ebf\u7a0b\u7684\u7a33\u5b9a\u6027\u5f71\u54cd\u7740\u5176\u4ed6\u5173\u952e\u7ebf\u7a0b\u3002\u8bbe\u7f6e scheduler_mode = 2 \u5219\u8868\u793aIMU\u7ebf\u7a0b\u5ef6\u65f6\u65b9\u6848\u4e3a\u81ea\u9002\u5e94\u5ef6\u65f6\u65b9\u6848\u3002","title":"\u4efb\u52a1\u8fd0\u884c\u9891\u7387"},{"location":"development/task_period/#_1","text":"\u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u8bbe\u7f6e\u4e0d\u540c\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\u3002RflyPilot\u4e2d\u4e0d\u540c\u7684\u7ebf\u7a0b\u6709\u4e0d\u540c\u7684\u8fd0\u884c\u9891\u7387\uff0c\u4e5f\u5bf9\u8fd0\u884c\u5468\u671f\u7684\u7a33\u5b9a\u6027\u6709\u4e0d\u540c\u7684\u8981\u6c42\uff0cRflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u8fd0\u884c\u9891\u7387\u8bbe\u7f6e\u65b9\u6848\u3002\u76f8\u5e94\u7684\u914d\u7f6e\u4e3a rflypilot.txt \u4e2d\u7684 scheduler_mode \u3002\u5728RflyPilot\u4e2d\uff0c\u8bbe\u7f6e\u8fd0\u884c\u9891\u7387\u7684\u65b9\u6848\u5171\u6709\u4e09\u79cd\uff0c\u5206\u522b\u4e3a \u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u7684\u65b9\u6cd5 \uff0c \u81ea\u9002\u5e94\u5ef6\u65f6 \uff0c Linux\u7cfb\u7edf\u5ef6\u65f6\u51fd\u6570 \u3002 \u65b9\u6848 \u8bf4\u660e \u7ebf\u7a0b\u540c\u6b65 \u9002\u7528\u4e8e\u5bf9\u7ebf\u7a0b\u95f4\u6709\u4e25\u683c\u65f6\u5e8f\u8981\u6c42\u7684\u60c5\u51b5\uff0c\u5982\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u3001IMU \u81ea\u9002\u5e94\u5ef6\u65f6 \u9002\u7528\u4e8e\u9700\u8981\u7cbe\u786e\u63a7\u5236\u8fd0\u884c\u5468\u671f\u7684\u60c5\u51b5\uff0c\u5982\u78c1\u529b\u8ba1\u3001\u65e5\u5fd7\u7cfb\u7edf\u7b49 Linux\u7cfb\u7edf\u5ef6\u65f6\u51fd\u6570 \u9002\u7528\u4e8e\u5bf9\u8fd0\u884c\u9891\u7387\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\uff0c\u5982\u5728\u7ebf\u793a\u6ce2\u5668\u7b49","title":"\u4efb\u52a1\u8fd0\u884c\u9891\u7387"},{"location":"development/task_period/#_2","text":"\u8fd9\u90e8\u5206\u5185\u5bb9\u8bf7\u89c1 \u7cfb\u7edf\u5b9e\u65f6\u6027-\u7ebf\u7a0b\u540c\u6b65\u673a\u5236 \u3002","title":"\u7ebf\u7a0b\u540c\u6b65"},{"location":"development/task_period/#_3","text":"\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8be5\u5ef6\u65f6\u51fd\u6570\u53ef\u4ee5\u81ea\u52a8\u8c03\u8282\u5ef6\u65f6\u65f6\u95f4\uff0c\u4f7f\u4efb\u52a1\u7a33\u5b9a\u8fd0\u884c\u5728\u671f\u671b\u9891\u7387\u4e0b\u3002\u7531\u4e8e\u4efb\u52a1\u672c\u8eab\u662f\u9700\u8981\u6d88\u8017CPU\u65f6\u95f4\u7684\uff0c\u4f20\u7edf\u7684\u5ef6\u65f6\u65b9\u6848\u5f88\u96be\u7cbe\u786e\u63a7\u5236\u4efb\u52a1\u7684\u8fd0\u884c\u9891\u7387\uff0c\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570\u901a\u8fc7\u5e26\u524d\u9988\u7684PI\u63a7\u5236\u5668\uff0c\u5b9e\u73b0\u81ea\u52a8\u8ba1\u7b97\u5ef6\u65f6\u65f6\u95f4\uff0c\u8fdb\u800c\u505a\u5230\u81ea\u9002\u5e94\u3002 \u8be5\u51fd\u6570\u5b9a\u4e49\u5728 src/system_utility/system.cpp \u4e2d\u3002 class adaptive_delay_typedef { public: timespec _sleep; bool initd; double delay_us_feedback; double integral; double integral_2; double kp_output; long delay_ns_output; double ff; double err; float kp; float ki; uint64_t offset_us; uint64_t t0_us; uint64_t t1_us; uint64_t delay_us_feedback_last; float lpf_k; bool locked; int lock_cnt; // offset_us \u4e3a\u7a0b\u5e8f\u672c\u8eab\u6240\u6d88\u8017\u7684\u65f6\u95f4 \u5355\u4f4dus adaptive_delay_typedef(float _kp, float _ki, uint64_t _offset_us); void delay_us(uint64_t us); uint64_t calc_delay_us(uint64_t us); void delay_freq(uint64_t freq); /**** for timestamp sync ***********/ uint64_t time_sync_accumulated; double time_sync_cnt; bool time_sync_initd; uint64_t time_sync_time0; uint64_t time_sync_time; };","title":"\u81ea\u9002\u5e94\u5ef6\u65f6\u51fd\u6570"},{"location":"development/task_period/#_4","text":"class adaptive_delay_typedef adp_delay(0.5,15,400);//\u5b9a\u4e49\u5bf9\u8c61\uff0ckp=0.5\uff0cki=15\uff0coffset=400us void main(void) { for(;;) { task();//\u8017\u65f6\u7ea6400us adp_delay.delay_us(1000000/800);//\u5355\u4f4dus } }","title":"\u51fd\u6570\u5b9a\u4e49\u4e0e\u4f7f\u7528"},{"location":"development/task_period/#imu","text":"\u53ef\u4ee5\u89c2\u5bdf\u5230IMU\u9891\u7387\u9010\u6e10\u7a33\u5b9a\u5728800Hz\u7684\u62e8\u52a8\u66f2\u7ebf\u3002","title":"IMU\u7ebf\u7a0b\u8fd0\u884c\u7ed3\u679c"},{"location":"development/task_period/#linux","text":"Linux\u7cfb\u7edf\u7ea7\u5ef6\u65f6\u51fd\u6570\u4e3a\u7cfb\u7edf\u5e93\u4e2d\u7684\u5ef6\u65f6\u51fd\u6570\uff0c\u5305\u62ec usleep \uff0c nanosleep \u7b49\uff0c\u5176\u4f7f\u7528\u65b9\u6cd5\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002","title":"Linux\u7cfb\u7edf\u7ea7\u5ef6\u65f6\u51fd\u6570"},{"location":"development/task_period/#_5","text":"RflyPilot\u652f\u6301\u5bf9\u90e8\u5206\u7ebf\u7a0b\u4e2d\u5ef6\u65f6\u65b9\u6cd5\u8fdb\u884c\u5207\u6362\uff0c\u8bbe\u7f6e rflypilot.txt \u4e2d\u7684 scheduler_mode \u5373\u53ef\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 2 \uff0c\u5373\u81ea\u9002\u5e94\u5ef6\u65f6\u65b9\u6848\u3002\u5f53\u5f00\u53d1\u8fd9\u60f3\u5207\u6362\u5230\u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u7684\u5ef6\u65f6\u65b9\u6848\u662f\uff0c\u9700\u8981\u8bbe\u7f6e scheduler_mode = 2 \u5e76\u542f\u7528 USING_THREAD_SYNC 1 \u3002 #system sample rate imu_rate = 800 mag_rate = 95 # max rate 100Hz controller_rate = 333 attitude_est_rate = 500 lpe_rate = 500 #scheduler_mode delay:1 adaptive_delay:2 timer:3(NOT RECOMMENDED!) scheduler_mode = 2 Tip \u57fa\u4e8e\u7ebf\u7a0b\u540c\u6b65\u65b9\u6848\u7684\u65f6\u949f\u6e90\u6765\u81eaIMU\u7ebf\u7a0b\uff0c\u6545IMU\u7ebf\u7a0b\u7684\u7a33\u5b9a\u6027\u5f71\u54cd\u7740\u5176\u4ed6\u5173\u952e\u7ebf\u7a0b\u3002\u8bbe\u7f6e scheduler_mode = 2 \u5219\u8868\u793aIMU\u7ebf\u7a0b\u5ef6\u65f6\u65b9\u6848\u4e3a\u81ea\u9002\u5e94\u5ef6\u65f6\u65b9\u6848\u3002","title":"\u5ef6\u65f6\u51fd\u6570\u7684\u5207\u6362"},{"location":"introduction/introduction/","text":"RflyPilot \u7b80\u4ecb \uf0c1 RflyPilot\u662f\u4e00\u6b3e\u7531\u5317\u822a\u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4\u5f00\u53d1\u7684\u591a\u65cb\u7ffc\u65e0\u4eba\u673a\u81ea\u9a7e\u4eea\uff0c\u5373\u98de\u63a7\u3002\u8be5\u98de\u63a7\u786c\u4ef6\u7684\u6838\u5fc3\u662f\u91c7\u7528Raspberry Pi CM4\u8ba1\u7b97\u677f\uff0c\u8f83\u4f20\u7edf\u7684\u57fa\u4e8e\u5fae\u5904\u7406\u5668\uff08MCU\uff09\u7684\u98de\u63a7\u786c\u4ef6\uff0c\u8be5\u98de\u63a7\u5177\u6709\u66f4\u5f3a\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u8fd0\u884c\u8bd5\u8bd5\u8fd0\u884c\u4e00\u4e9b\u9ad8\u8ba1\u7b97\u91cf\u8981\u6c42\u7684\u63a7\u5236\u65b9\u6cd5\uff0c\u6bd4\u5982\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08NMPC\uff09\u3002\u540c\u65f6RflyPilot\u91c7\u7528\u4e86\u6781\u7b80\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u629b\u5f03\u4e86\u5e38\u89c4\u7684\u591a\u5904\u7406\u65b9\u6848\uff08\u4e00\u9897\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\uff0c\u53e6\u4e00\u4e2a\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u4e0e\u4f20\u611f\u5668\u3001\u6267\u884c\u5668\u8fdb\u884c\u901a\u4fe1\uff09\uff0c\u800c\u91c7\u7528\u5355\u4e00\u5904\u7406\u5668\u65b9\u6848\uff0c\u5bf9\u4fe1\u53f7\u8fdb\u884c\u201c\u76f4\u63a5\u91c7\u6837\u201d\u3002\u8fd9\u6837\u7684\u65b9\u6848\u5927\u5927\u7b80\u5316\u4e86\u98de\u63a7\u7684\u5f00\u53d1\uff0c\u7cbe\u7b80\u4e86\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\uff0c\u4e5f\u964d\u4f4e\u4e86\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u53d1\u6325\u7cfb\u7edf\u7684\u6781\u81f4\u6027\u80fd\u3002\u98de\u63a7\u8f6f\u4ef6\u7684\u5f00\u53d1\u91c7\u7528\u4e86\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08Model Based Design, MBD\uff09\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u6709\u6548\u52a0\u901f\u5f00\u53d1\u6d41\u7a0b\uff0c\u5e76\u6709\u5229\u4e8e\u505a\u7cfb\u7edf\u7ea7\u9a8c\u8bc1\u3002\u5728MBD\u7684\u601d\u60f3\u4e4b\u4e0b\uff0cRflyPilot\u652f\u6301\u5bf9\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u8bb0\u5f55\u4e0e\u8c03\u8bd5\u529f\u80fd\uff0c\u6709\u5229\u4e8e\u5f00\u53d1\u8005\u5145\u5206\u6316\u6398\u63a7\u5236\u7cfb\u7edf\u7684\u6f5c\u80fd\u3002 \u4e3a\u4e86\u65b9\u4fbf\u98de\u63a7\u5f00\u53d1\uff0c\u8bfe\u9898\u7ec4\u4e5f\u4e3aRflyPilot\u7f16\u5199\u4e86\u4e00\u6b3eMATLAB\u5de5\u5177\u7bb1\uff0c\u53eb\u505aRflyPilotTools\uff0c\u8be5\u5de5\u5177\u7bb1\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u90e8\u7f72\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u7279\u6027 \uf0c1 RflyPilot\u91c7\u7528\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u4e3a\u6838\u5fc3\u5904\u7406\u5668\uff0c\u5177\u6709\u8f83\u5f3a\u7684\u8fd0\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u5b9e\u65f6\u8fd0\u884c\u590d\u6742\u7684\u63a7\u5236\u7b97\u6cd5\uff0c\u5982Nonlinear MPC\u7b49\uff1b RflyPilot\u7684\u5904\u7406\u5668\u4e0e\u4f20\u611f\u5668\u548c\u6267\u884c\u5668\u76f4\u63a5\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u66f4\u4e3a\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff1b RflyPilot\u91c7\u7528\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08MBD\uff09\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u63d0\u4f9b\u4e86\u5168\u94fe\u6761\u7684\u4eff\u771f\u9a8c\u8bc1\u65b9\u6848\uff0c\u53ef\u4ee5\u8fdb\u884cMIL\u3001SIH\u3001HIL\u548c\u5b9e\u98de\u5b9e\u9a8c\uff1b \u98de\u63a7\u63d0\u4f9b\u4e86\u5305\u62ec\u63a7\u5236\u5668\u3001\u88ab\u63a7\u5bf9\u8c61\u548c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4eff\u771f\u6a21\u578b\u6846\u67b6\uff0c\u5229\u7528MATLAB\u7684\u4ee3\u7801\u751f\u6210\u529f\u80fd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff1b RflyPilotTools\u4e3a\u98de\u63a7\u5f00\u53d1\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u63d0\u4f9b\u201c\u4e00\u952e\u4ee3\u7801\u90e8\u7f72\u201d\uff0c\u201c\u4e00\u952e\u7f16\u8bd1\u4e0e\u4e0a\u4f20\u201d\u7b49\u5b9e\u7528\u529f\u80fd\uff1b \u98de\u63a7\u57fa\u4e8eLinux\u7cfb\u7edf\uff0c\u5e95\u5c42\u9a71\u52a8\u4e0e\u7cfb\u7edf\u4efb\u52a1\u91c7\u7528\u9ad8\u6548\u7684C/C++\u4ee3\u7801\u7f16\u5199\u5b8c\u6210\uff0c\u91c7\u7528\u4e86\u591a\u79cd\u65b9\u6cd5\u4ee5\u4fdd\u969c\u98de\u884c\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\uff1b RflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u5f00\u53d1\u8c03\u8bd5\u63a5\u53e3\uff0c\u5305\u62ec\u5b9e\u65f6\u6570\u636e\u66f2\u7ebf\u3001\u5728\u7ebf\u53c2\u6570\u4fee\u6539\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u8fdc\u7a0b\u63a7\u5236\u53f0\u7b49\uff1b \u652f\u6301\u4ea4\u53c9\u7f16\u8bd1\u3002 \u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f \uf0c1 RflyPilot\u652f\u6301\u591a\u79cd\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a \u6a21\u5f0f\u4ee3\u53f7 \u6a21\u5f0f \u8bf4\u660e MIL \u6a21\u578b\u5728\u73af\uff08Model in the Loop\uff09 \u5b8c\u5168\u57fa\u4e8eSimulink\u7684\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u65e9\u671f\u7684\u6570\u503c\u4eff\u771f\u9a8c\u8bc1 SIH \u4eff\u771f\u5668\u5728\u73af\uff08Simulator in the Loop\uff09 \u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eRflyPilot\u98de\u63a7\u4e2d\uff0c\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u786c\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5b9e\u9645\u8868\u73b0 HIL \u786c\u4ef6\u5728\u73af\uff08Hardware in the Loop\uff09 RflyPilot\u8fde\u63a5\u5230\u865a\u62df\u88ab\u63a7\u5bf9\u8c61\u8fdb\u884c\u4eff\u771f\uff0c\u8be5\u6a21\u5f0f\u8003\u8651\u5230\u7cfb\u7edf\u8c03\u5ea6\u3001\u4f20\u611f\u5668\u5ef6\u65f6\u7b49\u7ec6\u8282\uff0c\u4f5c\u4e3a\u5b9e\u9a8c\u524d\u7684\u6700\u540e\u4e00\u6b65\u9a8c\u8bc1 EXP \u5b9e\u9a8c\uff08Experiment\uff09 \u5b9e\u98de\u9a8c\u8bc1 OFFBOARD \u4e0a\u4f4d\u673a\u6a21\u5f0f \u7528\u4e8e\u652f\u6301\u989d\u5916\u8ba1\u7b97\u673a\u81ea\u52a8\u5316\u6307\u4ee4\u8f93\u5165 \u5f97\u76ca\u4e8eMBD\u601d\u60f3\uff0c\u4e0a\u8ff0\u5404\u4e2a\u6a21\u5f0f\u95f4\u53ef\u4ee5\u8fdb\u884c\u5feb\u901f\u5207\u6362 MIL SIH HIL \uf0c1 \u5b9e\u98de\u5b9e\u9a8c \uf0c1 \u4e0b\u4e00\u4ee3RflyPilot \uf0c1 \u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u914d\u7f6e\u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u589e\u52a0FPGA\u82af\u7247\u4ee5\u652f\u6301\u66f4\u9ad8\u9891\u7684\u7535\u8c03\u534f\u8bae\uff0c\u5982OneShot\u3001Dshot\u7b49\u3002\u4e0b\u4e00\u4ee3RflyPilot\u8fd8\u5c06\u6269\u5c55\u66f4\u591a\u7684\u4e32\u53e3\uff0c\u4ee5\u652f\u6301\u66f4\u591a\u7684\u6267\u884c\u5668\u548c\u4f20\u611f\u5668\uff0c\u5982\u65e0\u5237\u76f4\u9a71\u7535\u673a\u3001UWB\u7b49\u3002\u540c\u65f6\u5728\u7535\u6e90\u82af\u7247\u4e0a\uff0c\u4e5f\u4f1a\u8fdb\u884c\u9769\u65b0\uff0c\u63d0\u4f9b\u66f4\u52a0\u7a33\u5065\u7684\u7535\u6e90\u65b9\u6848\uff0c\u4ee5\u786e\u4fdd\u98de\u63a7\u7684\u53ef\u9760\u8fd0\u884c\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u652f\u6301\u3001\u53ef\u9760\u6027\u7b49\u65b9\u9762\u8fdb\u884c\u6539\u8fdb\u3002","title":"RflyPilot \u7b80\u4ecb"},{"location":"introduction/introduction/#rflypilot","text":"RflyPilot\u662f\u4e00\u6b3e\u7531\u5317\u822a\u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4\u5f00\u53d1\u7684\u591a\u65cb\u7ffc\u65e0\u4eba\u673a\u81ea\u9a7e\u4eea\uff0c\u5373\u98de\u63a7\u3002\u8be5\u98de\u63a7\u786c\u4ef6\u7684\u6838\u5fc3\u662f\u91c7\u7528Raspberry Pi CM4\u8ba1\u7b97\u677f\uff0c\u8f83\u4f20\u7edf\u7684\u57fa\u4e8e\u5fae\u5904\u7406\u5668\uff08MCU\uff09\u7684\u98de\u63a7\u786c\u4ef6\uff0c\u8be5\u98de\u63a7\u5177\u6709\u66f4\u5f3a\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u8fd0\u884c\u8bd5\u8bd5\u8fd0\u884c\u4e00\u4e9b\u9ad8\u8ba1\u7b97\u91cf\u8981\u6c42\u7684\u63a7\u5236\u65b9\u6cd5\uff0c\u6bd4\u5982\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08NMPC\uff09\u3002\u540c\u65f6RflyPilot\u91c7\u7528\u4e86\u6781\u7b80\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u629b\u5f03\u4e86\u5e38\u89c4\u7684\u591a\u5904\u7406\u65b9\u6848\uff08\u4e00\u9897\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\uff0c\u53e6\u4e00\u4e2a\u5904\u7406\u5668\u4e3b\u8981\u7528\u4e8e\u4e0e\u4f20\u611f\u5668\u3001\u6267\u884c\u5668\u8fdb\u884c\u901a\u4fe1\uff09\uff0c\u800c\u91c7\u7528\u5355\u4e00\u5904\u7406\u5668\u65b9\u6848\uff0c\u5bf9\u4fe1\u53f7\u8fdb\u884c\u201c\u76f4\u63a5\u91c7\u6837\u201d\u3002\u8fd9\u6837\u7684\u65b9\u6848\u5927\u5927\u7b80\u5316\u4e86\u98de\u63a7\u7684\u5f00\u53d1\uff0c\u7cbe\u7b80\u4e86\u98de\u63a7\u8f6f\u4ef6\u67b6\u6784\uff0c\u4e5f\u964d\u4f4e\u4e86\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u53d1\u6325\u7cfb\u7edf\u7684\u6781\u81f4\u6027\u80fd\u3002\u98de\u63a7\u8f6f\u4ef6\u7684\u5f00\u53d1\u91c7\u7528\u4e86\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08Model Based Design, MBD\uff09\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u6709\u6548\u52a0\u901f\u5f00\u53d1\u6d41\u7a0b\uff0c\u5e76\u6709\u5229\u4e8e\u505a\u7cfb\u7edf\u7ea7\u9a8c\u8bc1\u3002\u5728MBD\u7684\u601d\u60f3\u4e4b\u4e0b\uff0cRflyPilot\u652f\u6301\u5bf9\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u8bb0\u5f55\u4e0e\u8c03\u8bd5\u529f\u80fd\uff0c\u6709\u5229\u4e8e\u5f00\u53d1\u8005\u5145\u5206\u6316\u6398\u63a7\u5236\u7cfb\u7edf\u7684\u6f5c\u80fd\u3002 \u4e3a\u4e86\u65b9\u4fbf\u98de\u63a7\u5f00\u53d1\uff0c\u8bfe\u9898\u7ec4\u4e5f\u4e3aRflyPilot\u7f16\u5199\u4e86\u4e00\u6b3eMATLAB\u5de5\u5177\u7bb1\uff0c\u53eb\u505aRflyPilotTools\uff0c\u8be5\u5de5\u5177\u7bb1\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u90e8\u7f72\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002","title":"RflyPilot \u7b80\u4ecb"},{"location":"introduction/introduction/#_1","text":"RflyPilot\u91c7\u7528\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u4e3a\u6838\u5fc3\u5904\u7406\u5668\uff0c\u5177\u6709\u8f83\u5f3a\u7684\u8fd0\u7b97\u80fd\u529b\uff0c\u53ef\u4ee5\u5b9e\u65f6\u8fd0\u884c\u590d\u6742\u7684\u63a7\u5236\u7b97\u6cd5\uff0c\u5982Nonlinear MPC\u7b49\uff1b RflyPilot\u7684\u5904\u7406\u5668\u4e0e\u4f20\u611f\u5668\u548c\u6267\u884c\u5668\u76f4\u63a5\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u66f4\u4e3a\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff1b RflyPilot\u91c7\u7528\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\uff08MBD\uff09\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u63d0\u4f9b\u4e86\u5168\u94fe\u6761\u7684\u4eff\u771f\u9a8c\u8bc1\u65b9\u6848\uff0c\u53ef\u4ee5\u8fdb\u884cMIL\u3001SIH\u3001HIL\u548c\u5b9e\u98de\u5b9e\u9a8c\uff1b \u98de\u63a7\u63d0\u4f9b\u4e86\u5305\u62ec\u63a7\u5236\u5668\u3001\u88ab\u63a7\u5bf9\u8c61\u548c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u4eff\u771f\u6a21\u578b\u6846\u67b6\uff0c\u5229\u7528MATLAB\u7684\u4ee3\u7801\u751f\u6210\u529f\u80fd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff1b RflyPilotTools\u4e3a\u98de\u63a7\u5f00\u53d1\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u63d0\u4f9b\u201c\u4e00\u952e\u4ee3\u7801\u90e8\u7f72\u201d\uff0c\u201c\u4e00\u952e\u7f16\u8bd1\u4e0e\u4e0a\u4f20\u201d\u7b49\u5b9e\u7528\u529f\u80fd\uff1b \u98de\u63a7\u57fa\u4e8eLinux\u7cfb\u7edf\uff0c\u5e95\u5c42\u9a71\u52a8\u4e0e\u7cfb\u7edf\u4efb\u52a1\u91c7\u7528\u9ad8\u6548\u7684C/C++\u4ee3\u7801\u7f16\u5199\u5b8c\u6210\uff0c\u91c7\u7528\u4e86\u591a\u79cd\u65b9\u6cd5\u4ee5\u4fdd\u969c\u98de\u884c\u7cfb\u7edf\u7684\u5b9e\u65f6\u6027\uff1b RflyPilot\u63d0\u4f9b\u4e86\u591a\u79cd\u5f00\u53d1\u8c03\u8bd5\u63a5\u53e3\uff0c\u5305\u62ec\u5b9e\u65f6\u6570\u636e\u66f2\u7ebf\u3001\u5728\u7ebf\u53c2\u6570\u4fee\u6539\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u8fdc\u7a0b\u63a7\u5236\u53f0\u7b49\uff1b \u652f\u6301\u4ea4\u53c9\u7f16\u8bd1\u3002","title":"\u7279\u6027"},{"location":"introduction/introduction/#_2","text":"RflyPilot\u652f\u6301\u591a\u79cd\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a \u6a21\u5f0f\u4ee3\u53f7 \u6a21\u5f0f \u8bf4\u660e MIL \u6a21\u578b\u5728\u73af\uff08Model in the Loop\uff09 \u5b8c\u5168\u57fa\u4e8eSimulink\u7684\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u65e9\u671f\u7684\u6570\u503c\u4eff\u771f\u9a8c\u8bc1 SIH \u4eff\u771f\u5668\u5728\u73af\uff08Simulator in the Loop\uff09 \u63a7\u5236\u5668\u4e0e\u6a21\u578b\u5747\u8fd0\u884c\u4e8eRflyPilot\u98de\u63a7\u4e2d\uff0c\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u786c\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5b9e\u9645\u8868\u73b0 HIL \u786c\u4ef6\u5728\u73af\uff08Hardware in the Loop\uff09 RflyPilot\u8fde\u63a5\u5230\u865a\u62df\u88ab\u63a7\u5bf9\u8c61\u8fdb\u884c\u4eff\u771f\uff0c\u8be5\u6a21\u5f0f\u8003\u8651\u5230\u7cfb\u7edf\u8c03\u5ea6\u3001\u4f20\u611f\u5668\u5ef6\u65f6\u7b49\u7ec6\u8282\uff0c\u4f5c\u4e3a\u5b9e\u9a8c\u524d\u7684\u6700\u540e\u4e00\u6b65\u9a8c\u8bc1 EXP \u5b9e\u9a8c\uff08Experiment\uff09 \u5b9e\u98de\u9a8c\u8bc1 OFFBOARD \u4e0a\u4f4d\u673a\u6a21\u5f0f \u7528\u4e8e\u652f\u6301\u989d\u5916\u8ba1\u7b97\u673a\u81ea\u52a8\u5316\u6307\u4ee4\u8f93\u5165 \u5f97\u76ca\u4e8eMBD\u601d\u60f3\uff0c\u4e0a\u8ff0\u5404\u4e2a\u6a21\u5f0f\u95f4\u53ef\u4ee5\u8fdb\u884c\u5feb\u901f\u5207\u6362","title":"\u4eff\u771f\u9a8c\u8bc1\u6a21\u5f0f"},{"location":"introduction/introduction/#mil-sih-hil","text":"","title":"MIL SIH HIL"},{"location":"introduction/introduction/#_3","text":"","title":"\u5b9e\u98de\u5b9e\u9a8c"},{"location":"introduction/introduction/#rflypilot_1","text":"\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u914d\u7f6e\u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u589e\u52a0FPGA\u82af\u7247\u4ee5\u652f\u6301\u66f4\u9ad8\u9891\u7684\u7535\u8c03\u534f\u8bae\uff0c\u5982OneShot\u3001Dshot\u7b49\u3002\u4e0b\u4e00\u4ee3RflyPilot\u8fd8\u5c06\u6269\u5c55\u66f4\u591a\u7684\u4e32\u53e3\uff0c\u4ee5\u652f\u6301\u66f4\u591a\u7684\u6267\u884c\u5668\u548c\u4f20\u611f\u5668\uff0c\u5982\u65e0\u5237\u76f4\u9a71\u7535\u673a\u3001UWB\u7b49\u3002\u540c\u65f6\u5728\u7535\u6e90\u82af\u7247\u4e0a\uff0c\u4e5f\u4f1a\u8fdb\u884c\u9769\u65b0\uff0c\u63d0\u4f9b\u66f4\u52a0\u7a33\u5065\u7684\u7535\u6e90\u65b9\u6848\uff0c\u4ee5\u786e\u4fdd\u98de\u63a7\u7684\u53ef\u9760\u8fd0\u884c\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u4e0b\u4e00\u4ee3RflyPilot\u5c06\u5728\u786c\u4ef6\u652f\u6301\u3001\u53ef\u9760\u6027\u7b49\u65b9\u9762\u8fdb\u884c\u6539\u8fdb\u3002","title":"\u4e0b\u4e00\u4ee3RflyPilot"},{"location":"introduction/sys_overview/","text":"\u672c\u5c0f\u7ed3\u5c06\u4e3b\u8981\u4ecb\u7ecdRflyPilot\u98de\u63a7\u7684\u786c\u4ef6\u53ca\u8f6f\u4ef6\u67b6\u6784\uff0c\u76ee\u7684\u662f\u8ba9\u8bfb\u8005\u5bf9RflyPilot\u6709\u7cfb\u7edf\u6027\u7684\u4e86\u89e3\u3002 1 \u786c\u4ef6\u67b6\u6784 \uf0c1 Rflypilot\u98de\u63a7\u786c\u4ef6\u65b9\u6848\u7684\u6700\u663e\u8457\u7279\u70b9\u5c31\u662f\u9ad8\u6027\u80fd\u4e0e\u201c\u76f4\u63a5\u91c7\u6837\u201d\uff0c\u5b83\u91c7\u7528\u4e86\u9ad8\u6027\u80fd\u7684ARM\u5904\u7406\u5668\uff0c\u5177\u67094\u6838CPU\u548c1.8GHz\u4e3b\u9891\uff0c\u5728\u4f20\u611f\u5668\u5916\u8bbe\u4e0a\uff0cCPU\u76f4\u63a5\u5bf9\u4f20\u611f\u5668\u6570\u636e\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u76f4\u63a5\u53d1\u9001\u63a7\u5236\u6307\u4ee4\u3002\u8fd9\u4e00\u70b9\u8f83\u4f20\u7edf\u7684\u201c\u4e0a\u4e0b\u4f4d\u673a\u201d\u7684\u786c\u4ef6\u65b9\u6848\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\u4e0a\u9650\u3002 RflyPilot\u98de\u63a7\u786c\u4ef6\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff0c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u548c\u5916\u8bbe\u62d3\u5c55\u677f\u3002\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u662f\u6210\u54c1\u7535\u8def\u677f\uff0c\u5b83\u8f83\u6811\u8393\u6d3e4B\u5177\u6709\u66f4\u5c0f\u7684\u4f53\u79ef\uff0c\u5b83\u53ea\u4fdd\u7559\u4e86\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6838\u5fc3\u7684\u5904\u7406\u5668\u3001\u5185\u5b58\u3001\u5b58\u50a8\u82af\u7247\u7b49\u90e8\u4ef6\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728\u5c0f\u578b\u591a\u65cb\u7ffc\u7684\u98de\u63a7\u4e2d\u4f5c\u8ba1\u7b97\u6838\u5fc3\u3002\u5916\u8bbe\u62d3\u5c55\u677f\u4e0e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u901a\u8fc7\u4e24\u6761100pin\u63a5\u53e3\u76f8\u8fde\u63a5\uff0c\u5b83\u4e3b\u8981\u5305\u542b\u98de\u63a7\u6240\u9700\u7684\u57fa\u672c\u4f20\u611f\u5668\uff08IMU\uff0c\u6c14\u538b\u8ba1\uff0c\u78c1\u529b\u8ba1\u7b49\uff09\uff0c\u540c\u65f6\u4e5f\u914d\u5907\u4e86\u8fde\u63a5GPS\u3001\u7535\u6e90\u6a21\u5757\u3001\u7535\u8c03\u3001\u63a5\u6536\u673a\u7b49\u98de\u884c\u5668\u5e38\u7528\u8bbe\u5907\u7ec4\u4ef6\u7684\u63a5\u53e3\u3002\u5f53\u7136\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u4e5f\u914d\u5907\u4e86\u7535\u6d41\u91c7\u6837\u82af\u7247\uff0c\u7528\u4e8e\u6d4b\u91cf\u52a8\u529b\u7cfb\u7edf\u7684\u5de5\u4f5c\u7535\u6d41\u3002 \u603b\u4f53\u4e0a\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u7684\u5c3a\u5bf8\u540c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u5927\u5c0f\u4e00\u81f4\uff0c\u5728\u914d\u5907\u4e30\u5bcc\u7684\u4f20\u611f\u5668\u4e0e\u9ad8\u6027\u80fd\u5904\u7406\u5668\u7684\u540c\u65f6\uff0c\u517c\u987e\u4e86\u4f53\u79ef\u3002 1.1 \u6811\u8393\u6d3e\u8ba1\u7b97\u7248 \uf0c1 \u5173\u4e8e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u7684\u76f8\u5173\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 https://www.raspberrypi.com/documentation/computers/compute-module.html 1.2 \u5916\u8bbe\u6269\u5c55\u677f \uf0c1 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u4e3b\u8981\u642d\u8f7d\u4f20\u611f\u5668\u3001\u5916\u90e8\u8bbe\u5907\u63a5\u53e3\u3001\u7535\u6d41\u4f20\u611f\u5668\u7b49\uff0c\u540c\u65f6\u5728\u62d3\u5c55\u677f\u4e0a\u4e5f\u8bbe\u8ba1\u4e86\u76f8\u5e94\u7684\u62e8\u7801\u5f00\u5173\uff0c\u7528\u4e8e\u4fee\u6539\u67d0\u4e9b\u914d\u7f6e\u9009\u9879\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u4f7f\u7528IMU\uff0cRflyPilot\u7684IMU\u88ab\u72ec\u7acb\u51fa\u6765\uff0c\u7528\u4e8e\u5f00\u53d1\u8005\u589e\u52a0\u51cf\u9707\u6216\u8005\u5176\u4ed6\u989d\u5916\u7684\u5904\u7406\u3002\uff08\u6bd4\u5982\uff0c\u5728\u56db\u65cb\u7ffc\u98de\u884c\u5668\u8fdb\u884c\u65cb\u7ffc\u5931\u6548\u7684\u5bb9\u9519\u5b9e\u9a8c\u65f6\uff0c\u98de\u884c\u5668\u5f80\u5f80\u4f1a\u8fdb\u5165\u9ad8\u901f\u7684\u81ea\u65cb\u72b6\u6001\uff0c\u6b64\u65f6\u7684\u81ea\u65cb\u89d2\u901f\u5ea6\u53ef\u80fd\u4f1a\u8d85\u51fa\u9640\u87ba\u4eea\u7684\u91cf\u7a0b\uff0c\u6b64\u65f6\u901a\u8fc7\u5c06\u9640\u87ba\u4eea\u503e\u659c\u653e\u7f6e\u662f\u53ef\u4ee5\u589e\u52a0\u9640\u87ba\u4eea\u5728\u67d0\u4e00\u4e2a\u65b9\u5411\u7684\u91cf\u7a0b\uff0c\u8fdb\u800c\u907f\u514d\u8d85\u7a0b\u95ee\u9898\uff09 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u90e8\u5206\u4f20\u611f\u5668\u5e03\u7f6e\u5982\u4e0b \u90e8\u5206\u63a5\u53e3\u914d\u7f6e\u60c5\u51b5\u5982\u4e0b \u4f20\u611f\u5668 \u603b\u7ebf\u7c7b\u578b \u5f15\u811a IMU SPI CS:BCM8,CLK:BCM11,MOSI:BCM10,MISO:BCM9 \u78c1\u529b\u8ba1QMC5883L IIC SCL:BCM3,SDA:BCM2 \u6c14\u538b\u8ba1MS5611 IIC SCL:BCM3,SDA:BCM2 PWM0\u82af\u7247PCA9685 IIC SCL:BCM3,SDA:BCM2 PWM1\u82af\u7247PCA9685 IIC SCL:BCM1,SDA:BCM0 \u7535\u6d41\u91c7\u6837ADS1115 IIC SCL:BCM3,SDA:BCM2 \u63a5\u6536\u673a SBUS/iBUS BCM15 \u6ce8\u610f \u7531\u4e8e\u6811\u8393\u6d3eCM4\u672c\u8eab\u7684\u652f\u6301PWM\u8f93\u51fa\u7684IO\u6570\u91cf\u8f83\u5c11\uff0cRflyPilot\u91c7\u7528PCA9685\u82af\u7247\u5b9e\u73b0PWM\u4fe1\u53f7\u7684\u751f\u6210\uff0c\u6811\u8393\u6d3eCM4\u901a\u8fc7IIC\u603b\u7ebf\u4e0ePCA9685\u8fdb\u884c\u901a\u4fe1\uff0c\u751f\u6210\u76f8\u5e94\u7684PWM\u4fe1\u53f7\u3002 2 \u8f6f\u4ef6\u67b6\u6784 \uf0c1 RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u3002\u987e\u540d\u601d\u4e49\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e3aRflyPilot\u63d0\u4f9b\u53ef\u9760\u7684\u5e95\u5c42\u9a71\u52a8\u3001\u7cfb\u7edf\u4efb\u52a1\u8c03\u5ea6\u3001\u8c03\u8bd5\u63a5\u53e3\u548c\u7ebf\u7a0b\u901a\u4fe1\u7b49\u76f8\u5173\u652f\u6301\uff0c\u6240\u6709\u4ee3\u7801\u5747\u7531C/C++\u7f16\u5199\u800c\u6210\u3002\u800c\u5f00\u53d1\u8005\u6a21\u5757\u5219\u63d0\u4f9b\u4e86Simulink\u7684\u4ee3\u7801\u751f\u6210\u63a5\u53e3\uff0c\u5305\u62ec\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u53ef\u4ee5\u76f4\u63a5\u7531Simulink\u4ee3\u7801\u751f\u6210\u5f97\u5230\uff0c\u5e76\u76f4\u63a5\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u7684\u63a5\u53e3\u8fdb\u884c\u5bf9\u63a5\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u90e8\u7f72\u7684\u65f6\u95f4\u6210\u672c\u3002\u5f00\u53d1\u8005\u6a21\u5757\u57fa\u4e8eMBD\u7684\u601d\u60f3\uff0c\u52a0\u901f\u4e86\u98de\u884c\u63a7\u5236\u548c\u72b6\u6001\u4f30\u8ba1\u7b97\u6cd5\u7684\u7cfb\u7edf\u7ea7\u5f00\u53d1\u4e0e\u9a8c\u8bc1\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u7684\u7279\u6027\u5728\u4e8e\u5176\u5f3a\u5927\u7684\u8ba1\u7b97\u6027\u80fd\u3001\u517c\u5907\u7cfb\u7edf\u7ea7\u7684\u9a8c\u8bc1\u80fd\u529b\u4e0e\u4fbf\u6377\u76f4\u89c2\u7684\u5f00\u53d1\u65b9\u5f0f\u3002 2.1 \u5e95\u5c42\u9a71\u52a8 \uf0c1 RflyPilot\u7684\u90e8\u5206\u5e95\u5c42\u9a71\u52a8\u53c2\u8003\u4e86PX4\u76f8\u5173\u7684\u9a71\u52a8\u4ee3\u7801\u3002\u603b\u4f53\u4e0a\uff0cRflyPilot\u652f\u6301\u5e38\u89c1\u7684\u4f20\u611f\u5668\uff0c\u5927\u591a\u6570\u4f20\u611f\u5668\u6570\u636e\u91c7\u96c6\u64cd\u4f5c\u88ab\u5c01\u88c5\u4e3a\u72ec\u7acb\u7684\u4efb\u52a1\uff0c\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7684\u5f62\u5f0f\u53d1\u5e03\u5230\u7cfb\u7edf\u4e2d\u3002 \u76ee\u524dRflyPilot\u652f\u6301\u7684\u4f20\u611f\u5668\u5982\u4e0b \u4f20\u611f\u5668 \u578b\u53f7 \u9a71\u52a8\u4ee3\u7801 IMU ICM42688p src/drivers/imu/icm42688p IMU ICM20689 src/drivers/imu/icm20689 \u6c14\u538b\u8ba1 MS5611 src/drivers/barometer/ms5611 \u78c1\u529b\u8ba1 IST8310 src/drviers/magnetometer/ist8310 \u78c1\u529b\u8ba1 QMC5883L src/drviers/magnetometer/qmc5883l \u63a5\u6536\u673a SBUS/iBUS src/drviers/rc/sbus GPS M8N/M9N src/drviers/gps PWM\u8f93\u51fa PCA9685 src/drviers/actuator/pca9685 UWB LinkTrack src/drivers/uwb 2.2 \u4efb\u52a1\u8c03\u5ea6 \uf0c1 RflyPilot\u98de\u63a7\u4e2d\u5404\u4e2a\u4efb\u52a1\u4ee5\u72ec\u7acb\u7ebf\u7a0b\uff08thread\uff09\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982IMU\u91c7\u6837\u7ebf\u7a0b\u3001GPS\u7ebf\u7a0b\u3001\u72b6\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\u7b49\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u542f\u52a8\u4e0d\u540c\u7ebf\u7a0b\uff0c\u7528\u4ee5\u652f\u6301\u7cfb\u7edf\u7684\u8fd0\u884c\u3002\u6811\u8393\u6d3e\u8ba1\u7b97\u677f\u91c7\u7528\u7684\u662fBCM2711\uff0c\u56db\u6838Cortex A72\u5904\u7406\u5668\uff0cRflyPilot\u4e2d\u90e8\u5206\u7ebf\u7a0b\u5206\u522b\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684\u5904\u7406\u5668\u6838\u5fc3\u4e0a\uff0c\u4e3a\u4fdd\u969c\u7ebf\u7a0b\u7684\u5b9e\u65f6\u6027\uff0c\u4e2a\u522b\u7ebf\u7a0b\u5c06\u88ab\u7ed1\u5b9a\u5230\u88ab\u7cfb\u7edf\u9694\u79bb\u7684CPU\u6838\u5fc3\u4e0a\uff0c\u5e76\u72ec\u4eab\u8be5CPU\u6838\u5fc3\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u964d\u4f4e\u7cfb\u7edf\u672c\u8eab\u548c\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8be5\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u4fdd\u969c\u5176\u5b9e\u65f6\u6027\u7684\u3002\u540c\u65f6\u4e3a\u4e86\u964d\u4f4e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0cRflyPilot\u4e5f\u5f15\u5165\u4e86\u4e00\u5957\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u7528\u4e8e\u89c4\u5b9a\u7ebf\u7a0b\u8fd0\u884c\u7684\u5148\u540e\u987a\u5e8f\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u8be5\u673a\u5236\u7684\u5f15\u5165\u5927\u5927\u63d0\u9ad8\u4e86\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u7684\u6027\u80fd\uff0c\u8ba9\u7cfb\u7edf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5728\u9ad8\u52a8\u6001\u7684\u5de5\u51b5\u3002 2.3 \u8c03\u8bd5\u6a21\u5757 \uf0c1 \u8c03\u8bd5\u6a21\u5757\u4e3b\u8981\u5305\u62ec\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3001\u53c2\u6570\u8bfb\u53d6\u4e0e\u5728\u7ebf\u66f4\u65b0\u529f\u80fd\u3001\u5728\u7ebf\u793a\u6ce2\u5668\u529f\u80fd\u3001\u63a7\u5236\u53f0\u529f\u80fd\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u66f4\u597d\u5730\u4e86\u89e3\u98de\u884c\u5668\u7684\u98de\u884c\u72b6\u6001\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u8c03\u8bd5\u63a5\u53e3\u3002\u6240\u6709\u7684\u5728\u7ebf\u8c03\u8bd5\u529f\u80fd\u5747\u53ef\u4ee5\u901a\u8fc7\u677f\u8f7dWIFI\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u989d\u5916\u589e\u52a0\u6570\u4f20\u6a21\u5757\u3002 2.4 \u901a\u4fe1\u673a\u5236 \uf0c1 RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u5185\u90e8\u7684\u7ebf\u7a0b\u901a\u4fe1\u673a\u5236\u4e3b\u8981\u91c7\u7528\u7684\u662f\u5171\u4eab\u5185\u5b58\u7684\u5f62\u5f0f\uff0c\u6240\u6709\u6570\u636e\u4ee5\u6d88\u606f\u5f62\u5f0f\u5b58\u50a8\u5728\u7cfb\u7edf\u5185\u5b58\u4e2d\u3002\u4e3a\u907f\u514d\u540c\u65f6\u8fdb\u884c\u6d88\u606f\u8bfb\u53d6\u4e0e\u5199\u5165\u800c\u51fa\u73b0\u7684\u6570\u636e\u5f02\u5e38\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u201c\u539f\u5b50\u9501 \u201d\u8fdb\u884c\u5904\u7406\uff0c\u6700\u7ec8\u6d88\u606f\u7684\u8bfb\u53d6 read \u4e0e\u53d1\u5e03 publish \u4e92\u4e0d\u51b2\u7a81\uff0c\u4e5f\u652f\u6301\u4e00\u53d1\u591a\u6536\u7684\u901a\u4fe1\u5f62\u5f0f\u3002\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8bfb\u53d6\u5386\u53f2\u6570\u636e\uff08\u4e00\u6bb5\u65f6\u95f4\uff09\uff0c\u7528\u4e8e\u907f\u514d\u6d88\u606f\u7684\u9057\u6f0f\uff0c\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8fdb\u884c\u5373\u65f6\u7684\u6d88\u606f\u8bb0\u5f55\u3002","title":"Sys overview"},{"location":"introduction/sys_overview/#1","text":"Rflypilot\u98de\u63a7\u786c\u4ef6\u65b9\u6848\u7684\u6700\u663e\u8457\u7279\u70b9\u5c31\u662f\u9ad8\u6027\u80fd\u4e0e\u201c\u76f4\u63a5\u91c7\u6837\u201d\uff0c\u5b83\u91c7\u7528\u4e86\u9ad8\u6027\u80fd\u7684ARM\u5904\u7406\u5668\uff0c\u5177\u67094\u6838CPU\u548c1.8GHz\u4e3b\u9891\uff0c\u5728\u4f20\u611f\u5668\u5916\u8bbe\u4e0a\uff0cCPU\u76f4\u63a5\u5bf9\u4f20\u611f\u5668\u6570\u636e\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u76f4\u63a5\u53d1\u9001\u63a7\u5236\u6307\u4ee4\u3002\u8fd9\u4e00\u70b9\u8f83\u4f20\u7edf\u7684\u201c\u4e0a\u4e0b\u4f4d\u673a\u201d\u7684\u786c\u4ef6\u65b9\u6848\u5177\u6709\u66f4\u4f4e\u7684\u73af\u8def\u5ef6\u8fdf\uff0c\u6709\u5229\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\u4e0a\u9650\u3002 RflyPilot\u98de\u63a7\u786c\u4ef6\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff0c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u548c\u5916\u8bbe\u62d3\u5c55\u677f\u3002\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u662f\u6210\u54c1\u7535\u8def\u677f\uff0c\u5b83\u8f83\u6811\u8393\u6d3e4B\u5177\u6709\u66f4\u5c0f\u7684\u4f53\u79ef\uff0c\u5b83\u53ea\u4fdd\u7559\u4e86\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6838\u5fc3\u7684\u5904\u7406\u5668\u3001\u5185\u5b58\u3001\u5b58\u50a8\u82af\u7247\u7b49\u90e8\u4ef6\uff0c\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728\u5c0f\u578b\u591a\u65cb\u7ffc\u7684\u98de\u63a7\u4e2d\u4f5c\u8ba1\u7b97\u6838\u5fc3\u3002\u5916\u8bbe\u62d3\u5c55\u677f\u4e0e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u901a\u8fc7\u4e24\u6761100pin\u63a5\u53e3\u76f8\u8fde\u63a5\uff0c\u5b83\u4e3b\u8981\u5305\u542b\u98de\u63a7\u6240\u9700\u7684\u57fa\u672c\u4f20\u611f\u5668\uff08IMU\uff0c\u6c14\u538b\u8ba1\uff0c\u78c1\u529b\u8ba1\u7b49\uff09\uff0c\u540c\u65f6\u4e5f\u914d\u5907\u4e86\u8fde\u63a5GPS\u3001\u7535\u6e90\u6a21\u5757\u3001\u7535\u8c03\u3001\u63a5\u6536\u673a\u7b49\u98de\u884c\u5668\u5e38\u7528\u8bbe\u5907\u7ec4\u4ef6\u7684\u63a5\u53e3\u3002\u5f53\u7136\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u4e5f\u914d\u5907\u4e86\u7535\u6d41\u91c7\u6837\u82af\u7247\uff0c\u7528\u4e8e\u6d4b\u91cf\u52a8\u529b\u7cfb\u7edf\u7684\u5de5\u4f5c\u7535\u6d41\u3002 \u603b\u4f53\u4e0a\uff0c\u5916\u8bbe\u62d3\u5c55\u677f\u7684\u5c3a\u5bf8\u540c\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u5927\u5c0f\u4e00\u81f4\uff0c\u5728\u914d\u5907\u4e30\u5bcc\u7684\u4f20\u611f\u5668\u4e0e\u9ad8\u6027\u80fd\u5904\u7406\u5668\u7684\u540c\u65f6\uff0c\u517c\u987e\u4e86\u4f53\u79ef\u3002","title":"1 \u786c\u4ef6\u67b6\u6784"},{"location":"introduction/sys_overview/#11","text":"\u5173\u4e8e\u6811\u8393\u6d3eCM4\u8ba1\u7b97\u677f\u7684\u76f8\u5173\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 https://www.raspberrypi.com/documentation/computers/compute-module.html","title":"1.1 \u6811\u8393\u6d3e\u8ba1\u7b97\u7248"},{"location":"introduction/sys_overview/#12","text":"RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u4e3b\u8981\u642d\u8f7d\u4f20\u611f\u5668\u3001\u5916\u90e8\u8bbe\u5907\u63a5\u53e3\u3001\u7535\u6d41\u4f20\u611f\u5668\u7b49\uff0c\u540c\u65f6\u5728\u62d3\u5c55\u677f\u4e0a\u4e5f\u8bbe\u8ba1\u4e86\u76f8\u5e94\u7684\u62e8\u7801\u5f00\u5173\uff0c\u7528\u4e8e\u4fee\u6539\u67d0\u4e9b\u914d\u7f6e\u9009\u9879\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u4f7f\u7528IMU\uff0cRflyPilot\u7684IMU\u88ab\u72ec\u7acb\u51fa\u6765\uff0c\u7528\u4e8e\u5f00\u53d1\u8005\u589e\u52a0\u51cf\u9707\u6216\u8005\u5176\u4ed6\u989d\u5916\u7684\u5904\u7406\u3002\uff08\u6bd4\u5982\uff0c\u5728\u56db\u65cb\u7ffc\u98de\u884c\u5668\u8fdb\u884c\u65cb\u7ffc\u5931\u6548\u7684\u5bb9\u9519\u5b9e\u9a8c\u65f6\uff0c\u98de\u884c\u5668\u5f80\u5f80\u4f1a\u8fdb\u5165\u9ad8\u901f\u7684\u81ea\u65cb\u72b6\u6001\uff0c\u6b64\u65f6\u7684\u81ea\u65cb\u89d2\u901f\u5ea6\u53ef\u80fd\u4f1a\u8d85\u51fa\u9640\u87ba\u4eea\u7684\u91cf\u7a0b\uff0c\u6b64\u65f6\u901a\u8fc7\u5c06\u9640\u87ba\u4eea\u503e\u659c\u653e\u7f6e\u662f\u53ef\u4ee5\u589e\u52a0\u9640\u87ba\u4eea\u5728\u67d0\u4e00\u4e2a\u65b9\u5411\u7684\u91cf\u7a0b\uff0c\u8fdb\u800c\u907f\u514d\u8d85\u7a0b\u95ee\u9898\uff09 RflyPilot\u5916\u8bbe\u62d3\u5c55\u677f\u90e8\u5206\u4f20\u611f\u5668\u5e03\u7f6e\u5982\u4e0b \u90e8\u5206\u63a5\u53e3\u914d\u7f6e\u60c5\u51b5\u5982\u4e0b \u4f20\u611f\u5668 \u603b\u7ebf\u7c7b\u578b \u5f15\u811a IMU SPI CS:BCM8,CLK:BCM11,MOSI:BCM10,MISO:BCM9 \u78c1\u529b\u8ba1QMC5883L IIC SCL:BCM3,SDA:BCM2 \u6c14\u538b\u8ba1MS5611 IIC SCL:BCM3,SDA:BCM2 PWM0\u82af\u7247PCA9685 IIC SCL:BCM3,SDA:BCM2 PWM1\u82af\u7247PCA9685 IIC SCL:BCM1,SDA:BCM0 \u7535\u6d41\u91c7\u6837ADS1115 IIC SCL:BCM3,SDA:BCM2 \u63a5\u6536\u673a SBUS/iBUS BCM15 \u6ce8\u610f \u7531\u4e8e\u6811\u8393\u6d3eCM4\u672c\u8eab\u7684\u652f\u6301PWM\u8f93\u51fa\u7684IO\u6570\u91cf\u8f83\u5c11\uff0cRflyPilot\u91c7\u7528PCA9685\u82af\u7247\u5b9e\u73b0PWM\u4fe1\u53f7\u7684\u751f\u6210\uff0c\u6811\u8393\u6d3eCM4\u901a\u8fc7IIC\u603b\u7ebf\u4e0ePCA9685\u8fdb\u884c\u901a\u4fe1\uff0c\u751f\u6210\u76f8\u5e94\u7684PWM\u4fe1\u53f7\u3002","title":"1.2 \u5916\u8bbe\u6269\u5c55\u677f"},{"location":"introduction/sys_overview/#2","text":"RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u3002\u987e\u540d\u601d\u4e49\uff0c\u7cfb\u7edf\u529f\u80fd\u6a21\u5757\u4e3aRflyPilot\u63d0\u4f9b\u53ef\u9760\u7684\u5e95\u5c42\u9a71\u52a8\u3001\u7cfb\u7edf\u4efb\u52a1\u8c03\u5ea6\u3001\u8c03\u8bd5\u63a5\u53e3\u548c\u7ebf\u7a0b\u901a\u4fe1\u7b49\u76f8\u5173\u652f\u6301\uff0c\u6240\u6709\u4ee3\u7801\u5747\u7531C/C++\u7f16\u5199\u800c\u6210\u3002\u800c\u5f00\u53d1\u8005\u6a21\u5757\u5219\u63d0\u4f9b\u4e86Simulink\u7684\u4ee3\u7801\u751f\u6210\u63a5\u53e3\uff0c\u5305\u62ec\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\uff0c\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u53ef\u4ee5\u76f4\u63a5\u7531Simulink\u4ee3\u7801\u751f\u6210\u5f97\u5230\uff0c\u5e76\u76f4\u63a5\u4e0e\u5f00\u53d1\u8005\u6a21\u5757\u7684\u63a5\u53e3\u8fdb\u884c\u5bf9\u63a5\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u90e8\u7f72\u7684\u65f6\u95f4\u6210\u672c\u3002\u5f00\u53d1\u8005\u6a21\u5757\u57fa\u4e8eMBD\u7684\u601d\u60f3\uff0c\u52a0\u901f\u4e86\u98de\u884c\u63a7\u5236\u548c\u72b6\u6001\u4f30\u8ba1\u7b97\u6cd5\u7684\u7cfb\u7edf\u7ea7\u5f00\u53d1\u4e0e\u9a8c\u8bc1\u3002 \u603b\u800c\u8a00\u4e4b\uff0cRflyPilot\u7684\u7279\u6027\u5728\u4e8e\u5176\u5f3a\u5927\u7684\u8ba1\u7b97\u6027\u80fd\u3001\u517c\u5907\u7cfb\u7edf\u7ea7\u7684\u9a8c\u8bc1\u80fd\u529b\u4e0e\u4fbf\u6377\u76f4\u89c2\u7684\u5f00\u53d1\u65b9\u5f0f\u3002","title":"2 \u8f6f\u4ef6\u67b6\u6784"},{"location":"introduction/sys_overview/#21","text":"RflyPilot\u7684\u90e8\u5206\u5e95\u5c42\u9a71\u52a8\u53c2\u8003\u4e86PX4\u76f8\u5173\u7684\u9a71\u52a8\u4ee3\u7801\u3002\u603b\u4f53\u4e0a\uff0cRflyPilot\u652f\u6301\u5e38\u89c1\u7684\u4f20\u611f\u5668\uff0c\u5927\u591a\u6570\u4f20\u611f\u5668\u6570\u636e\u91c7\u96c6\u64cd\u4f5c\u88ab\u5c01\u88c5\u4e3a\u72ec\u7acb\u7684\u4efb\u52a1\uff0c\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u7684\u5f62\u5f0f\u53d1\u5e03\u5230\u7cfb\u7edf\u4e2d\u3002 \u76ee\u524dRflyPilot\u652f\u6301\u7684\u4f20\u611f\u5668\u5982\u4e0b \u4f20\u611f\u5668 \u578b\u53f7 \u9a71\u52a8\u4ee3\u7801 IMU ICM42688p src/drivers/imu/icm42688p IMU ICM20689 src/drivers/imu/icm20689 \u6c14\u538b\u8ba1 MS5611 src/drivers/barometer/ms5611 \u78c1\u529b\u8ba1 IST8310 src/drviers/magnetometer/ist8310 \u78c1\u529b\u8ba1 QMC5883L src/drviers/magnetometer/qmc5883l \u63a5\u6536\u673a SBUS/iBUS src/drviers/rc/sbus GPS M8N/M9N src/drviers/gps PWM\u8f93\u51fa PCA9685 src/drviers/actuator/pca9685 UWB LinkTrack src/drivers/uwb","title":"2.1 \u5e95\u5c42\u9a71\u52a8"},{"location":"introduction/sys_overview/#22","text":"RflyPilot\u98de\u63a7\u4e2d\u5404\u4e2a\u4efb\u52a1\u4ee5\u72ec\u7acb\u7ebf\u7a0b\uff08thread\uff09\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u6bd4\u5982IMU\u91c7\u6837\u7ebf\u7a0b\u3001GPS\u7ebf\u7a0b\u3001\u72b6\u6001\u4f30\u8ba1\u7ebf\u7a0b\u3001\u63a7\u5236\u5668\u7ebf\u7a0b\u7b49\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u542f\u52a8\u4e0d\u540c\u7ebf\u7a0b\uff0c\u7528\u4ee5\u652f\u6301\u7cfb\u7edf\u7684\u8fd0\u884c\u3002\u6811\u8393\u6d3e\u8ba1\u7b97\u677f\u91c7\u7528\u7684\u662fBCM2711\uff0c\u56db\u6838Cortex A72\u5904\u7406\u5668\uff0cRflyPilot\u4e2d\u90e8\u5206\u7ebf\u7a0b\u5206\u522b\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684\u5904\u7406\u5668\u6838\u5fc3\u4e0a\uff0c\u4e3a\u4fdd\u969c\u7ebf\u7a0b\u7684\u5b9e\u65f6\u6027\uff0c\u4e2a\u522b\u7ebf\u7a0b\u5c06\u88ab\u7ed1\u5b9a\u5230\u88ab\u7cfb\u7edf\u9694\u79bb\u7684CPU\u6838\u5fc3\u4e0a\uff0c\u5e76\u72ec\u4eab\u8be5CPU\u6838\u5fc3\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u964d\u4f4e\u7cfb\u7edf\u672c\u8eab\u548c\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8be5\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u6bd4\u5982\u63a7\u5236\u5668\u7ebf\u7a0b\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u4fdd\u969c\u5176\u5b9e\u65f6\u6027\u7684\u3002\u540c\u65f6\u4e3a\u4e86\u964d\u4f4e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0cRflyPilot\u4e5f\u5f15\u5165\u4e86\u4e00\u5957\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u7528\u4e8e\u89c4\u5b9a\u7ebf\u7a0b\u8fd0\u884c\u7684\u5148\u540e\u987a\u5e8f\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u8be5\u673a\u5236\u7684\u5f15\u5165\u5927\u5927\u63d0\u9ad8\u4e86\u72b6\u6001\u4f30\u8ba1\u4e0e\u63a7\u5236\u7684\u6027\u80fd\uff0c\u8ba9\u7cfb\u7edf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5728\u9ad8\u52a8\u6001\u7684\u5de5\u51b5\u3002","title":"2.2 \u4efb\u52a1\u8c03\u5ea6"},{"location":"introduction/sys_overview/#23","text":"\u8c03\u8bd5\u6a21\u5757\u4e3b\u8981\u5305\u62ec\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u3001\u53c2\u6570\u8bfb\u53d6\u4e0e\u5728\u7ebf\u66f4\u65b0\u529f\u80fd\u3001\u5728\u7ebf\u793a\u6ce2\u5668\u529f\u80fd\u3001\u63a7\u5236\u53f0\u529f\u80fd\u7b49\u3002\u5176\u6838\u5fc3\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u66f4\u597d\u5730\u4e86\u89e3\u98de\u884c\u5668\u7684\u98de\u884c\u72b6\u6001\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u8c03\u8bd5\u63a5\u53e3\u3002\u6240\u6709\u7684\u5728\u7ebf\u8c03\u8bd5\u529f\u80fd\u5747\u53ef\u4ee5\u901a\u8fc7\u677f\u8f7dWIFI\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u989d\u5916\u589e\u52a0\u6570\u4f20\u6a21\u5757\u3002","title":"2.3 \u8c03\u8bd5\u6a21\u5757"},{"location":"introduction/sys_overview/#24","text":"RflyPilot\u8f6f\u4ef6\u7cfb\u7edf\u5185\u90e8\u7684\u7ebf\u7a0b\u901a\u4fe1\u673a\u5236\u4e3b\u8981\u91c7\u7528\u7684\u662f\u5171\u4eab\u5185\u5b58\u7684\u5f62\u5f0f\uff0c\u6240\u6709\u6570\u636e\u4ee5\u6d88\u606f\u5f62\u5f0f\u5b58\u50a8\u5728\u7cfb\u7edf\u5185\u5b58\u4e2d\u3002\u4e3a\u907f\u514d\u540c\u65f6\u8fdb\u884c\u6d88\u606f\u8bfb\u53d6\u4e0e\u5199\u5165\u800c\u51fa\u73b0\u7684\u6570\u636e\u5f02\u5e38\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u201c\u539f\u5b50\u9501 \u201d\u8fdb\u884c\u5904\u7406\uff0c\u6700\u7ec8\u6d88\u606f\u7684\u8bfb\u53d6 read \u4e0e\u53d1\u5e03 publish \u4e92\u4e0d\u51b2\u7a81\uff0c\u4e5f\u652f\u6301\u4e00\u53d1\u591a\u6536\u7684\u901a\u4fe1\u5f62\u5f0f\u3002\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8bfb\u53d6\u5386\u53f2\u6570\u636e\uff08\u4e00\u6bb5\u65f6\u95f4\uff09\uff0c\u7528\u4e8e\u907f\u514d\u6d88\u606f\u7684\u9057\u6f0f\uff0c\u540c\u65f6\u8be5\u6d88\u606f\u7cfb\u7edf\u4e5f\u652f\u6301\u8fdb\u884c\u5373\u65f6\u7684\u6d88\u606f\u8bb0\u5f55\u3002","title":"2.4 \u901a\u4fe1\u673a\u5236"},{"location":"mpc/mpc_example/","text":"\u672c\u8282\u5c06\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5c06\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u5e94\u7528\u5728RflyPilot\u98de\u63a7\u4e2d\uff0c\u5b9e\u73b0\u56db\u65cb\u7ffc\u7684\u98de\u884c\u63a7\u5236\u3002 1 \u6a21\u578b\u9884\u6d4b\u63a7\u5236 \uf0c1 \u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08Model Predictive Control\uff0cMPC\uff09\u662f\u4e00\u79cd\u53cd\u9988\u63a7\u5236\u7b56\u7565[56]\uff0c\u5b83\u7684\u57fa\u672c\u601d\u60f3\u53ef\u4ee5\u63cf\u8ff0\u4e3a\uff1a\u9488\u5bf9\u63a7\u5236\u5bf9\u8c61\u6a21\u578b\uff0c\u5728\u67d0\u4e00\u4e2a\u91c7\u6837\u65f6\u523b\uff0c\u5229\u7528\u6d4b\u91cf\u6216\u89c2\u6d4b\u7684\u72b6\u6001\u4fe1\u606f\uff0c \u5728\u7ebf\u6c42\u89e3\u5e76\u5f97\u5230\u4e00\u4e2a\u63a7\u5236\u5e8f\u5217\uff0c\u5e76\u5c06\u8be5\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u63a7\u5236\u91cf\u4f5c\u7528\u4e8e\u63a7\u5236\u5bf9\u8c61\uff0c\u5728\u4e0b \u4e00\u4e2a\u91c7\u6837\u65f6\u523b\u5faa\u73af\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u5b9e\u73b0\u6eda\u52a8\u4f18\u5316\u3002\u56e0\u6b64\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u57fa\u672c\u7279\u5f81\u53ef\u603b\u7ed3\u4e3a\u9884 \u6d4b\u6a21\u578b\u3001\u6eda\u52a8\u4f18\u5316\u548c\u53cd\u9988\u6821\u6b63\uff0c\u5982\u56fe![MPC\u9884\u6d4b\u65f6\u57df]\u6240\u793a\u3002 1\uff09 \u9884\u6d4b\u6a21\u578b \u987e\u540d\u601d\u4e49\uff0c\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u4e00\u79cd\u57fa\u4e8e\u6a21\u578b\u7684\u63a7\u5236\u7b56\u7565\uff0c\u5728\u63a7\u5236\u8fc7\u7a0b\u4e2d\u7684\u63a7\u5236\u5bf9\u8c61\u79f0 \u4e3a\u9884\u6d4b\u6a21\u578b\u3002\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u6839\u636e\u7cfb\u7edf\u7684\u5f53\u524d\u65f6\u523b\u7684\u4fe1\u606f\uff08\u7cfb\u7edf\u72b6\u6001 x(k)\uff09\u4ee5\u53ca\u4e0b\u4e00\u65f6\u523b\u7684\u63a7\u5236\u8f93\u5165 u(k+1)\uff0c\u6765\u9884\u6d4b\u672a\u6765\u65f6\u523b\u7684\u7cfb\u7edf\u8f93\u51fa\u4fe1\u606fx(k+1)\uff0c\u540c \u65f6\u901a\u8fc7\u5c06\u7cfb\u7edf\u8f93\u51fa\u4e0e\u7cfb\u7edf\u7684\u53c2\u8003\u503c\u7684\u8bef\u5dee\u4f18\u5316\u7cfb\u7edf\u7684\u63a7\u5236\u54cd\u5e94\uff0c\u4ee5\u8fbe\u5230\u66f4\u4f18\u7684\u63a7\u5236\u6548\u679c\u3002 2\uff09 \u6eda\u52a8\u4f18\u5316 \u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u5728\u6709\u9650\u65f6\u57df\u5185\u8fdb\u884c\u9884\u6d4b\u7684\uff0c\u5e76\u4e0d\u662f\u5c06\u76ee\u6807/\u4ee3\u4ef7\u51fd\u6570\u6240\u6c42\u51fa\u7684\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u5168\u90e8\u5e94\u7528\u4e8e\u7cfb\u7edf\u63a7\u5236\uff0c\u800c\u662f\u628a\u91c7\u6837\u5468\u671f\u5185\u7684\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u5206\u91cf\u4f5c\u4e3a\u8be5\u65f6\u57df\u7684\u63a7\u5236\u8f93\u5165\u4f5c\u7528\u4e8e\u7cfb\u7edf\uff0c\u5373\u5728\u8be5\u65f6\u57df\u5185\u6301\u7eed\u6eda\u52a8\u4f18\u5316\u3002\u6eda\u52a8\u4f18\u5316\u662f\u5728 k \u6b65\u901a\u8fc7\u4ee3\u4ef7 \u51fd\u6570\u5f97\u51fa\u6700\u4f18\u63a7\u5236\u5e8f\u5217 U'(k)\uff0c\u5c06\u8be5\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u5206\u91cf u'(k)\u4f5c\u7528\u4e8e\u6a21\u578b\uff0c\u5728k+1\u6b65\uff0c\u7cfb\u7edf\u7684\u521d\u59cb\u6761\u4ef6\u66f4\u65b0\u4e3a x(k+1)\uff0c\u6b64\u65f6\u518d\u5c06\u4f18\u5316\u6c42\u89e3\u5f97\u5230\u7684\u63a7\u5236\u5e8f\u5217U'(k+1) \u7684\u7b2c\u4e00\u4e2a\u5206\u91cf u'(k+1)\u4f5c\u7528\u4e8e\u7cfb\u7edf\uff0c\u5982\u6b64\u91cd\u590d\u8fdb\u884c\u5728\u7ebf\u4f18\u5316\u6c42\u89e3\u3002 3\uff09 \u53cd\u9988\u6821\u6b63 \u4e3a\u89e3\u51b3\u7531\u4e8e\u65f6\u53d8\u3001\u975e\u7ebf\u6027\u3001\u5e72\u6270\u7b49\u56e0\u7d20\u5bfc\u81f4\u7684\u9884\u6d4b\u6a21\u578b\u548c\u5b9e\u9645\u6a21\u578b\u4e4b\u95f4\u7684\u5931\u914d\u95ee\u9898\uff0c\u9700\u8981\u5728\u63a7\u5236\u8fc7\u7a0b\u4e2d\u589e\u52a0\u53cd\u9988\u6821\u6b63\u73af\u8282\uff0c\u5373\u628a\u6d4b\u91cf\u6216\u4f30\u8ba1\u51fa\u7684\u5b9e\u9645\u7cfb\u7edf\u8f93\u51fa\u4e0e\u9884\u6d4b\u8f93\u51fa\u8fdb\u884c\u5bf9\u6bd4\u3001\u4f18\u5316\uff0c\u8fdb\u800c\u51cf\u5c11\u63a7\u5236\u8bef\u5dee\uff0c\u63d0\u9ad8\u63a7\u5236\u7cbe\u5ea6\u3002 \u5982\u56fe\u4e0b\u56fe\u6240\u793a\uff0c\u5728 t0 \u65f6\u523b\u7cfb\u7edf\u72b6\u6001\u4e3ax(0)\uff0c\u57fa\u4e8e\u5f53\u524d\u7684\u72b6\u6001\uff0c\u786e\u5b9a\u51fa\u4e00\u4e2a\u6700\u4f18\u7684\u63a7\u5236 \u5e8f\u5217\u548c\u672a\u6765\u65f6\u523b\u76f8\u5e94\u7684\u72b6\u6001\u8f68\u8ff9\uff08x(0)\u81f3\\hat{x}(1) \u6bb5\u865a\u7ebf\uff09\u3002\u6267\u884c\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5f97\u5230 k+1\u6b65\u7684\u7cfb\u7edf\u72b6\u6001x(1)\uff0c\u8be5\u72b6\u6001\u53ef\u80fd\u4e0e\u9884\u6d4b\u72b6\u6001\\hat{x}(1) \u6709\u5dee\u5f02\u3002\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u8ba1\u7b97\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u548c\u672a\u6765\u7684\u72b6\u6001\u8f68\u8ff9\u3002 \u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u95ee\u9898\u7684\u6570\u5b66\u63cf\u8ff0 \u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08Nonlinear Model Predictive Control\uff0cNMPC\uff09\u662f\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u4e00\u79cd\uff0c\u5b83\u9002\u7528\u4e8e\u975e\u7ebf\u6027\u7cfb\u7edf\uff0c\u5176\u6570\u5b66\u63cf\u8ff0\u53ef\u4ee5\u8868\u793a\u4e3a \u7cfb\u7edf\u6846\u56fe\u4e3a \u4ece\u4e0a\u8ff0\u7cfb\u7edf\u6846\u56fe\u4e2d\uff0c\u4e00\u4e2aNMPC\u6c42\u89e3\u5668\u9700\u8981\u57fa\u672c\u53c2\u6570\uff0c\u5305\u62ec\u53cd\u9988\u72b6\u6001\u3001\u53c2\u8003\u8f93\u5165\u3001\u6743\u91cd\u3001\u63a7\u5236\u91cf\u7ea6\u675f\u4ee5\u53ca\u7cfb\u7edf\u53c2\u6570\uff0c\u8f93\u51fa\u4e3a\u63a7\u5236\u91cf\u3002 2 \u52a8\u529b\u5b66\u65b9\u7a0b\u7684\u83b7\u53d6 \uf0c1 \u5229\u7528MATLAB\u7684\u7b26\u53f7\u5de5\u5177\u7bb1\uff0c\u53ef\u4ee5\u8fdb\u884c\u98de\u884c\u5668\u52a8\u529b\u5b66\u65b9\u7a0b\u7684\u63a8\u5bfc\u3002 \u5229\u7528\u5982\u4e0b\u811a\u672c \u5728RflyPilot\u7684MATLAB\u5de5\u7a0b\u4e0b RflyPilot_Model \u8fd0\u884c\u5982\u4e0b\u811a\u672c\u5373\u53ef\u5f97\u5230\u56db\u65cb\u7ffc\u98de\u884c\u5668\u7684\u52a8\u529b\u5b66\u65b9\u7a0b\u3002 syms u1 u2 u3 u4 real; % \u5b9a\u4e49\u63a7\u5236\u8f93\u5165 syms vx vy vz q0 q1 q2 q3 wbx wby wbz T1 T2 T3 T4 real; %\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 syms R h mass K_tau drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz Tm q0d q1d q2d q3d disturbance_f disturbance_p disturbance_q disturbance_r real; %\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570 addpath('mathlib'); % \u52a0\u8f7d\u6570\u5b66\u5e93 T_1 = T1; T_2 = T2; T_3 = T3; T_4 = T4; g = 9.81; k_air = diag([drag_w_x,drag_w_y,drag_w_z]); J = diag([Jxx,Jyy,Jzz]); % dx = zeros(13,1); wb = [wbx;wby;wbz]; f_1 = [0; 0; -T_1]; f_2 = [0; 0; -T_2]; f_3 = [0; 0; -T_3]; f_4 = [0; 0; -T_4]; l_1 = [R/sqrt(2); R/sqrt(2); -h]; l_2 = [-R/sqrt(2); -R/sqrt(2); -h]; l_3 = [R/sqrt(2); -R/sqrt(2); -h]; l_4 = [-R/sqrt(2); R/sqrt(2); -h]; tau_f1 = cross3(l_1, f_1);%\u8ba1\u7b97\u529b\u77e9 tau_f2 = cross3(l_2, f_2); tau_f3 = cross3(l_3, f_3); tau_f4 = cross3(l_4, f_4); M_1 = [0; 0; K_tau * T_1];%\u8ba1\u7b97\u53cd\u626d\u529b\u77e9 M_2 = [0; 0; K_tau * T_2]; M_3 = [0; 0; K_tau * -T_3]; M_4 = [0; 0; K_tau * -T_4]; % M_1 = 0; % M_2 = 0; F = f_1 + f_2 + f_3 + f_4 + [0;0;disturbance_f];%\u8ba1\u7b97\u603b\u62c9\u529b\uff08\u5305\u62ec\u6270\u52a8\uff09 % \u8ba1\u7b97\u603b\u529b\u77e9\uff08\u5305\u62ec\u6270\u52a8\u529b\u77e9\uff09 M = M_1 + M_2 + M_3 + M_4 + tau_f1 + tau_f2 + tau_f3 + tau_f4 - [disturbance_p; disturbance_p; disturbance_r]; nQb = [q0; q1; q2; q3]; %% without nQb normlized %nQb = nQb / norm(nQb); bCn = nQb2bCn(nQb); accel_n = bCn * F / mass + [0;0;g]; angular_accel = M - k_air * (wb) - skew3(wb) * (J * wb); angular_accel(1) = angular_accel(1) / J(1,1); angular_accel(2) = angular_accel(2) / J(2,2); angular_accel(3) = angular_accel(3) / J(3,3); angular_accel = simplify(angular_accel); angular_accel = vpa(angular_accel,6) accel_n = simplify(accel_n); accel_n = vpa(accel_n,6) dot_q = simplify(q_dot(wb,nQb)); dot_q = vpa(dot_q,6) dotT = [u1 - T1; u2 - T2; u3 - T3; u4 - T4] ./ Tm; dotT = vpa(dotT,6) \u7ed3\u679c\u5982\u4e0b angular_accel = -(0.5*(2.0*disturbance_p + 1.41421*R*T1 - 1.41421*R*T2 - 1.41421*R*T3 + 1.41421*R*T4 + 2.0*drag_w_x*wbx - 2.0*Jyy*wby*wbz + 2.0*Jzz*wby*wbz))/Jxx -(0.5*(2.0*disturbance_p - 1.41421*R*T1 + 1.41421*R*T2 - 1.41421*R*T3 + 1.41421*R*T4 + 2.0*drag_w_y*wby + 2.0*Jxx*wbx*wbz - 2.0*Jzz*wbx*wbz))/Jyy -(1.0*(disturbance_r + drag_w_z*wbz - 1.0*K_tau*T1 - 1.0*K_tau*T2 + K_tau*T3 + K_tau*T4 - 1.0*Jxx*wbx*wby + Jyy*wbx*wby))/Jzz accel_n = -(1.0*(2.0*q0*q2 + 2.0*q1*q3)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass ((2.0*q0*q1 - 2.0*q2*q3)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass 9.81 - (1.0*(q0^2 - 1.0*q1^2 - 1.0*q2^2 + q3^2)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass dot_q = - 0.5*q1*wbx - 0.5*q2*wby - 0.5*q3*wbz 0.5*q0*wbx - 0.5*q3*wby + 0.5*q2*wbz 0.5*q3*wbx + 0.5*q0*wby - 0.5*q1*wbz 0.5*q1*wby - 0.5*q2*wbx + 0.5*q0*wbz dotT = -(1.0*(T1 - 1.0*u1))/Tm -(1.0*(T2 - 1.0*u2))/Tm -(1.0*(T3 - 1.0*u3))/Tm -(1.0*(T4 - 1.0*u4))/Tm 2 ACADO\u7b80\u4ecb \uf0c1 \u6709\u4e86\u4ee5\u4e0a\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u7406\u8bba\u57fa\u7840\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u8bbe\u8ba1\u51fa\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u4f18\u5316\u95ee\u9898\u3002ACADO\uff08Automatic Control and Dynamic Optimization\uff09\u4f5c\u4e3a\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u81ea\u52a8\u63a7\u5236\u4e0e\u52a8\u6001\u4f18\u5316\u5de5\u5177\u5305 \uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6700\u4f18\u63a7\u5236\u95ee\u9898\u7684\u4f18\u5316\u7684\u57fa\u672c\u6846\u67b6\uff0c\u5b83\u53ef\u4ee5\u7528\u4e8e\u751f\u6210\u9ad8\u6548\u7684\u6700\u4f18\u63a7\u5236\u95ee\u9898\u6c42\u89e3\u5668\uff0c\u5982NMPC\uff0c\u5b83\u4e5f\u63d0\u4f9b\u4e86MATLAB\u4e0eC++\u4ee3\u7801\u63a5\u53e3\uff0c\u7528\u4e8e\u5d4c\u5165\u5f0f\u90e8\u7f72\u3002 \u5728RflyPilot\u4e2d\uff0cACADO\u4e3b\u8981\u7528\u4e8e\u751f\u6210NMPC\u6c42\u89e3\u5668\uff0c\u751f\u6210\u5f97\u5230\u7684C++\u4ee3\u7801\u5c06\u88ab\u7528\u4e8eSimulink\u4eff\u771f\u6a21\u578b\u4e2d\uff0c\u8fdb\u884c\u6570\u503c\u4eff\u771f\u3002\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u90e8\u7f72\u5230\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5b9e\u73b0\u5728\u7ebf\u8fd0\u884c\u3002 3 \u5229\u7528ACADO\u751f\u6210NMPC\u6c42\u89e3\u5668 \uf0c1 \u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u5229\u7528ACADO\u5b9e\u73b0NMPC\u63a7\u5236\u3002 3.1 ACADO\u7684\u5b89\u88c5 \uf0c1 \u8f6f\u4ef6\u4e0b\u8f7d git clone https://github.com/acado/acado.git -b stable ACADOtoolkit \u8f6f\u4ef6\u5b89\u88c5 \u5728MATLAB\u547d\u4ee4\u884c\u7a97\u53e3 cd ACADOtoolkit/interfaces/matlab/ make clean all \u6ce8\uff1a\u9700\u8981\u4e8b\u5148\u5b89\u88c5VS2017\u7b49\u7f16\u8bd1\u73af\u5883\u3002\u9996\u6b21\u8fd0\u884c\u9700\u8981\u8fdb\u884c make clean all \uff0c\u540e\u7eed\u4ec5\u9700\u8981\u8fd0\u884c make \u5373\u53ef\u3002 3.2 ACADO\u8bed\u6cd5 \uf0c1 \u5173\u952e\u8bcd \u89e3\u91ca \u793a\u4f8b DifferentialState \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001\u91cf\uff08\u9700\u8981\u63d0\u4f9b\u5176\u5fae\u5206\u65b9\u7a0b\uff09 DifferentialState x1 x2 x3 Control \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u7684\u63a7\u5236\u91cf\uff0c\u5373\u8981\u6c42\u89e3\u7684\u63a7\u5236\u8f93\u5165 Control u1 u2 u3 u4 OnlineData \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570\u7b49\uff0c\u53ef\u4ee5\u5728\u9884\u6d4b\u65f6\u57df\u4e2d\u52a8\u6001\u4fee\u6539 OnlineData mass Ixx Iyy Izz \u751f\u6210ACADO\u6c42\u89e3\u5668\u6b65\u9aa4 \u5229\u7528ACADO\u914d\u7f6eNMPC\u6c42\u89e3\u5668\u7684\u57fa\u672c\u6b65\u9aa4 \u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001\u3001\u63a7\u5236\u8f93\u5165\u3001\u5728\u7ebf\u53c2\u6570 \u5b9a\u4e49\u7cfb\u7edf\u5fae\u5206\u65b9\u7a0b\u3001\u8f93\u51fa\u65b9\u7a0b\u3001\u7ec8\u7aef\u8f93\u51fa\u65b9\u7a0b \u914d\u7f6e\u4f18\u5316\u95ee\u9898\u57fa\u672c\u53c2\u6570 \u914d\u7f6e\u4f18\u5316\u6c42\u89e3\u5668\u53c2\u6570 3.3 \u751f\u6210\u6c42\u89e3\u5668 \uf0c1 \u6839\u636e\u5df2\u6709\u7684\u52a8\u529b\u5b66\u65b9\u7a0b\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u5c06\u5176\u7528ACADO\u8bed\u6cd5\u8fdb\u884c\u63cf\u8ff0\uff0c\u4e0b\u9762\u63d0\u4f9b\u4e00\u4e2a\u56db\u65cb\u7ffcNMPC\u63a7\u5236\u5668\u7684\u811a\u672c\u793a\u4f8b\u3002 \u6587\u4ef6\u4f4d\u7f6e\uff1a RflyPilot_Model/MIL/quad_make_solver_vz.m clc; clear all; close all; EXPORT_MPC = 1; EXPORT_SIM = 0; DifferentialState vz q0 q1 q2 q3 wbx wby wbz T1 T2 T3 T4;%\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 Control u1 u2 u3 u4;%\u5b9a\u4e49\u63a7\u5236\u91cf OnlineData R h mass K_tau drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz Tm q0d q1d q2d q3d disturbance_f disturbance_p disturbance_q disturbance_r;%\u5b9a\u4e49\u5728\u7ebf\u53ef\u4fee\u6539\u7684\u53c2\u6570 %IntermediateState q0n q1n q2n q3n T T = T1 + T2 + T3 + T4;%\u8ba1\u7b97\u603b\u62c9\u529b q0n = q0;%\u56db\u5143\u6570\u5f52\u4e00\u5316 q1n = q1; q2n = q2; q3n = q3; % q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 % q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); mpc_equ_dynamic = [ dot(vz) == 9.81 - (q0n^2 - q1n^2 - q2n^2 + q3n^2)/mass*(T-disturbance_f);... %\u56db\u5143\u6570\u5fae\u5206\u65b9\u7a0b dot(q0) == - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz;... dot(q1) == 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz;... dot(q2) == 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz;... dot(q3) == 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz;... %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(wbx) == -(0.0625*(1.41421*T1 - 1.41421*T2 - 1.41421*T3 + 1.41421*T4 + 16.0*drag_w_x*wbx - 16.0*Jyy*wby*wbz + 16.0*Jzz*wby*wbz))/Jxx - disturbance_p/Jxx;... dot(wby) == -(0.0625*(1.41421*T2 - 1.41421*T1 - 1.41421*T3 + 1.41421*T4 + 16.0*drag_w_y*wby + 16.0*Jxx*wbx*wbz - 16.0*Jzz*wbx*wbz))/Jyy - disturbance_q/Jyy;... dot(wbz) == -(drag_w_z*wbz - K_tau*T1 - K_tau*T2 + K_tau*T3 + K_tau*T4 - Jxx*wbx*wby + Jyy*wbx*wby)/Jzz - disturbance_r/Jzz;... %\u62c9\u529b\u5fae\u5206\u65b9\u7a0b dot(T1) == -(T1 - u1)/Tm;... dot(T2) == -(T2 - u2)/Tm;... dot(T3) == -(T3 - u3)/Tm;... dot(T4) == -(T4 - u4)/Tm;... ]; Ts = 0.001;%\u79ef\u5206\u5668\u7684\u6b65\u957f % % SIMexport \u751f\u6210\u79ef\u5206\u5668 \uff08\u7528\u4e8e\u4eff\u771f\u52a8\u529b\u5b66\u6a21\u578b\uff09 acadoSet('problemname', 'sim'); sim = acado.SIMexport( Ts); sim.setModel(mpc_equ_dynamic); sim.set( 'INTEGRATOR_TYPE', 'INT_IRK_GL2' ); % sim.set( 'NUM_INTEGRATOR_STEPS', numSteps ); if EXPORT_SIM % \u8fd9\u91cc\u662f\u751f\u6210\u56db\u65cb\u7ffc\u52a8\u529b\u5b66\u6a21\u578b\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u6682\u65f6\u4e0d\u5173\u6ce8\u8fd9\u91cc\uff08\u5982\u9700\u5173\u6ce8\u53ef\u4ee5\u67e5\u770bacado\u4e2d\u7684example\u6587\u4ef6\u5939\uff09 mkdir acado_SIM addpath acado_SIM cd acado_SIM sim.exportCode( 'export_SIM' );%\u5bfc\u51fa\u4ee3\u7801 cd export_SIM make_acado_integrator('../acado_SIMstep')%\u751f\u6210mex\u6587\u4ef6 cd ../../ end %% MPCexport %\u8bbe\u7f6empc\u8f93\u51fa\u65b9\u7a0b(\u5373\u516c\u5f0f\u4e2d\u7684h()) h = [ %n\u7cfbxy\u8f74 \u52a0\u901f\u5ea6 -((2.0*q0n*q2n + 2.0*q1n*q3n)*(T-disturbance_f))/mass;... ((2.0*q0n*q1n - 2.0*q2n*q3n)*(T-disturbance_f))/mass;... %n\u7cfbz\u8f74 \u901f\u5ea6\uff0c \u66ff\u6362\u539f\u672c\u7684\u52a0\u901f\u5ea6 vz;... % 9.81 - ((T-disturbance_f)*(q0n*q0n - q1n*q1n - q2n*q2n + q3n*q3n))/mass;... %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n; %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 wbx;wby;wbz; %\u8f93\u51fa\u62c9\u529b11-14 T1;... T2;... T3;... T4;... %\u8f93\u51fa\u62c9\u529b\u53d8\u5316\u738715-18 -(T1 - u1)/Tm;... -(T2 - u2)/Tm;... -(T3 - u3)/Tm;... -(T4 - u4)/Tm;... %\u671f\u671b\u8f93\u51fa19-22 u1;... u2;... u3;... u4;... ]; hN = h(1:14);%\u7ec8\u7aef\u8f93\u51fa\uff08\u4e0d\u80fd\u5305\u62ec\u63a7\u5236\u91cf\uff09(\u5373\u516c\u5f0f\u4e2d\u7684h_N) acadoSet('problemname', 'mpc'); N = 5;%nmpc\u9884\u6d4b\u6b65\u957f Ts_mpc = 0.1;%\u6bcf\u6b65\u9884\u6d4b\u65f6\u957f %\u914d\u7f6eMPC\u95ee\u9898\u53c2\u6570 ocp = acado.OCP( 0.0, N * Ts_mpc, N ); W = acado.BMatrix(eye(length(h)));%\u5b9a\u4e49\u6743\u91cd\u77e9\u9635\u7684\u7ef4\u6570 WN = acado.BMatrix(eye(length(hN))); ocp.minimizeLSQ( W ,h);%\u8bbe\u7f6e\u5e38\u89c4\u8f93\u51fa\u6743\u91cd ocp.minimizeLSQEndTerm( WN, hN );%\u8bbe\u7f6e\u7ec8\u7aef\u9879\u6743\u91cd ocp.subjectTo( 0 <= u1 <= 8 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( 0 <= u2 <= 8 ); ocp.subjectTo( 0 <= u3 <= 8 ); ocp.subjectTo( 0 <= u4 <= 8 ); ocp.setModel(mpc_equ_dynamic); %\u914d\u7f6e\u4f18\u5316\u95ee\u9898\u8bbe\u7f6e mpc = acado.OCPexport( ocp ); mpc.set( 'HESSIAN_APPROXIMATION', 'GAUSS_NEWTON' ); mpc.set( 'DISCRETIZATION_TYPE', 'MULTIPLE_SHOOTING' ); mpc.set( 'SPARSE_QP_SOLUTION', 'FULL_CONDENSING_N2'); mpc.set( 'LEVENBERG_MARQUARDT', 1e-5 ); mpc.set( 'INTEGRATOR_TYPE', 'INT_RK4' );%\u4f7f\u7528RK4 mpc.set( 'QP_SOLVER', 'QP_QPOASES' ); mpc.set('CG_USE_OPENMP', 0); %\u5e76\u884c\u8ba1\u7b97\u52a0\u901f mpc.set('CG_HARDCODE_CONSTRAINT_VALUES', 0); %\u52a8\u6001\u7ea6\u675f mpc.set('CG_USE_VARIABLE_WEIGHTING_MATRIX', 0); mpc.set('USE_SINGLE_PRECISION', 0); %float\u7c7b\u578b if EXPORT_MPC %\u5224\u65ad\u662f\u5426\u5bfc\u51faC\u4ee3\u7801 mkdir acado_MPC addpath acado_MPC cd acado_MPC mpc.exportCode( 'export_MPC' );%\u5bfc\u51fa\u4ee3\u7801 global ACADO_; copyfile([ACADO_.pwd '/../../external_packages/qpoases'], 'export_MPC/qpoases') cd export_MPC % make_acado_solver('../acado_MPCstep')%\u7f16\u8bd1\u751f\u6210mex\u6587\u4ef6 cd ../../ end \u6ce8\uff1a\u8be5\u811a\u672c\u5e94\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\uff0c MIL \u5e94\u4ee5\u5982\u4e0b\u65b9\u5f0f\u6253\u5f00\uff0c\u8fd0\u884c\u811a\u672c\u4e4b\u524d\u5e94\u52a0\u8f7dACADO\u5de5\u5177\u7bb1 \u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u5c06\u4f1a\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u751f\u6210 acado_MPC \u6587\u4ef6\u5939\uff0c\u8be5\u6587\u4ef6\u5939\u5305\u542b\u521a\u521a\u751f\u6210\u6c42\u89e3\u5668\u6e90\u7801\uff0c\u9700\u8981\u5c06\u8be5\u76ee\u5f55\u53ca\u5176\u5b50\u6587\u4ef6\u5b50\u6587\u4ef6\u5939\u5305\u542b\u5230\u5de5\u7a0b\u8def\u5f84\u4e2d\u3002 3.4 \u6c42\u89e3\u5668\u4ee3\u7801\u89e3\u6790 \uf0c1 \u6253\u5f00 acado_MPC \u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6587\u4ef6 \u8fd9\u91cc\u53ef\u4ee5\u53ea\u5173\u6ce8 acado_common.h \u4e0e test.c \u3002 test.c \u63d0\u4f9b\u4e86\u57fa\u672c\u7684\u8c03\u7528\u793a\u4f8b\uff0c\u6c42\u89e3\u8c03\u7528\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003\u8be5\u6587\u4ef6\u3002 acado_common.h \u5b9a\u4e49\u4e86\u6c42\u89e3\u5668\u9700\u8981\u7528\u5230\u7684\u53d8\u91cf\uff0c\u8fd9\u91cc\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002 /** Number of control/estimation intervals. */ #define ACADO_N 5 //\u5b9a\u4e49\u9884\u6d4b\u6b65\u6570 /** Number of online data values. */ #define ACADO_NOD 19 //\u5b9a\u4e49\u53c2\u6570\u4e2a\u6570 \u5373 onlinedata /** Number of path constraints. */ #define ACADO_NPAC 0 /** Number of control variables. */ #define ACADO_NU 4 //\u5b9a\u4e49\u63a7\u5236\u91cf\u6570\u76ee\uff0c\u5373Control\u5b9a\u4e49\u7684\u53d8\u91cf\u4e2a\u6570 /** Number of differential variables. */ #define ACADO_NX 12 //\u7cfb\u7edf\u72b6\u6001\u53d8\u91cf\u4e2a\u6570 /** Number of algebraic variables. */ #define ACADO_NXA 0 /** Number of differential derivative variables. */ #define ACADO_NXD 0 /** Number of references/measurements per node on the first N nodes. */ #define ACADO_NY 22 //\u7cfb\u7edf\u53c2\u8003\u8f93\u5165\u4e2a\u6570 /** Number of references/measurements on the last (N + 1)st node. */ #define ACADO_NYN 14 //\u7cfb\u7edf\u7ec8\u7aef\u53c2\u8003\u8f93\u5165\u4e2a\u6570 /** Total number of QP optimization variables. */ #define ACADO_QP_NV 20 /** Number of integration steps per shooting interval. */ #define ACADO_RK_NIS 6 /** Number of Runge-Kutta stages per integration step. */ #define ACADO_RK_NSTAGES 4 /** Providing interface for arrival cost. */ #define ACADO_USE_ARRIVAL_COST 0 /** Indicator for usage of non-hard-coded linear terms in the objective. */ #define ACADO_USE_LINEAR_TERMS 0 /** Indicator for type of fixed weighting matrices. */ #define ACADO_WEIGHTING_MATRICES_TYPE 1 /* * Globally used structure definitions */ /** The structure containing the user data. * * Via this structure the user \"communicates\" with the solver code. */ typedef struct ACADOvariables_ { int dummy; /** Matrix of size: 6 x 12 (row major format) * * Matrix containing 6 differential variable vectors. */ real_t x[ 72 ]; //\u4f18\u5316\u95ee\u9898\u6c42\u89e3\u65f6\u4f7f\u7528\u7684\u7cfb\u7edf\u72b6\u6001\u5e8f\u5217 \u957f\u5ea6\u4e3a\uff08N+1\uff09* NX \uff0c\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316 /** Matrix of size: 5 x 4 (row major format) * * Matrix containing 5 control variable vectors. */ real_t u[ 20 ]; //\u63a7\u5236\u91cf\u5e8f\u5217 N * NU \uff0c\u6c42\u89e3\u5668\u8f93\u51fa /** Matrix of size: 6 x 19 (row major format) * * Matrix containing 6 online data vectors. */ real_t od[ 114 ]; //\u53c2\u6570\u4e2a\u6570 \uff08N+1\uff09* NOD \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 110 * * Matrix containing 5 reference/measurement vectors of size 22 for first 5 nodes. */ real_t y[ 110 ]; // \u53c2\u8003\u8f93\u5165\u4e2a\u6570 NY * N \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 14 * * Reference/measurement vector for the 6. node. */ real_t yN[ 14 ]; //\u7ec8\u7aef\u53c2\u8003\u8f93\u5165 NYN * 1 \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Matrix of size: 22 x 22 (row major format) */ real_t W[ 484 ]; //\u6743\u91cd\u77e9\u9635 NY * NY\uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Matrix of size: 14 x 14 (row major format) */ real_t WN[ 196 ]; //\u7ec8\u7aef\u6743\u91cd\u77e9\u9635 NYN * NYN\uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 12 * * Current state feedback vector. */ real_t x0[ 12 ]; // \u5f53\u524d\u7cfb\u7edf\u72b6\u6001 NX \uff0c \u6c42\u89e3\u5668\u8f93\u5165\uff0c\u63d0\u4f9b\u5f53\u524d\u72b6\u6001\u7684\u53cd\u9988 /** Column vector of size: 20 * * Lower bounds values. */ real_t lbValues[ 20 ]; // \u63a7\u5236\u91cf\u7ea6\u675f\u4e0b\u754c NU * N \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 20 * * Upper bounds values. */ real_t ubValues[ 20 ]; // \u63a7\u5236\u91cf\u7ea6\u675f\u4e0a\u5c4a NU * N\uff0c \u6c42\u89e3\u5668\u8f93\u5165 } ACADOvariables; \u7efc\u4e0a\uff0c\u6c42\u89e3\u5668\u7684\u8f93\u5165\u8f93\u51fa\u7ed3\u6784\u53ef\u4ee5\u603b\u7ed3\u4e3a\u5982\u4e0b\u8868 \u53d8\u91cf \u5927\u5c0f \u8f93\u5165\u8f93\u51fa x (N+1)*NX \u521d\u59cb\u5316\u65f6\u4f5c\u4e3a\u8f93\u5165 u NU*N \u6c42\u89e3\u7ed3\u679c\uff1a\u63a7\u5236\u91cf od (N+1)*NX \u8f93\u5165 y NY*N \u8f93\u5165 yN NYN \u8f93\u5165 W NY*NY \u8f93\u5165 WN NYN*NYN \u8f93\u5165 x0 NX \u8f93\u5165 lbValues NU*N \u8f93\u5165 ubValues NU*N \u8f93\u5165 3.5 Simulink\u8c03\u7528\u6c42\u89e3\u5668\u7684\u5b9e\u73b0\u539f\u7406\u4e0e\u90e8\u7f72 \uf0c1 \u5728\u6a21\u578b MPCControllerCodeGen_Vz.slx \u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 S-Function \u8c03\u7528ACADO\u751f\u6210\u7684\u6c42\u89e3\u5668\u4ee3\u7801\u3002\u53cc\u51fb\u6253\u5f00\u8be5s-function\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b \u8be5\u6587\u4ef6\u5b9a\u4e49\u4e86simulink\u8c03\u7528ACADO\u6c42\u89e3\u5668\u7684\u63a5\u53e3\uff0c\u63a5\u53e3\u7684\u8854\u63a5\u901a\u8fc7C\u8bed\u8a00\u5b8c\u6210\u3002\u4ee3\u7801\u7684\u7ec6\u8282\u8fd9\u91cc\u4e0d\u518d\u5c55\u793a\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u5176\u4e2d\u7684\u5173\u952e\u51fd\u6570 nmpc_solver_vz_Start_wrapper() \uff1a\u8be5\u51fd\u6570\u7528\u4e8e\u5bf9\u6c42\u89e3\u5668\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5728\u8be5\u63a7\u5236\u5668\u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u4ec5\u8c03\u7528\u4e00\u6b21\u3002\u8be5\u51fd\u6570\u56fa\u5316\u4e86\u6c42\u89e3\u5668\u521d\u503c\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u5224\u65ad\u76f8\u5e94\u53d8\u91cf\u521d\u503c\uff0c\u6bd4\u5982\u7cfb\u7edf\u72b6\u6001\u4e2d\u7684\u56db\u5143\u6570\u7684q0\uff0c\u5176\u503c\u4e00\u822c\u53ef\u8bbe\u7f6e\u4e3a1\uff0c\u5982\u679c\u4e3a0\uff0c\u5219\u6c42\u89e3\u5668\u53ef\u80fd\u6c42\u89e3\u51faNaN\u7684\u7ed3\u679c\u3002\u5176\u4e2d\u53d8\u91cf\u7684\u7ef4\u5ea6\u4e5f\u8981\u6839\u636e\u5b9e\u9645\u9700\u8981\u8fdb\u884c\u4fee\u6539\uff0c od \u6570\u636e\u4e5f\u65f6\u5982\u6b64\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5c06\u8fdb\u884c\u8d4b\u503c\u3002 nmpc_solver_vz_Outputs_wrapper() \uff1a\u8be5\u51fd\u6570\u7528\u4e8e\u5b8c\u6210\u4e00\u6b21\u95ee\u9898\u6c42\u89e3\uff0c\u8f93\u5165\u53c2\u6570\u5305\u62ec\u53c2\u8003\u8f93\u5165\uff0c\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\uff0c\u7cfb\u7edf\u53c2\u6570\uff0c\u6c42\u89e3\u5668\u6743\u91cd\uff0c\u63a7\u5236\u91cf\u4e0a\u4e0b\u754c\uff1b\u8f93\u51fa\u4e3a\u6307\u4ee4\u63a7\u5236\u91cf\u3002\u5176\u8f93\u5165\u8f93\u51fa\u4fe1\u53f7\u7ef4\u5ea6\u5982\u4e0b \u6ce8\uff1a\u5982\u9700\u5bf9NMPC\u95ee\u9898\u8fdb\u884c\u4fee\u6539\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u5bf9\u4e0a\u8ff0\u7aef\u53e3\u8fdb\u884c\u76f8\u5e94\u8c03\u6574\u3002\u5982\u65e0\u9700\u4fee\u6539\uff0c\u8fd9\u91cc\u53ea\u9700\u8981\u70b9\u51fb\u201cBuild\u201d\u7f16\u8bd1\u5373\u53ef\uff0c\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u5b8c\u6210Simulink\u5bf9ACADO\u6c42\u89e3\u5668\u7684\u90e8\u7f72\u3002 \u6700\u7ec8\u5f97\u5230\u7684\u6c42\u89e3\u5668\u8f93\u5165\u8f93\u51fa\u63a5\u53e3\u4e3a \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5c06\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u751f\u6210 nmpc_solver_vz.mexw64 \u6587\u4ef6\u3002 3.6 MATLAB\u811a\u672c\u8c03\u7528ACADO\u6c42\u89e3\u5668 \uf0c1 \u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u811a\u672c\uff08\u8be5\u811a\u672c\u5b9e\u73b0\u4e86\u4e00\u6b21\u5728\u9884\u6d4b\u65f6\u57df\u5185\u7684\u9884\u6d4b\uff09 \u6ce8\u610f \u6b64\u811a\u672c\u589e\u52a0\u4e86 make_acado_solver('../mpc_step') \uff0c\u7528\u4e8e\u751f\u6210\u53ef\u4ee5\u88ab\u76f4\u63a5\u8c03\u7528mex\u6587\u4ef6 \u6c42\u89e3\u5668\u751f\u6210\u811a\u672c clc; clear all; % close all; EXPORT = 1; DifferentialState vx vy vz q0n q1n q2n q3n wbx wby wbz;%\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 Control T1x T1y T1z T2x T2y T2z T3x T3y T3z T4x T4y T4z;%\u5b9a\u4e49\u63a7\u5236\u91cf OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; %IntermediateState q0n q1n q2n q3n T % q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 % q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); mpc_equ_dynamic = [%\u56db\u5143\u6570\u5fae\u5206\u65b9\u7a0b %\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(vx) == ((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1z + T2z + T3z + T4z) - 1.0*(2.0*q0n*q3n - 2.0*q1n*q2n)*(T1y + T2y + T3y + T4y) + (T1x + T2x + T3x + T4x)*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass; dot(vy) == ((2.0*q0n*q3n + 2.0*q1n*q2n)*(T1x + T2x + T3x + T4x) - 1.0*(2.0*q0n*q1n - 2.0*q2n*q3n)*(T1z + T2z + T3z + T4z) + (T1y + T2y + T3y + T4y)*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass; dot(vz) == ((2.0*q0n*q1n + 2.0*q2n*q3n)*(T1y + T2y + T3y + T4y) - 1.0*(2.0*q0n*q2n - 2.0*q1n*q3n)*(T1x + T2x + T3x + T4x) + (T1z + T2z + T3z + T4z)*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass + 9.81; %\u59ff\u6001\u5fae\u5206\u65b9\u7a0b dot(q0n) == - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz - 1.0*gain_qw*q0n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q1n) == 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz - 1.0*gain_qxyz*q1n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q2n) == 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz - 1.0*gain_qxyz*q2n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q3n) == 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz - 1.0*gain_qxyz*q3n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(wbx) == (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; dot(wby) == (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; dot(wbz) == (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; %% MPCexport %\u8bbe\u7f6empc\u8f93\u51fa\u65b9\u7a0b h = [ %n\u7cfb\u901f\u5ea6 vx; vy; vz; % %wbx;wby;wbz; % relaxed hover solution (((wbz*(2.0*q0n*q2n + 2.0*q1n*q3n))/mass - (1.0*wby*(2.0*q0n*q3n - 2.0*q1n*q2n))/mass + (wbx*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2); (((wbx*(2.0*q0n*q3n + 2.0*q1n*q2n))/mass - (1.0*wbz*(2.0*q0n*q1n - 2.0*q2n*q3n))/mass + (wby*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2); (((wby*(2.0*q0n*q1n + 2.0*q2n*q3n))/mass - (1.0*wbx*(2.0*q0n*q2n - 2.0*q1n*q3n))/mass + (wbz*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2) + 9.81; %n\u7cfb\u52a0\u901f\u5ea6 % -(1.0*((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2)) - 1.0*(dfx + T1*sin(alpha1) + T2*sin(alpha2))*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2) + dfy*(2.0*q0n*q3n - 2.0*q1n*q2n)))/mass;... % ((2.0*q0n*q1n - 2.0*q2n*q3n)*(T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2)) + (2.0*q0n*q3n + 2.0*q1n*q2n)*(dfx + T1*sin(alpha1) + T2*sin(alpha2)) + dfy*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass;... % 9.81 - (1.0*((T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2))*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2) - 1.0*dfy*(2.0*q0n*q1n + 2.0*q2n*q3n) + (2.0*q0n*q2n - 2.0*q1n*q3n)*(dfx + T1*sin(alpha1) + T2*sin(alpha2))))/mass;... %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) %q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; % q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; % q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n;... % body rate in ned frame % wbx*(q0n^2 + q1n^2 - q2n^2 - q3n^2) + wby*(2*q0n*q3n + 2*q1n*q2n) - wbz*(2*q0n*q2n - 2*q1n*q3n);... % wby*(q0n^2 - q1n^2 + q2n^2 - q3n^2) - wbx*(2*q0n*q3n - 2*q1n*q2n) + wbz*(2*q0n*q1n + 2*q2n*q3n);... % wbz*(q0n^2 - q1n^2 - q2n^2 + q3n^2) + wbx*(2*q0n*q2n + 2*q1n*q3n) - wby*(2*q0n*q1n - 2*q2n*q3n);... %n\u7cfb\u52a0\u901f\u5ea6 % -((T1*cos(alpha1) + T2*cos(alpha2))*(2.0*q0n*q2n + 2.0*q1n*q3n) - (T1*sin(alpha1) + T2*sin(alpha2))*(q0n*q0n + q1n*q1n - q2n*q2n - q3n*q3n))/mass; % ((T1*cos(alpha1) + T2*cos(alpha2))*(2.0*q0n*q1n - 2.0*q2n*q3n) + (2.0*q0n*q3n + 2.0*q1n*q2n)*(T1*sin(alpha1) + T2*sin(alpha2)))/mass; % 9.81 - (((2.0*q0n*q2n - 2.0*q1n*q3n)*(T1*sin(alpha1) + T2*sin(alpha2)) + (T1*cos(alpha1) + T2*cos(alpha2))*(q0n*q0n - q1n*q1n - q2n*q2n + q3n*q3n)))/mass; %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 %wbx;wby;wbz; %\u8f93\u51fa\u89d2\u52a0\u901f\u5ea6 (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; hN = [ %n\u7cfb\u901f\u5ea6 vx; vy; vz; %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) %q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; % q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; % q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; % q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n;... %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 % wbx;wby;wbz; ]; acadoSet('problemname', 'mpc'); %1s - 0.05 failed N = 150;%nmpc\u9884\u6d4b\u6b65\u957f %\u6bd4\u8f83\u5408\u9002\u7684\u8303\u56f4 N= 10~20 Ts = 0.1~0.05 Ts_mpc = 0.05;%\u6bcf\u6b65\u9884\u6d4b\u65f6\u957f % 10 - 0.05 ocp = acado.OCP( 0.0, N * Ts_mpc, N ); W = acado.BMatrix(eye(length(h)));%\u5b9a\u4e49\u6743\u91cd\u77e9\u9635\u7684\u7ef4\u6570 WN = acado.BMatrix(eye(length(hN))); ocp.minimizeLSQ( W ,h);%\u8bbe\u7f6e\u5e38\u89c4\u8f93\u51fa\u6743\u91cd ocp.minimizeLSQEndTerm( WN, hN );%\u8bbe\u7f6e\u7ec8\u7aef\u9879\u6743\u91cd %\u8fd9\u662f\u4e00\u4e2a\u56db\u65cb\u7ffc\uff0c\u4f46\u662f\u6bcf\u4e00\u4e2a\u65cb\u7ffc\u90fd\u63d0\u4f9b\u4e09\u7ef4\u77e2\u91cf\u7684\u529b\u8f93\u5165 ocp.subjectTo( -15 <= T1x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T1y <= 15 ); ocp.subjectTo( -15 <= T1z <= 15 ); ocp.subjectTo( -15 <= T2x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T2y <= 15 ); ocp.subjectTo( -15 <= T2z <= 15 ); ocp.subjectTo( -15 <= T3x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T3y <= 15 ); ocp.subjectTo( -15 <= T3z <= 15 ); ocp.subjectTo( -15 <= T4x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T4y <= 15 ); ocp.subjectTo( -15 <= T4z <= 15 ); ocp.setModel(mpc_equ_dynamic); mpc = acado.OCPexport( ocp ); mpc.set( 'HESSIAN_APPROXIMATION', 'GAUSS_NEWTON' ); mpc.set( 'DISCRETIZATION_TYPE', 'MULTIPLE_SHOOTING' ); mpc.set( 'SPARSE_QP_SOLUTION', 'FULL_CONDENSING_N2'); mpc.set( 'LEVENBERG_MARQUARDT', 1e-5 ); mpc.set( 'INTEGRATOR_TYPE', 'INT_RK4' ); mpc.set( 'QP_SOLVER', 'QP_QPOASES' ); mpc.set('CG_USE_OPENMP', 1); %\u5e76\u884c\u8ba1\u7b97\u52a0\u901f mpc.set('CG_HARDCODE_CONSTRAINT_VALUES', 0); %\u52a8\u6001\u7ea6\u675f mpc.set('CG_USE_VARIABLE_WEIGHTING_MATRIX', 0); mpc.set('USE_SINGLE_PRECISION', 0); %float\u7c7b\u578b if EXPORT mkdir acado_MPC addpath acado_MPC cd acado_MPC mpc.exportCode( 'export_MPC' );%\u5bfc\u51fa\u4ee3\u7801 global ACADO_; copyfile([ACADO_.pwd '/../../external_packages/qpoases'], 'export_MPC/qpoases') cd export_MPC make_acado_solver('../mpc_step')%\u7f16\u8bd1\u751f\u6210mex\u6587\u4ef6 cd ../../ end \u8fd0\u884c\u811a\u672c clear input; addpath('../mathlib'); % NOTE % \u589e\u52a0\u6267\u884c\u5668\u52a8\u6001\u4ee5\u6392\u9664\u521d\u59cb\u72b6\u6001\u7684\u5f71\u54cd % \u6267\u884c\u5668\u5e94\u8be5\u652f\u6301\u53cc\u5411\u8f93\u5165 \u00b115 %\u5b9a\u4e49\u6743\u91cd %\u5e38\u89c4\u9879\u6743\u91cd\u5747\u4e3a0 % n\u7cfb\u901f\u5ea6 n\u7cfb\u52a0\u901f\u5ea6 qz_err omega dot_actuator actuator Weight = [ 10 10 1000 0 0 0 0.00001 0.01 0.01 0.01 ]; WeightN = [ 0 0 0 ]; W = diag(Weight); WN = diag(WeightN); %N = 50; \u6b64\u5904\u7ee7\u627fbi_make_solver %W =diag(zeros(1,17)); %\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570 \u4f7f\u7528onlinedata %\u9a8c\u8bc1\u59ff\u6001\u8bef\u5dee\u7684\u8868\u73b0\u60c5\u51b5\u3002\u6b27\u62c9\u89d2 x1 = 0.12; y1 = 0.12; z1 = 0; x2 = -0.12; y2 = -0.12; z2 = 0; x3 = 0.12; y3 = -0.12; z3 = 0; x4 = -0.12; y4 = 0.12; z4 = 0; mass = 0.828; K_tau1 = 0.00778; K_tau2 = 0.00778; K_tau3 = -0.00778; K_tau4 = -0.00778; drag_w_x = 0.0032; drag_w_y = 0.0032; drag_w_z = 0.0032; Jxx = 0.0063;%0.0056 Jyy = 0.0063; Jzz = 0.012;%0.0104; % \u671f\u671b\u59ff\u6001\u4e3a0 q0d = 1; q1d = 0; q2d = 0; q3d = 0; gain_qw = 10; gain_qxyz = 10; % OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; od = [mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4]; %\u5b9a\u4e49\u521d\u59cb\u72b6\u6001 % vx vy vz q0 q1 q2 q3 wx wy wz X0 = [0 0 0 1 0 0 0 0 0 -0.1]; %\u751f\u6210onlinedata\u77e9\u9635 \u957f\u5ea6\u4e3aN+1 %N\u4e3a\u9884\u6d4b\u6b65\u957f for i=1:N+1 input.x(i,:) = X0; input.od(i,:) = od; end %\u5b9a\u4e49\u63a7\u5236\u91cf\u53c2\u8003\u8f93\u5165\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e3a0 Uref = zeros(N,12); input.u = Uref; %\u5b9a\u4e49y reference y_N = 10; yN_N = 3; input.y = zeros(N,y_N);%\u5b9a\u4e49\u8f93\u51fay\u7684\u53c2\u8003\u8f93\u5165 %input.y(:,1) = ones(N,1); input.yN = zeros(1,yN_N); % \u5b9a\u4e49\u6743\u91cd input.W = W; input.WN = WN;%diag([5e-1 1 2e-3 2e-3]); %input.shifting.strategy = 1; %\u8bbe\u7f6e\u63a7\u5236\u91cf\u7ea6\u675f\u4e0e\u4eff\u5c04\u7ea6\u675f u_N = 12; for i = 1:N input.lbValues((i-1)*u_N+1,1)=0; input.lbValues((i-1)*u_N+2,1)=0; input.lbValues((i-1)*u_N+3,1)=-15; input.lbValues((i-1)*u_N+4,1)=0;%\u5355\u65cb\u7ffc\u5b8c\u5168\u5931\u6548 input.lbValues((i-1)*u_N+5,1)=0; input.lbValues((i-1)*u_N+6,1)=0; input.lbValues((i-1)*u_N+7,1)=0; input.lbValues((i-1)*u_N+8,1)=0; input.lbValues((i-1)*u_N+9,1)=-15; input.lbValues((i-1)*u_N+10,1)=0; input.lbValues((i-1)*u_N+11,1)=0; input.lbValues((i-1)*u_N+12,1)=-15; input.ubValues((i-1)*u_N+1,1)=0; input.ubValues((i-1)*u_N+2,1)=0; input.ubValues((i-1)*u_N+3,1)=0; input.ubValues((i-1)*u_N+4,1)=0; input.ubValues((i-1)*u_N+5,1)=0; input.ubValues((i-1)*u_N+6,1)=0; input.ubValues((i-1)*u_N+7,1)=0; input.ubValues((i-1)*u_N+8,1)=0; input.ubValues((i-1)*u_N+9,1)=0; input.ubValues((i-1)*u_N+10,1)=0; input.ubValues((i-1)*u_N+11,1)=0; input.ubValues((i-1)*u_N+12,1)=0; %\u5bf9\u5e94 0 <= sqrt(Tx^2 + Ty^2 + Tz^2) <= 16 % input.lbAValues(i,1) = 1; % input.ubAValues(i,1) = 1; end input.ctrl = 0; input.initialization = 0; input.x0 = X0; output = mpc_step(input); output.info output.x output.u u_control = output.u'; % %% [m, n] = size(output.x); x_list = zeros(n,m-1); x_list(:,1) = X0; for i = 2:(m-1) x_list(:,i) = rk4_integral(x_list(:,i-1), u_control(:,i-1), od, Ts_mpc); end % %% euler = []; vel = x_list(1:3,:)'; quat = x_list(4:7,:); omega = x_list(8:10,:)'; for i = 1:(m-1) euler(i,:) = nQb2euler(quat(:,i)); end t = 0:Ts_mpc:Ts_mpc*(N-1); subplot(4,1,1) plot(t,euler,'LineWidth',2); title('euler'); xlabel('time(s)'); ylabel('angle(rad)'); legend('roll','pitch','yaw'); subplot(4,1,2); plot(t,omega,'LineWidth',2); title('omega'); xlabel('time(s)'); ylabel('angular velocity(rad/s)'); legend('\\omega_x','\\omega_y','\\omega_z'); subplot(4,1,3); plot(t,vel,'LineWidth',2); title('vel'); xlabel('time(s)'); ylabel('velocity(m/s)'); legend('v_x','v_y','v_z'); subplot(4,1,4); u_control = u_control'; plot(t,u_control(:,[3,6,9,12]),'LineWidth',2); title('thrust'); xlabel('time(s)'); ylabel('thrust(N)'); legend('T_1','T_2','T_3','T_4'); % subplot(5,1,4); % plot(u_control(1:2,:)'); % title('thrust'); % subplot(5,1,5); % plot(u_control(3:4,:)'); % title('servo'); %% addition functions function y = rk4_integral(y0,input,param,Ts) % y(:,i) = y(:,i-1) + bicopter_ode(y(:,i-1),input,param) * Ts; k1 = calc_general_state(y0,input,param); k2 = calc_general_state(y0 + Ts * k1 / 2,input,param); k3 = calc_general_state(y0 + Ts * k2 / 2,input,param); k4 = calc_general_state(y0 + Ts * k3,input,param); y = y0 + (k1 + 2 * k2 + 2 * k3 + k4) * Ts / 6; end \u88ab\u63a7\u5bf9\u8c61\u6a21\u578b calc_general_state.m function x_dot = calc_general_state(x0, u, onlineData) vx = x0(1,1); vy = x0(2,1); vz = x0(3,1); q0 = x0(4,1); q1 = x0(5,1); q2 = x0(6,1); q3 = x0(7,1); wbx = x0(8,1); wby = x0(9,1); wbz = x0(10,1); % OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; mass = onlineData(1); drag_w_x = onlineData(2); drag_w_y = onlineData(3); drag_w_z = onlineData(4); Jxx = onlineData(5); Jyy = onlineData(6); Jzz = onlineData(7); q0d = onlineData(8); q1d = onlineData(9); q2d = onlineData(10); q3d = onlineData(11); gain_qw = onlineData(12); gain_qxyz = onlineData(13); x1 = onlineData(14); y1 = onlineData(15); z1 = onlineData(16); x2 = onlineData(17); y2 = onlineData(18); z2 = onlineData(19); x3 = onlineData(20); y3 = onlineData(21); z3 = onlineData(22); x4 = onlineData(23); y4 = onlineData(24); z4 = onlineData(25); K_tau1 = onlineData(26); K_tau2 = onlineData(27); K_tau3 = onlineData(28); K_tau4 = onlineData(29); q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q0n = q0; % q1n = q1; % q2n = q2; % q3n = q3; T1x = u(1); T1y = u(2); T1z = u(3); T2x = u(4); T2y = u(5); T2z = u(6); T3x = u(7); T3y = u(8); T3z = u(9); T4x = u(10); T4y = u(11); T4z = u(12); x_dot = [ ((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1z + T2z + T3z + T4z) - 1.0*(2.0*q0n*q3n - 2.0*q1n*q2n)*(T1y + T2y + T3y + T4y) + (T1x + T2x + T3x + T4x)*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass; ((2.0*q0n*q3n + 2.0*q1n*q2n)*(T1x + T2x + T3x + T4x) - 1.0*(2.0*q0n*q1n - 2.0*q2n*q3n)*(T1z + T2z + T3z + T4z) + (T1y + T2y + T3y + T4y)*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass; ((2.0*q0n*q1n + 2.0*q2n*q3n)*(T1y + T2y + T3y + T4y) - 1.0*(2.0*q0n*q2n - 2.0*q1n*q3n)*(T1x + T2x + T3x + T4x) + (T1z + T2z + T3z + T4z)*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass + 9.81; %\u59ff\u6001\u5fae\u5206\u65b9\u7a0b - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz - 1.0*gain_qw*q0n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz - 1.0*gain_qxyz*q1n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz - 1.0*gain_qxyz*q2n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz - 1.0*gain_qxyz*q3n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; end \u53c2\u8003\u8d44\u6599 \uf0c1 https://acado.github.io/","title":"\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u5e94\u7528\u6848\u4f8b"},{"location":"mpc/mpc_example/#1","text":"\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08Model Predictive Control\uff0cMPC\uff09\u662f\u4e00\u79cd\u53cd\u9988\u63a7\u5236\u7b56\u7565[56]\uff0c\u5b83\u7684\u57fa\u672c\u601d\u60f3\u53ef\u4ee5\u63cf\u8ff0\u4e3a\uff1a\u9488\u5bf9\u63a7\u5236\u5bf9\u8c61\u6a21\u578b\uff0c\u5728\u67d0\u4e00\u4e2a\u91c7\u6837\u65f6\u523b\uff0c\u5229\u7528\u6d4b\u91cf\u6216\u89c2\u6d4b\u7684\u72b6\u6001\u4fe1\u606f\uff0c \u5728\u7ebf\u6c42\u89e3\u5e76\u5f97\u5230\u4e00\u4e2a\u63a7\u5236\u5e8f\u5217\uff0c\u5e76\u5c06\u8be5\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u63a7\u5236\u91cf\u4f5c\u7528\u4e8e\u63a7\u5236\u5bf9\u8c61\uff0c\u5728\u4e0b \u4e00\u4e2a\u91c7\u6837\u65f6\u523b\u5faa\u73af\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u5b9e\u73b0\u6eda\u52a8\u4f18\u5316\u3002\u56e0\u6b64\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u57fa\u672c\u7279\u5f81\u53ef\u603b\u7ed3\u4e3a\u9884 \u6d4b\u6a21\u578b\u3001\u6eda\u52a8\u4f18\u5316\u548c\u53cd\u9988\u6821\u6b63\uff0c\u5982\u56fe![MPC\u9884\u6d4b\u65f6\u57df]\u6240\u793a\u3002 1\uff09 \u9884\u6d4b\u6a21\u578b \u987e\u540d\u601d\u4e49\uff0c\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u4e00\u79cd\u57fa\u4e8e\u6a21\u578b\u7684\u63a7\u5236\u7b56\u7565\uff0c\u5728\u63a7\u5236\u8fc7\u7a0b\u4e2d\u7684\u63a7\u5236\u5bf9\u8c61\u79f0 \u4e3a\u9884\u6d4b\u6a21\u578b\u3002\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u6839\u636e\u7cfb\u7edf\u7684\u5f53\u524d\u65f6\u523b\u7684\u4fe1\u606f\uff08\u7cfb\u7edf\u72b6\u6001 x(k)\uff09\u4ee5\u53ca\u4e0b\u4e00\u65f6\u523b\u7684\u63a7\u5236\u8f93\u5165 u(k+1)\uff0c\u6765\u9884\u6d4b\u672a\u6765\u65f6\u523b\u7684\u7cfb\u7edf\u8f93\u51fa\u4fe1\u606fx(k+1)\uff0c\u540c \u65f6\u901a\u8fc7\u5c06\u7cfb\u7edf\u8f93\u51fa\u4e0e\u7cfb\u7edf\u7684\u53c2\u8003\u503c\u7684\u8bef\u5dee\u4f18\u5316\u7cfb\u7edf\u7684\u63a7\u5236\u54cd\u5e94\uff0c\u4ee5\u8fbe\u5230\u66f4\u4f18\u7684\u63a7\u5236\u6548\u679c\u3002 2\uff09 \u6eda\u52a8\u4f18\u5316 \u6a21\u578b\u9884\u6d4b\u63a7\u5236\u662f\u5728\u6709\u9650\u65f6\u57df\u5185\u8fdb\u884c\u9884\u6d4b\u7684\uff0c\u5e76\u4e0d\u662f\u5c06\u76ee\u6807/\u4ee3\u4ef7\u51fd\u6570\u6240\u6c42\u51fa\u7684\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u5168\u90e8\u5e94\u7528\u4e8e\u7cfb\u7edf\u63a7\u5236\uff0c\u800c\u662f\u628a\u91c7\u6837\u5468\u671f\u5185\u7684\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u5206\u91cf\u4f5c\u4e3a\u8be5\u65f6\u57df\u7684\u63a7\u5236\u8f93\u5165\u4f5c\u7528\u4e8e\u7cfb\u7edf\uff0c\u5373\u5728\u8be5\u65f6\u57df\u5185\u6301\u7eed\u6eda\u52a8\u4f18\u5316\u3002\u6eda\u52a8\u4f18\u5316\u662f\u5728 k \u6b65\u901a\u8fc7\u4ee3\u4ef7 \u51fd\u6570\u5f97\u51fa\u6700\u4f18\u63a7\u5236\u5e8f\u5217 U'(k)\uff0c\u5c06\u8be5\u63a7\u5236\u5e8f\u5217\u7684\u7b2c\u4e00\u4e2a\u5206\u91cf u'(k)\u4f5c\u7528\u4e8e\u6a21\u578b\uff0c\u5728k+1\u6b65\uff0c\u7cfb\u7edf\u7684\u521d\u59cb\u6761\u4ef6\u66f4\u65b0\u4e3a x(k+1)\uff0c\u6b64\u65f6\u518d\u5c06\u4f18\u5316\u6c42\u89e3\u5f97\u5230\u7684\u63a7\u5236\u5e8f\u5217U'(k+1) \u7684\u7b2c\u4e00\u4e2a\u5206\u91cf u'(k+1)\u4f5c\u7528\u4e8e\u7cfb\u7edf\uff0c\u5982\u6b64\u91cd\u590d\u8fdb\u884c\u5728\u7ebf\u4f18\u5316\u6c42\u89e3\u3002 3\uff09 \u53cd\u9988\u6821\u6b63 \u4e3a\u89e3\u51b3\u7531\u4e8e\u65f6\u53d8\u3001\u975e\u7ebf\u6027\u3001\u5e72\u6270\u7b49\u56e0\u7d20\u5bfc\u81f4\u7684\u9884\u6d4b\u6a21\u578b\u548c\u5b9e\u9645\u6a21\u578b\u4e4b\u95f4\u7684\u5931\u914d\u95ee\u9898\uff0c\u9700\u8981\u5728\u63a7\u5236\u8fc7\u7a0b\u4e2d\u589e\u52a0\u53cd\u9988\u6821\u6b63\u73af\u8282\uff0c\u5373\u628a\u6d4b\u91cf\u6216\u4f30\u8ba1\u51fa\u7684\u5b9e\u9645\u7cfb\u7edf\u8f93\u51fa\u4e0e\u9884\u6d4b\u8f93\u51fa\u8fdb\u884c\u5bf9\u6bd4\u3001\u4f18\u5316\uff0c\u8fdb\u800c\u51cf\u5c11\u63a7\u5236\u8bef\u5dee\uff0c\u63d0\u9ad8\u63a7\u5236\u7cbe\u5ea6\u3002 \u5982\u56fe\u4e0b\u56fe\u6240\u793a\uff0c\u5728 t0 \u65f6\u523b\u7cfb\u7edf\u72b6\u6001\u4e3ax(0)\uff0c\u57fa\u4e8e\u5f53\u524d\u7684\u72b6\u6001\uff0c\u786e\u5b9a\u51fa\u4e00\u4e2a\u6700\u4f18\u7684\u63a7\u5236 \u5e8f\u5217\u548c\u672a\u6765\u65f6\u523b\u76f8\u5e94\u7684\u72b6\u6001\u8f68\u8ff9\uff08x(0)\u81f3\\hat{x}(1) \u6bb5\u865a\u7ebf\uff09\u3002\u6267\u884c\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5f97\u5230 k+1\u6b65\u7684\u7cfb\u7edf\u72b6\u6001x(1)\uff0c\u8be5\u72b6\u6001\u53ef\u80fd\u4e0e\u9884\u6d4b\u72b6\u6001\\hat{x}(1) \u6709\u5dee\u5f02\u3002\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u8ba1\u7b97\u6700\u4f18\u63a7\u5236\u5e8f\u5217\u548c\u672a\u6765\u7684\u72b6\u6001\u8f68\u8ff9\u3002 \u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u95ee\u9898\u7684\u6570\u5b66\u63cf\u8ff0 \u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\uff08Nonlinear Model Predictive Control\uff0cNMPC\uff09\u662f\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u4e00\u79cd\uff0c\u5b83\u9002\u7528\u4e8e\u975e\u7ebf\u6027\u7cfb\u7edf\uff0c\u5176\u6570\u5b66\u63cf\u8ff0\u53ef\u4ee5\u8868\u793a\u4e3a \u7cfb\u7edf\u6846\u56fe\u4e3a \u4ece\u4e0a\u8ff0\u7cfb\u7edf\u6846\u56fe\u4e2d\uff0c\u4e00\u4e2aNMPC\u6c42\u89e3\u5668\u9700\u8981\u57fa\u672c\u53c2\u6570\uff0c\u5305\u62ec\u53cd\u9988\u72b6\u6001\u3001\u53c2\u8003\u8f93\u5165\u3001\u6743\u91cd\u3001\u63a7\u5236\u91cf\u7ea6\u675f\u4ee5\u53ca\u7cfb\u7edf\u53c2\u6570\uff0c\u8f93\u51fa\u4e3a\u63a7\u5236\u91cf\u3002","title":"1 \u6a21\u578b\u9884\u6d4b\u63a7\u5236"},{"location":"mpc/mpc_example/#2","text":"\u5229\u7528MATLAB\u7684\u7b26\u53f7\u5de5\u5177\u7bb1\uff0c\u53ef\u4ee5\u8fdb\u884c\u98de\u884c\u5668\u52a8\u529b\u5b66\u65b9\u7a0b\u7684\u63a8\u5bfc\u3002 \u5229\u7528\u5982\u4e0b\u811a\u672c \u5728RflyPilot\u7684MATLAB\u5de5\u7a0b\u4e0b RflyPilot_Model \u8fd0\u884c\u5982\u4e0b\u811a\u672c\u5373\u53ef\u5f97\u5230\u56db\u65cb\u7ffc\u98de\u884c\u5668\u7684\u52a8\u529b\u5b66\u65b9\u7a0b\u3002 syms u1 u2 u3 u4 real; % \u5b9a\u4e49\u63a7\u5236\u8f93\u5165 syms vx vy vz q0 q1 q2 q3 wbx wby wbz T1 T2 T3 T4 real; %\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 syms R h mass K_tau drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz Tm q0d q1d q2d q3d disturbance_f disturbance_p disturbance_q disturbance_r real; %\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570 addpath('mathlib'); % \u52a0\u8f7d\u6570\u5b66\u5e93 T_1 = T1; T_2 = T2; T_3 = T3; T_4 = T4; g = 9.81; k_air = diag([drag_w_x,drag_w_y,drag_w_z]); J = diag([Jxx,Jyy,Jzz]); % dx = zeros(13,1); wb = [wbx;wby;wbz]; f_1 = [0; 0; -T_1]; f_2 = [0; 0; -T_2]; f_3 = [0; 0; -T_3]; f_4 = [0; 0; -T_4]; l_1 = [R/sqrt(2); R/sqrt(2); -h]; l_2 = [-R/sqrt(2); -R/sqrt(2); -h]; l_3 = [R/sqrt(2); -R/sqrt(2); -h]; l_4 = [-R/sqrt(2); R/sqrt(2); -h]; tau_f1 = cross3(l_1, f_1);%\u8ba1\u7b97\u529b\u77e9 tau_f2 = cross3(l_2, f_2); tau_f3 = cross3(l_3, f_3); tau_f4 = cross3(l_4, f_4); M_1 = [0; 0; K_tau * T_1];%\u8ba1\u7b97\u53cd\u626d\u529b\u77e9 M_2 = [0; 0; K_tau * T_2]; M_3 = [0; 0; K_tau * -T_3]; M_4 = [0; 0; K_tau * -T_4]; % M_1 = 0; % M_2 = 0; F = f_1 + f_2 + f_3 + f_4 + [0;0;disturbance_f];%\u8ba1\u7b97\u603b\u62c9\u529b\uff08\u5305\u62ec\u6270\u52a8\uff09 % \u8ba1\u7b97\u603b\u529b\u77e9\uff08\u5305\u62ec\u6270\u52a8\u529b\u77e9\uff09 M = M_1 + M_2 + M_3 + M_4 + tau_f1 + tau_f2 + tau_f3 + tau_f4 - [disturbance_p; disturbance_p; disturbance_r]; nQb = [q0; q1; q2; q3]; %% without nQb normlized %nQb = nQb / norm(nQb); bCn = nQb2bCn(nQb); accel_n = bCn * F / mass + [0;0;g]; angular_accel = M - k_air * (wb) - skew3(wb) * (J * wb); angular_accel(1) = angular_accel(1) / J(1,1); angular_accel(2) = angular_accel(2) / J(2,2); angular_accel(3) = angular_accel(3) / J(3,3); angular_accel = simplify(angular_accel); angular_accel = vpa(angular_accel,6) accel_n = simplify(accel_n); accel_n = vpa(accel_n,6) dot_q = simplify(q_dot(wb,nQb)); dot_q = vpa(dot_q,6) dotT = [u1 - T1; u2 - T2; u3 - T3; u4 - T4] ./ Tm; dotT = vpa(dotT,6) \u7ed3\u679c\u5982\u4e0b angular_accel = -(0.5*(2.0*disturbance_p + 1.41421*R*T1 - 1.41421*R*T2 - 1.41421*R*T3 + 1.41421*R*T4 + 2.0*drag_w_x*wbx - 2.0*Jyy*wby*wbz + 2.0*Jzz*wby*wbz))/Jxx -(0.5*(2.0*disturbance_p - 1.41421*R*T1 + 1.41421*R*T2 - 1.41421*R*T3 + 1.41421*R*T4 + 2.0*drag_w_y*wby + 2.0*Jxx*wbx*wbz - 2.0*Jzz*wbx*wbz))/Jyy -(1.0*(disturbance_r + drag_w_z*wbz - 1.0*K_tau*T1 - 1.0*K_tau*T2 + K_tau*T3 + K_tau*T4 - 1.0*Jxx*wbx*wby + Jyy*wbx*wby))/Jzz accel_n = -(1.0*(2.0*q0*q2 + 2.0*q1*q3)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass ((2.0*q0*q1 - 2.0*q2*q3)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass 9.81 - (1.0*(q0^2 - 1.0*q1^2 - 1.0*q2^2 + q3^2)*(T1 + T2 + T3 + T4 - 1.0*disturbance_f))/mass dot_q = - 0.5*q1*wbx - 0.5*q2*wby - 0.5*q3*wbz 0.5*q0*wbx - 0.5*q3*wby + 0.5*q2*wbz 0.5*q3*wbx + 0.5*q0*wby - 0.5*q1*wbz 0.5*q1*wby - 0.5*q2*wbx + 0.5*q0*wbz dotT = -(1.0*(T1 - 1.0*u1))/Tm -(1.0*(T2 - 1.0*u2))/Tm -(1.0*(T3 - 1.0*u3))/Tm -(1.0*(T4 - 1.0*u4))/Tm","title":"2 \u52a8\u529b\u5b66\u65b9\u7a0b\u7684\u83b7\u53d6"},{"location":"mpc/mpc_example/#2-acado","text":"\u6709\u4e86\u4ee5\u4e0a\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u7406\u8bba\u57fa\u7840\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u8bbe\u8ba1\u51fa\u975e\u7ebf\u6027\u6a21\u578b\u9884\u6d4b\u63a7\u5236\u7684\u4f18\u5316\u95ee\u9898\u3002ACADO\uff08Automatic Control and Dynamic Optimization\uff09\u4f5c\u4e3a\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u81ea\u52a8\u63a7\u5236\u4e0e\u52a8\u6001\u4f18\u5316\u5de5\u5177\u5305 \uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6700\u4f18\u63a7\u5236\u95ee\u9898\u7684\u4f18\u5316\u7684\u57fa\u672c\u6846\u67b6\uff0c\u5b83\u53ef\u4ee5\u7528\u4e8e\u751f\u6210\u9ad8\u6548\u7684\u6700\u4f18\u63a7\u5236\u95ee\u9898\u6c42\u89e3\u5668\uff0c\u5982NMPC\uff0c\u5b83\u4e5f\u63d0\u4f9b\u4e86MATLAB\u4e0eC++\u4ee3\u7801\u63a5\u53e3\uff0c\u7528\u4e8e\u5d4c\u5165\u5f0f\u90e8\u7f72\u3002 \u5728RflyPilot\u4e2d\uff0cACADO\u4e3b\u8981\u7528\u4e8e\u751f\u6210NMPC\u6c42\u89e3\u5668\uff0c\u751f\u6210\u5f97\u5230\u7684C++\u4ee3\u7801\u5c06\u88ab\u7528\u4e8eSimulink\u4eff\u771f\u6a21\u578b\u4e2d\uff0c\u8fdb\u884c\u6570\u503c\u4eff\u771f\u3002\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u90e8\u7f72\u5230\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5b9e\u73b0\u5728\u7ebf\u8fd0\u884c\u3002","title":"2 ACADO\u7b80\u4ecb"},{"location":"mpc/mpc_example/#3-acadonmpc","text":"\u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u5229\u7528ACADO\u5b9e\u73b0NMPC\u63a7\u5236\u3002","title":"3 \u5229\u7528ACADO\u751f\u6210NMPC\u6c42\u89e3\u5668"},{"location":"mpc/mpc_example/#31-acado","text":"\u8f6f\u4ef6\u4e0b\u8f7d git clone https://github.com/acado/acado.git -b stable ACADOtoolkit \u8f6f\u4ef6\u5b89\u88c5 \u5728MATLAB\u547d\u4ee4\u884c\u7a97\u53e3 cd ACADOtoolkit/interfaces/matlab/ make clean all \u6ce8\uff1a\u9700\u8981\u4e8b\u5148\u5b89\u88c5VS2017\u7b49\u7f16\u8bd1\u73af\u5883\u3002\u9996\u6b21\u8fd0\u884c\u9700\u8981\u8fdb\u884c make clean all \uff0c\u540e\u7eed\u4ec5\u9700\u8981\u8fd0\u884c make \u5373\u53ef\u3002","title":"3.1 ACADO\u7684\u5b89\u88c5"},{"location":"mpc/mpc_example/#32-acado","text":"\u5173\u952e\u8bcd \u89e3\u91ca \u793a\u4f8b DifferentialState \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001\u91cf\uff08\u9700\u8981\u63d0\u4f9b\u5176\u5fae\u5206\u65b9\u7a0b\uff09 DifferentialState x1 x2 x3 Control \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u7684\u63a7\u5236\u91cf\uff0c\u5373\u8981\u6c42\u89e3\u7684\u63a7\u5236\u8f93\u5165 Control u1 u2 u3 u4 OnlineData \u7528\u4e8e\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570\u7b49\uff0c\u53ef\u4ee5\u5728\u9884\u6d4b\u65f6\u57df\u4e2d\u52a8\u6001\u4fee\u6539 OnlineData mass Ixx Iyy Izz \u751f\u6210ACADO\u6c42\u89e3\u5668\u6b65\u9aa4 \u5229\u7528ACADO\u914d\u7f6eNMPC\u6c42\u89e3\u5668\u7684\u57fa\u672c\u6b65\u9aa4 \u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001\u3001\u63a7\u5236\u8f93\u5165\u3001\u5728\u7ebf\u53c2\u6570 \u5b9a\u4e49\u7cfb\u7edf\u5fae\u5206\u65b9\u7a0b\u3001\u8f93\u51fa\u65b9\u7a0b\u3001\u7ec8\u7aef\u8f93\u51fa\u65b9\u7a0b \u914d\u7f6e\u4f18\u5316\u95ee\u9898\u57fa\u672c\u53c2\u6570 \u914d\u7f6e\u4f18\u5316\u6c42\u89e3\u5668\u53c2\u6570","title":"3.2 ACADO\u8bed\u6cd5"},{"location":"mpc/mpc_example/#33","text":"\u6839\u636e\u5df2\u6709\u7684\u52a8\u529b\u5b66\u65b9\u7a0b\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u5c06\u5176\u7528ACADO\u8bed\u6cd5\u8fdb\u884c\u63cf\u8ff0\uff0c\u4e0b\u9762\u63d0\u4f9b\u4e00\u4e2a\u56db\u65cb\u7ffcNMPC\u63a7\u5236\u5668\u7684\u811a\u672c\u793a\u4f8b\u3002 \u6587\u4ef6\u4f4d\u7f6e\uff1a RflyPilot_Model/MIL/quad_make_solver_vz.m clc; clear all; close all; EXPORT_MPC = 1; EXPORT_SIM = 0; DifferentialState vz q0 q1 q2 q3 wbx wby wbz T1 T2 T3 T4;%\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 Control u1 u2 u3 u4;%\u5b9a\u4e49\u63a7\u5236\u91cf OnlineData R h mass K_tau drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz Tm q0d q1d q2d q3d disturbance_f disturbance_p disturbance_q disturbance_r;%\u5b9a\u4e49\u5728\u7ebf\u53ef\u4fee\u6539\u7684\u53c2\u6570 %IntermediateState q0n q1n q2n q3n T T = T1 + T2 + T3 + T4;%\u8ba1\u7b97\u603b\u62c9\u529b q0n = q0;%\u56db\u5143\u6570\u5f52\u4e00\u5316 q1n = q1; q2n = q2; q3n = q3; % q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 % q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); mpc_equ_dynamic = [ dot(vz) == 9.81 - (q0n^2 - q1n^2 - q2n^2 + q3n^2)/mass*(T-disturbance_f);... %\u56db\u5143\u6570\u5fae\u5206\u65b9\u7a0b dot(q0) == - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz;... dot(q1) == 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz;... dot(q2) == 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz;... dot(q3) == 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz;... %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(wbx) == -(0.0625*(1.41421*T1 - 1.41421*T2 - 1.41421*T3 + 1.41421*T4 + 16.0*drag_w_x*wbx - 16.0*Jyy*wby*wbz + 16.0*Jzz*wby*wbz))/Jxx - disturbance_p/Jxx;... dot(wby) == -(0.0625*(1.41421*T2 - 1.41421*T1 - 1.41421*T3 + 1.41421*T4 + 16.0*drag_w_y*wby + 16.0*Jxx*wbx*wbz - 16.0*Jzz*wbx*wbz))/Jyy - disturbance_q/Jyy;... dot(wbz) == -(drag_w_z*wbz - K_tau*T1 - K_tau*T2 + K_tau*T3 + K_tau*T4 - Jxx*wbx*wby + Jyy*wbx*wby)/Jzz - disturbance_r/Jzz;... %\u62c9\u529b\u5fae\u5206\u65b9\u7a0b dot(T1) == -(T1 - u1)/Tm;... dot(T2) == -(T2 - u2)/Tm;... dot(T3) == -(T3 - u3)/Tm;... dot(T4) == -(T4 - u4)/Tm;... ]; Ts = 0.001;%\u79ef\u5206\u5668\u7684\u6b65\u957f % % SIMexport \u751f\u6210\u79ef\u5206\u5668 \uff08\u7528\u4e8e\u4eff\u771f\u52a8\u529b\u5b66\u6a21\u578b\uff09 acadoSet('problemname', 'sim'); sim = acado.SIMexport( Ts); sim.setModel(mpc_equ_dynamic); sim.set( 'INTEGRATOR_TYPE', 'INT_IRK_GL2' ); % sim.set( 'NUM_INTEGRATOR_STEPS', numSteps ); if EXPORT_SIM % \u8fd9\u91cc\u662f\u751f\u6210\u56db\u65cb\u7ffc\u52a8\u529b\u5b66\u6a21\u578b\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u6682\u65f6\u4e0d\u5173\u6ce8\u8fd9\u91cc\uff08\u5982\u9700\u5173\u6ce8\u53ef\u4ee5\u67e5\u770bacado\u4e2d\u7684example\u6587\u4ef6\u5939\uff09 mkdir acado_SIM addpath acado_SIM cd acado_SIM sim.exportCode( 'export_SIM' );%\u5bfc\u51fa\u4ee3\u7801 cd export_SIM make_acado_integrator('../acado_SIMstep')%\u751f\u6210mex\u6587\u4ef6 cd ../../ end %% MPCexport %\u8bbe\u7f6empc\u8f93\u51fa\u65b9\u7a0b(\u5373\u516c\u5f0f\u4e2d\u7684h()) h = [ %n\u7cfbxy\u8f74 \u52a0\u901f\u5ea6 -((2.0*q0n*q2n + 2.0*q1n*q3n)*(T-disturbance_f))/mass;... ((2.0*q0n*q1n - 2.0*q2n*q3n)*(T-disturbance_f))/mass;... %n\u7cfbz\u8f74 \u901f\u5ea6\uff0c \u66ff\u6362\u539f\u672c\u7684\u52a0\u901f\u5ea6 vz;... % 9.81 - ((T-disturbance_f)*(q0n*q0n - q1n*q1n - q2n*q2n + q3n*q3n))/mass;... %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n; %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 wbx;wby;wbz; %\u8f93\u51fa\u62c9\u529b11-14 T1;... T2;... T3;... T4;... %\u8f93\u51fa\u62c9\u529b\u53d8\u5316\u738715-18 -(T1 - u1)/Tm;... -(T2 - u2)/Tm;... -(T3 - u3)/Tm;... -(T4 - u4)/Tm;... %\u671f\u671b\u8f93\u51fa19-22 u1;... u2;... u3;... u4;... ]; hN = h(1:14);%\u7ec8\u7aef\u8f93\u51fa\uff08\u4e0d\u80fd\u5305\u62ec\u63a7\u5236\u91cf\uff09(\u5373\u516c\u5f0f\u4e2d\u7684h_N) acadoSet('problemname', 'mpc'); N = 5;%nmpc\u9884\u6d4b\u6b65\u957f Ts_mpc = 0.1;%\u6bcf\u6b65\u9884\u6d4b\u65f6\u957f %\u914d\u7f6eMPC\u95ee\u9898\u53c2\u6570 ocp = acado.OCP( 0.0, N * Ts_mpc, N ); W = acado.BMatrix(eye(length(h)));%\u5b9a\u4e49\u6743\u91cd\u77e9\u9635\u7684\u7ef4\u6570 WN = acado.BMatrix(eye(length(hN))); ocp.minimizeLSQ( W ,h);%\u8bbe\u7f6e\u5e38\u89c4\u8f93\u51fa\u6743\u91cd ocp.minimizeLSQEndTerm( WN, hN );%\u8bbe\u7f6e\u7ec8\u7aef\u9879\u6743\u91cd ocp.subjectTo( 0 <= u1 <= 8 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( 0 <= u2 <= 8 ); ocp.subjectTo( 0 <= u3 <= 8 ); ocp.subjectTo( 0 <= u4 <= 8 ); ocp.setModel(mpc_equ_dynamic); %\u914d\u7f6e\u4f18\u5316\u95ee\u9898\u8bbe\u7f6e mpc = acado.OCPexport( ocp ); mpc.set( 'HESSIAN_APPROXIMATION', 'GAUSS_NEWTON' ); mpc.set( 'DISCRETIZATION_TYPE', 'MULTIPLE_SHOOTING' ); mpc.set( 'SPARSE_QP_SOLUTION', 'FULL_CONDENSING_N2'); mpc.set( 'LEVENBERG_MARQUARDT', 1e-5 ); mpc.set( 'INTEGRATOR_TYPE', 'INT_RK4' );%\u4f7f\u7528RK4 mpc.set( 'QP_SOLVER', 'QP_QPOASES' ); mpc.set('CG_USE_OPENMP', 0); %\u5e76\u884c\u8ba1\u7b97\u52a0\u901f mpc.set('CG_HARDCODE_CONSTRAINT_VALUES', 0); %\u52a8\u6001\u7ea6\u675f mpc.set('CG_USE_VARIABLE_WEIGHTING_MATRIX', 0); mpc.set('USE_SINGLE_PRECISION', 0); %float\u7c7b\u578b if EXPORT_MPC %\u5224\u65ad\u662f\u5426\u5bfc\u51faC\u4ee3\u7801 mkdir acado_MPC addpath acado_MPC cd acado_MPC mpc.exportCode( 'export_MPC' );%\u5bfc\u51fa\u4ee3\u7801 global ACADO_; copyfile([ACADO_.pwd '/../../external_packages/qpoases'], 'export_MPC/qpoases') cd export_MPC % make_acado_solver('../acado_MPCstep')%\u7f16\u8bd1\u751f\u6210mex\u6587\u4ef6 cd ../../ end \u6ce8\uff1a\u8be5\u811a\u672c\u5e94\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\uff0c MIL \u5e94\u4ee5\u5982\u4e0b\u65b9\u5f0f\u6253\u5f00\uff0c\u8fd0\u884c\u811a\u672c\u4e4b\u524d\u5e94\u52a0\u8f7dACADO\u5de5\u5177\u7bb1 \u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u5c06\u4f1a\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u751f\u6210 acado_MPC \u6587\u4ef6\u5939\uff0c\u8be5\u6587\u4ef6\u5939\u5305\u542b\u521a\u521a\u751f\u6210\u6c42\u89e3\u5668\u6e90\u7801\uff0c\u9700\u8981\u5c06\u8be5\u76ee\u5f55\u53ca\u5176\u5b50\u6587\u4ef6\u5b50\u6587\u4ef6\u5939\u5305\u542b\u5230\u5de5\u7a0b\u8def\u5f84\u4e2d\u3002","title":"3.3 \u751f\u6210\u6c42\u89e3\u5668"},{"location":"mpc/mpc_example/#34","text":"\u6253\u5f00 acado_MPC \u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6587\u4ef6 \u8fd9\u91cc\u53ef\u4ee5\u53ea\u5173\u6ce8 acado_common.h \u4e0e test.c \u3002 test.c \u63d0\u4f9b\u4e86\u57fa\u672c\u7684\u8c03\u7528\u793a\u4f8b\uff0c\u6c42\u89e3\u8c03\u7528\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003\u8be5\u6587\u4ef6\u3002 acado_common.h \u5b9a\u4e49\u4e86\u6c42\u89e3\u5668\u9700\u8981\u7528\u5230\u7684\u53d8\u91cf\uff0c\u8fd9\u91cc\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002 /** Number of control/estimation intervals. */ #define ACADO_N 5 //\u5b9a\u4e49\u9884\u6d4b\u6b65\u6570 /** Number of online data values. */ #define ACADO_NOD 19 //\u5b9a\u4e49\u53c2\u6570\u4e2a\u6570 \u5373 onlinedata /** Number of path constraints. */ #define ACADO_NPAC 0 /** Number of control variables. */ #define ACADO_NU 4 //\u5b9a\u4e49\u63a7\u5236\u91cf\u6570\u76ee\uff0c\u5373Control\u5b9a\u4e49\u7684\u53d8\u91cf\u4e2a\u6570 /** Number of differential variables. */ #define ACADO_NX 12 //\u7cfb\u7edf\u72b6\u6001\u53d8\u91cf\u4e2a\u6570 /** Number of algebraic variables. */ #define ACADO_NXA 0 /** Number of differential derivative variables. */ #define ACADO_NXD 0 /** Number of references/measurements per node on the first N nodes. */ #define ACADO_NY 22 //\u7cfb\u7edf\u53c2\u8003\u8f93\u5165\u4e2a\u6570 /** Number of references/measurements on the last (N + 1)st node. */ #define ACADO_NYN 14 //\u7cfb\u7edf\u7ec8\u7aef\u53c2\u8003\u8f93\u5165\u4e2a\u6570 /** Total number of QP optimization variables. */ #define ACADO_QP_NV 20 /** Number of integration steps per shooting interval. */ #define ACADO_RK_NIS 6 /** Number of Runge-Kutta stages per integration step. */ #define ACADO_RK_NSTAGES 4 /** Providing interface for arrival cost. */ #define ACADO_USE_ARRIVAL_COST 0 /** Indicator for usage of non-hard-coded linear terms in the objective. */ #define ACADO_USE_LINEAR_TERMS 0 /** Indicator for type of fixed weighting matrices. */ #define ACADO_WEIGHTING_MATRICES_TYPE 1 /* * Globally used structure definitions */ /** The structure containing the user data. * * Via this structure the user \"communicates\" with the solver code. */ typedef struct ACADOvariables_ { int dummy; /** Matrix of size: 6 x 12 (row major format) * * Matrix containing 6 differential variable vectors. */ real_t x[ 72 ]; //\u4f18\u5316\u95ee\u9898\u6c42\u89e3\u65f6\u4f7f\u7528\u7684\u7cfb\u7edf\u72b6\u6001\u5e8f\u5217 \u957f\u5ea6\u4e3a\uff08N+1\uff09* NX \uff0c\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316 /** Matrix of size: 5 x 4 (row major format) * * Matrix containing 5 control variable vectors. */ real_t u[ 20 ]; //\u63a7\u5236\u91cf\u5e8f\u5217 N * NU \uff0c\u6c42\u89e3\u5668\u8f93\u51fa /** Matrix of size: 6 x 19 (row major format) * * Matrix containing 6 online data vectors. */ real_t od[ 114 ]; //\u53c2\u6570\u4e2a\u6570 \uff08N+1\uff09* NOD \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 110 * * Matrix containing 5 reference/measurement vectors of size 22 for first 5 nodes. */ real_t y[ 110 ]; // \u53c2\u8003\u8f93\u5165\u4e2a\u6570 NY * N \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 14 * * Reference/measurement vector for the 6. node. */ real_t yN[ 14 ]; //\u7ec8\u7aef\u53c2\u8003\u8f93\u5165 NYN * 1 \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Matrix of size: 22 x 22 (row major format) */ real_t W[ 484 ]; //\u6743\u91cd\u77e9\u9635 NY * NY\uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Matrix of size: 14 x 14 (row major format) */ real_t WN[ 196 ]; //\u7ec8\u7aef\u6743\u91cd\u77e9\u9635 NYN * NYN\uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 12 * * Current state feedback vector. */ real_t x0[ 12 ]; // \u5f53\u524d\u7cfb\u7edf\u72b6\u6001 NX \uff0c \u6c42\u89e3\u5668\u8f93\u5165\uff0c\u63d0\u4f9b\u5f53\u524d\u72b6\u6001\u7684\u53cd\u9988 /** Column vector of size: 20 * * Lower bounds values. */ real_t lbValues[ 20 ]; // \u63a7\u5236\u91cf\u7ea6\u675f\u4e0b\u754c NU * N \uff0c \u6c42\u89e3\u5668\u8f93\u5165 /** Column vector of size: 20 * * Upper bounds values. */ real_t ubValues[ 20 ]; // \u63a7\u5236\u91cf\u7ea6\u675f\u4e0a\u5c4a NU * N\uff0c \u6c42\u89e3\u5668\u8f93\u5165 } ACADOvariables; \u7efc\u4e0a\uff0c\u6c42\u89e3\u5668\u7684\u8f93\u5165\u8f93\u51fa\u7ed3\u6784\u53ef\u4ee5\u603b\u7ed3\u4e3a\u5982\u4e0b\u8868 \u53d8\u91cf \u5927\u5c0f \u8f93\u5165\u8f93\u51fa x (N+1)*NX \u521d\u59cb\u5316\u65f6\u4f5c\u4e3a\u8f93\u5165 u NU*N \u6c42\u89e3\u7ed3\u679c\uff1a\u63a7\u5236\u91cf od (N+1)*NX \u8f93\u5165 y NY*N \u8f93\u5165 yN NYN \u8f93\u5165 W NY*NY \u8f93\u5165 WN NYN*NYN \u8f93\u5165 x0 NX \u8f93\u5165 lbValues NU*N \u8f93\u5165 ubValues NU*N \u8f93\u5165","title":"3.4 \u6c42\u89e3\u5668\u4ee3\u7801\u89e3\u6790"},{"location":"mpc/mpc_example/#35-simulink","text":"\u5728\u6a21\u578b MPCControllerCodeGen_Vz.slx \u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 S-Function \u8c03\u7528ACADO\u751f\u6210\u7684\u6c42\u89e3\u5668\u4ee3\u7801\u3002\u53cc\u51fb\u6253\u5f00\u8be5s-function\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b \u8be5\u6587\u4ef6\u5b9a\u4e49\u4e86simulink\u8c03\u7528ACADO\u6c42\u89e3\u5668\u7684\u63a5\u53e3\uff0c\u63a5\u53e3\u7684\u8854\u63a5\u901a\u8fc7C\u8bed\u8a00\u5b8c\u6210\u3002\u4ee3\u7801\u7684\u7ec6\u8282\u8fd9\u91cc\u4e0d\u518d\u5c55\u793a\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u5176\u4e2d\u7684\u5173\u952e\u51fd\u6570 nmpc_solver_vz_Start_wrapper() \uff1a\u8be5\u51fd\u6570\u7528\u4e8e\u5bf9\u6c42\u89e3\u5668\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5728\u8be5\u63a7\u5236\u5668\u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u4ec5\u8c03\u7528\u4e00\u6b21\u3002\u8be5\u51fd\u6570\u56fa\u5316\u4e86\u6c42\u89e3\u5668\u521d\u503c\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u5224\u65ad\u76f8\u5e94\u53d8\u91cf\u521d\u503c\uff0c\u6bd4\u5982\u7cfb\u7edf\u72b6\u6001\u4e2d\u7684\u56db\u5143\u6570\u7684q0\uff0c\u5176\u503c\u4e00\u822c\u53ef\u8bbe\u7f6e\u4e3a1\uff0c\u5982\u679c\u4e3a0\uff0c\u5219\u6c42\u89e3\u5668\u53ef\u80fd\u6c42\u89e3\u51faNaN\u7684\u7ed3\u679c\u3002\u5176\u4e2d\u53d8\u91cf\u7684\u7ef4\u5ea6\u4e5f\u8981\u6839\u636e\u5b9e\u9645\u9700\u8981\u8fdb\u884c\u4fee\u6539\uff0c od \u6570\u636e\u4e5f\u65f6\u5982\u6b64\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5c06\u8fdb\u884c\u8d4b\u503c\u3002 nmpc_solver_vz_Outputs_wrapper() \uff1a\u8be5\u51fd\u6570\u7528\u4e8e\u5b8c\u6210\u4e00\u6b21\u95ee\u9898\u6c42\u89e3\uff0c\u8f93\u5165\u53c2\u6570\u5305\u62ec\u53c2\u8003\u8f93\u5165\uff0c\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\uff0c\u7cfb\u7edf\u53c2\u6570\uff0c\u6c42\u89e3\u5668\u6743\u91cd\uff0c\u63a7\u5236\u91cf\u4e0a\u4e0b\u754c\uff1b\u8f93\u51fa\u4e3a\u6307\u4ee4\u63a7\u5236\u91cf\u3002\u5176\u8f93\u5165\u8f93\u51fa\u4fe1\u53f7\u7ef4\u5ea6\u5982\u4e0b \u6ce8\uff1a\u5982\u9700\u5bf9NMPC\u95ee\u9898\u8fdb\u884c\u4fee\u6539\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u5bf9\u4e0a\u8ff0\u7aef\u53e3\u8fdb\u884c\u76f8\u5e94\u8c03\u6574\u3002\u5982\u65e0\u9700\u4fee\u6539\uff0c\u8fd9\u91cc\u53ea\u9700\u8981\u70b9\u51fb\u201cBuild\u201d\u7f16\u8bd1\u5373\u53ef\uff0c\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u5b8c\u6210Simulink\u5bf9ACADO\u6c42\u89e3\u5668\u7684\u90e8\u7f72\u3002 \u6700\u7ec8\u5f97\u5230\u7684\u6c42\u89e3\u5668\u8f93\u5165\u8f93\u51fa\u63a5\u53e3\u4e3a \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5c06\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u751f\u6210 nmpc_solver_vz.mexw64 \u6587\u4ef6\u3002","title":"3.5 Simulink\u8c03\u7528\u6c42\u89e3\u5668\u7684\u5b9e\u73b0\u539f\u7406\u4e0e\u90e8\u7f72"},{"location":"mpc/mpc_example/#36-matlabacado","text":"\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u811a\u672c\uff08\u8be5\u811a\u672c\u5b9e\u73b0\u4e86\u4e00\u6b21\u5728\u9884\u6d4b\u65f6\u57df\u5185\u7684\u9884\u6d4b\uff09 \u6ce8\u610f \u6b64\u811a\u672c\u589e\u52a0\u4e86 make_acado_solver('../mpc_step') \uff0c\u7528\u4e8e\u751f\u6210\u53ef\u4ee5\u88ab\u76f4\u63a5\u8c03\u7528mex\u6587\u4ef6 \u6c42\u89e3\u5668\u751f\u6210\u811a\u672c clc; clear all; % close all; EXPORT = 1; DifferentialState vx vy vz q0n q1n q2n q3n wbx wby wbz;%\u5b9a\u4e49\u7cfb\u7edf\u72b6\u6001 Control T1x T1y T1z T2x T2y T2z T3x T3y T3z T4x T4y T4z;%\u5b9a\u4e49\u63a7\u5236\u91cf OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; %IntermediateState q0n q1n q2n q3n T % q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 % q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); mpc_equ_dynamic = [%\u56db\u5143\u6570\u5fae\u5206\u65b9\u7a0b %\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(vx) == ((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1z + T2z + T3z + T4z) - 1.0*(2.0*q0n*q3n - 2.0*q1n*q2n)*(T1y + T2y + T3y + T4y) + (T1x + T2x + T3x + T4x)*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass; dot(vy) == ((2.0*q0n*q3n + 2.0*q1n*q2n)*(T1x + T2x + T3x + T4x) - 1.0*(2.0*q0n*q1n - 2.0*q2n*q3n)*(T1z + T2z + T3z + T4z) + (T1y + T2y + T3y + T4y)*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass; dot(vz) == ((2.0*q0n*q1n + 2.0*q2n*q3n)*(T1y + T2y + T3y + T4y) - 1.0*(2.0*q0n*q2n - 2.0*q1n*q3n)*(T1x + T2x + T3x + T4x) + (T1z + T2z + T3z + T4z)*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass + 9.81; %\u59ff\u6001\u5fae\u5206\u65b9\u7a0b dot(q0n) == - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz - 1.0*gain_qw*q0n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q1n) == 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz - 1.0*gain_qxyz*q1n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q2n) == 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz - 1.0*gain_qxyz*q2n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); dot(q3n) == 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz - 1.0*gain_qxyz*q3n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b dot(wbx) == (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; dot(wby) == (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; dot(wbz) == (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; %% MPCexport %\u8bbe\u7f6empc\u8f93\u51fa\u65b9\u7a0b h = [ %n\u7cfb\u901f\u5ea6 vx; vy; vz; % %wbx;wby;wbz; % relaxed hover solution (((wbz*(2.0*q0n*q2n + 2.0*q1n*q3n))/mass - (1.0*wby*(2.0*q0n*q3n - 2.0*q1n*q2n))/mass + (wbx*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2); (((wbx*(2.0*q0n*q3n + 2.0*q1n*q2n))/mass - (1.0*wbz*(2.0*q0n*q1n - 2.0*q2n*q3n))/mass + (wby*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2); (((wby*(2.0*q0n*q1n + 2.0*q2n*q3n))/mass - (1.0*wbx*(2.0*q0n*q2n - 2.0*q1n*q3n))/mass + (wbz*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass)*(wbx*(T1x + T2x + T3x + T4x) + wby*(T1y + T2y + T3y + T4y) + wbz*(T1z + T2z + T3z + T4z)))/(wbx^2 + wby^2 + wbz^2) + 9.81; %n\u7cfb\u52a0\u901f\u5ea6 % -(1.0*((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2)) - 1.0*(dfx + T1*sin(alpha1) + T2*sin(alpha2))*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2) + dfy*(2.0*q0n*q3n - 2.0*q1n*q2n)))/mass;... % ((2.0*q0n*q1n - 2.0*q2n*q3n)*(T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2)) + (2.0*q0n*q3n + 2.0*q1n*q2n)*(dfx + T1*sin(alpha1) + T2*sin(alpha2)) + dfy*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass;... % 9.81 - (1.0*((T1*cos(alpha1) - 1.0*dfz + T2*cos(alpha2))*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2) - 1.0*dfy*(2.0*q0n*q1n + 2.0*q2n*q3n) + (2.0*q0n*q2n - 2.0*q1n*q3n)*(dfx + T1*sin(alpha1) + T2*sin(alpha2))))/mass;... %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) %q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; % q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; % q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n;... % body rate in ned frame % wbx*(q0n^2 + q1n^2 - q2n^2 - q3n^2) + wby*(2*q0n*q3n + 2*q1n*q2n) - wbz*(2*q0n*q2n - 2*q1n*q3n);... % wby*(q0n^2 - q1n^2 + q2n^2 - q3n^2) - wbx*(2*q0n*q3n - 2*q1n*q2n) + wbz*(2*q0n*q1n + 2*q2n*q3n);... % wbz*(q0n^2 - q1n^2 - q2n^2 + q3n^2) + wbx*(2*q0n*q2n + 2*q1n*q3n) - wby*(2*q0n*q1n - 2*q2n*q3n);... %n\u7cfb\u52a0\u901f\u5ea6 % -((T1*cos(alpha1) + T2*cos(alpha2))*(2.0*q0n*q2n + 2.0*q1n*q3n) - (T1*sin(alpha1) + T2*sin(alpha2))*(q0n*q0n + q1n*q1n - q2n*q2n - q3n*q3n))/mass; % ((T1*cos(alpha1) + T2*cos(alpha2))*(2.0*q0n*q1n - 2.0*q2n*q3n) + (2.0*q0n*q3n + 2.0*q1n*q2n)*(T1*sin(alpha1) + T2*sin(alpha2)))/mass; % 9.81 - (((2.0*q0n*q2n - 2.0*q1n*q3n)*(T1*sin(alpha1) + T2*sin(alpha2)) + (T1*cos(alpha1) + T2*cos(alpha2))*(q0n*q0n - q1n*q1n - q2n*q2n + q3n*q3n)))/mass; %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 %wbx;wby;wbz; %\u8f93\u51fa\u89d2\u52a0\u901f\u5ea6 (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; hN = [ %n\u7cfb\u901f\u5ea6 vx; vy; vz; %\u56db\u5143\u6570\u8bef\u5dee \u671f\u671b\u4e3aq0d q1d q2d q3d %qmul(inv(q),qd) %q0d*q0n + q1d*q1n + q2d*q2n + q3d*q3n; % q1d*q0n - q0d*q1n + q2d*q3n - q3d*q2n; % q2d*q0n - q0d*q2n - q1d*q3n + q3d*q1n; % q1d*q2n - q0d*q3n - q2d*q1n + q3d*q0n;... %\u8f93\u51fabody\u7cfb\u89d2\u901f\u5ea6 % wbx;wby;wbz; ]; acadoSet('problemname', 'mpc'); %1s - 0.05 failed N = 150;%nmpc\u9884\u6d4b\u6b65\u957f %\u6bd4\u8f83\u5408\u9002\u7684\u8303\u56f4 N= 10~20 Ts = 0.1~0.05 Ts_mpc = 0.05;%\u6bcf\u6b65\u9884\u6d4b\u65f6\u957f % 10 - 0.05 ocp = acado.OCP( 0.0, N * Ts_mpc, N ); W = acado.BMatrix(eye(length(h)));%\u5b9a\u4e49\u6743\u91cd\u77e9\u9635\u7684\u7ef4\u6570 WN = acado.BMatrix(eye(length(hN))); ocp.minimizeLSQ( W ,h);%\u8bbe\u7f6e\u5e38\u89c4\u8f93\u51fa\u6743\u91cd ocp.minimizeLSQEndTerm( WN, hN );%\u8bbe\u7f6e\u7ec8\u7aef\u9879\u6743\u91cd %\u8fd9\u662f\u4e00\u4e2a\u56db\u65cb\u7ffc\uff0c\u4f46\u662f\u6bcf\u4e00\u4e2a\u65cb\u7ffc\u90fd\u63d0\u4f9b\u4e09\u7ef4\u77e2\u91cf\u7684\u529b\u8f93\u5165 ocp.subjectTo( -15 <= T1x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T1y <= 15 ); ocp.subjectTo( -15 <= T1z <= 15 ); ocp.subjectTo( -15 <= T2x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T2y <= 15 ); ocp.subjectTo( -15 <= T2z <= 15 ); ocp.subjectTo( -15 <= T3x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T3y <= 15 ); ocp.subjectTo( -15 <= T3z <= 15 ); ocp.subjectTo( -15 <= T4x <= 15 );%\u63a7\u5236\u91cf\u7ea6\u675f ocp.subjectTo( -15 <= T4y <= 15 ); ocp.subjectTo( -15 <= T4z <= 15 ); ocp.setModel(mpc_equ_dynamic); mpc = acado.OCPexport( ocp ); mpc.set( 'HESSIAN_APPROXIMATION', 'GAUSS_NEWTON' ); mpc.set( 'DISCRETIZATION_TYPE', 'MULTIPLE_SHOOTING' ); mpc.set( 'SPARSE_QP_SOLUTION', 'FULL_CONDENSING_N2'); mpc.set( 'LEVENBERG_MARQUARDT', 1e-5 ); mpc.set( 'INTEGRATOR_TYPE', 'INT_RK4' ); mpc.set( 'QP_SOLVER', 'QP_QPOASES' ); mpc.set('CG_USE_OPENMP', 1); %\u5e76\u884c\u8ba1\u7b97\u52a0\u901f mpc.set('CG_HARDCODE_CONSTRAINT_VALUES', 0); %\u52a8\u6001\u7ea6\u675f mpc.set('CG_USE_VARIABLE_WEIGHTING_MATRIX', 0); mpc.set('USE_SINGLE_PRECISION', 0); %float\u7c7b\u578b if EXPORT mkdir acado_MPC addpath acado_MPC cd acado_MPC mpc.exportCode( 'export_MPC' );%\u5bfc\u51fa\u4ee3\u7801 global ACADO_; copyfile([ACADO_.pwd '/../../external_packages/qpoases'], 'export_MPC/qpoases') cd export_MPC make_acado_solver('../mpc_step')%\u7f16\u8bd1\u751f\u6210mex\u6587\u4ef6 cd ../../ end \u8fd0\u884c\u811a\u672c clear input; addpath('../mathlib'); % NOTE % \u589e\u52a0\u6267\u884c\u5668\u52a8\u6001\u4ee5\u6392\u9664\u521d\u59cb\u72b6\u6001\u7684\u5f71\u54cd % \u6267\u884c\u5668\u5e94\u8be5\u652f\u6301\u53cc\u5411\u8f93\u5165 \u00b115 %\u5b9a\u4e49\u6743\u91cd %\u5e38\u89c4\u9879\u6743\u91cd\u5747\u4e3a0 % n\u7cfb\u901f\u5ea6 n\u7cfb\u52a0\u901f\u5ea6 qz_err omega dot_actuator actuator Weight = [ 10 10 1000 0 0 0 0.00001 0.01 0.01 0.01 ]; WeightN = [ 0 0 0 ]; W = diag(Weight); WN = diag(WeightN); %N = 50; \u6b64\u5904\u7ee7\u627fbi_make_solver %W =diag(zeros(1,17)); %\u5b9a\u4e49\u7cfb\u7edf\u53c2\u6570 \u4f7f\u7528onlinedata %\u9a8c\u8bc1\u59ff\u6001\u8bef\u5dee\u7684\u8868\u73b0\u60c5\u51b5\u3002\u6b27\u62c9\u89d2 x1 = 0.12; y1 = 0.12; z1 = 0; x2 = -0.12; y2 = -0.12; z2 = 0; x3 = 0.12; y3 = -0.12; z3 = 0; x4 = -0.12; y4 = 0.12; z4 = 0; mass = 0.828; K_tau1 = 0.00778; K_tau2 = 0.00778; K_tau3 = -0.00778; K_tau4 = -0.00778; drag_w_x = 0.0032; drag_w_y = 0.0032; drag_w_z = 0.0032; Jxx = 0.0063;%0.0056 Jyy = 0.0063; Jzz = 0.012;%0.0104; % \u671f\u671b\u59ff\u6001\u4e3a0 q0d = 1; q1d = 0; q2d = 0; q3d = 0; gain_qw = 10; gain_qxyz = 10; % OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; od = [mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4]; %\u5b9a\u4e49\u521d\u59cb\u72b6\u6001 % vx vy vz q0 q1 q2 q3 wx wy wz X0 = [0 0 0 1 0 0 0 0 0 -0.1]; %\u751f\u6210onlinedata\u77e9\u9635 \u957f\u5ea6\u4e3aN+1 %N\u4e3a\u9884\u6d4b\u6b65\u957f for i=1:N+1 input.x(i,:) = X0; input.od(i,:) = od; end %\u5b9a\u4e49\u63a7\u5236\u91cf\u53c2\u8003\u8f93\u5165\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e3a0 Uref = zeros(N,12); input.u = Uref; %\u5b9a\u4e49y reference y_N = 10; yN_N = 3; input.y = zeros(N,y_N);%\u5b9a\u4e49\u8f93\u51fay\u7684\u53c2\u8003\u8f93\u5165 %input.y(:,1) = ones(N,1); input.yN = zeros(1,yN_N); % \u5b9a\u4e49\u6743\u91cd input.W = W; input.WN = WN;%diag([5e-1 1 2e-3 2e-3]); %input.shifting.strategy = 1; %\u8bbe\u7f6e\u63a7\u5236\u91cf\u7ea6\u675f\u4e0e\u4eff\u5c04\u7ea6\u675f u_N = 12; for i = 1:N input.lbValues((i-1)*u_N+1,1)=0; input.lbValues((i-1)*u_N+2,1)=0; input.lbValues((i-1)*u_N+3,1)=-15; input.lbValues((i-1)*u_N+4,1)=0;%\u5355\u65cb\u7ffc\u5b8c\u5168\u5931\u6548 input.lbValues((i-1)*u_N+5,1)=0; input.lbValues((i-1)*u_N+6,1)=0; input.lbValues((i-1)*u_N+7,1)=0; input.lbValues((i-1)*u_N+8,1)=0; input.lbValues((i-1)*u_N+9,1)=-15; input.lbValues((i-1)*u_N+10,1)=0; input.lbValues((i-1)*u_N+11,1)=0; input.lbValues((i-1)*u_N+12,1)=-15; input.ubValues((i-1)*u_N+1,1)=0; input.ubValues((i-1)*u_N+2,1)=0; input.ubValues((i-1)*u_N+3,1)=0; input.ubValues((i-1)*u_N+4,1)=0; input.ubValues((i-1)*u_N+5,1)=0; input.ubValues((i-1)*u_N+6,1)=0; input.ubValues((i-1)*u_N+7,1)=0; input.ubValues((i-1)*u_N+8,1)=0; input.ubValues((i-1)*u_N+9,1)=0; input.ubValues((i-1)*u_N+10,1)=0; input.ubValues((i-1)*u_N+11,1)=0; input.ubValues((i-1)*u_N+12,1)=0; %\u5bf9\u5e94 0 <= sqrt(Tx^2 + Ty^2 + Tz^2) <= 16 % input.lbAValues(i,1) = 1; % input.ubAValues(i,1) = 1; end input.ctrl = 0; input.initialization = 0; input.x0 = X0; output = mpc_step(input); output.info output.x output.u u_control = output.u'; % %% [m, n] = size(output.x); x_list = zeros(n,m-1); x_list(:,1) = X0; for i = 2:(m-1) x_list(:,i) = rk4_integral(x_list(:,i-1), u_control(:,i-1), od, Ts_mpc); end % %% euler = []; vel = x_list(1:3,:)'; quat = x_list(4:7,:); omega = x_list(8:10,:)'; for i = 1:(m-1) euler(i,:) = nQb2euler(quat(:,i)); end t = 0:Ts_mpc:Ts_mpc*(N-1); subplot(4,1,1) plot(t,euler,'LineWidth',2); title('euler'); xlabel('time(s)'); ylabel('angle(rad)'); legend('roll','pitch','yaw'); subplot(4,1,2); plot(t,omega,'LineWidth',2); title('omega'); xlabel('time(s)'); ylabel('angular velocity(rad/s)'); legend('\\omega_x','\\omega_y','\\omega_z'); subplot(4,1,3); plot(t,vel,'LineWidth',2); title('vel'); xlabel('time(s)'); ylabel('velocity(m/s)'); legend('v_x','v_y','v_z'); subplot(4,1,4); u_control = u_control'; plot(t,u_control(:,[3,6,9,12]),'LineWidth',2); title('thrust'); xlabel('time(s)'); ylabel('thrust(N)'); legend('T_1','T_2','T_3','T_4'); % subplot(5,1,4); % plot(u_control(1:2,:)'); % title('thrust'); % subplot(5,1,5); % plot(u_control(3:4,:)'); % title('servo'); %% addition functions function y = rk4_integral(y0,input,param,Ts) % y(:,i) = y(:,i-1) + bicopter_ode(y(:,i-1),input,param) * Ts; k1 = calc_general_state(y0,input,param); k2 = calc_general_state(y0 + Ts * k1 / 2,input,param); k3 = calc_general_state(y0 + Ts * k2 / 2,input,param); k4 = calc_general_state(y0 + Ts * k3,input,param); y = y0 + (k1 + 2 * k2 + 2 * k3 + k4) * Ts / 6; end \u88ab\u63a7\u5bf9\u8c61\u6a21\u578b calc_general_state.m function x_dot = calc_general_state(x0, u, onlineData) vx = x0(1,1); vy = x0(2,1); vz = x0(3,1); q0 = x0(4,1); q1 = x0(5,1); q2 = x0(6,1); q3 = x0(7,1); wbx = x0(8,1); wby = x0(9,1); wbz = x0(10,1); % OnlineData mass drag_w_x drag_w_y drag_w_z Jxx Jyy Jzz q0d q1d q2d q3d gain_qw gain_qxyz x1 y1 z1 x2 y2 z2 x3 y3 z3 x4 y4 z4 K_tau1 K_tau2 K_tau3 K_tau4; mass = onlineData(1); drag_w_x = onlineData(2); drag_w_y = onlineData(3); drag_w_z = onlineData(4); Jxx = onlineData(5); Jyy = onlineData(6); Jzz = onlineData(7); q0d = onlineData(8); q1d = onlineData(9); q2d = onlineData(10); q3d = onlineData(11); gain_qw = onlineData(12); gain_qxyz = onlineData(13); x1 = onlineData(14); y1 = onlineData(15); z1 = onlineData(16); x2 = onlineData(17); y2 = onlineData(18); z2 = onlineData(19); x3 = onlineData(20); y3 = onlineData(21); z3 = onlineData(22); x4 = onlineData(23); y4 = onlineData(24); z4 = onlineData(25); K_tau1 = onlineData(26); K_tau2 = onlineData(27); K_tau3 = onlineData(28); K_tau4 = onlineData(29); q0n = q0 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3);%\u56db\u5143\u6570\u5f52\u4e00\u5316 q1n = q1 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); q2n = q2 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); q3n = q3 / sqrt(q0*q0 + q1*q1 + q2*q2 + q3*q3); % q0n = q0; % q1n = q1; % q2n = q2; % q3n = q3; T1x = u(1); T1y = u(2); T1z = u(3); T2x = u(4); T2y = u(5); T2z = u(6); T3x = u(7); T3y = u(8); T3z = u(9); T4x = u(10); T4y = u(11); T4z = u(12); x_dot = [ ((2.0*q0n*q2n + 2.0*q1n*q3n)*(T1z + T2z + T3z + T4z) - 1.0*(2.0*q0n*q3n - 2.0*q1n*q2n)*(T1y + T2y + T3y + T4y) + (T1x + T2x + T3x + T4x)*(q0n^2 + q1n^2 - 1.0*q2n^2 - 1.0*q3n^2))/mass; ((2.0*q0n*q3n + 2.0*q1n*q2n)*(T1x + T2x + T3x + T4x) - 1.0*(2.0*q0n*q1n - 2.0*q2n*q3n)*(T1z + T2z + T3z + T4z) + (T1y + T2y + T3y + T4y)*(q0n^2 - 1.0*q1n^2 + q2n^2 - 1.0*q3n^2))/mass; ((2.0*q0n*q1n + 2.0*q2n*q3n)*(T1y + T2y + T3y + T4y) - 1.0*(2.0*q0n*q2n - 2.0*q1n*q3n)*(T1x + T2x + T3x + T4x) + (T1z + T2z + T3z + T4z)*(q0n^2 - 1.0*q1n^2 - 1.0*q2n^2 + q3n^2))/mass + 9.81; %\u59ff\u6001\u5fae\u5206\u65b9\u7a0b - 0.5*q1n*wbx - 0.5*q2n*wby - 0.5*q3n*wbz - 1.0*gain_qw*q0n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q0n*wbx - 0.5*q3n*wby + 0.5*q2n*wbz - 1.0*gain_qxyz*q1n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q3n*wbx + 0.5*q0n*wby - 0.5*q1n*wbz - 1.0*gain_qxyz*q2n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); 0.5*q1n*wby - 0.5*q2n*wbx + 0.5*q0n*wbz - 1.0*gain_qxyz*q3n*(q0n^2 + q1n^2 + q2n^2 + q3n^2 - 1.0); %\u89d2\u901f\u5ea6\u5fae\u5206\u65b9\u7a0b (T1z*y1 + T2z*y2 + T3z*y3 + T4z*y4 - 1.0*T1y*z1 - 1.0*T2y*z2 - 1.0*T3y*z3 - 1.0*T4y*z4 - 1.0*drag_w_x*wbx + K_tau1*T1x + K_tau2*T2x + K_tau3*T3x + K_tau4*T4x + Jyy*wby*wbz - 1.0*Jzz*wby*wbz)/Jxx; (T1x*z1 - 1.0*T2z*x2 - 1.0*T3z*x3 - 1.0*T4z*x4 - 1.0*T1z*x1 + T2x*z2 + T3x*z3 + T4x*z4 - 1.0*drag_w_y*wby + K_tau1*T1y + K_tau2*T2y + K_tau3*T3y + K_tau4*T4y - 1.0*Jxx*wbx*wbz + Jzz*wbx*wbz)/Jyy; (T1y*x1 + T2y*x2 + T3y*x3 + T4y*x4 - 1.0*T1x*y1 - 1.0*T2x*y2 - 1.0*T3x*y3 - 1.0*T4x*y4 - 1.0*drag_w_z*wbz + K_tau1*T1z + K_tau2*T2z + K_tau3*T3z + K_tau4*T4z + Jxx*wbx*wby - 1.0*Jyy*wbx*wby)/Jzz; ]; end","title":"3.6 MATLAB\u811a\u672c\u8c03\u7528ACADO\u6c42\u89e3\u5668"},{"location":"mpc/mpc_example/#_1","text":"https://acado.github.io/","title":"\u53c2\u8003\u8d44\u6599"},{"location":"others/help/","text":"\u5982\u4f55\u8d21\u732e\u6587\u6863 \uf0c1 \u76f8\u5173\u5185\u5bb9\u8bf7\u53c2\u8003 https://rflybuaa.github.io/RflySimRTDoc/help/readme/ \u5982\u4f55\u751f\u6210PDF \uf0c1 \u76f8\u5173\u5185\u5bb9\u8bf7\u53c2\u8003 https://pypi.org/project/mkdocs-with-pdf/ \u3002 Tip \u4f7f\u7528 mkdocs-with-pdf \u63d2\u4ef6\u9700\u8981\u63d0\u524d\u5b89\u88c5weasyprint\u3002\u5728\u5b89\u88c5weasyprint\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b89\u88c5 GTK3.x \u3002\u5728\u5b89\u88c5GTK3.x\u65f6\uff0c\u63a8\u8350\u4f7f\u7528\u9ed8\u8ba4\u7684\u5b89\u88c5\u9009\u9879\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u91cd\u542f\uff08\u4f7f\u73af\u5883\u53d8\u91cf\u751f\u6548\uff09\u3002 \u5b89\u88c5weasyprint: python -m pip install weasyprint \u542f\u7528pdf\u751f\u6210\uff0c\u4fee\u6539 mkdocs.yml \u3002 plugins: - search - autorefs # - git-latest-changes #\u5c55\u793a\u6700\u8fd1\u4e00\u6b21\u66f4\u65b0\u7684\u53d8\u5316 # - git-latest-release - mkdocs-video: is_video: true video_autoplay: false - resize-images: source-dir: img-large target-dir: img enable_cache: True size: [400, 400] extensions: ['.jpg', '.jpeg', '.png', '.svg'] - with-pdf: verbose: true \u7136\u540e\u6267\u884c\u547d\u4ee4 mkdocs build \uff0c\u968f\u540e\u5c06\u5728 site/pdf \u6587\u4ef6\u5939\u4e2d\u751f\u6210PDF\u6587\u4ef6\u3002 Tip \u5efa\u8bae\u5728\u751f\u6210pdf\u540e\uff0c\u53d6\u6d88\u6539\u63d2\u4ef6\u8bbe\u7f6e\u3002","title":"Contribute"},{"location":"others/help/#_1","text":"\u76f8\u5173\u5185\u5bb9\u8bf7\u53c2\u8003 https://rflybuaa.github.io/RflySimRTDoc/help/readme/","title":"\u5982\u4f55\u8d21\u732e\u6587\u6863"},{"location":"others/help/#pdf","text":"\u76f8\u5173\u5185\u5bb9\u8bf7\u53c2\u8003 https://pypi.org/project/mkdocs-with-pdf/ \u3002 Tip \u4f7f\u7528 mkdocs-with-pdf \u63d2\u4ef6\u9700\u8981\u63d0\u524d\u5b89\u88c5weasyprint\u3002\u5728\u5b89\u88c5weasyprint\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b89\u88c5 GTK3.x \u3002\u5728\u5b89\u88c5GTK3.x\u65f6\uff0c\u63a8\u8350\u4f7f\u7528\u9ed8\u8ba4\u7684\u5b89\u88c5\u9009\u9879\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u91cd\u542f\uff08\u4f7f\u73af\u5883\u53d8\u91cf\u751f\u6548\uff09\u3002 \u5b89\u88c5weasyprint: python -m pip install weasyprint \u542f\u7528pdf\u751f\u6210\uff0c\u4fee\u6539 mkdocs.yml \u3002 plugins: - search - autorefs # - git-latest-changes #\u5c55\u793a\u6700\u8fd1\u4e00\u6b21\u66f4\u65b0\u7684\u53d8\u5316 # - git-latest-release - mkdocs-video: is_video: true video_autoplay: false - resize-images: source-dir: img-large target-dir: img enable_cache: True size: [400, 400] extensions: ['.jpg', '.jpeg', '.png', '.svg'] - with-pdf: verbose: true \u7136\u540e\u6267\u884c\u547d\u4ee4 mkdocs build \uff0c\u968f\u540e\u5c06\u5728 site/pdf \u6587\u4ef6\u5939\u4e2d\u751f\u6210PDF\u6587\u4ef6\u3002 Tip \u5efa\u8bae\u5728\u751f\u6210pdf\u540e\uff0c\u53d6\u6d88\u6539\u63d2\u4ef6\u8bbe\u7f6e\u3002","title":"\u5982\u4f55\u751f\u6210PDF"},{"location":"quick_start/env_install/","text":"Quick Start \uf0c1 \u8fd9\u90e8\u5206\u5185\u5bb9\u7684\u4e3b\u8981\u76ee\u7684\u662f\u642d\u5efa\u8d77RflyPilot\u5f00\u53d1\u73af\u5883 0 \u786c\u4ef6\u4e0e\u8f6f\u4ef6\u51c6\u5907 \uf0c1 RflyPilot\u98de\u63a7 \u88c5\u6709WSL\u4e0eMATLAB2022B\u7684Windows\u7535\u8111 1 RflyPilot\u7cfb\u7edf\u914d\u7f6e \uf0c1 1.1 \u6811\u8393\u6d3e\u56fa\u4ef6\u51c6\u5907 \uf0c1 RflyPilot\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u662fnavio2\u3002 navio2 \u63d0\u4f9b\u7684\u56fa\u4ef6(\u542b\u5b9e\u65f6\u8865\u4e0132\u4f4d), Download , \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177 Etcher \u5b89\u88c5. 1.2 \u56fa\u4ef6\u4e0b\u8f7d \uf0c1 RflyPilot\u91c7\u7528\u7684\u662f\u6811\u8393\u6d3eCM4\u6838\u5fc3\u677f\uff0c\u4e0e\u6811\u8393\u6d3e4B\u6807\u51c6\u7248\u4e0d\u540c\uff0c\u5b83\u4e0d\u5305\u542bSD\u5361\u69fd\uff0c\u6838\u5fc3\u677f\u4e0a\u9ed8\u8ba4\u88c5\u6709EMMC\u5b58\u50a8\u82af\u7247\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u6811\u8393\u6d3e\u56fa\u4ef6\u4e0b\u8f7d\u5230EMMC\u4e2d\u3002\u5728\u6811\u8393\u6d3e4B\u4e2d\u53ef\u4ee5\u7528SD\u5361\u8bfb\u5361\u5668\u5bf9\u6811\u8393\u6d3e\u56fa\u4ef6\u8fdb\u884c\u4e0b\u8f7d\uff0c\u5c06\u56fa\u4ef6\u5199\u5165\u5230SD\u5361\u4e2d\uff0c\u5bf9\u4e8e\u6811\u8393\u6d3eCM4\u800c\u8a00\uff0c\u7531\u4e8e\u5b58\u50a8\u82af\u7247\u65e0\u6cd5\u62c6\u5378\uff0c\u9700\u8981\u4fee\u6539\u6811\u8393\u6d3eCM4\u7684\u542f\u52a8\u6a21\u5f0f\uff0c\u4ee4\u5176\u5728\u7535\u8111\u4e0a\u8bc6\u522b\u4e3aU\u76d8\u8bbe\u5907\uff0c\u5373\u53ef\u5b89\u88c5\u5e38\u89c4\u65b9\u6cd5\u8fdb\u884c\u56fa\u4ef6\u4e0b\u8f7d\u3002 1.2.1 \u6811\u8393\u6d3e\u542f\u52a8\u6a21\u5f0f \uf0c1 \u6807\u53f7 \u5f00\u5173 OFF ON 1 BOOT \u4ece\u5185\u90e8\u5b58\u50a8\u542f\u52a8 \u8bc6\u522b\u4e3aU\u76d8 2 DAT(GPIO25) \u98de\u63a7\u7a0b\u5e8f\u5f00\u673a\u81ea\u542f* \u53d6\u6d88\u81ea\u542f 3 SW SBUS\u534f\u8bae IBUS\u534f\u8bae \u6ce8\u610f \u98de\u63a7\u7a0b\u5e8f\u5f00\u673a\u81ea\u542f\u529f\u80fd\u76ee\u524d\u5e76\u672a\u5b9e\u73b0 1.2.2 RflyPilot\u56fa\u4ef6\u4e0b\u8f7d \uf0c1 \u9996\u5148\u9700\u8981\u5b89\u88c5\u9a71\u52a8\u7a0b\u5e8f\uff0c rpiboot \uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u8fd0\u884c rpiboot.exe \uff0c\u7136\u540e\u5c06\u5c06RflyPilot\u62e8\u7801\u5f00\u5173\u7684 BOOT \u952e\u62e8\u4e3a ON \uff0c\u5373\u8bc6\u522b\u4e3aU\u76d8\u3002\u901a\u8fc7USB\u7ebf\u8fde\u63a5\u5230\u7535\u8111\u3002 \u6ce8\u610f \u6b64\u65f6\u4e0d\u80fd\u5c06\u98de\u63a7\u8fde\u63a5\u5230\u98de\u673a\u4e0a\uff0c\u4ee5\u514d\u51fa\u73b0\u4fe1\u53f7\u5f02\u5e38\u73b0\u8c61 \u7a0d\u7b49\u4e00\u4f1a\u513f\uff0c\u4fbf\u4f1a\u770b\u5230\u5982\u4e0b\u754c\u9762 \u6700\u540e\u53ef\u4ee5\u770b\u5230\u65b0\u589e\u7684\u4e24\u4e2a\u78c1\u76d8 2. \u6811\u8393\u6d3e\u88ab\u8bc6\u522b\u6210U\u76d8\u540e\uff0c\u5176\u7cfb\u7edf\u70e7\u5199\u6b65\u9aa4\u4e0eSD\u5361\u70e7\u5199\u65b9\u6848\u65e0\u5f02\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u8fd9\u91cc\u6211\u4eec\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f navio2 \u7684\u7cfb\u7edf\u955c\u50cf\uff0c\u8be5\u955c\u50cf\u5177\u6709\u5b9e\u65f6\u8865\u4e01\uff0c\u53ef\u4ee5\u4e00\u5b9a\u7a0b\u5ea6\u63d0\u9ad8\u7cfb\u7edf\u5b9e\u65f6\u6027\u3002 1.3 \u7cfb\u7edf\u914d\u7f6e \uf0c1 \u5728\u56fa\u4ef6\u70e7\u5199\u5b8c\u6210\u540e\uff0c\u8fd8\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884cRflyPilot\u8f6f\u4ef6\u7a0b\u5e8f\uff0c\u9700\u8981\u5bf9\u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\u3002\u5982WIFI\u3001SSH\u3001\u5f15\u5bfc\u7a0b\u5e8f\u7b49\u3002\u8fd9\u90e8\u5206\u4fee\u6539\u53ef\u4ee5\u76f4\u63a5\u5728U\u76d8\u6a21\u5f0f\u4e0b\u5b8c\u6210\u3002 1.3.1 \u914d\u7f6e /boot/config.txt \uf0c1 [all] # enable sc16is752 overlay dtoverlay=sc16is752-spi1 # enable I2C-1 and set the frequency to 400KHz # enable spidev0.0 dtparam=spi=on # enable RC input enable_uart=1 #init_uart_clock=80000000 #dtoverlay=uart2 #dtoverlay=uart3 #dtoverlay=uart4 ! uart4 conflict with spi0.0 #dtoverlay=uart5 # enable I2C-0 dtparam=i2c_vc=on,i2c_vc_baudrate=1000000 dtparam=i2c_arm=on,i2c_arm_baudrate=1000000 # switch Bluetooth to miniuart dtoverlay=miniuart-bt [cm4] force_turbo=1 core_freq=500 core_freq_min=500 arm_freq=1800 arm_freq_min=1500 start_x=0 # usb otg host mode dtoverlay=dwc2,dr_mode=host Tip \u8fd9\u91cc\u5c06usb\u53e3\u8bbe\u7f6e\u6210\u4e86host\u6a21\u5f0f\uff0c\u5982\u9700\u8981\u5229\u7528\u6811\u8393\u6d3e\u7684USB\u53e3\u7ed9\u5176\u4ed6\u8bbe\u5907\u4f9b\u7535\uff0c\u9700\u8981\u77ed\u63a5\u98de\u63a7\u677f\u4e0a\u7684D1\u4e8c\u6781\u7ba1\u4ee5\u4fdd\u969c\u98de\u63a7\u53ef\u4ee5\u4e3aUSB\u8bbe\u5907\u4f9b\u7535\u3002 Tip \u6d4b\u8bd5\u6838\u5fc3\u9891\u7387 vcgencmd measure_clock arm 1.3.2 \u914d\u7f6e /boot/cmdline.txt \uf0c1 dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait isolcpus=2,3 \u6ce8\u610f \u8fd9\u91cc isocpus=2,3 \u7684\u610f\u601d\u662f\u9694\u79bbCPU2\u4e0eCPU3\uff0c\u5373\u7cfb\u7edf\u9ed8\u8ba4\u4e0d\u4f1a\u4f7f\u7528\u8fd9\u4e24\u4e2a\u6838\u5fc3\uff0c\u8fd9\u4e24\u4e2a\u6838\u5fc3\u5c06\u4e3b\u8981\u88ab\u7528\u4e8e\u8fd0\u884c\u98de\u63a7\u7cfb\u7edf\u3002\u5f53\u524d\u7684\u6811\u8393\u6d3eCM4\uff0c\u4e00\u51714\u4e2aCPU\u6838\u5fc3\uff0c\u5206\u522b\u662fCPU0\\CPU1\\CPU2\\CPU3\u3002 \u5982\u679c\u662fRpi\u5b98\u65b9\u7cfb\u7edf root=/dev/mmcblk0p2 \u7684\u5185\u5bb9\u53ef\u80fd\u6bcf\u6b21\u5237\u56fa\u4ef6\u90fd\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4e5f\u53ef\u80fd\u548c\u7cfb\u7edf\u7248\u672c\u6709\u5173\u7cfb\uff0c\u7b14\u8005\u8fd9\u91cc\u6ca1\u6709\u6df1\u5165\u4e86\u89e3\u3002 1.3.3 \u914d\u7f6e /boot/wpa_supplication.conf \uf0c1 country=CN ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev update_config=1 network={ ssid=\"xxx\" psk=\"XXXXXXXX\" } Tip \u6b64\u5904\u4e3aWIFI\u8bbe\u7f6e\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u914d\u7f6e\uff0cRflyPilot\u5c06\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u8fde\u63a5\u8be5WIFI\u3002 1.3.4 \u914d\u7f6eSSH \uf0c1 \u5728 boot \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u53d6\u4e3a ssh \u5373\u53ef\uff0c\u6b64\u65f6\u7cfb\u7edf\u5c06\u9ed8\u8ba4\u5728\u5f00\u59cb\u65f6\u542f\u52a8SSH\u670d\u52a1\u3002 \u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u4e86RflyPilot\u98de\u63a7\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u914d\u7f6e\u3002 \u6ce8\u610f \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u5e94\u5c06 BOOT \u5f00\u5173\u62e8\u56de OFF \uff0c\u4ee5\u4ece\u5185\u90e8\u5b58\u50a8\u542f\u52a8\u7cfb\u7edf\u3002 1.4 \u6811\u8393\u6d3e\u64cd\u4f5c\u7cfb\u7edf\u7684\u4f7f\u7528 \uf0c1 \u672c\u5c0f\u8282\u4e3b\u8981\u4ecb\u7ecd\u6811\u8393\u6d3e\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5\u4e0e\u5e38\u7528\u6307\u4ee4\u3002 \u6811\u8393\u6d3e\u4e0a\u7535\u4e4b\u540e\u7b49\u5f85\u4e00\u4f1a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u98de\u63a7\u7684\u9ec4\u8272\u6307\u793a\u706f(ACTION)\u4f1a\u95ea\u70c1\uff0c\u8868\u793a\u7cfb\u7edf\u6b63\u5728\u6267\u884c\u67d0\u4e9b\u4efb\u52a1\u3002\u6700\u7ec8\u4e24\u9897\u7ea2\u8272LED\u4f1a\u5e38\u4eae\uff0c\u8868\u793a\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u3002\u6b64\u65f6\u901a\u8fc7SSH\u5373\u53ef\u8fde\u63a5\u5230\u6811\u8393\u6d3e\u7cfb\u7edf\u3002\u8fd9\u91cc\u4f7f\u7528 WindTerm \u4f5c\u4e3a\u7ec8\u7aef\u8f6f\u4ef6\u8fdb\u884cSSH\u8fde\u63a5\uff08\u9700\u8981\u6811\u8393\u6d3e\u81ea\u52a8\u8fde\u63a5WIFI\uff09\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u7531\u4e8e\u6811\u8393\u6d3e\u7cfb\u7edf\u8d44\u6e90\u6709\u9650\uff0c\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u57fa\u4e8e\u547d\u4ee4\u884c\u7684\u65b9\u5f0f\u8fdb\u884c\u4e86\u4ea4\u4e92\uff0c\u4ee5\u51cf\u4f4e\u7cfb\u7edf\u81ea\u8eab\u7684\u6d88\u8017\u3002 Tip \u9ed8\u8ba4\u7528\u6237\u540d\uff1a pi \u9ed8\u8ba4\u5bc6\u7801\uff1a raspberry \u5e38\u901a\u8fc7 htop \u6307\u4ee4\u53bb\u67e5\u770b\u7cfb\u7edf\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230CPU3\\CPU4\u5e76\u6ca1\u6709\u88ab\u7cfb\u7edf\u6240\u4f7f\u7528\uff0c\u5360\u7528\u7387\u4e3a0 \u5e38\u7528\u547d\u4ee4\u8fd8\u6709\uff1adf ifconfig cp rm ls free top netstat vim 2 Windows\u73af\u5883\u914d\u7f6e \uf0c1 \u5bf9\u4e8eWindows\u7684\u73af\u5883\u8981\u6c42\u5982\u4e0b \u9996\u5148\u786e\u8ba4\u5f00\u542f\u4e86 \u9002\u7528\u4e8eWindows\u7684Linux\u5b50\u7cfb\u7edf\u529f\u80fd \u901a\u8fc7Windows\u5e94\u7528\u5546\u5e97\u5b89\u88c5WSL ubuntu18.04\u7248\u672c. \u5b89\u88c5\u540e\u6253\u5f00, \u7b49\u5f85\u914d\u7f6e\u540e\u5230\u63d0\u793a\u8f93\u5165\u7528\u6237\u540d\u7684\u9636\u6bb5\u65f6\u4e0d\u8981\u8f93\u5165\u7528\u6237\u540d\u76f4\u63a5\u5173\u95edubuntu 18.04\u7684\u7ec8\u7aef. \u5b89\u88c5Virtual Studio 2017\u7528\u4e8e\u4ee3\u7801\u751f\u6210 \u5b89\u88c5MATLAB 2022b Tip \u8fd9\u91cc\u4f7f\u7528WSL\u5b50\u7cfb\u7edf\u7684\u4e3b\u8981\u76ee\u7684\u662f\u7528\u4e8e \u4ea4\u53c9\u7f16\u8bd1 \uff0c\u8fd9\u91cc\u4e3b\u8981\u8003\u8651\u5230\uff0c\u98de\u63a7\u4ee3\u7801\u5728\u6811\u8393\u6d3e\u673a\u8f7d\u7aef\u76f4\u63a5\u7f16\u8bd1\u4f1a\u975e\u5e38\u6162\uff0c\u800c\u901a\u8fc7Linux\u7cfb\u7edf\u8ba1\u7b97\u673a\u7f16\u8bd1\u4f1a\u5feb\u5f88\u591a\u3002\u4e3a\u4e86\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0cRflyPilot\u9009\u62e9\u4f7f\u7528\u4ea4\u53c9\u7f16\u8bd1\u7684\u65b9\u5f0f\u5728Linux\u7aef\u76f4\u63a5\u7f16\u8bd1\u5f97\u5230\u53ef\u4ee5\u7528\u5728\u6811\u8393\u6d3e\u7aef\u6267\u884c\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 2.1 WSL\u73af\u5883\u914d\u7f6e \uf0c1 \u8fdb\u5165WSL\u540e\uff0c\u6267\u884c\u547d\u4ee4 sudo apt install cmake sudo apt install gcc-arm-linux-gnueabihf sudo apt install g++-arm-linux-gnueabihf sudo apt install sshpass 2.2 RflyPilot\u6e90\u7801\u4e0b\u8f7d \uf0c1 RflyPilot\u7684\u6e90\u7801\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff1aRflyPilot\u98de\u63a7\u7cfb\u7edf\u63a5\u53e3\uff08C++\u4ee3\u7801\uff09\u4e0e\u7528\u4e8e\u98de\u63a7\u8bbe\u8ba1\u7684\u6a21\u578b\u6587\u4ef6(MATLAB)\u3002 RflyPilot\u6e90\u7801: https://gitee.com/RflyBUAA/RflyPilot.git RflyPilot MATLAB\u6e90\u7801: https://gitee.com/RflyBUAA/RflyPilot_Model.git \u4f7f\u7528\u547d\u4ee4 git clone https://gitee.com/RflyBUAA/RflyPilot.git git clone https://gitee.com/RflyBUAA/RflyPilot_Model.git RflyPilot\u98de\u63a7\u7cfb\u7edf\u63a5\u53e3\u91c7\u7528\u9ad8\u6548\u7684C++\u4ee3\u7801\u5b8c\u6210\uff0c\u4e3aRflyPilot\u63d0\u4f9b\u57fa\u672c\u7684\u98de\u63a7\u529f\u80fd\uff0c\u5305\u62ec\u4f20\u611f\u5668\u8bfb\u53d6\u4efb\u52a1\u3001\u6267\u884c\u5668\u8f93\u51fa\u4efb\u52a1\u3001\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u63a5\u53e3\u3001\u65e5\u5fd7\u7cfb\u7edf\u3001\u4f20\u611f\u5668\u6821\u51c6\u6a21\u5757\u7b49\u7b49\u3002\u5728\u5e38\u89c4\u7684\u98de\u63a7\u7b97\u6cd5\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u4fee\u6539\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u3002 \u98de\u63a7\u6a21\u578b\u6587\u4ef6\u4e3b\u8981\u5305\u542b\u63a7\u5236\u5668\u6a21\u578b\u3001\u65e0\u4eba\u673a\u6a21\u578b\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u6a21\u578b\u7b49\u3002\u8fd9\u90e8\u5206\u6a21\u578b\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u524d\u671f\u7684\u63a7\u5236\u7cfb\u7edf\u9a8c\u8bc1\u3002\u8bbe\u8ba1\u597d\u7684\u98de\u63a7\u53ef\u4ee5\u8fdb\u884c\u4ee3\u7801\u751f\u6210\uff0c\u8fdb\u800c\u5d4c\u5165\u5230RflyPilot\u98de\u63a7\u7cfb\u7edf\u4e2d\u3002\u8fd9\u90e8\u5206\u5185\u5bb9\u662f\u5f00\u53d1\u8005\u9700\u8981\u7ecf\u5e38\u4fee\u6539\u8c03\u8bd5\u7684\u5185\u5bb9\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u5904\u7406\u4ee3\u7801\u8fc1\u79fb\u4e0e\u7f16\u8bd1\u7684\u95ee\u9898\uff0c\u8bfe\u9898\u7ec4\u4e5f\u9488\u5bf9\u6027\u5730\u5f00\u53d1\u4e86\u4e00\u5957\u5de5\u5177\u2014\u2014RflyPilotTools\uff0c\u7528\u4e8e\u7b80\u5316\u590d\u6742\u7684\u64cd\u4f5c\u6d41\u7a0b\u3002 \u7531\u4e8eMATLAB\u6a21\u578b\u4e2d\u8fd8\u672a\u5305\u542b\u72b6\u6001\u4f30\u8ba1\u6a21\u578b\u548c\u65e0\u4eba\u673a\u6a21\u578b\uff0c\u8fd8\u9700\u8981\u6267\u884c\u5b50\u6a21\u5757\u66f4\u65b0\u6307\u4ee4\uff0c\u65b9\u53ef\u5b8c\u6210\u5bf9\u6a21\u578b\u7684\u5b8c\u6574\u4e0b\u8f7d\u3002 cd RflyPilot_Model git submodule update --init --recursive cd Estimator git checkout master cd ../Model git checkout master cd .. 2.3 \u6587\u4ef6\u7ec4\u7ec7\u7ed3\u6784 \uf0c1 . \u251c\u2500\u2500 Estimator \u2502 \u251c\u2500\u2500 AttitudeEstimator.slx\uff08\u59ff\u6001\u4f30\u8ba1\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 AttitudeEstimatorParameters.m\uff08\u59ff\u6001\u4f30\u8ba1\u5668\u7684\u53c2\u6570\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 Estimator.sldd\uff08\u7528\u4e8e\u5b58\u50a8\u4f30\u8ba1\u5668\u53c2\u6570\uff09 \u2502 \u251c\u2500\u2500 Inteface.sldd\uff08\u4ee3\u7801\u751f\u6210\u7684\u63a5\u53e3\u5b9a\u4e49\u6587\u4ef6\uff09 \u2502 \u251c\u2500\u2500 PositionEstimator.slx\uff08\u4f4d\u7f6e\u4f30\u8ba1\u5668\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 PositionEstimatorParameters.m\uff08\u4f4d\u7f6e\u4f30\u8ba1\u5668\u7684\u53c2\u6570\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 README.md \u2502 \u251c\u2500\u2500 doc \u2502 \u2502 \u2514\u2500\u2500 estimatordoc.tex\uff08\u72b6\u6001\u4f30\u8ba1\u7684\u8bf4\u660e\u6587\u6863\uff09 \u251c\u2500\u2500 MATLABApp \u2502 \u2514\u2500\u2500 RflyPilotToolBox.mlappinstall\uff08RflyPilot\u5b89\u88c5\u5305\uff09 \u251c\u2500\u2500 MIL \u2502 \u251c\u2500\u2500 ControlInit_vz.m\uff08\u63a7\u5236\u5668\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 MPCControllerCodeGen_Vz.slx\uff08\u56db\u65cb\u7ffcNMPC\u63a7\u5236\u5668\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 MPC_HIL.slx\uff08\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 README.txt \u2502 \u251c\u2500\u2500 SIH_Model.slx\uff08SIH\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 quad_make_solver_vz.m\uff08\u7528\u4e8e\u751f\u6210\u56db\u65cb\u7ffcNMPC\u6c42\u89e3\u5668\uff09 \u2502 \u2514\u2500\u2500 usrController.slx\uff08\u7528\u4e8e\u4ee3\u7801\u751f\u6210\u7684\u63a7\u5236\u5668\u6a21\u578b\uff09 \u251c\u2500\u2500 Model \u2502 \u251c\u2500\u2500 H250Model.slx\uff08\u56db\u65cb\u7ffc\u6a21\u578b\u6587\u4ef6\uff09 \u2502 \u251c\u2500\u2500 ModelParam_H2504S.m\uff08\u56db\u65cb\u7ffc\u6a21\u578b\u53c2\u6570\u521d\u59cb\u5316\u6587\u4ef6\uff09 \u251c\u2500\u2500 RflyPilot_Model.prj\uff08\u5de5\u7a0b\u6587\u4ef6\uff09 \u251c\u2500\u2500 cache \u251c\u2500\u2500 debug_tools\uff08\u7528\u4e8e\u5b58\u653eRflyPilot\u7684\u5728\u7ebf\u793a\u6ce2\u5668\uff09 \u251c\u2500\u2500 i2c2pwm \u251c\u2500\u2500 log_analysis\uff08\u7528\u4e8elog\u5b58\u50a8\u4e0e\u5206\u6790\u7684\u6587\u4ef6\uff09 \u251c\u2500\u2500 mathlib\uff08\u6570\u5b66\u5e93\uff09 \u251c\u2500\u2500 nmpc_solver_vz.cpp\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 nmpc_solver_vz.tlc\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 nmpc_solver_vz_wrapper.cpp\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 resources (Simulink\u5de5\u7a0b\u7f13\u5b58\u6587\u4ef6) \u251c\u2500\u2500 simulink_codegen\uff08\u4ee3\u7801\u751f\u6210\u7684\u76ee\u6807\u6587\u4ef6\u5939\uff09 \u2514\u2500\u2500 swfiles\uff08RflyPilot\u98de\u63a7\u5916\u58f33D\u6253\u5370\u6587\u4ef6\uff09 3 \u6a21\u578b\u7684\u8fd0\u884c(MIL) \uf0c1 \u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u8fd0\u884c\u6570\u503c\u4eff\u771f\uff0c\u5373\u6a21\u578b\u5728\u73af\u4eff\u771f\u3002 3.1 \u4eff\u771f\u53c2\u6570\u521d\u59cb\u5316 \uf0c1 \u9996\u5148\u5728MATLAB\u4e2d\u6253\u5f00\u5de5\u7a0b\u6587\u4ef6 RflyPilot_Model.prj \uff0c\u7136\u540e\u5206\u522b\u8fd0\u884c\u5982\u4e0b\u811a\u672c MIL/ControlInit_vz.m Estimator/AttitudeEstimatorParameters.m Estimator/PositionEstimatorParameters.m Model/ModelParam_H2504S.m \u6ce8\u610f \u4e3a\u907f\u514d\u540e\u7eed\u4eff\u771f\u8fc7\u7a0b\u4e2d\u6587\u4ef6\u8def\u5f84\u53d1\u751f\u9519\u8bef\u7b49\u95ee\u9898 \u5f3a\u70c8 \u5efa\u8bae\u5728\u540e\u7eed\u8fdb\u884c\u4eff\u771f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5de5\u4f5c\u76ee\u5f55\u4f9d\u7136\u4fdd\u6301\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u5373 RflyPilot_Model \u76ee\u5f55\u4e0b\u3002 3.2 \u7efc\u5408\u4eff\u771f \uf0c1 \u6253\u5f00MIL/MIL_HIL.slx\u6a21\u578b \u8fd9\u662f\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff0c\u5b83\u6574\u5408\u4e86\u9065\u63a7\u5668\u8f93\u5165\u63a5\u53e3\uff0c\u63a7\u5236\u5668\uff0c\u65e0\u4eba\u673a\u6a21\u578b\uff0c\u72b6\u6001\u4f30\u8ba1\u5668\u4ee5\u53ca3D\u663e\u793a\u8f93\u51fa\u6a21\u5757\uff0c\u662f\u4e00\u4e2a\u8f83\u4e3a\u5168\u9762\u7684\u4eff\u771f\u6a21\u578b\u3002\u8fd9\u91cc\u7684\u63a7\u5236\u5668\u4e0e\u65e0\u4eba\u673a\u6a21\u578b\u90e8\u5206\u5747\u4f7f\u7528\u4e86Simulink\u7684ModelReferance\u529f\u80fd(\u7c7b\u4f3c\u4e0e\u51fd\u6570\u8c03\u7528)\uff0c\u901a\u8fc7\u89c4\u8303\u5316\u6a21\u578b\u8f93\u5165\u8f93\u51fa\u63a5\u53e3\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u5b50\u6a21\u578b\uff0c\u5982\uff0c\u63a7\u5236\u5668\u6a21\u578b\u8c03\u7528\u4e86 MPCControllerCodeGen.slx \uff0c\u800c\u65e0\u4eba\u673a\u6a21\u578b\u5219\u8c03\u7528\u4e86 H250Model.slx \uff0c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u5219\u5728\u5185\u90e8\u5206\u522b\u8c03\u7528\u4e86 AttitudeEstimator \u4e0e PostionEstimator \u3002\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5728\u90e8\u7f72\u5b8c NMPC\u6c42\u89e3\u5668 \u540e\uff0c\u53ef\u4ee5\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u751f\u6210 nmpc_solver_vz.mexw64 \u3002\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff0c\u5e76\u6253\u5f00 RflySim3D \uff0c\u8fdb\u884c\u4f4d\u59ff\u663e\u793a\u3002\u9ed8\u8ba4\u6a21\u578b\u91c7\u7528Dashboard\u8fdb\u884c\u6307\u4ee4\u8f93\u5165\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff08\u5728Viewer\u4e2d\uff09\u3002 \u6ce8\u610f \u9700\u8981\u4fdd\u8bc1NMPC\u6c42\u89e3\u5668\u6e90\u7801\u6587\u4ef6\u5939 acado_MPC \u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u540c\u65f6\u786e\u4fdd\u5176\u5df2\u7ecf\u52a0\u8f7d\u5230\u5de5\u7a0b\u7d22\u5f15\u8def\u5f84\u4e2d\u3002 4 \u4ee3\u7801\u751f\u6210 \uf0c1 \u5728\u8fdb\u884c\u6570\u503c\u4eff\u771f\u4e4b\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u5bf9\u7cfb\u7edf\u7684\u6027\u80fd\u6709\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u5224\u65ad\u3002\u53ef\u4ee5\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u9a8c\u8bc1\u5de5\u4f5c\uff0c\u5305\u62ecHIL(\u534a\u7269\u7406\u4eff\u771f)\u3001SIH(\u786c\u4ef6\u4eff\u771f)\u3001EXP(\u5b9e\u98de\u5b9e\u9a8c)\u3002\u7136\u800c\u8fd9\u4e9b\u9a8c\u8bc1\u6a21\u5f0f\u90fd\u9700\u8981\u5c06\u4eff\u771f\u7a0b\u5e8f\u8f6c\u5316\u4e3a\u53ef\u4ee5\u8fdb\u884c\u5b9e\u9645\u90e8\u7f72\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u5c06\u8fd9\u4e9b\u6a21\u578b\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u5219\u662f\u4e00\u6761\u5fc5\u7ecf\u4e4b\u8def\u3002 4.1 \u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210 \uf0c1 \u6253\u5f00 MIL/usrController.slx \u6a21\u578b\uff0c\u53ef\u4ee5\u770b\u5230\uff08\u4e0b\u56fe\uff09\u5176\u4e2d\u5de6\u4fa7\u4e3a\u6a21\u578b\u8f93\u5165\u63a5\u53e3\uff0c\u5176\u5747\u4e3a\u7ed3\u6784\u4f53\u7c7b\u578b\uff0c\u5176\u4e2d\u5305\u542b\u591a\u79cd\u6570\u636e\uff0c\u6a21\u578b\u53f3\u4fa7\u4e3aPWM\u4fe1\u53f7\u8f93\u51fa\u63a5\u53e3\u4e0e\u8c03\u8bd5\u6570\u636e\u8f93\u51fa\u63a5\u53e3\u3002\u5176\u4e2d\u53f3\u4fa7\u5bf9\u8bdd\u6846\u4e2d\u7684\u5916\u90e8\u6570\u636e\u7528\u4e8e\u52a0\u8f7d\u63a5\u53e3\u5b9a\u4e49\u6587\u4ef6 Interface.sldd \u3002\u8fd9\u4e2a\u6587\u4ef6\u5b9a\u4e49\u7684\u63a5\u53e3\u4e0eRflyPilot\u98de\u63a7\u4e2d\u7684C++\u4ee3\u7801\u63a5\u53e3\u4e00\u81f4\uff0c\u662f\u6c9f\u901a\u4ee3\u7801\u751f\u6210\u4e0eRflyPilot\u57fa\u7840\u7cfb\u7edf\u7684\u6865\u6881\u3002\u540c\u65f6\u8fd9\u4e2a\u6a21\u578b\u662f\u5c06\u539f\u6709 MPCControllerCodeGen_Vz.slx \u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u8fd9\u6837\u7684\u5904\u7406\u65b9\u6cd5\u6709\u5229\u4e8e\u4ee3\u7801\u751f\u6210\u540e\u63a5\u53e3\u7684\u517c\u5bb9\uff0c\u4e5f\u6709\u52a9\u4e8e\u8fdb\u884c\u63a7\u5236\u6a21\u578b\u7684\u5feb\u901f\u5207\u6362\u4e0e\u90e8\u7f72\u3002 \u5728\u4e0a\u8ff0\u8bbe\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u5373\u53ef\u5bf9\u8be5\u63a7\u5236\u5668\u6a21\u578b\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u3002\u8fdb\u5165APP\u4e0b\u7684Embedded Code\u5de5\u5177\u7bb1\uff0c\u9009\u62e9\u8fdb\u884c \u7f16\u8bd1 \u3002 Tip \u4ee3\u7801\u751f\u6210\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u9047\u5230\u9519\u8bef\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5c06acado_MPC\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u91cd\u65b0\u52a0\u8f7d\uff0c\u6216\u5c1d\u8bd5\u6e05\u9664 cache \u548c simulink_codegen \u6587\u4ef6\u5939\u4e0b\u7684\u5185\u5bb9\u540e\u91cd\u65b0\u751f\u6210\u3002 \u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u754c\u9762\u3002 4.2 \u72b6\u6001\u4f30\u8ba1\u4ee3\u7801\u751f\u6210 \uf0c1 \u72b6\u6001\u4f30\u8ba1\u90e8\u5206\u7684\u4ee3\u7801\u751f\u6210\u5206\u4e3a\u59ff\u6001\u4f30\u8ba1\u5668\u4ee3\u7801\u751f\u6210\u4e0e\u4f4d\u7f6e\u4f30\u8ba1\u4ee3\u7801\u751f\u6210\u3002\u9996\u5148\u4ecb\u7ecd\u59ff\u6001\u4f30\u8ba1\u4ee3\u7801\u751f\u6210\uff0c\u6253\u5f00 Estimator/AttitudeEstimator.slx \u6a21\u578b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5176\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u4e0e\u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u9664\u4e86\u59ff\u6001\u4fe1\u606f\uff0c\u4f4d\u7f6e\u4fe1\u606f\u4e5f\u4e0d\u53ef\u6216\u7f3a\u3002\u4f4d\u7f6e\u4f30\u8ba1\u5668\u7684\u6a21\u578b\u4e3a Estimator/PositionEstimator.slx \uff0c\u4f4d\u7f6e\u4f30\u8ba1\u6a21\u578b\u7684\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u4e0e\u59ff\u6001\u4f30\u8ba1\u6a21\u578b\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u540c\u6837\u4e0d\u518d\u8d58\u8ff0\u3002 Tip \u5173\u4e8e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u76f8\u5173\u4ecb\u7ecd\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003PX4\u7684Q_estimator\u548cLPE\u3002 4.3 \u65e0\u4eba\u673a\u6a21\u578b\u4ee3\u7801\u751f\u6210 \uf0c1 \u81f3\u6b64\uff0c\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u6a21\u578b\u5747\u5df2\u88ab\u751f\u6210\u4e3a\u4ee3\u7801\u7684\u5f62\u5f0f\uff0c\u65e0\u4eba\u673a\u7684\u4eff\u771f\u6a21\u578b\u540c\u6837\u53ef\u4ee5\u8fdb\u884c\u4ee3\u7801\u751f\u6210\uff0c\u8fd9\u91cc\u4e3b\u8981\u7528\u4f5cSIH\u4eff\u771f\u4e2d\u7684\u88ab\u63a7\u5bf9\u8c61\uff0c\u5373\u53ea\u9700\u8981\u4e00\u5171\u98de\u63a7\u786c\u4ef6\u5c3d\u53ef\u4ee5\u8fdb\u884c\u98de\u884c\u4eff\u771f\uff0c\u8fd9\u79cd\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u5b9e\u9645\u98de\u63a7\u5e73\u53f0\u4e2d\u7684\u8fd0\u884c\u662f\u5426\u6b63\u5e38\u3002 \u6253\u5f00\u6a21\u578b SIH_Model.slx \uff0c\u8fd9\u91cc\u540c\u6837\u4f7f\u7528\u4e86\u53c2\u8003\u6a21\u578b\u7684\u6a21\u578b\u642d\u5efa\u65b9\u5f0f\uff0c\u4f7f\u7528\u7684\u6a21\u578b\u662f Model/H250Model2.slx \uff08\u4e0e\u6570\u503c\u4eff\u771f\u6a21\u578b Model/H250Model.slx \u7684\u533a\u522b\u8be6\u89c1 Model/README.md \uff09\uff0c\u4f7f\u7528\u7684\u63a5\u53e3\u6587\u4ef6\u540c\u6837\u662f Interface.sldd \uff0c\u5176\u4ee3\u7801\u751f\u6210\u65b9\u5f0f\u4e5f\u4e0d\u518d\u8d58\u8ff0\u4e86\u3002 Tip \u5728\u751f\u6210\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9047\u5230\u5982\u4e0b\u62a5\u9519\uff0c\u76f4\u63a5\u70b9\u51fb\u201c\u4fee\u590d\u201d\u5373\u53ef\u3002 5 \u4ee3\u7801\u7684\u90e8\u7f72\u7f16\u8bd1\u4e0eRflyPilot \uf0c1 5.1 \u4ee3\u7801\u90e8\u7f72 \uf0c1 \u5c06\u56db\u5927\u529f\u80fd\u6a21\u5757\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u540e\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff0c\u5728 simulink_codegen \u6587\u4ef6\u5939\u4e0b\u3002\u53ef\u4ee5\u770b\u5230\u751f\u6210\u7684\u4ee3\u7801\u5df2\u88ab\u6253\u5305\u4e3azip\u6587\u4ef6\u3002 \u5982\u4f55\u5c06\u5176\u751f\u6210\u7684\u4ee3\u7801\u90e8\u7f72\u5230\u5b9e\u9645\u98de\u63a7\u4e2d\u5462\uff1f\u6b64\u65f6\u5c31\u9700\u8981\u901a\u8fc7RflyPilotTools\u8fdb\u884c\u8854\u63a5\u3002 RflyPilotTools\u662f\u4e00\u6b3e\u57fa\u4e8eMATLAB\u7684\u5de5\u5177\u7bb1\uff0c\u5b83\u7684\u5b89\u88c5\u5305\u4f4d\u4e8e MATLABApp/RflyPilotToolBox.mlappinstall \uff0c\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u53cc\u51fb\u5373\u53ef\u5b89\u88c5\uff0c\u6700\u7ec8\u4f1a\u663e\u793a\u5728MATLAB\u5de5\u5177\u7bb1\u754c\u9762\u4e2d\u3002 \u9996\u6b21\u4f7f\u7528RflyPilotTool\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u914d\u7f6e\uff0c\u4e3b\u8981\u914d\u7f6e\u9009\u9879\u4e3a RflyPilot Path \uff0c\u5373RflyPilot\u6e90\u7801\u7684\u8def\u5f84\uff0c\u81f3\u4e8e CodeGen Path \u4e0e Unzip Path \u5219\u5206\u522b\u4e3a\u4ee3\u7801\u751f\u6210\u6e90\u7801\u7684\u8def\u5f84\u548c\u751f\u6210\u538b\u7f29\u5305\u7684\u8def\u5f84\uff0c\u8fd9\u91cc\u4fdd\u6301\u9ed8\u8ba4\u5373\u53ef\u3002\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u201cSave Setting\u201d\uff0c\u5373\u53ef\u4fdd\u6301\u914d\u7f6e\u5230\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u7684 rflypilottoolbox.mat \u4e2d\u3002 \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u4f9d\u6b21\u70b9\u51fb\u201cUpdate Estimator\u201d \u201cUpdate SIH Model\u201d \u201cUpdate Controller\"\u5373\u53ef\u505a\u5230\u201c\u4e00\u952e\u90e8\u7f72\u201d\uff0c\u5373\u5c06\u4ee3\u7801\u590d\u5236\u5230\u76f8\u5e94\u7684\u6e90\u7801\u6587\u4ef6\u5939\u4e2d\u3002\u4e0e\u4e4b\u5bf9\u5e94\u7684\u6587\u4ef6\u5939\u5206\u522b\u4e3a estimator_codegen , sih_codegen , controller_codegen \u3002\u5728\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u8bfb\u8005\u53ef\u4ee5\u5728\u81ea\u884c\u53bb\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u67e5\u770b\u76f8\u5e94\u7684\u6e90\u7801\u3002 5.2 RflyPilot\u7f16\u8bd1 \uf0c1 RflyPilot\u7684\u4ea4\u53c9\u7f16\u8bd1\u662f\u5728WSL\u7cfb\u7edf\u4e2d\u8fdb\u884c\u7684\u3002\u4f46\u5f97\u76ca\u4e8eRflyPilotTool\uff0c\u8fd9\u4e2a\u6b65\u9aa4\u88ab\u8fdb\u4e00\u6b65\u7b80\u5316\u3002 \u9996\u5148\u5728RflyPilot\u6e90\u7801\u6587\u4ef6\u5939\u4e2d\u521b\u5efa build \u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u3002\u7136\u540e\u5728RflyPilotTool\u4e2d\uff0c\u70b9\u51fb\u201cBuild\u201d\uff0c\u5373\u53ef\u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\u3002\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u8f93\u51fa\u53ef\u4ee5\u5728MATLAB\u547d\u4ee4\u884c\u4e2d\u67e5\u770b\u3002 \u8f93\u51fa\u7ed3\u679c\u4e3a -- Configuring done -- Generating done -- Build files have been written to: /mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build [ 14%] Built target confc [ 20%] Built target controller_codegen [ 27%] Built target basic_controller_codegen [ 31%] Built target libsbus [ 40%] Built target estimator_codegen [ 55%] Built target sih_codegen Scanning dependencies of target rflypilot [ 56%] Building CXX object CMakeFiles/rflypilot.dir/src/application/attitudeEstimator_thread.cpp.o [ 57%] Building CXX object CMakeFiles/rflypilot.dir/src/application/ulog_thread.cpp.o [ 57%] Building CXX object CMakeFiles/rflypilot.dir/src/application/usrController_thread.cpp.o [ 58%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/norm_afMWvhHe.cpp.o [ 59%] Building CXX object CMakeFiles/rflypilot.dir/src/application/system_app.cpp.o [ 60%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/norm_a2pQkYtO.cpp.o [ 61%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rtGetInf.cpp.o [ 62%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rtGetNaN.cpp.o [ 63%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_atan2d_snf.cpp.o [ 63%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_atan2f_snf.cpp.o [ 64%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_nonfinite.cpp.o [ 65%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_r32zcfcn.cpp.o [ 66%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_zcfcn.cpp.o [ 67%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/px4lib/test_time.cpp.o [ 68%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/posix/i2c.cpp.o [ 68%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/posix/spi.cpp.o [ 69%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/actuator/pca9685/pca9685.cpp.o [ 70%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/actuator/fpga/actuator_fpga.cpp.o [ 71%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/rc/sbus/sbus_api.cpp.o [ 72%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/icm42688p/ICM42688P.cpp.o [ 73%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/icm20689new/ICM20689.cpp.o [ 73%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/gyroscope/PX4Gyroscope.cpp.o [ 74%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/accelerometer/PX4Accelerometer.cpp.o [ 75%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/magnetometer/ist8310/ist8310.cpp.o [ 76%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/magnetometer/qmc5883l/QMC5883L.cpp.o [ 77%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/barometer/ms5611/ms5611.cpp.o [ 78%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/gps/gps_api.cpp.o [ 78%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_tty_linux.c.o [ 79%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_low_latency_linux.c.o [ 80%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_low_latency_none.c.o [ 81%] Building CXX object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/decoder/DecoderFSM.cpp.o [ 82%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/decoder/packet_decoder.c.o [ 83%] Building CXX object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/driver/SBUS.cpp.o [ 83%] Linking CXX executable rflypilot [100%] Built target rflypilot \u5176\u80cc\u540e\u5728WSL\u4e2d\u6267\u884c\u7684\u547d\u4ee4\u4e3a cd build cmake .. && make -j128 5.3 \u98de\u63a7\u7a0b\u5e8f\u90e8\u7f72 \uf0c1 \u4ea4\u53c9\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5c06\u5728 build \u76ee\u5f55\u4e0b\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6 rflypilot \uff0c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u53ea\u80fd\u8fd0\u884c\u4e8e\u6811\u8393\u6d3e\u7cfb\u7edf\u4e2d\u3002\u6545\u9700\u8981\u4e0a\u4f20\u5230\u6811\u8393\u6d3e\u4e2d\u624d\u53ef\u4ee5\u8fd0\u884c\u3002\u4e8e\u6b64\u540c\u65f6\uff0c\u9664\u4e86 rflypilot \u6587\u4ef6\u4ee5\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u88ab\u540c\u65f6\u4e0a\u4f20\u5230\u6811\u8393\u6d3e\u4e2d config/parameter.txt \u2014\u2014\u7528\u4e8e\u5b58\u50a8\u81ea\u5b9a\u4e49\u7684\u98de\u63a7\u53c2\u6570 config/rflypilot.txt \u2014\u2014RflyPilot\u914d\u7f6e\u6587\u4ef6 \u70b9\u51fb\u201cUpload\u201d\u540e\uff0c\u5373\u53ef\u5728RflyPilot\u98de\u63a7\u4e2d\u770b\u5230\u66f4\u65b0\u540e\u7684\u6587\u4ef6\u3002 \u6ce8\u610f \u7b2c\u4e00\u6b21\u4e0b\u8f7d\u9700\u8981\u63d0\u524d\u7528WSL ubuntu 18.04\u767b\u5f55\u6811\u8393\u6d3e\u7684SSH, \u5e76\u5efa\u7acb\u6587\u4ef6\u5939RflyPilot_Project\\RflyPilot pi@navio:~ $ cd RflyPilot_Project/RflyPilot/ pi@navio:~/RflyPilot_Project/RflyPilot $ ls parameter.txt rflypilot rflypilot.txt pi@navio:~/RflyPilot_Project/RflyPilot $ \u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u4e86\u98de\u63a7\u7a0b\u5e8f\u7684\u90e8\u7f72\u3002 6 \u98de\u63a7\u7684\u8fd0\u884c\uff08SIH\uff09 \uf0c1 \u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u8fd9\u91cc\u4ee5SIH\u4eff\u771f\u4e3a\u4f8b\uff0c\u8fdb\u884c\u98de\u63a7\u7684\u8fd0\u884c\u9a8c\u8bc1\u3002 \u9996\u5148\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u8fd0\u884c\u6a21\u5f0f\u4fee\u6539\u4e3aSIH\u6a21\u5f0f\uff0c\u5373\uff0c valid_mode = 1 \u3002\u7136\u540e\u5c06 scope_ip \u4e0e station_ip \u4fee\u6539\u4e3a\u7535\u8111IP\u3002 \u6ce8\u610f \u8981\u6ce8\u610f\u5728 = \u4e24\u7aef\u5b58\u5728\u4e24\u4e2a\u7a7a\u683c\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fdd\u7559\u6b64\u7a7a\u683c\uff01 ########################### SYSTEM PARAMETER ################### #validation mode SIH:1 HIL:2 EXP:3 OFFBOARD:4 valid_mode = 1 #SIH mode use real state sih_use_real_state = 1 #system sample rate imu_rate = 800 mag_rate = 95 # max rate 100Hz controller_rate = 333 attitude_est_rate = 500 lpe_rate = 500 #imu cutoff in Hz accel_cutoff_hz = 50 gyro_cutoff_hz = 50 #scheduler_mode delay:1 adaptive_delay:2 timer:3(NOT RECOMMENDED!) scheduler_mode = 2 # msg logger enable sys_log_en = 1 est_log_en = 0 ctrl_log_en = 1 # msg scope enable sys_scope_en = 1 est_scope_en = 0 ctrl_scope_en = 1 # string scope_ip = \"192.168.199.233\" # 152 station_ip = \"192.168.199.233\" log_dir = \".\" ########################## USER DEFINED PARAMETER ######################### \u7136\u540e\u901a\u8fc7\u547d\u4ee4 ./rflypilot \u5373\u53ef\u8fd0\u884c\u98de\u63a7\u4e8eSIH\u6a21\u5f0f\u3002 \u7cfb\u7edf\u542f\u52a8\u65f6\uff0c\u754c\u9762\u5982\u4e0b Tip \u6b64\u65f6\u5e94\u4ed4\u7ec6\u89c2\u5bdf\u8c03\u8bd5\u8f93\u51fa\u4fe1\u606f\uff0c\u67e5\u770b\u662f\u5426\u5b58\u5728\u5f02\u5e38\u73b0\u8c61\u3002 \u7cfb\u7edf\u6b63\u5e38\u542f\u52a8\u540e\uff0c\u754c\u9762\u5982\u4e0b \u6b64\u65f6\u6309 Ctrl+C \u952e\u5373\u53ef\u4e2d\u6b62\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002 7 SIH\u4eff\u771f \uf0c1 \u57fa\u4e8e\u4ee5\u4e0a\u5185\u5bb9\uff0c\u8bfb\u8005\u5df2\u7ecf\u5b8c\u6210\u4e86\u4ece\u73af\u5883\u5b89\u88c5\u5230\u6a21\u578b\u4eff\u771f\uff08MIL\uff09\uff0c\u518d\u5230\u4ee3\u7801\u751f\u6210\u3001\u8fd0\u884c\u98de\u63a7\u7684\u5168\u6d41\u7a0b\u3002\u7b14\u8005\u4ee5SIH\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4eff\u771f\u7684\u57fa\u672c\u6d41\u7a0b\u548c\u64cd\u4f5c\u3002 7.1 \u524d\u671f\u51c6\u5907 \uf0c1 \u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u98de\u63a7\u8f6f\u4ef6\u548c\u88ab\u63a7\u5bf9\u8c61\u90fd\u8fd0\u884c\u5728RflyPilot\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8fde\u63a5\u5230\u98de\u884c\u5668\u672c\u4f53\u4e0a\uff0c\u4f46\u662f\u7531\u4e8e\u4eff\u771f\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8f93\u5165\u63a7\u5236\u6307\u4ee4\uff0c\u6b64\u65f6\uff0c\u8fd8\u9700\u8981\u5c06\u9065\u63a7\u5668\u7684\u63a5\u6536\u673a\u8fde\u63a5\u5230RflyPilot\u4e0a\u3002 \u6545\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u786c\u4ef6\u51c6\u5907\u4e0a\uff0c\u53ea\u9700\u8981RflyPilot\u4e0e\u9065\u63a7\u5668\u548c\u63a5\u6536\u673a\uff0c\u6700\u540e\u901a\u8fc7WIFI\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u5728RflySim3D\u4e0a\u8fdb\u884c\u663e\u793a\u3002 Scope\u793a\u6ce2\u5668\uff1a\u6253\u5f00MATLAB\u5de5\u7a0b\u6587\u4ef6\u4e2d\u7684 debug_tools/udp_recv3_ke.slx \uff0c\u8be5\u6a21\u578b\u5229\u7528Simulink\u7684UDP\u5de5\u5177\u7bb1\uff0c\u5b9e\u73b0\u4e86\u7b80\u6613\u7684\u98de\u63a7\u6570\u636e\u66f2\u7ebf\u5b9e\u65f6\u5c55\u793a\u529f\u80fd\uff0cRflyPilot\u7684\u4e00\u4e9b\u5173\u952e\u6570\u636e\uff0c\u5982\u4f4d\u7f6e\u3001\u901f\u5ea6\u3001\u59ff\u6001\u7b49\u4fe1\u606f\uff0c\u5747\u4f1a\u5728\u98de\u63a7\u8fd0\u884c\u65f6\u5b9e\u65f6\u663e\u793a\u3002\u53cc\u51fb\u6253\u5f00\u2460\u540e\uff0c\u914d\u7f6e\u2461 Remote IP address \uff0c\u8be5IP\u5e94\u8bbe\u7f6e\u4e3aRflyPilot\u7684IP\u3002\u70b9\u51fb\u201c\u786e\u5b9a\u201d\u5373\u53ef\u5b8c\u6210\u8bbe\u7f6e\uff0c\u968f\u540e\u70b9\u51fb\u201c\u8fd0\u884c\u201d\u3002 RflySim3D: RflySim3D\u662f\u4e00\u6b3e\u57fa\u4e8eUE\u5f15\u64ce\u5f00\u53d1\u7684\u98de\u884c\u5668\u89c6\u666f\u663e\u793a\u5e73\u53f0\uff0c\u5b83\u662f \u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4 \u5f00\u53d1\u7684RflySim\u5e73\u53f0\u7684\u4e00\u90e8\u5206\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u901a\u8fc7UDP\u53d1\u9001\u7279\u5b9a\u534f\u8bae\u7684\u6570\u636e\u5305\uff0c\u8fdb\u800c\u5b9e\u73b0\u63a7\u5236\u89c6\u666f\u4e2d\u65e0\u4eba\u673a\u7684\u4f4d\u7f6e\u3001\u59ff\u6001\u3001\u65cb\u7ffc\u8f6c\u901f\u7b49\uff0c\u662f\u65e0\u4eba\u673a\u63a7\u5236\u5668\u5f00\u53d1\u7684\u5229\u5668\u3002\u66f4\u591a\u7684\u4ecb\u7ecd\u8bf7\u53c2\u8003 RflySim\u5b98\u65b9\u7f51\u7ad9 \u3002Rflysim3D\u5728RflyPilot\u4e2d\u4e3b\u8981\u4f5c\u4e3a\u89c6\u666f\u663e\u793a\u8f6f\u4ef6\uff0c\u4f4d\u59ff\u6570\u636e\u4eceRflyPilot\u4e2d\u53d1\u9001\uff0c\u901a\u8fc7UDP\u534f\u8bae\uff0c\u7531RflySim3D\u8f6f\u4ef6\u8fdb\u884c\u63a5\u6536\u548c\u663e\u793a\u3002 RflySim3D\u8f6f\u4ef6\u7684\u76f8\u5173\u4f7f\u7528\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 Rflysim \u3002 Tip \u5728\u8fdb\u884cSIH\u4eff\u771f\u65f6\uff0c\u8fd0\u884cRflySim3D\u548c\u5728\u7ebf\u793a\u6ce2\u5668\u7684\u8ba1\u7b97\u673a\u548cRflyPilot\u5e94\u5904\u4e8e\u540c\u4e00\u5c40\u57df\u7f51\u4e0b 7.2 \u5f00\u59cb\u4eff\u771f \uf0c1 \u901a\u8fc7\u547d\u4ee4 ./rflypilot \u8fd0\u884c\u98de\u63a7\u5373\u53ef\uff0c\u6ce8\u610f\u6b64\u65f6\u5e94\u8be5\u8bbe\u7f6e\u597d\u98de\u63a7\u7684\u4eff\u771f\u6a21\u5f0f\u548cIP\u5730\u5740\u3002\u6253\u5f00\u9065\u63a7\u5668\u3002\u6b64\u65f6\u5728\u793a\u6ce2\u5668\u4e2d\u53ef\u4ee5\u89c2\u5bdf\u5230\u5f53\u524d\u98de\u884c\u5668\u7684\u72b6\u6001\u6570\u636e\u3002 \u901a\u9053 \u529f\u80fd \u8bf4\u660e CH1 x \u6c34\u5e73\u901a\u9053 CH2 y \u6c34\u5e73\u901a\u9053 CH3 z \u5782\u5411\u901a\u9053 CH4 yaw \u822a\u5411\u63a7\u5236 CH5 MODE* \u7528\u4e8e\u8bbe\u7f6e\u98de\u884c\u6a21\u5f0f CH6 ARM \u7528\u4e8e\u89e3\u9501(ARM>1250) \u6ce8\u610f MODE\u529f\u80fd\u672a\u660e\u786e\u5728\u4eff\u771f\u6a21\u578b\u4e2d\u5b9a\u4e49\uff0c\u8be5\u901a\u9053\u7ea6\u5b9a\u4fd7\u6210\u4e3a\u6a21\u5f0f\u5207\u6362\u901a\u9053\u3002ARM\u901a\u9053\u7684\u8bbe\u8ba1\u4e0e\u4eff\u771f\u6a21\u578b\u65e0\u5173\uff0c\u8be5\u901a\u9053\u7684\u529f\u80fd\u5728\u5e95\u5c42\u98de\u63a7\u7cfb\u7edf\u4e2d\u56fa\u5b9a\u4e3a\u89e3\u9501\u901a\u9053\u3002 Tip \u4eff\u771f\u6280\u5de7\uff1a\u4eff\u771f\u65f6\u5e94\u5148\u89e3\u9501\uff0c\u518d\u7f13\u6162\u63a8\u6cb9\u95e8\uff0c\u76f4\u81f3\u98de\u884c\u5668\u8d77\u98de \u53c2\u8003\u8d44\u6599 \uf0c1 config.txt\u6811\u8393\u6d3e\u5b98\u65b9\u8bf4\u660e \u6811\u8393\u6d3e\u8d85\u9891 \u6811\u8393\u6d3e\u914d\u7f6e\u6587\u6863config.txt\u8bf4\u660e","title":"\u5feb\u901f\u4f7f\u7528"},{"location":"quick_start/env_install/#quick-start","text":"\u8fd9\u90e8\u5206\u5185\u5bb9\u7684\u4e3b\u8981\u76ee\u7684\u662f\u642d\u5efa\u8d77RflyPilot\u5f00\u53d1\u73af\u5883","title":"Quick Start"},{"location":"quick_start/env_install/#0","text":"RflyPilot\u98de\u63a7 \u88c5\u6709WSL\u4e0eMATLAB2022B\u7684Windows\u7535\u8111","title":"0 \u786c\u4ef6\u4e0e\u8f6f\u4ef6\u51c6\u5907"},{"location":"quick_start/env_install/#1-rflypilot","text":"","title":"1 RflyPilot\u7cfb\u7edf\u914d\u7f6e"},{"location":"quick_start/env_install/#11","text":"RflyPilot\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u662fnavio2\u3002 navio2 \u63d0\u4f9b\u7684\u56fa\u4ef6(\u542b\u5b9e\u65f6\u8865\u4e0132\u4f4d), Download , \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177 Etcher \u5b89\u88c5.","title":"1.1 \u6811\u8393\u6d3e\u56fa\u4ef6\u51c6\u5907"},{"location":"quick_start/env_install/#12","text":"RflyPilot\u91c7\u7528\u7684\u662f\u6811\u8393\u6d3eCM4\u6838\u5fc3\u677f\uff0c\u4e0e\u6811\u8393\u6d3e4B\u6807\u51c6\u7248\u4e0d\u540c\uff0c\u5b83\u4e0d\u5305\u542bSD\u5361\u69fd\uff0c\u6838\u5fc3\u677f\u4e0a\u9ed8\u8ba4\u88c5\u6709EMMC\u5b58\u50a8\u82af\u7247\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u6811\u8393\u6d3e\u56fa\u4ef6\u4e0b\u8f7d\u5230EMMC\u4e2d\u3002\u5728\u6811\u8393\u6d3e4B\u4e2d\u53ef\u4ee5\u7528SD\u5361\u8bfb\u5361\u5668\u5bf9\u6811\u8393\u6d3e\u56fa\u4ef6\u8fdb\u884c\u4e0b\u8f7d\uff0c\u5c06\u56fa\u4ef6\u5199\u5165\u5230SD\u5361\u4e2d\uff0c\u5bf9\u4e8e\u6811\u8393\u6d3eCM4\u800c\u8a00\uff0c\u7531\u4e8e\u5b58\u50a8\u82af\u7247\u65e0\u6cd5\u62c6\u5378\uff0c\u9700\u8981\u4fee\u6539\u6811\u8393\u6d3eCM4\u7684\u542f\u52a8\u6a21\u5f0f\uff0c\u4ee4\u5176\u5728\u7535\u8111\u4e0a\u8bc6\u522b\u4e3aU\u76d8\u8bbe\u5907\uff0c\u5373\u53ef\u5b89\u88c5\u5e38\u89c4\u65b9\u6cd5\u8fdb\u884c\u56fa\u4ef6\u4e0b\u8f7d\u3002","title":"1.2 \u56fa\u4ef6\u4e0b\u8f7d"},{"location":"quick_start/env_install/#121","text":"\u6807\u53f7 \u5f00\u5173 OFF ON 1 BOOT \u4ece\u5185\u90e8\u5b58\u50a8\u542f\u52a8 \u8bc6\u522b\u4e3aU\u76d8 2 DAT(GPIO25) \u98de\u63a7\u7a0b\u5e8f\u5f00\u673a\u81ea\u542f* \u53d6\u6d88\u81ea\u542f 3 SW SBUS\u534f\u8bae IBUS\u534f\u8bae \u6ce8\u610f \u98de\u63a7\u7a0b\u5e8f\u5f00\u673a\u81ea\u542f\u529f\u80fd\u76ee\u524d\u5e76\u672a\u5b9e\u73b0","title":"1.2.1 \u6811\u8393\u6d3e\u542f\u52a8\u6a21\u5f0f"},{"location":"quick_start/env_install/#122-rflypilot","text":"\u9996\u5148\u9700\u8981\u5b89\u88c5\u9a71\u52a8\u7a0b\u5e8f\uff0c rpiboot \uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u8fd0\u884c rpiboot.exe \uff0c\u7136\u540e\u5c06\u5c06RflyPilot\u62e8\u7801\u5f00\u5173\u7684 BOOT \u952e\u62e8\u4e3a ON \uff0c\u5373\u8bc6\u522b\u4e3aU\u76d8\u3002\u901a\u8fc7USB\u7ebf\u8fde\u63a5\u5230\u7535\u8111\u3002 \u6ce8\u610f \u6b64\u65f6\u4e0d\u80fd\u5c06\u98de\u63a7\u8fde\u63a5\u5230\u98de\u673a\u4e0a\uff0c\u4ee5\u514d\u51fa\u73b0\u4fe1\u53f7\u5f02\u5e38\u73b0\u8c61 \u7a0d\u7b49\u4e00\u4f1a\u513f\uff0c\u4fbf\u4f1a\u770b\u5230\u5982\u4e0b\u754c\u9762 \u6700\u540e\u53ef\u4ee5\u770b\u5230\u65b0\u589e\u7684\u4e24\u4e2a\u78c1\u76d8 2. \u6811\u8393\u6d3e\u88ab\u8bc6\u522b\u6210U\u76d8\u540e\uff0c\u5176\u7cfb\u7edf\u70e7\u5199\u6b65\u9aa4\u4e0eSD\u5361\u70e7\u5199\u65b9\u6848\u65e0\u5f02\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u8fd9\u91cc\u6211\u4eec\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f navio2 \u7684\u7cfb\u7edf\u955c\u50cf\uff0c\u8be5\u955c\u50cf\u5177\u6709\u5b9e\u65f6\u8865\u4e01\uff0c\u53ef\u4ee5\u4e00\u5b9a\u7a0b\u5ea6\u63d0\u9ad8\u7cfb\u7edf\u5b9e\u65f6\u6027\u3002","title":"1.2.2 RflyPilot\u56fa\u4ef6\u4e0b\u8f7d"},{"location":"quick_start/env_install/#13","text":"\u5728\u56fa\u4ef6\u70e7\u5199\u5b8c\u6210\u540e\uff0c\u8fd8\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884cRflyPilot\u8f6f\u4ef6\u7a0b\u5e8f\uff0c\u9700\u8981\u5bf9\u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\u3002\u5982WIFI\u3001SSH\u3001\u5f15\u5bfc\u7a0b\u5e8f\u7b49\u3002\u8fd9\u90e8\u5206\u4fee\u6539\u53ef\u4ee5\u76f4\u63a5\u5728U\u76d8\u6a21\u5f0f\u4e0b\u5b8c\u6210\u3002","title":"1.3 \u7cfb\u7edf\u914d\u7f6e"},{"location":"quick_start/env_install/#131-bootconfigtxt","text":"[all] # enable sc16is752 overlay dtoverlay=sc16is752-spi1 # enable I2C-1 and set the frequency to 400KHz # enable spidev0.0 dtparam=spi=on # enable RC input enable_uart=1 #init_uart_clock=80000000 #dtoverlay=uart2 #dtoverlay=uart3 #dtoverlay=uart4 ! uart4 conflict with spi0.0 #dtoverlay=uart5 # enable I2C-0 dtparam=i2c_vc=on,i2c_vc_baudrate=1000000 dtparam=i2c_arm=on,i2c_arm_baudrate=1000000 # switch Bluetooth to miniuart dtoverlay=miniuart-bt [cm4] force_turbo=1 core_freq=500 core_freq_min=500 arm_freq=1800 arm_freq_min=1500 start_x=0 # usb otg host mode dtoverlay=dwc2,dr_mode=host Tip \u8fd9\u91cc\u5c06usb\u53e3\u8bbe\u7f6e\u6210\u4e86host\u6a21\u5f0f\uff0c\u5982\u9700\u8981\u5229\u7528\u6811\u8393\u6d3e\u7684USB\u53e3\u7ed9\u5176\u4ed6\u8bbe\u5907\u4f9b\u7535\uff0c\u9700\u8981\u77ed\u63a5\u98de\u63a7\u677f\u4e0a\u7684D1\u4e8c\u6781\u7ba1\u4ee5\u4fdd\u969c\u98de\u63a7\u53ef\u4ee5\u4e3aUSB\u8bbe\u5907\u4f9b\u7535\u3002 Tip \u6d4b\u8bd5\u6838\u5fc3\u9891\u7387 vcgencmd measure_clock arm","title":"1.3.1 \u914d\u7f6e/boot/config.txt"},{"location":"quick_start/env_install/#132-bootcmdlinetxt","text":"dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait isolcpus=2,3 \u6ce8\u610f \u8fd9\u91cc isocpus=2,3 \u7684\u610f\u601d\u662f\u9694\u79bbCPU2\u4e0eCPU3\uff0c\u5373\u7cfb\u7edf\u9ed8\u8ba4\u4e0d\u4f1a\u4f7f\u7528\u8fd9\u4e24\u4e2a\u6838\u5fc3\uff0c\u8fd9\u4e24\u4e2a\u6838\u5fc3\u5c06\u4e3b\u8981\u88ab\u7528\u4e8e\u8fd0\u884c\u98de\u63a7\u7cfb\u7edf\u3002\u5f53\u524d\u7684\u6811\u8393\u6d3eCM4\uff0c\u4e00\u51714\u4e2aCPU\u6838\u5fc3\uff0c\u5206\u522b\u662fCPU0\\CPU1\\CPU2\\CPU3\u3002 \u5982\u679c\u662fRpi\u5b98\u65b9\u7cfb\u7edf root=/dev/mmcblk0p2 \u7684\u5185\u5bb9\u53ef\u80fd\u6bcf\u6b21\u5237\u56fa\u4ef6\u90fd\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4e5f\u53ef\u80fd\u548c\u7cfb\u7edf\u7248\u672c\u6709\u5173\u7cfb\uff0c\u7b14\u8005\u8fd9\u91cc\u6ca1\u6709\u6df1\u5165\u4e86\u89e3\u3002","title":"1.3.2 \u914d\u7f6e/boot/cmdline.txt"},{"location":"quick_start/env_install/#133-bootwpa_supplicationconf","text":"country=CN ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev update_config=1 network={ ssid=\"xxx\" psk=\"XXXXXXXX\" } Tip \u6b64\u5904\u4e3aWIFI\u8bbe\u7f6e\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u914d\u7f6e\uff0cRflyPilot\u5c06\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u8fde\u63a5\u8be5WIFI\u3002","title":"1.3.3 \u914d\u7f6e/boot/wpa_supplication.conf"},{"location":"quick_start/env_install/#134-ssh","text":"\u5728 boot \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u53d6\u4e3a ssh \u5373\u53ef\uff0c\u6b64\u65f6\u7cfb\u7edf\u5c06\u9ed8\u8ba4\u5728\u5f00\u59cb\u65f6\u542f\u52a8SSH\u670d\u52a1\u3002 \u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u4e86RflyPilot\u98de\u63a7\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u914d\u7f6e\u3002 \u6ce8\u610f \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u5e94\u5c06 BOOT \u5f00\u5173\u62e8\u56de OFF \uff0c\u4ee5\u4ece\u5185\u90e8\u5b58\u50a8\u542f\u52a8\u7cfb\u7edf\u3002","title":"1.3.4 \u914d\u7f6eSSH"},{"location":"quick_start/env_install/#14","text":"\u672c\u5c0f\u8282\u4e3b\u8981\u4ecb\u7ecd\u6811\u8393\u6d3e\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5\u4e0e\u5e38\u7528\u6307\u4ee4\u3002 \u6811\u8393\u6d3e\u4e0a\u7535\u4e4b\u540e\u7b49\u5f85\u4e00\u4f1a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u98de\u63a7\u7684\u9ec4\u8272\u6307\u793a\u706f(ACTION)\u4f1a\u95ea\u70c1\uff0c\u8868\u793a\u7cfb\u7edf\u6b63\u5728\u6267\u884c\u67d0\u4e9b\u4efb\u52a1\u3002\u6700\u7ec8\u4e24\u9897\u7ea2\u8272LED\u4f1a\u5e38\u4eae\uff0c\u8868\u793a\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u3002\u6b64\u65f6\u901a\u8fc7SSH\u5373\u53ef\u8fde\u63a5\u5230\u6811\u8393\u6d3e\u7cfb\u7edf\u3002\u8fd9\u91cc\u4f7f\u7528 WindTerm \u4f5c\u4e3a\u7ec8\u7aef\u8f6f\u4ef6\u8fdb\u884cSSH\u8fde\u63a5\uff08\u9700\u8981\u6811\u8393\u6d3e\u81ea\u52a8\u8fde\u63a5WIFI\uff09\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u7531\u4e8e\u6811\u8393\u6d3e\u7cfb\u7edf\u8d44\u6e90\u6709\u9650\uff0c\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u57fa\u4e8e\u547d\u4ee4\u884c\u7684\u65b9\u5f0f\u8fdb\u884c\u4e86\u4ea4\u4e92\uff0c\u4ee5\u51cf\u4f4e\u7cfb\u7edf\u81ea\u8eab\u7684\u6d88\u8017\u3002 Tip \u9ed8\u8ba4\u7528\u6237\u540d\uff1a pi \u9ed8\u8ba4\u5bc6\u7801\uff1a raspberry \u5e38\u901a\u8fc7 htop \u6307\u4ee4\u53bb\u67e5\u770b\u7cfb\u7edf\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230CPU3\\CPU4\u5e76\u6ca1\u6709\u88ab\u7cfb\u7edf\u6240\u4f7f\u7528\uff0c\u5360\u7528\u7387\u4e3a0 \u5e38\u7528\u547d\u4ee4\u8fd8\u6709\uff1adf ifconfig cp rm ls free top netstat vim","title":"1.4 \u6811\u8393\u6d3e\u64cd\u4f5c\u7cfb\u7edf\u7684\u4f7f\u7528"},{"location":"quick_start/env_install/#2-windows","text":"\u5bf9\u4e8eWindows\u7684\u73af\u5883\u8981\u6c42\u5982\u4e0b \u9996\u5148\u786e\u8ba4\u5f00\u542f\u4e86 \u9002\u7528\u4e8eWindows\u7684Linux\u5b50\u7cfb\u7edf\u529f\u80fd \u901a\u8fc7Windows\u5e94\u7528\u5546\u5e97\u5b89\u88c5WSL ubuntu18.04\u7248\u672c. \u5b89\u88c5\u540e\u6253\u5f00, \u7b49\u5f85\u914d\u7f6e\u540e\u5230\u63d0\u793a\u8f93\u5165\u7528\u6237\u540d\u7684\u9636\u6bb5\u65f6\u4e0d\u8981\u8f93\u5165\u7528\u6237\u540d\u76f4\u63a5\u5173\u95edubuntu 18.04\u7684\u7ec8\u7aef. \u5b89\u88c5Virtual Studio 2017\u7528\u4e8e\u4ee3\u7801\u751f\u6210 \u5b89\u88c5MATLAB 2022b Tip \u8fd9\u91cc\u4f7f\u7528WSL\u5b50\u7cfb\u7edf\u7684\u4e3b\u8981\u76ee\u7684\u662f\u7528\u4e8e \u4ea4\u53c9\u7f16\u8bd1 \uff0c\u8fd9\u91cc\u4e3b\u8981\u8003\u8651\u5230\uff0c\u98de\u63a7\u4ee3\u7801\u5728\u6811\u8393\u6d3e\u673a\u8f7d\u7aef\u76f4\u63a5\u7f16\u8bd1\u4f1a\u975e\u5e38\u6162\uff0c\u800c\u901a\u8fc7Linux\u7cfb\u7edf\u8ba1\u7b97\u673a\u7f16\u8bd1\u4f1a\u5feb\u5f88\u591a\u3002\u4e3a\u4e86\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0cRflyPilot\u9009\u62e9\u4f7f\u7528\u4ea4\u53c9\u7f16\u8bd1\u7684\u65b9\u5f0f\u5728Linux\u7aef\u76f4\u63a5\u7f16\u8bd1\u5f97\u5230\u53ef\u4ee5\u7528\u5728\u6811\u8393\u6d3e\u7aef\u6267\u884c\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002","title":"2 Windows\u73af\u5883\u914d\u7f6e"},{"location":"quick_start/env_install/#21-wsl","text":"\u8fdb\u5165WSL\u540e\uff0c\u6267\u884c\u547d\u4ee4 sudo apt install cmake sudo apt install gcc-arm-linux-gnueabihf sudo apt install g++-arm-linux-gnueabihf sudo apt install sshpass","title":"2.1 WSL\u73af\u5883\u914d\u7f6e"},{"location":"quick_start/env_install/#22-rflypilot","text":"RflyPilot\u7684\u6e90\u7801\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u90e8\u5206\uff1aRflyPilot\u98de\u63a7\u7cfb\u7edf\u63a5\u53e3\uff08C++\u4ee3\u7801\uff09\u4e0e\u7528\u4e8e\u98de\u63a7\u8bbe\u8ba1\u7684\u6a21\u578b\u6587\u4ef6(MATLAB)\u3002 RflyPilot\u6e90\u7801: https://gitee.com/RflyBUAA/RflyPilot.git RflyPilot MATLAB\u6e90\u7801: https://gitee.com/RflyBUAA/RflyPilot_Model.git \u4f7f\u7528\u547d\u4ee4 git clone https://gitee.com/RflyBUAA/RflyPilot.git git clone https://gitee.com/RflyBUAA/RflyPilot_Model.git RflyPilot\u98de\u63a7\u7cfb\u7edf\u63a5\u53e3\u91c7\u7528\u9ad8\u6548\u7684C++\u4ee3\u7801\u5b8c\u6210\uff0c\u4e3aRflyPilot\u63d0\u4f9b\u57fa\u672c\u7684\u98de\u63a7\u529f\u80fd\uff0c\u5305\u62ec\u4f20\u611f\u5668\u8bfb\u53d6\u4efb\u52a1\u3001\u6267\u884c\u5668\u8f93\u51fa\u4efb\u52a1\u3001\u63a7\u5236\u5668\u4e0e\u72b6\u6001\u4f30\u8ba1\u63a5\u53e3\u3001\u65e5\u5fd7\u7cfb\u7edf\u3001\u4f20\u611f\u5668\u6821\u51c6\u6a21\u5757\u7b49\u7b49\u3002\u5728\u5e38\u89c4\u7684\u98de\u63a7\u7b97\u6cd5\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u4fee\u6539\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u3002 \u98de\u63a7\u6a21\u578b\u6587\u4ef6\u4e3b\u8981\u5305\u542b\u63a7\u5236\u5668\u6a21\u578b\u3001\u65e0\u4eba\u673a\u6a21\u578b\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u6a21\u578b\u7b49\u3002\u8fd9\u90e8\u5206\u6a21\u578b\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u4eff\u771f\uff0c\u7528\u4e8e\u524d\u671f\u7684\u63a7\u5236\u7cfb\u7edf\u9a8c\u8bc1\u3002\u8bbe\u8ba1\u597d\u7684\u98de\u63a7\u53ef\u4ee5\u8fdb\u884c\u4ee3\u7801\u751f\u6210\uff0c\u8fdb\u800c\u5d4c\u5165\u5230RflyPilot\u98de\u63a7\u7cfb\u7edf\u4e2d\u3002\u8fd9\u90e8\u5206\u5185\u5bb9\u662f\u5f00\u53d1\u8005\u9700\u8981\u7ecf\u5e38\u4fee\u6539\u8c03\u8bd5\u7684\u5185\u5bb9\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u5904\u7406\u4ee3\u7801\u8fc1\u79fb\u4e0e\u7f16\u8bd1\u7684\u95ee\u9898\uff0c\u8bfe\u9898\u7ec4\u4e5f\u9488\u5bf9\u6027\u5730\u5f00\u53d1\u4e86\u4e00\u5957\u5de5\u5177\u2014\u2014RflyPilotTools\uff0c\u7528\u4e8e\u7b80\u5316\u590d\u6742\u7684\u64cd\u4f5c\u6d41\u7a0b\u3002 \u7531\u4e8eMATLAB\u6a21\u578b\u4e2d\u8fd8\u672a\u5305\u542b\u72b6\u6001\u4f30\u8ba1\u6a21\u578b\u548c\u65e0\u4eba\u673a\u6a21\u578b\uff0c\u8fd8\u9700\u8981\u6267\u884c\u5b50\u6a21\u5757\u66f4\u65b0\u6307\u4ee4\uff0c\u65b9\u53ef\u5b8c\u6210\u5bf9\u6a21\u578b\u7684\u5b8c\u6574\u4e0b\u8f7d\u3002 cd RflyPilot_Model git submodule update --init --recursive cd Estimator git checkout master cd ../Model git checkout master cd ..","title":"2.2 RflyPilot\u6e90\u7801\u4e0b\u8f7d"},{"location":"quick_start/env_install/#23","text":". \u251c\u2500\u2500 Estimator \u2502 \u251c\u2500\u2500 AttitudeEstimator.slx\uff08\u59ff\u6001\u4f30\u8ba1\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 AttitudeEstimatorParameters.m\uff08\u59ff\u6001\u4f30\u8ba1\u5668\u7684\u53c2\u6570\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 Estimator.sldd\uff08\u7528\u4e8e\u5b58\u50a8\u4f30\u8ba1\u5668\u53c2\u6570\uff09 \u2502 \u251c\u2500\u2500 Inteface.sldd\uff08\u4ee3\u7801\u751f\u6210\u7684\u63a5\u53e3\u5b9a\u4e49\u6587\u4ef6\uff09 \u2502 \u251c\u2500\u2500 PositionEstimator.slx\uff08\u4f4d\u7f6e\u4f30\u8ba1\u5668\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 PositionEstimatorParameters.m\uff08\u4f4d\u7f6e\u4f30\u8ba1\u5668\u7684\u53c2\u6570\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 README.md \u2502 \u251c\u2500\u2500 doc \u2502 \u2502 \u2514\u2500\u2500 estimatordoc.tex\uff08\u72b6\u6001\u4f30\u8ba1\u7684\u8bf4\u660e\u6587\u6863\uff09 \u251c\u2500\u2500 MATLABApp \u2502 \u2514\u2500\u2500 RflyPilotToolBox.mlappinstall\uff08RflyPilot\u5b89\u88c5\u5305\uff09 \u251c\u2500\u2500 MIL \u2502 \u251c\u2500\u2500 ControlInit_vz.m\uff08\u63a7\u5236\u5668\u521d\u59cb\u5316\u811a\u672c\uff09 \u2502 \u251c\u2500\u2500 MPCControllerCodeGen_Vz.slx\uff08\u56db\u65cb\u7ffcNMPC\u63a7\u5236\u5668\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 MPC_HIL.slx\uff08\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 README.txt \u2502 \u251c\u2500\u2500 SIH_Model.slx\uff08SIH\u4eff\u771f\u6a21\u578b\uff09 \u2502 \u251c\u2500\u2500 quad_make_solver_vz.m\uff08\u7528\u4e8e\u751f\u6210\u56db\u65cb\u7ffcNMPC\u6c42\u89e3\u5668\uff09 \u2502 \u2514\u2500\u2500 usrController.slx\uff08\u7528\u4e8e\u4ee3\u7801\u751f\u6210\u7684\u63a7\u5236\u5668\u6a21\u578b\uff09 \u251c\u2500\u2500 Model \u2502 \u251c\u2500\u2500 H250Model.slx\uff08\u56db\u65cb\u7ffc\u6a21\u578b\u6587\u4ef6\uff09 \u2502 \u251c\u2500\u2500 ModelParam_H2504S.m\uff08\u56db\u65cb\u7ffc\u6a21\u578b\u53c2\u6570\u521d\u59cb\u5316\u6587\u4ef6\uff09 \u251c\u2500\u2500 RflyPilot_Model.prj\uff08\u5de5\u7a0b\u6587\u4ef6\uff09 \u251c\u2500\u2500 cache \u251c\u2500\u2500 debug_tools\uff08\u7528\u4e8e\u5b58\u653eRflyPilot\u7684\u5728\u7ebf\u793a\u6ce2\u5668\uff09 \u251c\u2500\u2500 i2c2pwm \u251c\u2500\u2500 log_analysis\uff08\u7528\u4e8elog\u5b58\u50a8\u4e0e\u5206\u6790\u7684\u6587\u4ef6\uff09 \u251c\u2500\u2500 mathlib\uff08\u6570\u5b66\u5e93\uff09 \u251c\u2500\u2500 nmpc_solver_vz.cpp\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 nmpc_solver_vz.tlc\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 nmpc_solver_vz_wrapper.cpp\uff08nmpc\u6c42\u89e3\u5668\u76f8\u5173\u6587\u4ef6\uff09 \u251c\u2500\u2500 resources (Simulink\u5de5\u7a0b\u7f13\u5b58\u6587\u4ef6) \u251c\u2500\u2500 simulink_codegen\uff08\u4ee3\u7801\u751f\u6210\u7684\u76ee\u6807\u6587\u4ef6\u5939\uff09 \u2514\u2500\u2500 swfiles\uff08RflyPilot\u98de\u63a7\u5916\u58f33D\u6253\u5370\u6587\u4ef6\uff09","title":"2.3 \u6587\u4ef6\u7ec4\u7ec7\u7ed3\u6784"},{"location":"quick_start/env_install/#3-mil","text":"\u672c\u5c0f\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u8fd0\u884c\u6570\u503c\u4eff\u771f\uff0c\u5373\u6a21\u578b\u5728\u73af\u4eff\u771f\u3002","title":"3 \u6a21\u578b\u7684\u8fd0\u884c(MIL)"},{"location":"quick_start/env_install/#31","text":"\u9996\u5148\u5728MATLAB\u4e2d\u6253\u5f00\u5de5\u7a0b\u6587\u4ef6 RflyPilot_Model.prj \uff0c\u7136\u540e\u5206\u522b\u8fd0\u884c\u5982\u4e0b\u811a\u672c MIL/ControlInit_vz.m Estimator/AttitudeEstimatorParameters.m Estimator/PositionEstimatorParameters.m Model/ModelParam_H2504S.m \u6ce8\u610f \u4e3a\u907f\u514d\u540e\u7eed\u4eff\u771f\u8fc7\u7a0b\u4e2d\u6587\u4ef6\u8def\u5f84\u53d1\u751f\u9519\u8bef\u7b49\u95ee\u9898 \u5f3a\u70c8 \u5efa\u8bae\u5728\u540e\u7eed\u8fdb\u884c\u4eff\u771f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5de5\u4f5c\u76ee\u5f55\u4f9d\u7136\u4fdd\u6301\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u5373 RflyPilot_Model \u76ee\u5f55\u4e0b\u3002","title":"3.1 \u4eff\u771f\u53c2\u6570\u521d\u59cb\u5316"},{"location":"quick_start/env_install/#32","text":"\u6253\u5f00MIL/MIL_HIL.slx\u6a21\u578b \u8fd9\u662f\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff0c\u5b83\u6574\u5408\u4e86\u9065\u63a7\u5668\u8f93\u5165\u63a5\u53e3\uff0c\u63a7\u5236\u5668\uff0c\u65e0\u4eba\u673a\u6a21\u578b\uff0c\u72b6\u6001\u4f30\u8ba1\u5668\u4ee5\u53ca3D\u663e\u793a\u8f93\u51fa\u6a21\u5757\uff0c\u662f\u4e00\u4e2a\u8f83\u4e3a\u5168\u9762\u7684\u4eff\u771f\u6a21\u578b\u3002\u8fd9\u91cc\u7684\u63a7\u5236\u5668\u4e0e\u65e0\u4eba\u673a\u6a21\u578b\u90e8\u5206\u5747\u4f7f\u7528\u4e86Simulink\u7684ModelReferance\u529f\u80fd(\u7c7b\u4f3c\u4e0e\u51fd\u6570\u8c03\u7528)\uff0c\u901a\u8fc7\u89c4\u8303\u5316\u6a21\u578b\u8f93\u5165\u8f93\u51fa\u63a5\u53e3\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u5b50\u6a21\u578b\uff0c\u5982\uff0c\u63a7\u5236\u5668\u6a21\u578b\u8c03\u7528\u4e86 MPCControllerCodeGen.slx \uff0c\u800c\u65e0\u4eba\u673a\u6a21\u578b\u5219\u8c03\u7528\u4e86 H250Model.slx \uff0c\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u5219\u5728\u5185\u90e8\u5206\u522b\u8c03\u7528\u4e86 AttitudeEstimator \u4e0e PostionEstimator \u3002\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5728\u90e8\u7f72\u5b8c NMPC\u6c42\u89e3\u5668 \u540e\uff0c\u53ef\u4ee5\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u751f\u6210 nmpc_solver_vz.mexw64 \u3002\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u7efc\u5408\u4eff\u771f\u6a21\u578b\uff0c\u5e76\u6253\u5f00 RflySim3D \uff0c\u8fdb\u884c\u4f4d\u59ff\u663e\u793a\u3002\u9ed8\u8ba4\u6a21\u578b\u91c7\u7528Dashboard\u8fdb\u884c\u6307\u4ee4\u8f93\u5165\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff08\u5728Viewer\u4e2d\uff09\u3002 \u6ce8\u610f \u9700\u8981\u4fdd\u8bc1NMPC\u6c42\u89e3\u5668\u6e90\u7801\u6587\u4ef6\u5939 acado_MPC \u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u540c\u65f6\u786e\u4fdd\u5176\u5df2\u7ecf\u52a0\u8f7d\u5230\u5de5\u7a0b\u7d22\u5f15\u8def\u5f84\u4e2d\u3002","title":"3.2 \u7efc\u5408\u4eff\u771f"},{"location":"quick_start/env_install/#4","text":"\u5728\u8fdb\u884c\u6570\u503c\u4eff\u771f\u4e4b\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u5bf9\u7cfb\u7edf\u7684\u6027\u80fd\u6709\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u5224\u65ad\u3002\u53ef\u4ee5\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u9a8c\u8bc1\u5de5\u4f5c\uff0c\u5305\u62ecHIL(\u534a\u7269\u7406\u4eff\u771f)\u3001SIH(\u786c\u4ef6\u4eff\u771f)\u3001EXP(\u5b9e\u98de\u5b9e\u9a8c)\u3002\u7136\u800c\u8fd9\u4e9b\u9a8c\u8bc1\u6a21\u5f0f\u90fd\u9700\u8981\u5c06\u4eff\u771f\u7a0b\u5e8f\u8f6c\u5316\u4e3a\u53ef\u4ee5\u8fdb\u884c\u5b9e\u9645\u90e8\u7f72\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u5c06\u8fd9\u4e9b\u6a21\u578b\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u5219\u662f\u4e00\u6761\u5fc5\u7ecf\u4e4b\u8def\u3002","title":"4 \u4ee3\u7801\u751f\u6210"},{"location":"quick_start/env_install/#41","text":"\u6253\u5f00 MIL/usrController.slx \u6a21\u578b\uff0c\u53ef\u4ee5\u770b\u5230\uff08\u4e0b\u56fe\uff09\u5176\u4e2d\u5de6\u4fa7\u4e3a\u6a21\u578b\u8f93\u5165\u63a5\u53e3\uff0c\u5176\u5747\u4e3a\u7ed3\u6784\u4f53\u7c7b\u578b\uff0c\u5176\u4e2d\u5305\u542b\u591a\u79cd\u6570\u636e\uff0c\u6a21\u578b\u53f3\u4fa7\u4e3aPWM\u4fe1\u53f7\u8f93\u51fa\u63a5\u53e3\u4e0e\u8c03\u8bd5\u6570\u636e\u8f93\u51fa\u63a5\u53e3\u3002\u5176\u4e2d\u53f3\u4fa7\u5bf9\u8bdd\u6846\u4e2d\u7684\u5916\u90e8\u6570\u636e\u7528\u4e8e\u52a0\u8f7d\u63a5\u53e3\u5b9a\u4e49\u6587\u4ef6 Interface.sldd \u3002\u8fd9\u4e2a\u6587\u4ef6\u5b9a\u4e49\u7684\u63a5\u53e3\u4e0eRflyPilot\u98de\u63a7\u4e2d\u7684C++\u4ee3\u7801\u63a5\u53e3\u4e00\u81f4\uff0c\u662f\u6c9f\u901a\u4ee3\u7801\u751f\u6210\u4e0eRflyPilot\u57fa\u7840\u7cfb\u7edf\u7684\u6865\u6881\u3002\u540c\u65f6\u8fd9\u4e2a\u6a21\u578b\u662f\u5c06\u539f\u6709 MPCControllerCodeGen_Vz.slx \u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u8fd9\u6837\u7684\u5904\u7406\u65b9\u6cd5\u6709\u5229\u4e8e\u4ee3\u7801\u751f\u6210\u540e\u63a5\u53e3\u7684\u517c\u5bb9\uff0c\u4e5f\u6709\u52a9\u4e8e\u8fdb\u884c\u63a7\u5236\u6a21\u578b\u7684\u5feb\u901f\u5207\u6362\u4e0e\u90e8\u7f72\u3002 \u5728\u4e0a\u8ff0\u8bbe\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u5373\u53ef\u5bf9\u8be5\u63a7\u5236\u5668\u6a21\u578b\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u3002\u8fdb\u5165APP\u4e0b\u7684Embedded Code\u5de5\u5177\u7bb1\uff0c\u9009\u62e9\u8fdb\u884c \u7f16\u8bd1 \u3002 Tip \u4ee3\u7801\u751f\u6210\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u9047\u5230\u9519\u8bef\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5c06acado_MPC\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u91cd\u65b0\u52a0\u8f7d\uff0c\u6216\u5c1d\u8bd5\u6e05\u9664 cache \u548c simulink_codegen \u6587\u4ef6\u5939\u4e0b\u7684\u5185\u5bb9\u540e\u91cd\u65b0\u751f\u6210\u3002 \u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u754c\u9762\u3002","title":"4.1 \u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210"},{"location":"quick_start/env_install/#42","text":"\u72b6\u6001\u4f30\u8ba1\u90e8\u5206\u7684\u4ee3\u7801\u751f\u6210\u5206\u4e3a\u59ff\u6001\u4f30\u8ba1\u5668\u4ee3\u7801\u751f\u6210\u4e0e\u4f4d\u7f6e\u4f30\u8ba1\u4ee3\u7801\u751f\u6210\u3002\u9996\u5148\u4ecb\u7ecd\u59ff\u6001\u4f30\u8ba1\u4ee3\u7801\u751f\u6210\uff0c\u6253\u5f00 Estimator/AttitudeEstimator.slx \u6a21\u578b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5176\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u4e0e\u63a7\u5236\u5668\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u9664\u4e86\u59ff\u6001\u4fe1\u606f\uff0c\u4f4d\u7f6e\u4fe1\u606f\u4e5f\u4e0d\u53ef\u6216\u7f3a\u3002\u4f4d\u7f6e\u4f30\u8ba1\u5668\u7684\u6a21\u578b\u4e3a Estimator/PositionEstimator.slx \uff0c\u4f4d\u7f6e\u4f30\u8ba1\u6a21\u578b\u7684\u4ee3\u7801\u751f\u6210\u6b65\u9aa4\u4e0e\u59ff\u6001\u4f30\u8ba1\u6a21\u578b\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u540c\u6837\u4e0d\u518d\u8d58\u8ff0\u3002 Tip \u5173\u4e8e\u72b6\u6001\u4f30\u8ba1\u7cfb\u7edf\u7684\u76f8\u5173\u4ecb\u7ecd\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003PX4\u7684Q_estimator\u548cLPE\u3002","title":"4.2 \u72b6\u6001\u4f30\u8ba1\u4ee3\u7801\u751f\u6210"},{"location":"quick_start/env_install/#43","text":"\u81f3\u6b64\uff0c\u63a7\u5236\u5668\u3001\u72b6\u6001\u4f30\u8ba1\u5668\u7684\u6a21\u578b\u5747\u5df2\u88ab\u751f\u6210\u4e3a\u4ee3\u7801\u7684\u5f62\u5f0f\uff0c\u65e0\u4eba\u673a\u7684\u4eff\u771f\u6a21\u578b\u540c\u6837\u53ef\u4ee5\u8fdb\u884c\u4ee3\u7801\u751f\u6210\uff0c\u8fd9\u91cc\u4e3b\u8981\u7528\u4f5cSIH\u4eff\u771f\u4e2d\u7684\u88ab\u63a7\u5bf9\u8c61\uff0c\u5373\u53ea\u9700\u8981\u4e00\u5171\u98de\u63a7\u786c\u4ef6\u5c3d\u53ef\u4ee5\u8fdb\u884c\u98de\u884c\u4eff\u771f\uff0c\u8fd9\u79cd\u4eff\u771f\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u9a8c\u8bc1\u63a7\u5236\u5668\u5728\u5b9e\u9645\u98de\u63a7\u5e73\u53f0\u4e2d\u7684\u8fd0\u884c\u662f\u5426\u6b63\u5e38\u3002 \u6253\u5f00\u6a21\u578b SIH_Model.slx \uff0c\u8fd9\u91cc\u540c\u6837\u4f7f\u7528\u4e86\u53c2\u8003\u6a21\u578b\u7684\u6a21\u578b\u642d\u5efa\u65b9\u5f0f\uff0c\u4f7f\u7528\u7684\u6a21\u578b\u662f Model/H250Model2.slx \uff08\u4e0e\u6570\u503c\u4eff\u771f\u6a21\u578b Model/H250Model.slx \u7684\u533a\u522b\u8be6\u89c1 Model/README.md \uff09\uff0c\u4f7f\u7528\u7684\u63a5\u53e3\u6587\u4ef6\u540c\u6837\u662f Interface.sldd \uff0c\u5176\u4ee3\u7801\u751f\u6210\u65b9\u5f0f\u4e5f\u4e0d\u518d\u8d58\u8ff0\u4e86\u3002 Tip \u5728\u751f\u6210\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9047\u5230\u5982\u4e0b\u62a5\u9519\uff0c\u76f4\u63a5\u70b9\u51fb\u201c\u4fee\u590d\u201d\u5373\u53ef\u3002","title":"4.3 \u65e0\u4eba\u673a\u6a21\u578b\u4ee3\u7801\u751f\u6210"},{"location":"quick_start/env_install/#5-rflypilot","text":"","title":"5 \u4ee3\u7801\u7684\u90e8\u7f72\u7f16\u8bd1\u4e0eRflyPilot"},{"location":"quick_start/env_install/#51","text":"\u5c06\u56db\u5927\u529f\u80fd\u6a21\u5757\u8fdb\u884c\u4ee3\u7801\u751f\u6210\u540e\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff0c\u5728 simulink_codegen \u6587\u4ef6\u5939\u4e0b\u3002\u53ef\u4ee5\u770b\u5230\u751f\u6210\u7684\u4ee3\u7801\u5df2\u88ab\u6253\u5305\u4e3azip\u6587\u4ef6\u3002 \u5982\u4f55\u5c06\u5176\u751f\u6210\u7684\u4ee3\u7801\u90e8\u7f72\u5230\u5b9e\u9645\u98de\u63a7\u4e2d\u5462\uff1f\u6b64\u65f6\u5c31\u9700\u8981\u901a\u8fc7RflyPilotTools\u8fdb\u884c\u8854\u63a5\u3002 RflyPilotTools\u662f\u4e00\u6b3e\u57fa\u4e8eMATLAB\u7684\u5de5\u5177\u7bb1\uff0c\u5b83\u7684\u5b89\u88c5\u5305\u4f4d\u4e8e MATLABApp/RflyPilotToolBox.mlappinstall \uff0c\u5728\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\uff0c\u53cc\u51fb\u5373\u53ef\u5b89\u88c5\uff0c\u6700\u7ec8\u4f1a\u663e\u793a\u5728MATLAB\u5de5\u5177\u7bb1\u754c\u9762\u4e2d\u3002 \u9996\u6b21\u4f7f\u7528RflyPilotTool\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u914d\u7f6e\uff0c\u4e3b\u8981\u914d\u7f6e\u9009\u9879\u4e3a RflyPilot Path \uff0c\u5373RflyPilot\u6e90\u7801\u7684\u8def\u5f84\uff0c\u81f3\u4e8e CodeGen Path \u4e0e Unzip Path \u5219\u5206\u522b\u4e3a\u4ee3\u7801\u751f\u6210\u6e90\u7801\u7684\u8def\u5f84\u548c\u751f\u6210\u538b\u7f29\u5305\u7684\u8def\u5f84\uff0c\u8fd9\u91cc\u4fdd\u6301\u9ed8\u8ba4\u5373\u53ef\u3002\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u201cSave Setting\u201d\uff0c\u5373\u53ef\u4fdd\u6301\u914d\u7f6e\u5230\u5de5\u7a0b\u6839\u76ee\u5f55\u4e0b\u7684 rflypilottoolbox.mat \u4e2d\u3002 \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u4f9d\u6b21\u70b9\u51fb\u201cUpdate Estimator\u201d \u201cUpdate SIH Model\u201d \u201cUpdate Controller\"\u5373\u53ef\u505a\u5230\u201c\u4e00\u952e\u90e8\u7f72\u201d\uff0c\u5373\u5c06\u4ee3\u7801\u590d\u5236\u5230\u76f8\u5e94\u7684\u6e90\u7801\u6587\u4ef6\u5939\u4e2d\u3002\u4e0e\u4e4b\u5bf9\u5e94\u7684\u6587\u4ef6\u5939\u5206\u522b\u4e3a estimator_codegen , sih_codegen , controller_codegen \u3002\u5728\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u8bfb\u8005\u53ef\u4ee5\u5728\u81ea\u884c\u53bb\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u67e5\u770b\u76f8\u5e94\u7684\u6e90\u7801\u3002","title":"5.1 \u4ee3\u7801\u90e8\u7f72"},{"location":"quick_start/env_install/#52-rflypilot","text":"RflyPilot\u7684\u4ea4\u53c9\u7f16\u8bd1\u662f\u5728WSL\u7cfb\u7edf\u4e2d\u8fdb\u884c\u7684\u3002\u4f46\u5f97\u76ca\u4e8eRflyPilotTool\uff0c\u8fd9\u4e2a\u6b65\u9aa4\u88ab\u8fdb\u4e00\u6b65\u7b80\u5316\u3002 \u9996\u5148\u5728RflyPilot\u6e90\u7801\u6587\u4ef6\u5939\u4e2d\u521b\u5efa build \u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u3002\u7136\u540e\u5728RflyPilotTool\u4e2d\uff0c\u70b9\u51fb\u201cBuild\u201d\uff0c\u5373\u53ef\u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\u3002\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u8f93\u51fa\u53ef\u4ee5\u5728MATLAB\u547d\u4ee4\u884c\u4e2d\u67e5\u770b\u3002 \u8f93\u51fa\u7ed3\u679c\u4e3a -- Configuring done -- Generating done -- Build files have been written to: /mnt/d/nash.zhao/RflyPilot_DEMO/RflyPilot/build [ 14%] Built target confc [ 20%] Built target controller_codegen [ 27%] Built target basic_controller_codegen [ 31%] Built target libsbus [ 40%] Built target estimator_codegen [ 55%] Built target sih_codegen Scanning dependencies of target rflypilot [ 56%] Building CXX object CMakeFiles/rflypilot.dir/src/application/attitudeEstimator_thread.cpp.o [ 57%] Building CXX object CMakeFiles/rflypilot.dir/src/application/ulog_thread.cpp.o [ 57%] Building CXX object CMakeFiles/rflypilot.dir/src/application/usrController_thread.cpp.o [ 58%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/norm_afMWvhHe.cpp.o [ 59%] Building CXX object CMakeFiles/rflypilot.dir/src/application/system_app.cpp.o [ 60%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/norm_a2pQkYtO.cpp.o [ 61%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rtGetInf.cpp.o [ 62%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rtGetNaN.cpp.o [ 63%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_atan2d_snf.cpp.o [ 63%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_atan2f_snf.cpp.o [ 64%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_nonfinite.cpp.o [ 65%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_r32zcfcn.cpp.o [ 66%] Building CXX object CMakeFiles/rflypilot.dir/src/simulink_utility/rt_zcfcn.cpp.o [ 67%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/px4lib/test_time.cpp.o [ 68%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/posix/i2c.cpp.o [ 68%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/posix/spi.cpp.o [ 69%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/actuator/pca9685/pca9685.cpp.o [ 70%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/actuator/fpga/actuator_fpga.cpp.o [ 71%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/rc/sbus/sbus_api.cpp.o [ 72%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/icm42688p/ICM42688P.cpp.o [ 73%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/icm20689new/ICM20689.cpp.o [ 73%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/gyroscope/PX4Gyroscope.cpp.o [ 74%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/imu/accelerometer/PX4Accelerometer.cpp.o [ 75%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/magnetometer/ist8310/ist8310.cpp.o [ 76%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/magnetometer/qmc5883l/QMC5883L.cpp.o [ 77%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/barometer/ms5611/ms5611.cpp.o [ 78%] Building CXX object CMakeFiles/rflypilot.dir/src/drivers/gps/gps_api.cpp.o [ 78%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_tty_linux.c.o [ 79%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_low_latency_linux.c.o [ 80%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/tty/sbus_low_latency_none.c.o [ 81%] Building CXX object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/decoder/DecoderFSM.cpp.o [ 82%] Building C object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/decoder/packet_decoder.c.o [ 83%] Building CXX object CMakeFiles/rflypilot.dir/src/3rdparty/sbus/src/driver/SBUS.cpp.o [ 83%] Linking CXX executable rflypilot [100%] Built target rflypilot \u5176\u80cc\u540e\u5728WSL\u4e2d\u6267\u884c\u7684\u547d\u4ee4\u4e3a cd build cmake .. && make -j128","title":"5.2 RflyPilot\u7f16\u8bd1"},{"location":"quick_start/env_install/#53","text":"\u4ea4\u53c9\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5c06\u5728 build \u76ee\u5f55\u4e0b\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6 rflypilot \uff0c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u53ea\u80fd\u8fd0\u884c\u4e8e\u6811\u8393\u6d3e\u7cfb\u7edf\u4e2d\u3002\u6545\u9700\u8981\u4e0a\u4f20\u5230\u6811\u8393\u6d3e\u4e2d\u624d\u53ef\u4ee5\u8fd0\u884c\u3002\u4e8e\u6b64\u540c\u65f6\uff0c\u9664\u4e86 rflypilot \u6587\u4ef6\u4ee5\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u88ab\u540c\u65f6\u4e0a\u4f20\u5230\u6811\u8393\u6d3e\u4e2d config/parameter.txt \u2014\u2014\u7528\u4e8e\u5b58\u50a8\u81ea\u5b9a\u4e49\u7684\u98de\u63a7\u53c2\u6570 config/rflypilot.txt \u2014\u2014RflyPilot\u914d\u7f6e\u6587\u4ef6 \u70b9\u51fb\u201cUpload\u201d\u540e\uff0c\u5373\u53ef\u5728RflyPilot\u98de\u63a7\u4e2d\u770b\u5230\u66f4\u65b0\u540e\u7684\u6587\u4ef6\u3002 \u6ce8\u610f \u7b2c\u4e00\u6b21\u4e0b\u8f7d\u9700\u8981\u63d0\u524d\u7528WSL ubuntu 18.04\u767b\u5f55\u6811\u8393\u6d3e\u7684SSH, \u5e76\u5efa\u7acb\u6587\u4ef6\u5939RflyPilot_Project\\RflyPilot pi@navio:~ $ cd RflyPilot_Project/RflyPilot/ pi@navio:~/RflyPilot_Project/RflyPilot $ ls parameter.txt rflypilot rflypilot.txt pi@navio:~/RflyPilot_Project/RflyPilot $ \u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u4e86\u98de\u63a7\u7a0b\u5e8f\u7684\u90e8\u7f72\u3002","title":"5.3 \u98de\u63a7\u7a0b\u5e8f\u90e8\u7f72"},{"location":"quick_start/env_install/#6-sih","text":"\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u8fd9\u91cc\u4ee5SIH\u4eff\u771f\u4e3a\u4f8b\uff0c\u8fdb\u884c\u98de\u63a7\u7684\u8fd0\u884c\u9a8c\u8bc1\u3002 \u9996\u5148\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u8fd0\u884c\u6a21\u5f0f\u4fee\u6539\u4e3aSIH\u6a21\u5f0f\uff0c\u5373\uff0c valid_mode = 1 \u3002\u7136\u540e\u5c06 scope_ip \u4e0e station_ip \u4fee\u6539\u4e3a\u7535\u8111IP\u3002 \u6ce8\u610f \u8981\u6ce8\u610f\u5728 = \u4e24\u7aef\u5b58\u5728\u4e24\u4e2a\u7a7a\u683c\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fdd\u7559\u6b64\u7a7a\u683c\uff01 ########################### SYSTEM PARAMETER ################### #validation mode SIH:1 HIL:2 EXP:3 OFFBOARD:4 valid_mode = 1 #SIH mode use real state sih_use_real_state = 1 #system sample rate imu_rate = 800 mag_rate = 95 # max rate 100Hz controller_rate = 333 attitude_est_rate = 500 lpe_rate = 500 #imu cutoff in Hz accel_cutoff_hz = 50 gyro_cutoff_hz = 50 #scheduler_mode delay:1 adaptive_delay:2 timer:3(NOT RECOMMENDED!) scheduler_mode = 2 # msg logger enable sys_log_en = 1 est_log_en = 0 ctrl_log_en = 1 # msg scope enable sys_scope_en = 1 est_scope_en = 0 ctrl_scope_en = 1 # string scope_ip = \"192.168.199.233\" # 152 station_ip = \"192.168.199.233\" log_dir = \".\" ########################## USER DEFINED PARAMETER ######################### \u7136\u540e\u901a\u8fc7\u547d\u4ee4 ./rflypilot \u5373\u53ef\u8fd0\u884c\u98de\u63a7\u4e8eSIH\u6a21\u5f0f\u3002 \u7cfb\u7edf\u542f\u52a8\u65f6\uff0c\u754c\u9762\u5982\u4e0b Tip \u6b64\u65f6\u5e94\u4ed4\u7ec6\u89c2\u5bdf\u8c03\u8bd5\u8f93\u51fa\u4fe1\u606f\uff0c\u67e5\u770b\u662f\u5426\u5b58\u5728\u5f02\u5e38\u73b0\u8c61\u3002 \u7cfb\u7edf\u6b63\u5e38\u542f\u52a8\u540e\uff0c\u754c\u9762\u5982\u4e0b \u6b64\u65f6\u6309 Ctrl+C \u952e\u5373\u53ef\u4e2d\u6b62\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002","title":"6 \u98de\u63a7\u7684\u8fd0\u884c\uff08SIH\uff09"},{"location":"quick_start/env_install/#7-sih","text":"\u57fa\u4e8e\u4ee5\u4e0a\u5185\u5bb9\uff0c\u8bfb\u8005\u5df2\u7ecf\u5b8c\u6210\u4e86\u4ece\u73af\u5883\u5b89\u88c5\u5230\u6a21\u578b\u4eff\u771f\uff08MIL\uff09\uff0c\u518d\u5230\u4ee3\u7801\u751f\u6210\u3001\u8fd0\u884c\u98de\u63a7\u7684\u5168\u6d41\u7a0b\u3002\u7b14\u8005\u4ee5SIH\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4eff\u771f\u7684\u57fa\u672c\u6d41\u7a0b\u548c\u64cd\u4f5c\u3002","title":"7 SIH\u4eff\u771f"},{"location":"quick_start/env_install/#71","text":"\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u98de\u63a7\u8f6f\u4ef6\u548c\u88ab\u63a7\u5bf9\u8c61\u90fd\u8fd0\u884c\u5728RflyPilot\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8fde\u63a5\u5230\u98de\u884c\u5668\u672c\u4f53\u4e0a\uff0c\u4f46\u662f\u7531\u4e8e\u4eff\u771f\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8f93\u5165\u63a7\u5236\u6307\u4ee4\uff0c\u6b64\u65f6\uff0c\u8fd8\u9700\u8981\u5c06\u9065\u63a7\u5668\u7684\u63a5\u6536\u673a\u8fde\u63a5\u5230RflyPilot\u4e0a\u3002 \u6545\u5728SIH\u4eff\u771f\u6a21\u5f0f\u4e0b\uff0c\u786c\u4ef6\u51c6\u5907\u4e0a\uff0c\u53ea\u9700\u8981RflyPilot\u4e0e\u9065\u63a7\u5668\u548c\u63a5\u6536\u673a\uff0c\u6700\u540e\u901a\u8fc7WIFI\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\uff0c\u5728RflySim3D\u4e0a\u8fdb\u884c\u663e\u793a\u3002 Scope\u793a\u6ce2\u5668\uff1a\u6253\u5f00MATLAB\u5de5\u7a0b\u6587\u4ef6\u4e2d\u7684 debug_tools/udp_recv3_ke.slx \uff0c\u8be5\u6a21\u578b\u5229\u7528Simulink\u7684UDP\u5de5\u5177\u7bb1\uff0c\u5b9e\u73b0\u4e86\u7b80\u6613\u7684\u98de\u63a7\u6570\u636e\u66f2\u7ebf\u5b9e\u65f6\u5c55\u793a\u529f\u80fd\uff0cRflyPilot\u7684\u4e00\u4e9b\u5173\u952e\u6570\u636e\uff0c\u5982\u4f4d\u7f6e\u3001\u901f\u5ea6\u3001\u59ff\u6001\u7b49\u4fe1\u606f\uff0c\u5747\u4f1a\u5728\u98de\u63a7\u8fd0\u884c\u65f6\u5b9e\u65f6\u663e\u793a\u3002\u53cc\u51fb\u6253\u5f00\u2460\u540e\uff0c\u914d\u7f6e\u2461 Remote IP address \uff0c\u8be5IP\u5e94\u8bbe\u7f6e\u4e3aRflyPilot\u7684IP\u3002\u70b9\u51fb\u201c\u786e\u5b9a\u201d\u5373\u53ef\u5b8c\u6210\u8bbe\u7f6e\uff0c\u968f\u540e\u70b9\u51fb\u201c\u8fd0\u884c\u201d\u3002 RflySim3D: RflySim3D\u662f\u4e00\u6b3e\u57fa\u4e8eUE\u5f15\u64ce\u5f00\u53d1\u7684\u98de\u884c\u5668\u89c6\u666f\u663e\u793a\u5e73\u53f0\uff0c\u5b83\u662f \u53ef\u9760\u98de\u884c\u63a7\u5236\u7ec4 \u5f00\u53d1\u7684RflySim\u5e73\u53f0\u7684\u4e00\u90e8\u5206\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u901a\u8fc7UDP\u53d1\u9001\u7279\u5b9a\u534f\u8bae\u7684\u6570\u636e\u5305\uff0c\u8fdb\u800c\u5b9e\u73b0\u63a7\u5236\u89c6\u666f\u4e2d\u65e0\u4eba\u673a\u7684\u4f4d\u7f6e\u3001\u59ff\u6001\u3001\u65cb\u7ffc\u8f6c\u901f\u7b49\uff0c\u662f\u65e0\u4eba\u673a\u63a7\u5236\u5668\u5f00\u53d1\u7684\u5229\u5668\u3002\u66f4\u591a\u7684\u4ecb\u7ecd\u8bf7\u53c2\u8003 RflySim\u5b98\u65b9\u7f51\u7ad9 \u3002Rflysim3D\u5728RflyPilot\u4e2d\u4e3b\u8981\u4f5c\u4e3a\u89c6\u666f\u663e\u793a\u8f6f\u4ef6\uff0c\u4f4d\u59ff\u6570\u636e\u4eceRflyPilot\u4e2d\u53d1\u9001\uff0c\u901a\u8fc7UDP\u534f\u8bae\uff0c\u7531RflySim3D\u8f6f\u4ef6\u8fdb\u884c\u63a5\u6536\u548c\u663e\u793a\u3002 RflySim3D\u8f6f\u4ef6\u7684\u76f8\u5173\u4f7f\u7528\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 Rflysim \u3002 Tip \u5728\u8fdb\u884cSIH\u4eff\u771f\u65f6\uff0c\u8fd0\u884cRflySim3D\u548c\u5728\u7ebf\u793a\u6ce2\u5668\u7684\u8ba1\u7b97\u673a\u548cRflyPilot\u5e94\u5904\u4e8e\u540c\u4e00\u5c40\u57df\u7f51\u4e0b","title":"7.1 \u524d\u671f\u51c6\u5907"},{"location":"quick_start/env_install/#72","text":"\u901a\u8fc7\u547d\u4ee4 ./rflypilot \u8fd0\u884c\u98de\u63a7\u5373\u53ef\uff0c\u6ce8\u610f\u6b64\u65f6\u5e94\u8be5\u8bbe\u7f6e\u597d\u98de\u63a7\u7684\u4eff\u771f\u6a21\u5f0f\u548cIP\u5730\u5740\u3002\u6253\u5f00\u9065\u63a7\u5668\u3002\u6b64\u65f6\u5728\u793a\u6ce2\u5668\u4e2d\u53ef\u4ee5\u89c2\u5bdf\u5230\u5f53\u524d\u98de\u884c\u5668\u7684\u72b6\u6001\u6570\u636e\u3002 \u901a\u9053 \u529f\u80fd \u8bf4\u660e CH1 x \u6c34\u5e73\u901a\u9053 CH2 y \u6c34\u5e73\u901a\u9053 CH3 z \u5782\u5411\u901a\u9053 CH4 yaw \u822a\u5411\u63a7\u5236 CH5 MODE* \u7528\u4e8e\u8bbe\u7f6e\u98de\u884c\u6a21\u5f0f CH6 ARM \u7528\u4e8e\u89e3\u9501(ARM>1250) \u6ce8\u610f MODE\u529f\u80fd\u672a\u660e\u786e\u5728\u4eff\u771f\u6a21\u578b\u4e2d\u5b9a\u4e49\uff0c\u8be5\u901a\u9053\u7ea6\u5b9a\u4fd7\u6210\u4e3a\u6a21\u5f0f\u5207\u6362\u901a\u9053\u3002ARM\u901a\u9053\u7684\u8bbe\u8ba1\u4e0e\u4eff\u771f\u6a21\u578b\u65e0\u5173\uff0c\u8be5\u901a\u9053\u7684\u529f\u80fd\u5728\u5e95\u5c42\u98de\u63a7\u7cfb\u7edf\u4e2d\u56fa\u5b9a\u4e3a\u89e3\u9501\u901a\u9053\u3002 Tip \u4eff\u771f\u6280\u5de7\uff1a\u4eff\u771f\u65f6\u5e94\u5148\u89e3\u9501\uff0c\u518d\u7f13\u6162\u63a8\u6cb9\u95e8\uff0c\u76f4\u81f3\u98de\u884c\u5668\u8d77\u98de","title":"7.2 \u5f00\u59cb\u4eff\u771f"},{"location":"quick_start/env_install/#_1","text":"config.txt\u6811\u8393\u6d3e\u5b98\u65b9\u8bf4\u660e \u6811\u8393\u6d3e\u8d85\u9891 \u6811\u8393\u6d3e\u914d\u7f6e\u6587\u6863config.txt\u8bf4\u660e","title":"\u53c2\u8003\u8d44\u6599"}]}